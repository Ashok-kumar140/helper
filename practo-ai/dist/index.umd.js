!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","react-dom"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).PractoAI={},e.React,e.ReactDOM)}(this,(function(e,t,n){"use strict";function r(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}function i(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const a=r(t);var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l,u={exports:{}},c={};var d,h={};
/**
   * @license React
   * react-jsx-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */"production"===process.env.NODE_ENV?u.exports=function(){if(l)return c;l=1;var e=t,n=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,r){var o,l={},u=null,c=null;for(o in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,o)&&!s.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:n,type:e,key:u,ref:c,props:l,_owner:a.current}}return c.Fragment=r,c.jsx=o,c.jsxs=o,c}():u.exports=(d||(d=1,"production"!==process.env.NODE_ENV&&function(){var e,n=t,r=Symbol.for("react.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),v=Symbol.iterator,g=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];!function(e,t,n){var r=g.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var i=n.map((function(e){return String(e)}));i.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,i)}("error",e,n)}function b(e){return e.displayName||"Context"}function y(e){if(null==e)return null;if("number"==typeof e.tag&&E("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case a:return"Fragment";case i:return"Portal";case o:return"Profiler";case s:return"StrictMode";case d:return"Suspense";case f:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case u:return b(e)+".Consumer";case l:return b(e._context)+".Provider";case c:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case p:var t=e.displayName||null;return null!==t?t:y(e.type)||"Memo";case _:var n=e,r=n._payload,h=n._init;try{return y(h(r))}catch(m){return null}}return null}e=Symbol.for("react.module.reference");var C,T,N,S,I,w,A,M=Object.assign,R=0;function D(){}D.__reactDisabledLog=!0;var k,L=g.ReactCurrentDispatcher;function x(e,t,n){if(void 0===k)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);k=r&&r[1]||""}return"\n"+k+e}var U,P=!1,F="function"==typeof WeakMap?WeakMap:Map;function B(e,t){if(!e||P)return"";var n,r=U.get(e);if(void 0!==r)return r;P=!0;var i,a=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=L.current,L.current=null,function(){if(0===R){C=console.log,T=console.info,N=console.warn,S=console.error,I=console.group,w=console.groupCollapsed,A=console.groupEnd;var e={configurable:!0,enumerable:!0,value:D,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}R++}();try{if(t){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(s,[])}catch(p){n=p}Reflect.construct(e,[],s)}else{try{s.call()}catch(p){n=p}e.call(s.prototype)}}else{try{throw Error()}catch(p){n=p}e()}}catch(_){if(_&&n&&"string"==typeof _.stack){for(var o=_.stack.split("\n"),l=n.stack.split("\n"),u=o.length-1,c=l.length-1;u>=1&&c>=0&&o[u]!==l[c];)c--;for(;u>=1&&c>=0;u--,c--)if(o[u]!==l[c]){if(1!==u||1!==c)do{if(u--,--c<0||o[u]!==l[c]){var d="\n"+o[u].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),"function"==typeof e&&U.set(e,d),d}}while(u>=1&&c>=0);break}}}finally{P=!1,L.current=i,function(){if(0==--R){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:M({},e,{value:C}),info:M({},e,{value:T}),warn:M({},e,{value:N}),error:M({},e,{value:S}),group:M({},e,{value:I}),groupCollapsed:M({},e,{value:w}),groupEnd:M({},e,{value:A})})}R<0&&E("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=a}var h=e?e.displayName||e.name:"",f=h?x(h):"";return"function"==typeof e&&U.set(e,f),f}function H(e,t,n){if(null==e)return"";if("function"==typeof e)return B(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return x(e);switch(e){case d:return x("Suspense");case f:return x("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case c:return B(e.render,!1);case p:return H(e.type,t,n);case _:var i=e,a=i._payload,s=i._init;try{return H(s(a),t,n)}catch(o){}}return""}U=new F;var G=Object.prototype.hasOwnProperty,j={},V=g.ReactDebugCurrentFrame;function q(e){if(e){var t=e._owner,n=H(e.type,e._source,t?t.type:null);V.setExtraStackFrame(n)}else V.setExtraStackFrame(null)}var z=Array.isArray;function K(e){return z(e)}function Y(e){return""+e}function W(e){if(function(e){try{return Y(e),!1}catch(O){return!0}}(e))return E("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),Y(e)}var Q,X,Z=g.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function $(e,t,n,i,a){var s,o={},l=null,u=null;for(s in void 0!==n&&(W(n),l=""+n),function(e){if(G.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(t)&&(W(t.key),l=""+t.key),function(e){if(G.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}(t)&&(u=t.ref,function(e){"string"==typeof e.ref&&Z.current}(t)),t)G.call(t,s)&&!J.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps){var c=e.defaultProps;for(s in c)void 0===o[s]&&(o[s]=c[s])}if(l||u){var d="function"==typeof e?e.displayName||e.name||"Unknown":e;l&&function(e,t){var n=function(){Q||(Q=!0,E("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}(o,d),u&&function(e,t){var n=function(){X||(X=!0,E("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}(o,d)}return function(e,t,n,i,a,s,o){var l={$$typeof:r,type:e,key:t,ref:n,props:o,_owner:s,_store:{}};return Object.defineProperty(l._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(l,"_self",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.defineProperty(l,"_source",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.freeze&&(Object.freeze(l.props),Object.freeze(l)),l}(e,l,u,a,i,Z.current,o)}var ee,te=g.ReactCurrentOwner,ne=g.ReactDebugCurrentFrame;function re(e){if(e){var t=e._owner,n=H(e.type,e._source,t?t.type:null);ne.setExtraStackFrame(n)}else ne.setExtraStackFrame(null)}function ie(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}function ae(){if(te.current){var e=y(te.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}ee=!1;var se={};function oe(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=ae();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!se[n]){se[n]=!0;var r="";e&&e._owner&&e._owner!==te.current&&(r=" It was passed a child from "+y(e._owner.type)+"."),re(e),E('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,r),re(null)}}}function le(e,t){if("object"==typeof e)if(K(e))for(var n=0;n<e.length;n++){var r=e[n];ie(r)&&oe(r,t)}else if(ie(e))e._store&&(e._store.validated=!0);else if(e){var i=function(e){if(null===e||"object"!=typeof e)return null;var t=v&&e[v]||e["@@iterator"];return"function"==typeof t?t:null}(e);if("function"==typeof i&&i!==e.entries)for(var a,s=i.call(e);!(a=s.next()).done;)ie(a.value)&&oe(a.value,t)}}function ue(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==c&&n.$$typeof!==p)return;t=n.propTypes}if(t){var r=y(n);!function(e,t,n,r,i){var a=Function.call.bind(G);for(var s in e)if(a(e,s)){var o=void 0;try{if("function"!=typeof e[s]){var l=Error((r||"React class")+": "+n+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw l.name="Invariant Violation",l}o=e[s](t,s,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(u){o=u}!o||o instanceof Error||(q(i),E("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,s,typeof o),q(null)),o instanceof Error&&!(o.message in j)&&(j[o.message]=!0,q(i),E("Failed %s type: %s",n,o.message),q(null))}}(t,e.props,"prop",r,e)}else void 0===n.PropTypes||ee||(ee=!0,E("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",y(n)||"Unknown"));"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||E("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function ce(t,n,i,h,v,g){var b=function(t){return"string"==typeof t||"function"==typeof t||t===a||t===o||t===s||t===d||t===f||t===m||"object"==typeof t&&null!==t&&(t.$$typeof===_||t.$$typeof===p||t.$$typeof===l||t.$$typeof===u||t.$$typeof===c||t.$$typeof===e||void 0!==t.getModuleId)}(t);if(!b){var C,T="";(void 0===t||"object"==typeof t&&null!==t&&0===Object.keys(t).length)&&(T+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),T+=ae(),null===t?C="null":K(t)?C="array":void 0!==t&&t.$$typeof===r?(C="<"+(y(t.type)||"Unknown")+" />",T=" Did you accidentally export a JSX literal instead of a component?"):C=typeof t,E("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",C,T)}var N=$(t,n,i,v,g);if(null==N)return N;if(b){var S=n.children;if(void 0!==S)if(h)if(K(S)){for(var I=0;I<S.length;I++)le(S[I],t);Object.freeze&&Object.freeze(S)}else E("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else le(S,t)}return t===a?function(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var r=t[n];if("children"!==r&&"key"!==r){re(e),E("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),re(null);break}}null!==e.ref&&(re(e),E("Invalid attribute `ref` supplied to `React.Fragment`."),re(null))}(N):ue(N),N}var de=function(e,t,n){return ce(e,t,n,!1)},he=function(e,t,n){return ce(e,t,n,!0)};h.Fragment=a,h.jsx=de,h.jsxs=he}()),h);var f=u.exports,p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var m=function(){return m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},m.apply(this,arguments)};function v(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function g(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))}function E(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(O){o=[6,O],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function b(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var y=function(e,t){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var T=function(){return T=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},T.apply(this,arguments)};function N(e,t,n,r){return new(n||(n=Promise))((function(t,i){function a(e){try{o(r.next(e))}catch(t){i(t)}}function s(e){try{o(r.throw(e))}catch(t){i(t)}}function o(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(a,s)}o((r=r.apply(e,[])).next())}))}function S(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function I(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(o){i={error:o}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s}function A(e,t,n){if(2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var M,O,R="4.17.2",D=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return R},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();(O=M||(M={}))[O.NON_AUTHORIZED=400108]="NON_AUTHORIZED",O[O.INVALID_TOKEN=400111]="INVALID_TOKEN",O[O.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",O[O.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",O[O.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",O[O.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",O[O.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",O[O.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",O[O.SESSION_REVOKED=400310]="SESSION_REVOKED",O[O.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",O[O.INVALID_AUTH_FOR_SERVICE=400313]="INVALID_AUTH_FOR_SERVICE",O[O.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",O[O.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",O[O.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",O[O.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",O[O.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",O[O.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",O[O.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",O[O.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",O[O.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",O[O.LOST_INSTANCE=700100]="LOST_INSTANCE",O[O.CONNECTION_RENEW=700102]="CONNECTION_RENEW",O[O.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",O[O.INVALID_COMMAND=700700]="INVALID_COMMAND",O[O.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",O[O.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",O[O.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",O[O.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",O[O.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",O[O.INVALID_PARAMETER=800110]="INVALID_PARAMETER",O[O.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",O[O.NETWORK_ERROR=800120]="NETWORK_ERROR",O[O.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",O[O.MALFORMED_DATA=800130]="MALFORMED_DATA",O[O.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",O[O.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",O[O.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",O[O.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",O[O.ACK_TIMEOUT=800180]="ACK_TIMEOUT",O[O.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",O[O.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",O[O.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",O[O.REQUEST_FAILED=800220]="REQUEST_FAILED",O[O.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",O[O.REQUEST_CANCELED=800240]="REQUEST_CANCELED",O[O.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",O[O.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",O[O.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED=800270]="ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED",O[O.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",O[O.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",O[O.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",O[O.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",O[O.DATABASE_ERROR=800700]="DATABASE_ERROR",O[O.USER_DEACTIVATED=900021]="USER_DEACTIVATED",O[O.CHANNEL_IS_FROZEN=900050]="CHANNEL_IS_FROZEN",O[O.RECEIVER_USER_DEACTIVATED=900081]="RECEIVER_USER_DEACTIVATED";var k,L,x,U,P,F,B=function(e){return!(e instanceof H&&!e.shouldThrowOutside)},H=function(e){function t(n){var r=n.code,i=void 0===r?0:r,a=n.message,s=void 0===a?"":a,o=e.call(this,s)||this;return o.shouldThrowOutside=!1,o._detail="",o.name="SendbirdError",o.code=i,Object.setPrototypeOf(o,t.prototype),o}return C(t,e),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),t.prototype.setDetail=function(e){this._detail=e},Object.defineProperty(t.prototype,"isInvalidTokenError",{get:function(){return this.code===M.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiredError",{get:function(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===M.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===M.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionInvalidatedError",{get:function(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionRevokedError",{get:function(){return this.code===M.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===M.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===M.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isNetworkError",{get:function(){return this.code===M.NETWORK_ERROR||this.code===M.NETWORK_ROUTING_ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(t,"debugModeRequired",{get:function(){return new t({code:M.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"lostInstance",{get:function(){return new t({code:M.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidCommand",{get:function(){return new t({code:M.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unknown",{get:function(){return new t({code:M.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRenew",{get:function(){return new t({code:M.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidConnectionStateTransition",{get:function(){return new t({code:M.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"xmlHttpRequestNotSupported",{get:function(){return new t({code:M.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRequired",{get:function(){return new t({code:M.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionCanceled",{get:function(){return new t({code:M.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidParameters",{get:function(){return new t({code:M.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"notSupportedError",{get:function(){return new t({code:M.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"channelTypeNotSupportedError",{get:function(){return new t({code:M.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"networkError",{get:function(){return new t({code:M.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"markAsReadAllRateLimitExceeded",{get:function(){return new t({code:M.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"queryInProgress",{get:function(){return new t({code:M.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"noAckTimeout",{get:function(){return new t({code:M.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"loginTimeout",{get:function(){return new t({code:M.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionClosed",{get:function(){return new t({code:M.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestFailed",{get:function(){return new t({code:M.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"tooManyRequests",{get:function(){return new t({code:M.REQUEST_DUPLICATED,message:"Too many requests."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"alreadyConnectedAsAnotherUser",{get:function(){return new t({code:M.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileUploadCanceled",{get:function(){return new t({code:M.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestCanceled",{get:function(){return new t({code:M.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRefreshFailed",{get:function(){return new t({code:M.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRequestFailed",{get:function(){return new t({code:M.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseError",{get:function(){return new t({code:M.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileSizeLimitExceededError",{get:function(){return new t({code:M.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"statLogUploadLimitExceededError",{get:function(){return new t({code:M.ERR_UPLOAD_STAT_RETRY_COUNT_EXCEEDED,message:"The upload request failed due to the retry count being exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"malformedDataError",{get:function(){return new t({code:M.MALFORMED_DATA,message:"Malformed data."})},enumerable:!1,configurable:!0}),t.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},t}(Error),G=[M.CONNECTION_REQUIRED,M.NETWORK_ERROR,M.ACK_TIMEOUT,M.WEBSOCKET_CONNECTION_CLOSED,M.WEBSOCKET_CONNECTION_FAILED,M.FILE_UPLOAD_CANCEL_FAILED,M.REQUEST_CANCELED,M.INTERNAL_SERVER_ERROR,M.RATE_LIMIT_EXCEEDED,M.UNKNOWN_SERVER_ERROR,M.USER_DEACTIVATED,M.CHANNEL_IS_FROZEN,M.RECEIVER_USER_DEACTIVATED],j=[M.WEBSOCKET_CONNECTION_CLOSED,M.WEBSOCKET_CONNECTION_FAILED,M.CONNECTION_REQUIRED,M.CHANNEL_IS_FROZEN],V=function(e,t){if(e!==t){var n=T({},e),r=T({},t);return!(n.hasOwnProperty("messageId")&&r.hasOwnProperty("messageId")&&n.messageId!==r.messageId||n.hasOwnProperty("reqId")&&r.hasOwnProperty("reqId")&&n.reqId!==r.reqId||(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(n)!==JSON.stringify(r)))}return!0},q=function(e,t,n){return void 0===n&&(n=!1),!(!n||!Z(t))||("string"!=typeof e?"object"==typeof e?z(e,t):K(e,t):typeof t===e)},z=function(e,t,n){return void 0===n&&(n=!1),!(!n||!Z(t))||Object.values(e).includes(t)},K=function(e,t){return t instanceof e},Y=function(e,t,n){return void 0===n&&(n=!1),!(!n||!Z(t))||Array.isArray(t)&&t.every((function(t){return q(e,t)}))},W=function(e,t){return!!Z(e)||"number"==typeof e&&13===e.toString().length},Q=function(e){return e>0&&j.indexOf(e)>=0},X=function(e,t){if(void 0===t&&(t=!1),t&&Z(e))return!0;var n="object"==typeof e&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},Z=function(e){return null==e},J=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0===n||n,i=t.typingIndicatorInvalidateTime,a=void 0===i?1e4:i,s=t.typingIndicatorThrottle,o=void 0===s?1e3:s,l=t.websocketResponseTimeout,u=void 0===l?1e4:l,c=t.websocketPayloadDecompression,d=void 0===c||c,h=t.sessionTokenRefreshTimeout,f=void 0===h?60:h;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=a,this._typingIndicatorThrottle=o,this._websocketResponseTimeout=u,this._sessionTokenRefreshTimeout=f,this.websocketPayloadDecompression=d}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){q("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){q("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){q("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){q("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(e){q("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)},enumerable:!1,configurable:!0}),e}(),$={encrypt:function(e){return e},decrypt:function(e){return e}},ee=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t}return e.prototype._savePreferenceKeys=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:A([],w(this._preference.keys()),!1)})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e,t){var n;return void 0===t&&(t=1),N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return this._version=t,this._keysAddress=e,r="".concat(e,".metadata.version"),[4,this._store.get(r)];case 1:return i=p.sent(),[4,this._store.get(e)];case 2:return a=null!==(n=p.sent())&&void 0!==n?n:[],!i||i.version<this._version?9===this._version?[3,3]:[3,6]:[3,10];case 3:return(s=a.find((function(e){return e.includes("groupchannel/sync.meta")})))?[4,this._store.remove(s)]:[3,5];case 4:p.sent(),p.label=5;case 5:return[3,8];case 6:return[4,this._resetPreferenceData(a)];case 7:p.sent(),p.label=8;case 8:return[4,this._updatePreferenceVersionInfo(r)];case 9:return p.sent(),[3,17];case 10:p.trys.push([10,15,16,17]),o=I(a),l=o.next(),p.label=11;case 11:return l.done?[3,14]:(u=l.value,[4,this._store.get(u)]);case 12:(c=p.sent())&&this._preference.set(u,c),p.label=13;case 13:return l=o.next(),[3,11];case 14:return[3,17];case 15:return d=p.sent(),h={error:d},[3,17];case 16:try{l&&!l.done&&(f=o.return)&&f.call(o)}finally{if(h)throw h.error}return[7];case 17:return[2]}}))}))},e.prototype._updatePreferenceVersionInfo=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._store.set({key:e,value:{version:this._version}})];case 1:return t.sent(),[2]}}))}))},e.prototype._resetPreferenceData=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this._preference=new Map,[4,this._store.removeMany(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.get=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this._preference.get(e)]}))}))},e.prototype.set=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t})];case 1:return r.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.remove=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._store.removeMany(A([],w(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),te=function(){function e(e){var t=e.encryption,n=e.store,r=e.localCacheEnabled,i=e.localCacheConfig;this.store=n,this.preference=new ee({store:n}),this.encryption=null!=t?t:$,this.localCacheEnabled=r,this.localCacheConfig=i}return e.prototype.replaceStore=function(e){this.store=e,this.preference=new ee({store:e})},e}();!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(k||(k={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(L||(L={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}(x||(x={})),function(e){e.SESSION_TOKEN="session_token",e.ACCESS_TOKEN="access_token"}(U||(U={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(P||(P={})),function(e){e.CUSTOM="custom",e.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(F||(F={}));var ne,re=function(){function e(e){var t=e.channel,n=e.cachedMessageCount;this._cachedMessageCount=0,this._channel=t,this._cachedMessageCount=n}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cachedMessageCount",{get:function(){return this._cachedMessageCount},enumerable:!1,configurable:!0}),e}(),ie=function(){function e(e){var t=void 0===e?{}:e,n=t.maxSize,r=void 0===n?256:n,i=t.clearOrder,a=void 0===i?F.MESSAGE_COLLECTION_ACCESSED_AT:i,s=t.customClearOrderComparator,o=t.enableAutoResend,l=void 0===o||o;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(e,t){return e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(r,64),s?(this._clearOrder=a,this._customClearOrderComparator=s):this._clearOrder=F.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=l}return Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrderComparator",{get:function(){var e;return this._clearOrder===F.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableAutoResend",{get:function(){return this._enableAutoResend},enumerable:!1,configurable:!0}),e}();!function(e){e.FEED="feed",e.CHAT="chat",e.CHAT_API="chat_api"}(ne||(ne={}));var ae,se,oe,le,ue,ce,de,he,fe,pe,_e,me,ve,ge=function(){function e(){this.isRefreshing=!1}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChatServicePermission",{get:function(){var e;return!!(null===(e=this.services)||void 0===e?void 0:e.includes(ne.CHAT))},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]},e}(),Ee=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},be=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=Ee()}return e.prototype._register=function(e,t,n){var r;return e in this._container||(this._container[e]=new Map),null===(r=this._container[e])||void 0===r||r.set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){var e=this;Object.keys(this._container).forEach((function(t){var n;null===(n=e._container[t])||void 0===n||n.delete(e.key)}))},e}(),ye=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new be({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new be({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var a=[];try{for(var s=I(i.keys()),o=s.next();!o.done;o=s.next()){var l=o.value,u=i.get(l);u.handler(t),u.occurence>0&&(u.occurence--,0===u.occurence&&a.push(l))}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}a.forEach((function(e){return i.delete(e)}))}},e}(),Ce=function(){function e(){this._dispatcher=new ye}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),Te=function(){},Ne=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0===e[n]||Number.isNaN(e[n])||null===e[n]||(t[n]=e[n])})),t},Se=function(e){if(null!=e){if("object"==typeof e){if(Array.isArray(e)){for(var t=A([],w(e),!1),n=0;n<t.length;n++)t[n]=Se(t[n]);return t}return Object.keys(e).forEach((function(t){null===e[t]&&delete e[t]})),e}return e}};!function(e){e.BASE="base",e.GROUP="group",e.OPEN="open",e.FEED="feed"}(ae||(ae={})),function(e){e.OPERATOR="operator",e.NONE="none"}(se||(se={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}(oe||(oe={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(le||(le={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(ue||(ue={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(ce||(ce={})),function(e){e.USERS="users",e.CHANNEL="channel"}(de||(de={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(he||(he={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(fe||(fe={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled"}(pe||(pe={})),function(e){e.INREVIEW="InReview",e.APPROVED="Approved"}(_e||(_e={})),function(e){e.HIGH="high",e.NORMAL="normal",e.LOW="low"}(me||(me={})),function(e){e.CREATED_AT="created_at",e.UPDATED_AT="updated_at"}(ve||(ve={}));var Ie,we="v3",Ae="/".concat(we,"/users"),Me="/".concat(we,"/sdk/users"),Oe="/".concat(we,"/storage/file"),Re="/".concat(we,"/group_channels"),De="/".concat(we,"/sdk/group_channels"),ke="/".concat(we,"/open_channels"),Le="/".concat(we,"/sdk/open_channels"),xe="/".concat(we,"/search"),Ue="/".concat(we,"/report"),Pe="/".concat(we,"/emojis"),Fe="/".concat(we,"/emoji_categories"),Be="/".concat(we,"/polls"),He="/".concat(we,"/scheduled_messages"),Ge="/".concat(we,"/sdk/ui_kit/configuration"),je="/".concat(we,"/sdk/statistics"),Ve="/".concat(we,"/sdk/statistics/notification_statistics"),qe="/".concat(we,"/message_templates"),ze="/".concat(we,"/sdk/push_delivery"),Ke="/".concat(we,"/forms"),Ye="/".concat(we,"/report_category"),We="/".concat(we,"/sdk/applications/settings"),Qe=function(e){switch(e){case ae.FEED:case ae.GROUP:return Re;case ae.OPEN:return ke;default:return null}},Xe=function(e){switch(e){case ae.GROUP:return"".concat(Ue,"/group_channels");case ae.OPEN:return"".concat(Ue,"/open_channels");default:return null}},Ze=function(e,t,n){var r,i;switch(e){case de.CHANNEL:return!0;case de.USERS:if(t)try{for(var a=I(t),s=a.next();!s.done;s=a.next())if(s.value===n)return!0}catch(o){r={error:o}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}return!1},Je=function(e,t,n){var r,i,a,s,o=Ze(null!==(r=e.mentionType)&&void 0!==r?r:null,null!==(i=e.mentionedUserIds)&&void 0!==i?i:[],n),l=Ze(null!==(a=t.mentionType)&&void 0!==a?a:null,null!==(s=t.mentionedUserIds)&&void 0!==s?s:[],n);return!o&&l?1:o&&!l?-1:0},$e=function(e,t,n){var r,i=t||new FormData;for(var a in e)if(e.hasOwnProperty(a)){var s=e[a],o=n?"".concat(n,"[").concat(a,"]"):a;X(s)?i.append(o,s,null!==(r=s.name)&&void 0!==r?r:"filename"):"object"!=typeof s||null===s||Array.isArray(s)||s instanceof Blob?i.append(o,String(s)):i=$e(s,i,o)}return i};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(Ie||(Ie={}));var et,tt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=Ee(),t}return C(t,e),t.prototype.encodeParams=function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))},Object.defineProperty(t.prototype,"query",{get:function(){var e=this,t=Ne(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){var e=Ne(this.params);return Object.keys(e).some((function(t){return X(e[t])}))?$e(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSessionKey",{get:function(){return void 0!==this.headers["Session-Key"]},enumerable:!1,configurable:!0}),t}(Te),nt=function(e){function t(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return C(t,e),Object.defineProperty(t.prototype,"payload",{get:function(){return T({},this._payload)},enumerable:!1,configurable:!0}),t.prototype.as=function(e){return new e(this._iid,this.payload)},t}(Te),rt=function(e){function t(t){var n=e.call(this)||this;return n.requestId=t,n}return C(t,e),t}(Te),it=function(e){function t(t){var n=t.expires_in,r=t.reason,i=void 0===r?M.SESSION_KEY_EXPIRED:r,a=t.message,s=void 0===a?"":a,o=e.call(this)||this;switch(o.expiresIn=null!=n?n:0,i){case M.SESSION_KEY_EXPIRED:case M.SESSION_TOKEN_EXPIRED:case M.SESSION_REVOKED:case M.USER_AUTH_DEACTIVATED:case M.USER_AUTH_DELETED_OR_NOT_FOUND:o.error=new H({code:i,message:s})}return o}return C(t,e),Object.defineProperty(t.prototype,"invalidateSessionToken",{get:function(){var e;return!!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),t}(Te),at=function(e){function t(t,n,r,i){void 0===i&&(i="");var a,s=this;return(s=e.call(this)||this)._iid=t,s.code=n,s.payload=r,s.requestId=null!==(a=r.req_id)&&void 0!==a?a:i,s}return C(t,e),t.createFromRawMessage=function(e,n){var r=n.substring(0,4),i={};try{i=JSON.parse(n.substring(4))}catch(a){r="NOOP"}finally{return new t(e,r,i)}},t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},t.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},t}(Te),st=function(e){function t(t){var n,r=t.code,i=t.ackRequired,a=t.payload,s=void 0===a?{}:a,o=this;return(o=e.call(this)||this).code=r,o.payload=s,o.requestId=null!==(n=o.payload.req_id)&&void 0!==n?n:Ee(),o.ackRequired=i,o.payload.req_id=o.requestId,o}return C(t,e),t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},t}(Te),ot=function(e){function t(t){var n=t.userId,r=t.authToken,i=t.services,a=t.expiringSession,s=void 0===a||a,o=e.call(this)||this;return o.path="".concat(Ae,"/").concat(n,"/session_key"),o.method=Ie.POST,o.params=Ne({token:r,services:i,expiring_session:!!s}),o.requireAuth=!1,o}return C(t,e),t}(tt),lt=function(e){function t(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r,a=t.requestId,s=void 0===a?void 0:a;return e.call(this,{code:"LOGI",payload:Ne({token:n,expiring_session:i?1:0,req_id:s}),ackRequired:!0})||this}return C(t,e),t}(st),ut=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.key,a=n.expires_at,s=n.services;return r.key=i,r.expiresAt=a,r.services=s,r}return C(t,e),t}(nt),ct=function(e){function t(t,n,r){var i,a=this;return(a=e.call(this,t,"LOGI",r)||this).error=null,a.newKey=null,a.newKey=null!==(i=r.new_key)&&void 0!==i?i:null,a.error=r.error?new H(r):null,a}return C(t,e),t}(at),dt=function(e){function t(t){var n=e.call(this)||this;return n.statLog=t,n}return C(t,e),t}(Te),ht=function(e){function t(t){var n=t.request,r=t.deferred,i=t.error,a=void 0===i?H.requestFailed:i,s=e.call(this)||this;return s.request=n,s.deferred=r,s.error=a,s}return C(t,e),t}(Te);!function(e){e.FEATURE_LOCALCACHE="feature:local_cache",e.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",e.NOTIFICATION="noti:stats",e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(et||(et={}));var ft,pt,_t,mt=function(){function e(e){var t=e.type,n=e.data,r=e.ts,i=void 0===r?Date.now():r;this.type=t,this.createdAt=i,this.data=n}return e.payloadify=function(e){return Ne({stat_type:e.type,ts:e.createdAt,data:Ne(e.data)})},e}(),vt=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},gt=function(){return!("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};!function(e){e.CHAT="chat",e.CALLS="calls",e.DESK="desk",e.LIVE="live",e.UIKIT_CHAT="uikit-chat",e.UIKIT_LIVE="uikit-live"}(ft||(ft={})),function(e){e.ANDROID="android",e.IOS="ios",e.JS="js",e.UNREAL="unreal",e.UNITY="unity",e.REACT_NATIVE="react-native",e.FLUTTER="flutter"}(pt||(pt={})),function(e){e.ANDROID="android",e.IOS="ios",e.WEB="web",e.MOBILE_WEB="mobile_web",e.WINDOWS="windows"}(_t||(_t={}));var Et=function(){function e(){}return e.sendbirdSdkUserAgentWithExtension=function(e){var t=vt()?pt.REACT_NATIVE:pt.JS,n={main_sdk_info:"chat/".concat(t,"/").concat(D.SDK_VERSION),device_os_platform:gt()?"mobile-web":"web",os_version:D.OS_VERSION};if(e){var r=e.sendbirdExtensions,i=e.deviceOS,a=e.customData,s=void 0===a?{}:a;i.version&&(n.os_version=i.version),i.platform&&(n.device_os_platform=i.platform),r.length>0&&(n.extension_sdk_info=r.map((function(e){var t=e.product,n=e.platform,r=e.version;return"".concat(t,"/").concat(n,"/").concat(r)})).join(",")),Object.keys(n).forEach((function(e){return delete s[e]})),Object.keys(s).length>0&&(n=T(T({},n),s))}return Object.entries(n).map((function(e){var t=w(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)})).join("&")},e.userAgentWithExtension=function(e){var t=vt()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",i=e["device-os-platform"]?"o".concat(e["device-os-platform"]):gt()?"omobile-web":"oweb";return"".concat(t,"/c").concat(D.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(i)},e}(),bt=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=function(e){n(e)}}))},yt=function(e){function t(t){var n=e.call(this)||this;return n.requestId=t.requestId,n}return C(t,e),t}(Te),Ct=function(e){function t(t){var n=e.call(this)||this;return n.method=Ie.DELETE,n.path="".concat(Qe(t.channelType),"/").concat(t.channelUrl,"/messages/").concat(t.messageId),t.messageToken&&(n.params=Ne({mesg_token:t.messageToken})),n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Tt=function(e){function t(t,n,r){var i,a=this;return(a=e.call(this,t,"DELM",r)||this).channelUrl=r.channel_url,a.channelType=r.channel_type,a.messageId=Number(r.msg_id),a.silent=r.silent,a.messageCreatedAt=r.message_created_at?Number(r.message_created_at):-1,a.senderId=null!==(i=r.sender_id)&&void 0!==i?i:void 0,a}return C(t,e),t}(at),Nt=function(){function e(e,t){var n=t.session,r=t.sdkState,i=t.dispatcher,a=t.logger,s=t.useFetchCompat,o=void 0!==s&&s,l=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=e,this._session=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof rt&&l.cancel(e.requestId)})),this._logger=a,this._shouldImportFetchCompat=o}return e.prototype._createHeader=function(e,t){var n=this._sdkState,r=n.appId,i=n.appVersion,a=n.sendbirdRuntimeEnvironment,s=T(T({},e.headers),{SendBird:"JS,".concat(D.OS_VERSION,",").concat(D.SDK_VERSION,",").concat(r).concat(i?",".concat(i):""),"SB-User-Agent":Et.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":Et.sendbirdSdkUserAgentWithExtension(a)});return t||(s["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&!e.hasSessionKey&&this._session.hasSession&&(s["Session-Key"]=this._session.sessionKey),s["App-Id"]=r,this._session&&this._session.authToken&&(s["Access-Token"]=this._session.authToken),s},e.prototype._statLogApiResult=function(e,t,n){e.path.includes("/sdk/statistics")||this._dispatcher.dispatch(new dt(new mt({type:et.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},e.prototype._isBodyRequired=function(e){var t=e.method;return t!==Ie.GET&&(t!==Ie.DELETE||e instanceof Ct)},e.prototype.send=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E;return S(this,(function(b){switch(b.label){case 0:t=e.path,n=e.method,r=e.uploadProgressHandler,i=this._isBodyRequired(e),a=this._sdkState.api,s="".concat(a.host).concat(t).concat(i?"":e.query),o=i?e.payload:null,l=this._createHeader(e,o instanceof FormData?o:void 0),u=new AbortController,c=u.signal,this._abortControl.set(e.requestId,u),d=Date.now(),b.label=1;case 1:return b.trys.push([1,13,,14]),r?[4,Promise.resolve().then((()=>Lj))]:[3,6];case 2:h=b.sent().xmlHttpRequest,b.label=3;case 3:return b.trys.push([3,5,,6]),[4,h(this._iid,{requestId:e.requestId,method:e.method,url:s,headers:l,data:null!=o?o:void 0,uploadProgressHandler:r})];case 4:return f=b.sent(),this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,d),[2,f];case 5:if(!((p=b.sent())instanceof H&&p.code===M.XMLHTTPREQUEST_NOT_SUPPORTED))throw p;return this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored."),[3,6];case 6:return this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null),"undefined"!=typeof AbortController?[3,8]:[4,Promise.resolve().then((()=>xj))];case 7:b.sent(),b.label=8;case 8:return"function"==typeof fetch?[3,10]:[4,Promise.resolve().then((()=>lV))];case 9:b.sent(),b.label=10;case 10:return[4,fetch(s,{method:n,body:o,headers:l,signal:c})];case 11:return[4,(_=b.sent()).json()];case 12:if(m=b.sent(),_.ok||_.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,d),[2,new nt(this._iid,m)];if(m){if((v=new H(m)).isSessionExpiredError){if(this._dispatcher.dispatch(new it({reason:v.code,message:v.message})),!(e instanceof ot))return g=new bt,this._dispatcher.dispatch(new ht({request:e,deferred:g,error:v})),[2,g.promise];throw v}throw v.isSessionInvalidatedError?(this._dispatcher.dispatch(new it({reason:v.code,message:v.message})),v):v}throw H.requestFailed;case 13:throw E=b.sent(),this._statLogApiResult(e,d,E),E instanceof H?(this._logger.debug("fail api request",E),E):"AbortError"===(null==E?void 0:E.name)?H.requestCanceled:(this._logger.debug("fail api request",E),H.networkError);case 14:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e)),this._dispatcher.dispatch(new yt({requestId:e}))},e.prototype.cancelAll=function(){var e,t;try{for(var n=I(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear(),this._dispatcher.dispatch(new yt({}))},e}(),St=function(){};function It(e){let t=e.length;for(;--t>=0;)e[t]=0}const wt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),At=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Mt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rt=new Array(576);It(Rt);const Dt=new Array(60);It(Dt);const kt=new Array(512);It(kt);const Lt=new Array(256);It(Lt);const xt=new Array(29);It(xt);const Ut=new Array(30);function Pt(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let Ft,Bt,Ht;function Gt(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}It(Ut);const jt=e=>e<256?kt[e]:kt[256+(e>>>7)],Vt=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},qt=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Vt(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},zt=(e,t,n)=>{qt(e,n[2*t],n[2*t+1])},Kt=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Yt=(e,t,n)=>{const r=new Array(16);let i,a,s=0;for(i=1;i<=15;i++)s=s+n[i-1]<<1,r[i]=s;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Kt(r[t]++,t))}},Wt=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Qt=e=>{e.bi_valid>8?Vt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Xt=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},Zt=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Xt(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Xt(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},Jt=(e,t,n)=>{let r,i,a,s,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===r?zt(e,i,t):(a=Lt[i],zt(e,a+256+1,t),s=wt[a],0!==s&&(i-=xt[a],qt(e,i,s)),r--,a=jt(r),zt(e,a,n),s=At[a],0!==s&&(r-=Ut[a],qt(e,r,s)))}while(o<e.sym_next);zt(e,256,t)},$t=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let s,o,l,u=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<a;s++)0!==n[2*s]?(e.heap[++e.heap_len]=u=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=u,s=e.heap_len>>1;s>=1;s--)Zt(e,n,s);l=a;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Zt(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,n[2*l]=n[2*s]+n[2*o],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,n[2*s+1]=n[2*o+1]=l,e.heap[1]=l++,Zt(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let u,c,d,h,f,p,_=0;for(h=0;h<=15;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)c=e.heap[u],h=n[2*n[2*c+1]+1]+1,h>l&&(h=l,_++),n[2*c+1]=h,c>r||(e.bl_count[h]++,f=0,c>=o&&(f=s[c-o]),p=n[2*c],e.opt_len+=p*(h+f),a&&(e.static_len+=p*(i[2*c+1]+f)));if(0!==_){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,_-=2}while(_>0);for(h=l;0!==h;h--)for(c=e.bl_count[h];0!==c;)d=e.heap[--u],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),c--)}})(e,t),Yt(n,u,e.bl_count)},en=(e,t,n)=>{let r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++o<l&&i===s||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))},tn=(e,t,n)=>{let r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(o<u)do{zt(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(zt(e,i,e.bl_tree),o--),zt(e,16,e.bl_tree),qt(e,o-3,2)):o<=10?(zt(e,17,e.bl_tree),qt(e,o-3,3)):(zt(e,18,e.bl_tree),qt(e,o-11,7));o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}};let nn=!1;const rn=(e,t,n,r)=>{qt(e,0+(r?1:0),3),Qt(e),Vt(e,n),Vt(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var an={_tr_init:e=>{nn||((()=>{let e,t,n,r,i;const a=new Array(16);for(n=0,r=0;r<28;r++)for(xt[r]=n,e=0;e<1<<wt[r];e++)Lt[n++]=r;for(Lt[n-1]=r,i=0,r=0;r<16;r++)for(Ut[r]=i,e=0;e<1<<At[r];e++)kt[i++]=r;for(i>>=7;r<30;r++)for(Ut[r]=i<<7,e=0;e<1<<At[r]-7;e++)kt[256+i++]=r;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)Rt[2*e+1]=8,e++,a[8]++;for(;e<=255;)Rt[2*e+1]=9,e++,a[9]++;for(;e<=279;)Rt[2*e+1]=7,e++,a[7]++;for(;e<=287;)Rt[2*e+1]=8,e++,a[8]++;for(Yt(Rt,287,a),e=0;e<30;e++)Dt[2*e+1]=5,Dt[2*e]=Kt(e,5);Ft=new Pt(Rt,wt,257,286,15),Bt=new Pt(Dt,At,0,30,15),Ht=new Pt(new Array(0),Mt,0,19,7)})(),nn=!0),e.l_desc=new Gt(e.dyn_ltree,Ft),e.d_desc=new Gt(e.dyn_dtree,Bt),e.bl_desc=new Gt(e.bl_tree,Ht),e.bi_buf=0,e.bi_valid=0,Wt(e)},_tr_stored_block:rn,_tr_flush_block:(e,t,n,r)=>{let i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),$t(e,e.l_desc),$t(e,e.d_desc),s=(e=>{let t;for(en(e,e.dyn_ltree,e.l_desc.max_code),en(e,e.dyn_dtree,e.d_desc.max_code),$t(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Ot[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?rn(e,t,n,r):4===e.strategy||a===i?(qt(e,2+(r?1:0),3),Jt(e,Rt,Dt)):(qt(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(qt(e,t-257,5),qt(e,n-1,5),qt(e,r-4,4),i=0;i<r;i++)qt(e,e.bl_tree[2*Ot[i]+1],3);tn(e,e.dyn_ltree,t-1),tn(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Jt(e,e.dyn_ltree,e.dyn_dtree)),Wt(e),r&&Qt(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Lt[n]+256+1)]++,e.dyn_dtree[2*jt(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{var t;qt(e,2,3),zt(e,256,Rt),16===(t=e).bi_valid?(Vt(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},sn=(e,t,n,r)=>{let i=65535&e,a=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,a=a+i|0}while(--s);i%=65521,a%=65521}return i|a<<16};const on=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var ln=(e,t,n,r)=>{const i=on,a=r+n;e^=-1;for(let s=r;s<a;s++)e=e>>>8^i[255&(e^t[s])];return~e},un={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},cn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dn,_tr_stored_block:hn,_tr_flush_block:fn,_tr_tally:pn,_tr_align:_n}=an,{Z_NO_FLUSH:mn,Z_PARTIAL_FLUSH:vn,Z_FULL_FLUSH:gn,Z_FINISH:En,Z_BLOCK:bn,Z_OK:yn,Z_STREAM_END:Cn,Z_STREAM_ERROR:Tn,Z_DATA_ERROR:Nn,Z_BUF_ERROR:Sn,Z_DEFAULT_COMPRESSION:In,Z_FILTERED:wn,Z_HUFFMAN_ONLY:An,Z_RLE:Mn,Z_FIXED:On,Z_DEFAULT_STRATEGY:Rn,Z_UNKNOWN:Dn,Z_DEFLATED:kn}=cn,Ln=258,xn=262,Un=42,Pn=113,Fn=666,Bn=(e,t)=>(e.msg=un[t],t),Hn=e=>2*e-(e>4?9:0),Gn=e=>{let t=e.length;for(;--t>=0;)e[t]=0},jn=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let Vn=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const qn=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},zn=(e,t)=>{fn(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,qn(e.strm)},Kn=(e,t)=>{e.pending_buf[e.pending++]=t},Yn=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Wn=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=sn(e.adler,t,i,n):2===e.state.wrap&&(e.adler=ln(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Qn=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-xn?e.strstart-(e.w_size-xn):0,u=e.window,c=e.w_mask,d=e.prev,h=e.strstart+Ln;let f=u[a+s-1],p=u[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,u[n+s]===p&&u[n+s-1]===f&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<h);if(r=Ln-(h-a),a=h-Ln,r>s){if(e.match_start=t,s=r,r>=o)break;f=u[a+s-1],p=u[a+s]}}}while((t=d[t&c])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead},Xn=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-xn)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),jn(e),r+=t),0===e.strm.avail_in)break;if(n=Wn(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vn(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vn(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<xn&&0!==e.strm.avail_in)},Zn=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==En||t===mn||n!==r+e.strm.avail_in))break;s=t===En&&n===r+e.strm.avail_in?1:0,hn(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,qn(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Wn(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==mn&&t!==En&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Wn(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===En)&&t!==mn&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===En&&0===e.strm.avail_in&&n===r?1:0,hn(e,e.block_start,n,s),e.block_start+=n,qn(e.strm)),s?3:1)},Jn=(e,t)=>{let n,r;for(;;){if(e.lookahead<xn){if(Xn(e),e.lookahead<xn&&t===mn)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vn(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-xn&&(e.match_length=Qn(e,n)),e.match_length>=3)if(r=pn(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Vn(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vn(e,e.ins_h,e.window[e.strstart+1]);else r=pn(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(zn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===En?(zn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zn(e,!1),0===e.strm.avail_out)?1:2},$n=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<xn){if(Xn(e),e.lookahead<xn&&t===mn)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vn(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-xn&&(e.match_length=Qn(e,n),e.match_length<=5&&(e.strategy===wn||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=pn(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Vn(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(zn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=pn(e,0,e.window[e.strstart-1]),r&&zn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=pn(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===En?(zn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zn(e,!1),0===e.strm.avail_out)?1:2};function er(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const tr=[new er(0,0,0,0,Zn),new er(4,4,8,4,Jn),new er(4,5,16,8,Jn),new er(4,6,32,32,Jn),new er(4,4,16,16,$n),new er(8,16,32,32,$n),new er(8,16,128,128,$n),new er(8,32,128,256,$n),new er(32,128,258,1024,$n),new er(32,258,258,4096,$n)];function nr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Gn(this.dyn_ltree),Gn(this.dyn_dtree),Gn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Gn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Gn(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const rr=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Un&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Pn&&t.status!==Fn?1:0},ir=e=>{if(rr(e))return Bn(e,Tn);e.total_in=e.total_out=0,e.data_type=Dn;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Un:Pn,e.adler=2===t.wrap?0:1,t.last_flush=-2,dn(t),yn},ar=e=>{const t=ir(e);var n;return t===yn&&((n=e.state).window_size=2*n.w_size,Gn(n.head),n.max_lazy_match=tr[n.level].max_lazy,n.good_match=tr[n.level].good_length,n.nice_match=tr[n.level].nice_length,n.max_chain_length=tr[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},sr=(e,t,n,r,i,a)=>{if(!e)return Tn;let s=1;if(t===In&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==kn||r<8||r>15||t<0||t>9||a<0||a>On||8===r&&1!==s)return Bn(e,Tn);8===r&&(r=9);const o=new nr;return e.state=o,o.strm=e,o.status=Un,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=n,ar(e)};var or=sr,lr=(e,t)=>rr(e)||2!==e.state.wrap?Tn:(e.state.gzhead=t,yn),ur=(e,t)=>{if(rr(e)||t>bn||t<0)return e?Bn(e,Tn):Tn;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Fn&&t!==En)return Bn(e,0===e.avail_out?Sn:Tn);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(qn(e),0===e.avail_out)return n.last_flush=-1,yn}else if(0===e.avail_in&&Hn(t)<=Hn(r)&&t!==En)return Bn(e,Sn);if(n.status===Fn&&0!==e.avail_in)return Bn(e,Sn);if(n.status===Un&&0===n.wrap&&(n.status=Pn),n.status===Un){let t=kn+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=An||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Yn(n,t),0!==n.strstart&&(Yn(n,e.adler>>>16),Yn(n,65535&e.adler)),e.adler=1,n.status=Pn,qn(e),0!==n.pending)return n.last_flush=-1,yn}if(57===n.status)if(e.adler=0,Kn(n,31),Kn(n,139),Kn(n,8),n.gzhead)Kn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Kn(n,255&n.gzhead.time),Kn(n,n.gzhead.time>>8&255),Kn(n,n.gzhead.time>>16&255),Kn(n,n.gzhead.time>>24&255),Kn(n,9===n.level?2:n.strategy>=An||n.level<2?4:0),Kn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Kn(n,255&n.gzhead.extra.length),Kn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=ln(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Kn(n,0),Kn(n,0),Kn(n,0),Kn(n,0),Kn(n,0),Kn(n,9===n.level?2:n.strategy>=An||n.level<2?4:0),Kn(n,3),n.status=Pn,qn(e),0!==n.pending)return n.last_flush=-1,yn;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=ln(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,qn(e),0!==n.pending)return n.last_flush=-1,yn;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=ln(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=ln(e.adler,n.pending_buf,n.pending-r,r)),qn(e),0!==n.pending)return n.last_flush=-1,yn;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Kn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=ln(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=ln(e.adler,n.pending_buf,n.pending-r,r)),qn(e),0!==n.pending)return n.last_flush=-1,yn;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Kn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=ln(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qn(e),0!==n.pending))return n.last_flush=-1,yn;Kn(n,255&e.adler),Kn(n,e.adler>>8&255),e.adler=0}if(n.status=Pn,qn(e),0!==n.pending)return n.last_flush=-1,yn}if(0!==e.avail_in||0!==n.lookahead||t!==mn&&n.status!==Fn){let r=0===n.level?Zn(n,t):n.strategy===An?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Xn(e),0===e.lookahead)){if(t===mn)return 1;break}if(e.match_length=0,n=pn(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(zn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===En?(zn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zn(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Mn?((e,t)=>{let n,r,i,a;const s=e.window;for(;;){if(e.lookahead<=Ln){if(Xn(e),e.lookahead<=Ln&&t===mn)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){a=e.strstart+Ln;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=Ln-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=pn(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=pn(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(zn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===En?(zn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zn(e,!1),0===e.strm.avail_out)?1:2})(n,t):tr[n.level].func(n,t);if(3!==r&&4!==r||(n.status=Fn),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),yn;if(2===r&&(t===vn?_n(n):t!==bn&&(hn(n,0,0,!1),t===gn&&(Gn(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),qn(e),0===e.avail_out))return n.last_flush=-1,yn}return t!==En?yn:n.wrap<=0?Cn:(2===n.wrap?(Kn(n,255&e.adler),Kn(n,e.adler>>8&255),Kn(n,e.adler>>16&255),Kn(n,e.adler>>24&255),Kn(n,255&e.total_in),Kn(n,e.total_in>>8&255),Kn(n,e.total_in>>16&255),Kn(n,e.total_in>>24&255)):(Yn(n,e.adler>>>16),Yn(n,65535&e.adler)),qn(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?yn:Cn)},cr=e=>{if(rr(e))return Tn;const t=e.state.status;return e.state=null,t===Pn?Bn(e,Nn):yn},dr=(e,t)=>{let n=t.length;if(rr(e))return Tn;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==Un||r.lookahead)return Tn;if(1===i&&(e.adler=sn(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Gn(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const a=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Xn(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=Vn(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Xn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=a,r.wrap=i,yn};const hr=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var fr=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)hr(n,t)&&(e[t]=n[t])}}return e},pr=e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let t=e[r];n.set(t,i),i+=t.length}return n};let _r=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(O){_r=!1}const mr=new Uint8Array(256);for(let Zz=0;Zz<256;Zz++)mr[Zz]=Zz>=252?6:Zz>=248?5:Zz>=240?4:Zz>=224?3:Zz>=192?2:1;mr[254]=mr[254]=1;var vr=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},gr=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let s=mr[t];if(s>4)a[i++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&_r)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(a,i)},Er=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+mr[e[n]]>t?n:t},br=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const yr=Object.prototype.toString,{Z_NO_FLUSH:Cr,Z_SYNC_FLUSH:Tr,Z_FULL_FLUSH:Nr,Z_FINISH:Sr,Z_OK:Ir,Z_STREAM_END:wr,Z_DEFAULT_COMPRESSION:Ar,Z_DEFAULT_STRATEGY:Mr,Z_DEFLATED:Or}=cn;function Rr(e){this.options=fr({level:Ar,method:Or,chunkSize:16384,windowBits:15,memLevel:8,strategy:Mr},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new br,this.strm.avail_out=0;let n=or(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Ir)throw new Error(un[n]);if(t.header&&lr(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?vr(t.dictionary):"[object ArrayBuffer]"===yr.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=dr(this.strm,e),n!==Ir)throw new Error(un[n]);this._dict_set=!0}}function Dr(e,t){const n=new Rr(t);if(n.push(e,!0),n.err)throw n.msg||un[n.err];return n.result}Rr.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Sr:Cr,"string"==typeof e?n.input=vr(e):"[object ArrayBuffer]"===yr.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===Tr||a===Nr)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=ur(n,a),i===wr)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=cr(this.strm),this.onEnd(i),this.ended=!0,i===Ir;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Rr.prototype.onData=function(e){this.chunks.push(e)},Rr.prototype.onEnd=function(e){e===Ir&&(this.result=pr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var kr={Deflate:Rr,deflate:Dr,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Dr(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Dr(e,t)}};const Lr=16209;var xr=function(e,t){let n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N,S;const I=e.state;n=e.next_in,N=e.input,r=n+(e.avail_in-5),i=e.next_out,S=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),o=I.dmax,l=I.wsize,u=I.whave,c=I.wnext,d=I.window,h=I.hold,f=I.bits,p=I.lencode,_=I.distcode,m=(1<<I.lenbits)-1,v=(1<<I.distbits)-1;e:do{f<15&&(h+=N[n++]<<f,f+=8,h+=N[n++]<<f,f+=8),g=p[h&m];t:for(;;){if(E=g>>>24,h>>>=E,f-=E,E=g>>>16&255,0===E)S[i++]=65535&g;else{if(!(16&E)){if(64&E){if(32&E){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=Lr;break e}g=p[(65535&g)+(h&(1<<E)-1)];continue t}for(b=65535&g,E&=15,E&&(f<E&&(h+=N[n++]<<f,f+=8),b+=h&(1<<E)-1,h>>>=E,f-=E),f<15&&(h+=N[n++]<<f,f+=8,h+=N[n++]<<f,f+=8),g=_[h&v];;){if(E=g>>>24,h>>>=E,f-=E,E=g>>>16&255,16&E){if(y=65535&g,E&=15,f<E&&(h+=N[n++]<<f,f+=8,f<E&&(h+=N[n++]<<f,f+=8)),y+=h&(1<<E)-1,y>o){e.msg="invalid distance too far back",I.mode=Lr;break e}if(h>>>=E,f-=E,E=i-a,y>E){if(E=y-E,E>u&&I.sane){e.msg="invalid distance too far back",I.mode=Lr;break e}if(C=0,T=d,0===c){if(C+=l-E,E<b){b-=E;do{S[i++]=d[C++]}while(--E);C=i-y,T=S}}else if(c<E){if(C+=l+c-E,E-=c,E<b){b-=E;do{S[i++]=d[C++]}while(--E);if(C=0,c<b){E=c,b-=E;do{S[i++]=d[C++]}while(--E);C=i-y,T=S}}}else if(C+=c-E,E<b){b-=E;do{S[i++]=d[C++]}while(--E);C=i-y,T=S}for(;b>2;)S[i++]=T[C++],S[i++]=T[C++],S[i++]=T[C++],b-=3;b&&(S[i++]=T[C++],b>1&&(S[i++]=T[C++]))}else{C=i-y;do{S[i++]=S[C++],S[i++]=S[C++],S[i++]=S[C++],b-=3}while(b>2);b&&(S[i++]=S[C++],b>1&&(S[i++]=S[C++]))}break}if(64&E){e.msg="invalid distance code",I.mode=Lr;break e}g=_[(65535&g)+(h&(1<<E)-1)]}}break}}while(n<r&&i<s);b=f>>3,n-=b,f-=b<<3,h&=(1<<f)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),I.hold=h,I.bits=f};const Ur=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Pr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Br=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Hr=(e,t,n,r,i,a,s,o)=>{const l=o.bits;let u,c,d,h,f,p,_=0,m=0,v=0,g=0,E=0,b=0,y=0,C=0,T=0,N=0,S=null;const I=new Uint16Array(16),w=new Uint16Array(16);let A,M,O,R=null;for(_=0;_<=15;_++)I[_]=0;for(m=0;m<r;m++)I[t[n+m]]++;for(E=l,g=15;g>=1&&0===I[g];g--);if(E>g&&(E=g),0===g)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(v=1;v<g&&0===I[v];v++);for(E<v&&(E=v),C=1,_=1;_<=15;_++)if(C<<=1,C-=I[_],C<0)return-1;if(C>0&&(0===e||1!==g))return-1;for(w[1]=0,_=1;_<15;_++)w[_+1]=w[_]+I[_];for(m=0;m<r;m++)0!==t[n+m]&&(s[w[t[n+m]]++]=m);if(0===e?(S=R=s,p=20):1===e?(S=Ur,R=Pr,p=257):(S=Fr,R=Br,p=0),N=0,m=0,_=v,f=a,b=E,y=0,d=-1,T=1<<E,h=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){A=_-y,s[m]+1<p?(M=0,O=s[m]):s[m]>=p?(M=R[s[m]-p],O=S[s[m]-p]):(M=96,O=0),u=1<<_-y,c=1<<b,v=c;do{c-=u,i[f+(N>>y)+c]=A<<24|M<<16|O}while(0!==c);for(u=1<<_-1;N&u;)u>>=1;if(0!==u?(N&=u-1,N+=u):N=0,m++,0==--I[_]){if(_===g)break;_=t[n+s[m]]}if(_>E&&(N&h)!==d){for(0===y&&(y=E),f+=v,b=_-y,C=1<<b;b+y<g&&(C-=I[b+y],!(C<=0));)b++,C<<=1;if(T+=1<<b,1===e&&T>852||2===e&&T>592)return 1;d=N&h,i[d]=E<<24|b<<16|f-a}}return 0!==N&&(i[f+N]=_-y<<24|64<<16),o.bits=E,0};const{Z_FINISH:Gr,Z_BLOCK:jr,Z_TREES:Vr,Z_OK:qr,Z_STREAM_END:zr,Z_NEED_DICT:Kr,Z_STREAM_ERROR:Yr,Z_DATA_ERROR:Wr,Z_MEM_ERROR:Qr,Z_BUF_ERROR:Xr,Z_DEFLATED:Zr}=cn,Jr=16180,$r=16190,ei=16191,ti=16192,ni=16194,ri=16199,ii=16200,ai=16206,si=16209,oi=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function li(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ui=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Jr||t.mode>16211?1:0},ci=e=>{if(ui(e))return Yr;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Jr,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qr},di=e=>{if(ui(e))return Yr;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ci(e)},hi=(e,t)=>{let n;if(ui(e))return Yr;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Yr:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,di(e))},fi=(e,t)=>{if(!e)return Yr;const n=new li;e.state=n,n.strm=e,n.window=null,n.mode=Jr;const r=hi(e,t);return r!==qr&&(e.state=null),r};let pi,_i,mi=!0;const vi=e=>{if(mi){pi=new Int32Array(512),_i=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Hr(1,e.lens,0,288,pi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Hr(2,e.lens,0,32,_i,0,e.work,{bits:5}),mi=!1}e.lencode=pi,e.lenbits=9,e.distcode=_i,e.distbits=5},gi=(e,t,n,r)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var Ei=di,bi=fi,yi=(e,t)=>{let n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N=0;const S=new Uint8Array(4);let I,w;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ui(e)||!e.output||!e.input&&0!==e.avail_in)return Yr;n=e.state,n.mode===ei&&(n.mode=ti),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,u=n.hold,c=n.bits,d=o,h=l,T=qr;e:for(;;)switch(n.mode){case Jr:if(0===n.wrap){n.mode=ti;break}for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&u,S[1]=u>>>8&255,n.check=ln(n.check,S,2,0),u=0,c=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=si;break}if((15&u)!==Zr){e.msg="unknown compression method",n.mode=si;break}if(u>>>=4,c-=4,C=8+(15&u),0===n.wbits&&(n.wbits=C),C>15||C>n.wbits){e.msg="invalid window size",n.mode=si;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:ei,u=0,c=0;break;case 16181:for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(n.flags=u,(255&n.flags)!==Zr){e.msg="unknown compression method",n.mode=si;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=si;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=ln(n.check,S,2,0)),u=0,c=0,n.mode=16182;case 16182:for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.head&&(n.head.time=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,n.check=ln(n.check,S,4,0)),u=0,c=0,n.mode=16183;case 16183:for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=ln(n.check,S,2,0)),u=0,c=0,n.mode=16184;case 16184:if(1024&n.flags){for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=ln(n.check,S,2,0)),u=0,c=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+f),C)),512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,f,a)),o-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;f=0;do{C=r[a+f++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,f,a)),o-=f,a+=f,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;f=0;do{C=r[a+f++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,f,a)),o-=f,a+=f,C)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=si;break}u=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ei;break;case 16189:for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}e.adler=n.check=oi(u),u=0,c=0,n.mode=$r;case $r:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,Kr;e.adler=n.check=1,n.mode=ei;case ei:if(t===jr||t===Vr)break e;case ti:if(n.last){u>>>=7&c,c-=7&c,n.mode=ai;break}for(;c<3;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}switch(n.last=1&u,u>>>=1,c-=1,3&u){case 0:n.mode=16193;break;case 1:if(vi(n),n.mode=ri,t===Vr){u>>>=2,c-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=si}u>>>=2,c-=2;break;case 16193:for(u>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=si;break}if(n.length=65535&u,u=0,c=0,n.mode=ni,t===Vr)break e;case ni:n.mode=16195;case 16195:if(f=n.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;i.set(r.subarray(a,a+f),s),o-=f,a+=f,l-=f,s+=f,n.length-=f;break}n.mode=ei;break;case 16196:for(;c<14;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(n.nlen=257+(31&u),u>>>=5,c-=5,n.ndist=1+(31&u),u>>>=5,c-=5,n.ncode=4+(15&u),u>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=si;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;c<3;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.lens[A[n.have++]]=7&u,u>>>=3,c-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},T=Hr(0,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,T){e.msg="invalid code lengths set",n.mode=si;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;N=n.lencode[u&(1<<n.lenbits)-1],m=N>>>24,v=N>>>16&255,g=65535&N,!(m<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(g<16)u>>>=m,c-=m,n.lens[n.have++]=g;else{if(16===g){for(w=m+2;c<w;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(u>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=si;break}C=n.lens[n.have-1],f=3+(3&u),u>>>=2,c-=2}else if(17===g){for(w=m+3;c<w;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=m,c-=m,C=0,f=3+(7&u),u>>>=3,c-=3}else{for(w=m+7;c<w;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=m,c-=m,C=0,f=11+(127&u),u>>>=7,c-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=si;break}for(;f--;)n.lens[n.have++]=C}}if(n.mode===si)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=si;break}if(n.lenbits=9,I={bits:n.lenbits},T=Hr(1,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,T){e.msg="invalid literal/lengths set",n.mode=si;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},T=Hr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,T){e.msg="invalid distances set",n.mode=si;break}if(n.mode=ri,t===Vr)break e;case ri:n.mode=ii;case ii:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,xr(e,h),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,u=n.hold,c=n.bits,n.mode===ei&&(n.back=-1);break}for(n.back=0;N=n.lencode[u&(1<<n.lenbits)-1],m=N>>>24,v=N>>>16&255,g=65535&N,!(m<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(v&&!(240&v)){for(E=m,b=v,y=g;N=n.lencode[y+((u&(1<<E+b)-1)>>E)],m=N>>>24,v=N>>>16&255,g=65535&N,!(E+m<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=E,c-=E,n.back+=E}if(u>>>=m,c-=m,n.back+=m,n.length=g,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=ei;break}if(64&v){e.msg="invalid literal/length code",n.mode=si;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(w=n.extra;c<w;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;N=n.distcode[u&(1<<n.distbits)-1],m=N>>>24,v=N>>>16&255,g=65535&N,!(m<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(!(240&v)){for(E=m,b=v,y=g;N=n.distcode[y+((u&(1<<E+b)-1)>>E)],m=N>>>24,v=N>>>16&255,g=65535&N,!(E+m<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=E,c-=E,n.back+=E}if(u>>>=m,c-=m,n.back+=m,64&v){e.msg="invalid distance code",n.mode=si;break}n.offset=g,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(w=n.extra;c<w;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=si;break}n.mode=16204;case 16204:if(0===l)break e;if(f=h-l,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=si;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),_=n.window}else _=i,p=s-n.offset,f=n.length;f>l&&(f=l),l-=f,n.length-=f;do{i[s++]=_[p++]}while(--f);0===n.length&&(n.mode=ii);break;case 16205:if(0===l)break e;i[s++]=n.length,l--,n.mode=ii;break;case ai:if(n.wrap){for(;c<32;){if(0===o)break e;o--,u|=r[a++]<<c,c+=8}if(h-=l,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?ln(n.check,i,h,s-h):sn(n.check,i,h,s-h)),h=l,4&n.wrap&&(n.flags?u:oi(u))!==n.check){e.msg="incorrect data check",n.mode=si;break}u=0,c=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=si;break}u=0,c=0}n.mode=16208;case 16208:T=zr;break e;case si:T=Wr;break e;case 16210:return Qr;default:return Yr}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,(n.wsize||h!==e.avail_out&&n.mode<si&&(n.mode<ai||t!==Gr))&&gi(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?ln(n.check,i,h,e.next_out-h):sn(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ei?128:0)+(n.mode===ri||n.mode===ni?256:0),(0===d&&0===h||t===Gr)&&T===qr&&(T=Xr),T},Ci=e=>{if(ui(e))return Yr;let t=e.state;return t.window&&(t.window=null),e.state=null,qr},Ti=(e,t)=>{if(ui(e))return Yr;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,qr):Yr},Ni=(e,t)=>{const n=t.length;let r,i,a;return ui(e)?Yr:(r=e.state,0!==r.wrap&&r.mode!==$r?Yr:r.mode===$r&&(i=1,i=sn(i,t,n,0),i!==r.check)?Wr:(a=gi(e,t,n,n),a?(r.mode=16210,Qr):(r.havedict=1,qr)))},Si=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ii=Object.prototype.toString,{Z_NO_FLUSH:wi,Z_FINISH:Ai,Z_OK:Mi,Z_STREAM_END:Oi,Z_NEED_DICT:Ri,Z_STREAM_ERROR:Di,Z_DATA_ERROR:ki,Z_MEM_ERROR:Li}=cn;function xi(e){this.options=fr({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new br,this.strm.avail_out=0;let n=bi(this.strm,t.windowBits);if(n!==Mi)throw new Error(un[n]);if(this.header=new Si,Ti(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=vr(t.dictionary):"[object ArrayBuffer]"===Ii.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ni(this.strm,t.dictionary),n!==Mi)))throw new Error(un[n])}function Ui(e,t){const n=new xi(t);if(n.push(e),n.err)throw n.msg||un[n.err];return n.result}xi.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Ai:wi,"[object ArrayBuffer]"===Ii.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=yi(n,s),a===Ri&&i&&(a=Ni(n,i),a===Mi?a=yi(n,s):a===ki&&(a=Ri));n.avail_in>0&&a===Oi&&n.state.wrap>0&&0!==e[n.next_in];)Ei(n),a=yi(n,s);switch(a){case Di:case ki:case Ri:case Li:return this.onEnd(a),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||a===Oi))if("string"===this.options.to){let e=Er(n.output,n.next_out),t=n.next_out-e,i=gr(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==Mi||0!==o){if(a===Oi)return a=Ci(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},xi.prototype.onData=function(e){this.chunks.push(e)},xi.prototype.onEnd=function(e){e===Mi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=pr(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Pi={Inflate:xi,inflate:Ui,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Ui(e,t)},ungzip:Ui};const{Deflate:Fi,deflate:Bi,deflateRaw:Hi,gzip:Gi}=kr,{Inflate:ji,inflate:Vi,inflateRaw:qi,ungzip:zi}=Pi;var Ki,Yi={Deflate:Fi,deflate:Bi,deflateRaw:Hi,gzip:Gi,Inflate:ji,inflate:Vi,inflateRaw:qi,ungzip:zi,constants:cn},Wi=function(e){return N(void 0,0,void 0,(function(){var t;return S(this,(function(n){return t=Yi.ungzip(e),[2,String.fromCharCode.apply(null,t)]}))}))},Qi=function(e){return N(void 0,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof H))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},Xi=function(e){return N(void 0,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(Ki||(Ki={}));var Zi,Ji=function(e){function t(t,n){var r=n.sdkState,i=n.dispatcher,a=n.logger,s=e.call(this)||this;return s.lastActive=0,s._iid=t,s._sdkState=r,s._dispatcher=i,s._logger=a,s}return C(t,e),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.connectionState===Ki.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Ki.CONNECTING;case 1:return Ki.OPEN}return Ki.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){var e;return null!==(e=this._ws)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),t.prototype._handleMessage=function(e){var t=this;e.split("\n").forEach((function(e){if(e){var n=at.createFromRawMessage(t._iid,e);if(t._logger.debug("receive websocket event",n),"LOGI"===n.code)t.dispatch("message",n);else if("PONG"===n.code)t.dispatch("pong");else if("EXPR"===n.code){if(n.payload){var r=new it(n.payload);r.expiresIn>=0&&t._dispatcher.dispatch(r)}}else"NOOP"===n.code||t.dispatch("message",n)}}))},t.prototype.connect=function(e,t){return void 0===t&&(t=""),N(this,0,void 0,(function(){var n=this;return S(this,(function(r){switch(r.label){case 0:return"function"==typeof fetch?[3,2]:[4,Promise.resolve().then((()=>lV))];case 1:r.sent(),r.label=2;case 2:return Xi((function(){return N(n,0,void 0,(function(){return S(this,(function(e){return fetch(this._sdkState.api.host),[2]}))}))})),this._ws=new WebSocket(e,encodeURIComponent(t)),this._ws.onopen=function(){n._logger.debug("websocket open"),n.dispatch("open")},this._ws.onmessage=function(e){return N(n,0,void 0,(function(){var t,n,r,i,a,s,o,l=this;return S(this,(function(u){switch(u.label){case 0:return(null===(o=this._sdkState.websocket)||void 0===o?void 0:o.compression)?e.data instanceof Blob?((t=new FileReader).readAsArrayBuffer(e.data),t.onloadend=function(){return N(l,0,void 0,(function(){var e,n;return S(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wi(t.result)];case 1:return e=r.sent(),this._handleMessage(e),[3,3];case 2:return n=r.sent(),this.error(n),[3,3];case 3:return[2]}}))}))},[3,12]):[3,1]:[3,13];case 1:if(!(e.data instanceof ArrayBuffer))return[3,6];u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Wi(new Uint8Array(e.data))];case 3:return a=u.sent(),this._handleMessage(a),[3,5];case 4:return n=u.sent(),this.error(n),[3,5];case 5:return[3,12];case 6:if(!("undefined"!=typeof Buffer&&e.data instanceof Buffer))return[3,11];u.label=7;case 7:return u.trys.push([7,9,,10]),r=e.data,i=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength),[4,Wi(i)];case 8:return a=u.sent(),this._handleMessage(a),[3,10];case 9:return s=u.sent(),this.error(s),[3,10];case 10:return[3,12];case 11:"string"==typeof e.data&&this._handleMessage(e.data),u.label=12;case 12:return[3,14];case 13:this._handleMessage(e.data),u.label=14;case 14:return[2]}}))}))},this._ws.onerror=function(){n._logger.debug("websocket error"),n.dispatch("error",H.networkError)},this._ws.onclose=function(e){n._logger.debug("websocket close",e.code,e.reason),n.cleanUpWebSocket(),n.dispatch("close")},this.lastActive=Date.now(),[2]}}))}))},t.prototype.cleanUpWebSocket=function(){this._ws&&(this._ws.onopen=St,this._ws.onmessage=St,this._ws.onerror=St,this._ws.onclose=St,this.connectionState===Ki.OPEN&&this._ws.close(1e3,"Normal Closure"),this._ws=void 0)},t.prototype.disconnect=function(){var e=this;return new Promise((function(t){if(e._ws){if(e.connectionState===Ki.CLOSED)return e.cleanUpWebSocket(),void t();e._ws.onclose=function(){e.cleanUpWebSocket(),e.dispatch("close"),t()},e._ws.close()}else t()}))},t.prototype.send=function(e){if(!this._ws)throw H.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},t.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},t}(ye),$i=function(e){function t(t){var n=t.all,r=t.feed,i=t.custom_types,a=t.ts,s=e.call(this)||this;return s.all=n,s.feed=r,s.customTypes=i,s.ts=a,s}return C(t,e),t}(Te),ea=function(){function e(e,t){var n=t.session,r=t.sdkState,i=t.dispatcher,a=t.logger,s=t.useFetchCompat,o=void 0!==s&&s,l=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=a,this.apiClient=new Nt(e,{session:n,sdkState:r,dispatcher:i,logger:a,useFetchCompat:o}),this.websocketClient=new Ji(e,{sdkState:r,dispatcher:i,logger:a}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&l._dispatcher.dispatch(new $i(e.payload.unread_cnt)),e.requestId){if(l._ackStateMap.has(e.requestId)){var t=l._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new H({code:e.payload.code,message:e.payload.message}))}}else l._dispatcher.dispatch(e)})).on("close",(function(){l._ackStateMap.forEach((function(e){e.reject(H.connectionClosed)})),l._ackStateMap.clear()}))}return e.prototype._sendApiRequest=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return N(this,0,void 0,(function(){var t,n,r,i=this;return S(this,(function(a){if(!this._sdkState.websocket)throw H.connectionRequired;if(t=new bt,e.ackRequired){r=function(r,a){i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(i._logger.debug("fail websocket request",e.requestId,r),t.reject(r)):(i._logger.debug("receive websocket ack",e.requestId,e),i._logger.debug("receive websocket ack",a),t.resolve(a)))};try{n=setTimeout((function(){return r(H.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(void 0,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e)}catch(s){r(s)}}else try{this.websocketClient.send(e),t.resolve()}catch(s){t.reject(s)}return[2,t.promise]}))}))},e.prototype.send=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return e instanceof tt?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof st?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw H.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT"}(Zi||(Zi={}));var ta,na,ra=function(e){function t(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return C(t,e),t}(Te),ia=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t}(Te),aa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t}(Te),sa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t}(Te),oa=function(){function e(e){var t,n,r,i;this.isEnabled=null!==(t=e.enabled)&&void 0!==t&&t,this.feedChannels=null!==(n=e.feed_channels)&&void 0!==n?n:{},this.templateListToken=null!==(r=e.template_list_token)&&void 0!==r?r:null,this.settingsUpdatedAt=null!==(i=e.settings_updated_at)&&void 0!==i?i:0}return e.payloadify=function(e){return Ne(Se({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))},e}(),la=function(e){return"sendbird@".concat(e,"/changelog_include_chat_notifications")},ua=function(){function e(e){var t;this.lastUpdatedAt=null!==(t=e.last_updated_at)&&void 0!==t?t:0}return e.payloadify=function(e){return Ne(Se({last_updated_at:e.lastUpdatedAt}))},e}(),ca=function(){function e(e){var t;this.token=null!==(t=e.template_list_token)&&void 0!==t?t:""}return e.payloadify=function(e){return Ne(Se({template_list_token:e.token}))},e}(),da=function(){function e(e){void 0===e&&(e={min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}),this.minStatCount=e.min_stat_count,this.minInterval=1e3*e.min_interval,this.maxStatCountPerRequest=e.max_stat_count_per_request,this.lowerThreshold=e.lower_threshold,this.requestDelayRange=1e3*e.request_delay_range}return e.payloadify=function(e){return Ne(Se({min_stat_count:e.minStatCount,min_interval:e.minInterval/1e3,max_stat_count_per_request:e.maxStatCountPerRequest,lower_threshold:e.lowerThreshold,request_delay_range:e.requestDelayRange/1e3}))},e}(),ha=function(){function e(e){void 0===e&&(e={default:{min_stat_count:100,min_interval:10800,max_stat_count_per_request:1e3,lower_threshold:10,request_delay_range:180}}),this.default=new da(e.default),this.realTime=new da(e.realtime)}return e.payloadify=function(e){return Ne(Se({default:da.payloadify(e.default),realtime:da.payloadify(e.realTime)}))},e}(),fa=1048576;!function(e){e[e.NONE=0]="NONE",e[e.INCLUDE_REPLY=1]="INCLUDE_REPLY",e[e.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",e[e.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL"}(ta||(ta={})),function(e){e[e.NONE=0]="NONE",e[e.INCLUDE_REPLY=1]="INCLUDE_REPLY",e[e.EXCLUDE_REPLY=2]="EXCLUDE_REPLY",e[e.INCLUDE_REPLY_TO_CHANNEL=3]="INCLUDE_REPLY_TO_CHANNEL"}(na||(na={}));var pa=function(){function e(e){var t,n,r,i,a,s,o,l,u;void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?e.file_upload_size_limit*fa:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=null!==(t=e.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(n=e.premium_feature_list)&&void 0!==n?n:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(r=e.multiple_file_send_max_size)&&void 0!==r?r:5,this.allowSdkStatsUpload=null===(i=e.allow_sdk_log_ingestion)||void 0===i||i,this.unreadCountThreadingPolicy=null!==(a=e.unread_cnt_threading_policy)&&void 0!==a?a:ta.NONE,this.lastMessageThreadingPolicy=null!==(s=e.last_msg_threading_policy)&&void 0!==s?s:na.NONE,this.uikitConfigInfo=new ua(null!==(o=e.uikit_config)&&void 0!==o?o:{}),this.notificationInfo=e.notifications?new oa(e.notifications):null,this.messageTemplateInfo=e.message_template?new ca(e.message_template):null,this.statConfigInfo=e.log_publish_config?new ha(e.log_publish_config):new ha,this.disableSuperGroupMack=null!==(l=e.disable_supergroup_mack)&&void 0!==l&&l,this.configSyncNeeded=null!==(u=e.config_sync_needed)&&void 0!==u&&u}return e.payloadify=function(e){return Ne(Se({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/fa,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,unread_cnt_threading_policy:e.unreadCountThreadingPolicy,last_msg_threading_policy:e.lastMessageThreadingPolicy,uikit_config:e.uikitConfigInfo?ua.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?oa.payloadify(e.notificationInfo):null,message_template:e.messageTemplateInfo?ca.payloadify(e.messageTemplateInfo):null,log_publish_config:e.statConfigInfo?ha.payloadify(e.statConfigInfo):null,disable_supergroup_mack:e.disableSuperGroupMack,config_sync_needed:e.configSyncNeeded}))},e}(),_a=function(e){return"sendbird@".concat(e,"/app_configs_info")},ma=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return{}},e}(),va=function(e){function t(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=Ie.POST,i.path="".concat(Ae,"/").concat(n,"/metadata"),i.params={metadata:r},i}return C(t,e),t}(tt),ga=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaData=n,r}return C(t,e),t}(nt),Ea=function(e){function t(t){var n=t.userId,r=t.metadata,i=t.upsert,a=e.call(this)||this;return a.method=Ie.PUT,a.path="".concat(Ae,"/").concat(n,"/metadata"),a.params={metadata:r,upsert:i},a}return C(t,e),t}(tt),ba=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return C(t,e),t}(nt),ya=function(e){function t(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(n,"/metadata/").concat(r),i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Ca=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.DELETE,r.path="".concat(Ae,"/").concat(n,"/metadata"),r}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Ta,Na=function(e,t){var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},Sa=function(e,t){return JSON.parse(JSON.stringify(e))},Ia=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(Ta||(Ta={}));var wa,Aa=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m=this;return(m=e.call(this,t)||this).userId=null!==(i=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==i?i:"",m.nickname=null!==(s=null!==(a=n.nickname)&&void 0!==a?a:n.name)&&void 0!==s?s:"",m.plainProfileUrl=null!==(l=null!==(o=n.profile_url)&&void 0!==o?o:n.image)&&void 0!==l?l:"",m.requireAuth=null!==(u=n.require_auth_for_profile_image)&&void 0!==u&&u,m.metaData=null!==(c=n.metadata)&&void 0!==c?c:{},m.connectionStatus=Ta.NON_AVAILABLE,z(Ta,n.is_online)?m.connectionStatus=n.is_online:q("boolean",n.is_online)&&(m.connectionStatus=n.is_online?Ta.ONLINE:Ta.OFFLINE),m.isActive=null===(d=n.is_active)||void 0===d||d,m.lastSeenAt=null!==(h=n.last_seen_at)&&void 0!==h?h:null,m.preferredLanguages=n.preferred_languages?A([],w(n.preferred_languages),!1):null,m.friendDiscoveryKey=null!==(f=n.friend_discovery_key)&&void 0!==f?f:null,m.friendName=null!==(p=n.friend_name)&&void 0!==p?p:null,m._hashValue=m._generateHashValue(),m._updatedAt=null!==(_=n.updatedat)&&void 0!==_?_:0,m}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})))},t._buildUserFromSerializedData=function(e){var n=Sa(e);return new t(n._iid,t.payloadify(n))},t.prototype._generateHashValue=function(){for(var e,t=JSON.stringify({userId:this.userId,nickname:this.nickname,plainProfileUrl:this.plainProfileUrl,friendDiscoveryKey:this.friendDiscoveryKey,friendName:this.friendName,metaData:JSON.stringify(this.metaData),performanceLanguages:null===(e=this.preferredLanguages)||void 0===e?void 0:e.toString(),requireAuth:this.requireAuth}),n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n|=0;return n},Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=As.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.prototype.serialize=function(){return Na(this)},t.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return q("string",e)}))},t.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r]}))},t.prototype.createMetaData=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(this._isValidMetaData(e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new va({userId:n.userId,metadata:e}),[4,r.send(i)];case 1:return a=o.sent(),s=a.as(ga).metaData,this._applyMetaData(s),[2,this.metaData]}}))}))},t.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(this._isValidMetaData(e)).throw(H.invalidParameters),n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Ea({userId:r.userId,metadata:e,upsert:t}),[4,i.send(a)];case 1:return s=l.sent(),o=s.as(ba).metadata,this._applyMetaData(o),[2,this.metaData]}}))}))},t.prototype.deleteMetaData=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ya({userId:n.userId,metadataKey:e}),[4,r.send(i)];case 1:return s.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}}))}))},t.prototype.deleteAllMetaData=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ca({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},t}(ma),Ma=function(e){function t(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return C(t,e),t}(Te),Oa=function(){function e(e,t){var n,r,i,a,s,o,l,u,c,d,h,f,p,_;this._iid=e,this.appInfo=new pa(t),this.user=new Aa(e,t),this.connectedAt=null!==(n=t.login_ts)&&void 0!==n?n:0,this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(s=null===(a=t.reconnect)||void 0===a?void 0:a.interval)&&void 0!==s?s:3e3,this.reconnectMaxInterval=null!==(l=null===(o=t.reconnect)||void 0===o?void 0:o.max_interval)&&void 0!==l?l:6e4,this.reconnectRetryCount=null!==(c=null===(u=t.reconnect)||void 0===u?void 0:u.retry_cnt)&&void 0!==c?c:5,this.reconnectIntervalMultiple=null!==(h=null===(d=t.reconnect)||void 0===d?void 0:d.mul)&&void 0!==h?h:2,this.maxUnreadCountOnSuperGroup=null!==(f=t.max_unread_cnt_on_super_group)&&void 0!==f?f:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(p=t.concurrent_call_limit)&&void 0!==p?p:5,this.backOffDelay=null!==(_=t.back_off_delay)&&void 0!==_?_:100}return e.payloadify=function(e){return Ne(Se(T(T(T({},Aa.payloadify(e.user)),pa.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=As.of(this._iid);r.sdkState.websocket&&(r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}}),r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new Ma({userProfile:this}))},e}(),Ra=function(e){function t(t){var n=t.request,r=void 0===n||n,i=t.features,a=void 0===i?{}:i,s=t.options,o=void 0===s?{}:s,l=t.statConfigInfo,u=e.call(this)||this;return u.request=r,u.features=T({localCache:!0,notification:!0},a),u.options=T({ingestion:!0},o),u.statConfigInfo=l,u}return C(t,e),t}(Te),Da=function(e){function t(t){var n=e.call(this)||this;return n.configSyncNeeded=!1,n.configSyncNeeded=t,n}return C(t,e),t}(Te),ka=function(e){function t(t,n,r){var i,a,s,o,l=this;return(l=e.call(this,t,n,r)||this).error=null,l.services=[],l.userProfile=new Oa(t,r),l.deviceTokenLastDeletedAt=null!==(i=r.device_token_last_deleted_at)&&void 0!==i?i:0,l.key=null!==(a=r.key)&&void 0!==a?a:"",l.ekey=null!==(s=r.ekey)&&void 0!==s?s:"",l.error=r.error?new H(r):null,l.services=null!==(o=r.services)&&void 0!==o?o:[],l}return C(t,e),t.asError=function(e){return new t("","LOGI",T({user_id:"",error:!0},e))},t.prototype.applyTo=function(e){return N(this,0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return this.error?[3,4]:(t=As.of(e))?(n=t.sessionManager,r=t.dispatcher,[4,n.login(this)]):[3,2];case 1:return i.sent(),this.userProfile.apply(),r.dispatch(new Da(this.userProfile.appInfo.configSyncNeeded)),r.dispatch(new Ra({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload},statConfigInfo:this.userProfile.appInfo.statConfigInfo})),[3,3];case 2:throw H.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}}))}))},t}(at),La=function(){function e(){this.type=Zi.NONE,this.name="none"}return e.prototype.run=function(e){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,t.cause,N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.onDisconnectWebSocket=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},e}(),xa=function(e){function t(t){void 0===t&&(t={});var n,r=this;return(r=e.call(this)||this).type=Zi.LOGOUT,r.name="logout",r._wasPreviouslyConnected=null===(n=t.wasPreviouslyConnected)||void 0===n||n,r}return C(t,e),t.prototype.run=function(e){return N(this,0,void 0,(function(){var t,n,r=this;return S(this,(function(i){switch(i.label){case 0:return t=Date.now(),n=e.sdkState.userId,[4,e.logout()];case 1:return i.sent(),[4,e.changeState(new Ya,t)];case 2:return i.sent(),this._wasPreviouslyConnected&&Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onDisconnected&&e.onDisconnected(n)})),[2]}))}))})),[2]}}))}))},t}(La),Ua=function(e){function t(){var t=e.call(this)||this;return t.type=Zi.EXTERNAL_DISCONNECTED,t.name="externaldisconnected",t}return C(t,e),t.prototype.run=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.disconnect()];case 1:return t.sent(),[2]}}))}))},t.prototype.onConnect=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return r.sent(),[4,e.changeState(new qa({authToken:t}),n)];case 2:return r.sent(),[2]}}))}))},t.prototype.onReconnect=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ga,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new xa,t)];case 1:return n.sent(),[2]}}))}))},t}(La),Pa=function(e){function t(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=Zi.INTERNAL_DISCONNECTED,r.name="internaldisconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return C(t,e),t.prototype.run=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),this._autoReconnect?[4,e.changeState(new Ga,t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onConnect=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return r.sent(),[4,e.changeState(new qa({authToken:t}),n)];case 2:return r.sent(),[2]}}))}))},t.prototype.onReconnect=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ga,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onDisconnectWebSocket=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ua,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new xa,t)];case 1:return n.sent(),[2]}}))}))},t}(La),Fa=function(e){return N(void 0,0,void 0,(function(){return S(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},Ba=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),Ha=function(e,t,n){return void 0===n&&(n=new Ba),N(void 0,0,void 0,(function(){var r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:r=0,i=null,a=function(e){return i=null!=e?e:new Error("Halted")},s=function(){r=0},u.label=1;case 1:if(!(-1===t||r<t))return[3,9];u.label=2;case 2:return u.trys.push([2,4,,8]),[4,e(a,s)];case 3:if(o=u.sent(),i)throw i;return[2,o];case 4:if(l=u.sent(),i)return[3,6];if(++r===t)throw l;return[4,Fa(n.calcTimeout(r))];case 5:return u.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}}))}))},Ga=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Zi.RECONNECTING,t.name="reconnecting",t._callbacks=[],t}return C(t,e),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))},t.prototype.run=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:t=Date.now(),n=new bt,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),Qi((function(){return N(o,0,void 0,(function(){return S(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted&&e.onReconnectStarted()})),[2]}))}))})),l.label=1;case 1:return l.trys.push([1,4,,9]),r=e.sdkState.websocket,i=r.reconnectMaxRetry,a=r.reconnectRetryStrategy,[4,Ha((function(t,n){return N(o,0,void 0,(function(){var r;return S(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if(r=i.sent(),e.clearLoginTimer(),r instanceof H){if(r.code===M.CONNECTION_CANCELED)return t(r),[2];if(r.isSessionExpiredError||r.isSessionInvalidatedError)return t(r),[2]}throw r;case 4:return[2]}}))}))}),i,a)];case 2:return l.sent(),[4,e.changeState(new ja,t)];case 3:return l.sent(),this._flushCallbacks(),Qi((function(){return N(o,0,void 0,(function(){return S(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded&&e.onReconnectSucceeded()})),[2]}))}))})),[3,9];case 4:return s=l.sent(),B(s)?[3,7]:s instanceof H?s.code===M.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Pa({autoReconnect:!1}),t)]:[3,6];case 5:l.sent(),l.label=6;case 6:return this._flushCallbacks(s),Qi((function(){return N(o,0,void 0,(function(){return S(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed&&e.onReconnectFailed()})),[2]}))}))})),[3,8];case 7:throw s;case 8:return[3,9];case 9:return[2,n.promise]}}))}))},t.prototype.onConnect=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){return n=new bt,this._halt(H.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var r=Date.now();e.changeState(new qa({authToken:t}),r).then((function(){n.resolve()})).catch((function(e){n.reject(e)}))})),[2,n.promise]}))}))},t.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,r=void 0!==n&&n;return N(this,0,void 0,(function(){var e;return S(this,(function(t){return e=new bt,this._resetConnect&&r&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},t.prototype.onDisconnect=function(e,t){t._error;var n=t.autoReconnect,r=void 0===n||n;return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new Pa({autoReconnect:r}),t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onDisconnectWebSocket=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new Ua,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new xa,t)];case 1:return n.sent(),[2]}}))}))},t}(La),ja=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Zi.CONNECTED,t.name="connected",t}return C(t,e),t.prototype.onReconnect=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),[4,e.changeState(new Ga,t)];case 2:return n.sent(),[2]}}))}))},t.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return N(this,0,void 0,(function(){var t;return S(this,(function(r){switch(r.label){case 0:return t=Date.now(),[4,e.changeState(new Pa({autoReconnect:n}),t)];case 1:return r.sent(),[2]}}))}))},t.prototype.onDisconnectWebSocket=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ua,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new xa,t)];case 1:return n.sent(),[2]}}))}))},t}(La);!function(e){e.ExternalSetBackground="ExternalSetBackground",e.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket"}(wa||(wa={}));var Va=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,i=t.connectionHandlers,a=t.sessionManager,s=t.websocketClient,o=t.dispatcher,l=t.logger,u=t.disableWebSocketCloseEventHandling,c=void 0!==u&&u;this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=l,this._disableWebSocketCloseEventHandling=c,this._context=new Za(e,{sdkState:n,cacheContext:r,connectionHandlers:i,sessionManager:a,websocketClient:s,dispatcher:o,logger:l}),this._sdkState=n,this._sessionManager=a,this._websocketClient=s}return e.prototype._registerEventDispatcher=function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),Xi((function(){return N(e,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this.reconnect()];case 1:return e.sent(),[2]}}))}))})))})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"!==e._sdkState.appState||e._webSocketClosedCause||Xi((function(){return N(e,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._sessionManager.isSessionKeyRefreshing?[3,2]:(this._logger.debug("try reconnect by websocket connection closed"),[4,this.reconnect()]);case 1:return e.sent(),[3,4];case 2:return[4,this.disconnectWebSocket()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}))})))},e.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===Zi.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Zi.CONNECTING||e.type===Zi.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onConnect(this._context,e)];case 1:return n.sent(),this._registerEventDispatcher(),[2]}}))}))},e.prototype.reconnect=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onReconnect(this._context,{})];case 1:return t.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.background=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=wa.ExternalSetBackground,[4,e.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0,cause:this._webSocketClosedCause})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnectWebSocket=function(e){return void 0===e&&(e=!1),N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,e&&(this._webSocketClosedCause=wa.ExternalDisconnectWebSocket),[4,t.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})];case 1:return n.sent(),[2]}}))}))},e.prototype.logout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,this._clearEventDispatcher(),[4,t.onLogout(this._context,e)];case 1:return n.sent(),[2]}}))}))},e}(),qa=function(e){function t(t){var n=t.authToken,r=e.call(this)||this;return r.type=Zi.CONNECTING,r.name="connecting",r._authToken="",r._callbacks=[],r._authToken=n,r}return C(t,e),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))},t.prototype.run=function(e){return N(this,0,void 0,(function(){var t,n,r,i=this;return S(this,(function(a){switch(a.label){case 0:t=Date.now(),n=new bt,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),a.label=1;case 1:return a.trys.push([1,4,,10]),[4,Ha((function(t){return N(i,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if(n=r.sent(),e.clearLoginTimer(),n instanceof H&&n.code===M.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new ja,t)];case 3:return a.sent(),Qi((function(){return N(i,0,void 0,(function(){return S(this,(function(t){return this._flushCallbacks(),e.connectionHandlers.forEach((function(t){t.onConnected&&t.onConnected(e.sdkState.userId)})),[2]}))}))})),[3,10];case 4:return r=a.sent(),B(r)?[3,8]:[4,e.disconnect()];case 5:return a.sent(),r instanceof H?r.code===M.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new Ya,t)]:[3,7];case 6:a.sent(),a.label=7;case 7:return Qi((function(){return N(i,0,void 0,(function(){return S(this,(function(e){return this._flushCallbacks(r),[2]}))}))})),[3,9];case 8:throw r;case 9:return[3,10];case 10:return[2,n.promise]}}))}))},t.prototype.onConnect=function(e){return N(this,0,void 0,(function(){var e;return S(this,(function(t){return e=new bt,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},t.prototype.onDisconnect=function(e,t){var n=t.error,r=void 0===n?null:n,i=t.autoReconnect,a=void 0!==i&&i,s=t.cause,o=void 0===s?null:s;return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(null!=r?r:za(o)),e.hasSession?[4,e.changeState(new Pa({autoReconnect:a}),t)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.changeState(new xa,t)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.onDisconnectWebSocket=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return this._halt(za((null==t?void 0:t.cause)||null)),n=Date.now(),e.hasSession?[4,e.changeState(new Ua,n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.changeState(new xa,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},t.prototype.onLogout=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=Date.now(),this._halt(null!=t?t:H.connectionCanceled),[4,e.changeState(new xa,n)];case 1:return r.sent(),[2]}}))}))},t}(La);function za(e){var t=H.connectionCanceled;if(e){var n=null;switch(e){case wa.ExternalSetBackground:n="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case wa.ExternalDisconnectWebSocket:n="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}n&&t.setDetail(n)}return t}var Ka,Ya=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Zi.INITIALIZED,t.name="initialized",t}return C(t,e),t.prototype.onConnect=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.changeState(new qa({authToken:t}),n)];case 1:return r.sent(),[2]}}))}))},t.prototype.onLogout=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new xa({wasPreviouslyConnected:!1}),t)];case 1:return n.sent(),[2]}}))}))},t}(La),Wa=function(e){function t(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return C(t,e),t}(st),Qa=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this.pingDelegate=t,this.sdkState=n,this._logger=r}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this;if(!this.sdkState.websocket)throw H.connectionRequired;var n=new Wa;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error()}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(i){this._logger.debug("pinger.ping() error",i),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},e.prototype.refreshTimer=function(){var e,t=this;if(!this.sdkState.websocket)throw H.connectionRequired;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},e}(),Xa=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications","message_template"],Za=function(e){function t(t,n){var r,i=n.sdkState,a=n.cacheContext,s=n.connectionHandlers,o=n.sessionManager,l=n.websocketClient,u=n.dispatcher,c=n.logger,d=n.entryState,h=void 0===d?new Ya:d,f=this;return(f=e.call(this)||this)._stateUpdatedAt=0,f._connectingAt=0,f._connectedAt=0,f._logiReceivedAt=0,f._connectionRequestQueue=[],f._iid=t,f.sdkState=i,f.cacheContext=a,f.connectionHandlers=s,f._sessionManager=o,f._websocketClient=l,f._dispatcher=u,f._logger=c,f._currentState=h,(null===(r=f.sdkState.websocket)||void 0===r?void 0:r.pingerDisabled)||(f._pinger=new Qa({pingDelegate:{send:function(e){return f._websocketClient.send(e)},error:function(e){return f._websocketClient.error(e)}},sdkState:f.sdkState,logger:c})),f._websocketClient.on("open",(function(){f._connectedAt=Date.now(),f._tryResolveConnectionRequest()})).on("message",(function(e){"LOGI"===e.code&&(f.clearLoginTimer(),f._dispatcher.dispatch(e.as(ka)))})).on("ping-refresh",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=f._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){f._logiProcessingTimer=setTimeout((function(){f._logiProcessingTimer=void 0,f._unresolvedLogi||f._rejectConnectionRequest(H.networkError)}),500)})),f._dispatcher.on((function(e){e instanceof ka&&(f._unresolvedLogi=e,f._tryResolveConnectionRequest())})),f}return C(t,e),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSession",{get:function(){return this._sessionManager.session.hasSession},enumerable:!1,configurable:!0}),t.prototype.changeState=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return t>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=t,this._dispatcher.dispatch(new ra({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return n.sent(),[2,!0];case 2:return[2,!1]}}))}))},t.prototype._tryResolveConnectionRequest=function(){var e;return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=this._unresolvedLogi,this._websocketClient.isOpen&&t?(this._unresolvedLogi=void 0,this._logiReceivedAt=Date.now(),t.error?[3,2]:[4,t.applyTo(this._iid)]):[3,3];case 1:return n.sent(),this._statLogConnection(),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.session.authToken=void 0,t.error.isSessionExpiredError||t.error.isSessionInvalidatedError?this._dispatcher.dispatch(new it({reason:t.error.code,message:t.error.message})):this._logger.warn("login failed: ".concat(t.error)),this._rejectConnectionRequest(t.error),n.label=3;case 3:return[2]}}))}))},t.prototype._rejectConnectionRequest=function(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var n=this._connectionRequestQueue;this._connectionRequestQueue=[],n.forEach((function(t){return t.reject(e)})),this._statLogConnection(e)}},t.prototype._url=function(e){var t,n=e.configTs,r=this.sdkState,i=r.appId,a=r.appVersion,s=r.userId,o=r.extensions,l=r.sendbirdRuntimeEnvironment,u=this.cacheContext.localCacheEnabled,c=this._sessionManager.session,d=null===(t=this.sdkState.websocket)||void 0===t?void 0:t.compression,h=!!(null!=o?o:{}).sb_uikit,f=Et.userAgentWithExtension(o);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(D.OS_VERSION),"&sv=").concat(encodeURIComponent(D.SDK_VERSION),"&ai=").concat(i).concat(a?"&av=".concat(a):"").concat(c.hasSession?"":"&user_id=".concat(encodeURIComponent(s)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(f,"&SB-SDK-User-Agent=").concat(encodeURIComponent(Et.sendbirdSdkUserAgentWithExtension(l)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(Xa))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(u?1:0,"&include_poll_details=1").concat(h?"&uikit_config=1":"","&config_ts=").concat(n)},t.prototype._statLogConnection=function(e){var t;this._dispatcher.dispatch(new dt(new mt({type:et.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:this._connectedAt>0?this._connectedAt-this._connectingAt:Date.now()-this._connectingAt,logi_latency:this._logiReceivedAt>0?this._logiReceivedAt-this._connectingAt:void 0,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},t.prototype.connect=function(e){var t;return void 0===e&&(e=""),N(this,0,void 0,(function(){var n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(H.connectionCanceled)),n=new bt,this._connectionRequestQueue.push(n),1!==this._connectionRequestQueue.length?[3,2]:(this._connectingAt=Date.now(),this._connectedAt=0,this._logiReceivedAt=0,this._loginTimer=setTimeout((function(){o._loginTimer=void 0,o._rejectConnectionRequest(H.loginTimeout)}),null===(t=this.sdkState.websocket)||void 0===t?void 0:t.responseTimeout),r=this._sessionManager.session,e&&(r.authToken=e,r.sessionKey=void 0),i=0,[4,this.cacheContext.preference.get(_a(this.sdkState.appId))]);case 1:(a=l.sent())&&(i=a.configTs),s=this._url({configTs:i}),r.sessionKey||r.authToken?this._websocketClient.connect(s,JSON.stringify(r.hasSession?{auth:r.sessionKey}:{token:r.authToken})):this._websocketClient.connect(s,JSON.stringify({})),l.label=2;case 2:return[2,n.promise]}}))}))},t.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ka.asError(H.connectionRenew))},t.prototype.disconnect=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}}))}))},t.prototype.logout=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this.disconnect()];case 1:return e.sent(),[4,this._sessionManager.clear()];case 2:return e.sent(),[2]}}))}))},t.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},t}(ye),Ja=function(e){function t(t){var n=t.appId,r=t.userId,i=t.includeUIKitConfig,a=void 0!==i&&i,s=t.localCacheEnabled,o=void 0===s||s,l=t.expiringSession,u=void 0===l||l,c=t.configTs,d=void 0===c?0:c,h=e.call(this)||this;return h.path="".concat(Me,"/").concat(r,"/authentication"),h.method=Ie.POST,h.params=Ne({expiring_session:!!u,include_logi:!0,include_extra_data:String(Xa),uikit_config:a,use_local_cache:o,app_id:n,config_ts:d}),h.requireAuth=!1,h}return C(t,e),t}(tt),$a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.logi=new ka(t,"LOGI",n),r}return C(t,e),t}(nt);!function(e){e[e.ALL=0]="ALL",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.API=2]="API"}(Ka||(Ka={}));var es,ts,ns=[ot,Ja],rs=function(){function e(e,t){var n=t.session,r=t.sdkState,i=t.dispatcher,a=t.logger,s=t.useFetchCompat,o=void 0!==s&&s,l=this;this._currentConnectionStateType=Zi.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new ea(e,{session:n,sdkState:r,dispatcher:i,logger:a,useFetchCompat:o}),this._session=n,this._logger=a,this._dispatcher=i,this._dispatcher.on((function(e){var t,n,r;if(e instanceof ra){var i=e.stateType;switch(l._currentConnectionStateType=i,i){case Zi.CONNECTED:l._resolveLazyCallQueue();break;case Zi.INITIALIZED:case Zi.INTERNAL_DISCONNECTED:case Zi.EXTERNAL_DISCONNECTED:case Zi.LOGOUT:l._session.isRefreshing||l._rejectLazyCallQueue((null===(r=l._session)||void 0===r?void 0:r.hasSession)?H.connectionClosed:H.connectionRequired)}}else if(e instanceof ia)l._session.hasChatServicePermission||l._resolveLazyCallQueue(Ka.API);else if(e instanceof aa||e instanceof sa)l._rejectLazyCallQueue(H.connectionClosed);else if(e instanceof ht){var a=e.request,s=e.deferred,o=e.error;try{for(var u=I(ns),c=u.next();!c.done;c=u.next())if(a instanceof c.value)return void s.reject(o)}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}l._lazyCallQueue.push({command:a,deferred:s})}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Zi.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Zi.CONNECTING||this._currentConnectionStateType===Zi.RECONNECTING||this._session.isRefreshing},enumerable:!1,configurable:!0}),e.prototype._classifyLazyCallQueueByScope=function(e){var t,n=[],r=[];switch(e){case Ka.ALL:t=null;break;case Ka.WEBSOCKET:t=st;break;case Ka.API:t=tt}var i=!1;return this._lazyCallQueue.forEach((function(e){!t||e.command instanceof t||(i=!0),i?r.push(e):n.push(e)})),[n,r]},e.prototype._resolveLazyCallQueue=function(e){var t=this;void 0===e&&(e=Ka.ALL);var n=w(this._classifyLazyCallQueueByScope(e),2),r=n[0],i=n[1];this._lazyCallQueue=i,r.forEach((function(e){return N(t,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:t=e.command,n=e.deferred,(r=e.timeout)&&clearTimeout(r),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.send(t)];case 2:return i=s.sent(),n.resolve(i),[3,4];case 3:return a=s.sent(),n.reject(a),[3,4];case 4:return[2]}}))}))}))},e.prototype._rejectLazyCallQueue=function(e,t){var n=this;void 0===t&&(t=Ka.ALL);var r=w(this._classifyLazyCallQueueByScope(t),2),i=r[0],a=r[1];this._lazyCallQueue=a,i.forEach((function(t){return N(n,0,void 0,(function(){var n,r;return S(this,(function(i){return n=t.deferred,r=t.timeout,clearTimeout(r),n.reject(e),[2]}))}))}))},e.prototype.send=function(e){return N(this,0,void 0,(function(){var t,n,r=this;return S(this,(function(i){switch(i.label){case 0:return e instanceof st?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:case 7:return[2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new bt,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),H.connectionRequired;case 3:case 9:return[3,11];case 4:return e instanceof tt?this._session.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,10];case 6:return e.hasSessionKey?(this._logger.debug("send api request with tmp session key",e),[4,this.commandRouter.send(e)]):[3,8];case 8:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new bt,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=H.connectionRequired,this._logger.debug("fail api request",n),n;case 10:throw H.invalidCommand;case 11:return[2]}}))}))},e.prototype.forceSend=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this._logger.debug("send forced request",e),e instanceof st||e instanceof tt?[4,this.commandRouter.send(e)]:[3,2];case 1:return[2,t.sent()];case 2:throw H.invalidCommand}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(H.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),is="sendbird@devicetokens",as=function(){function e(e){var t=e.type,n=e.token,r=e.device_os,i=e.device_manufacturer,a=e.system_push_enabled;this.type=t,this.token=n,this.deviceOS=r,this.deviceManufacturer=i,this.systemPushEnabled=a}return e.payloadify=function(e){return Ne(Se({type:e.type,token:e.token,device_os:e.deviceOS,device_manufacturer:e.deviceManufacturer,system_push_enabled:e.systemPushEnabled}))},e}(),ss=new WeakMap,os=function(e){function t(t){var n=t._iid,r=t.session,i=t.cacheContext,a=t.sdkState,s=t.dispatcher,o=t.requestQueue,l=t.logger,u=t.pushNotificationAckManager,c=e.call(this)||this;return c._currentConnectionStateType=Zi.INITIALIZED,c._isRefreshingAuthToken=!1,c.currentUser=null,c.session=r,c._iid=n,c._cacheContext=i,c._sdkState=a,c._dispatcher=s,c._requestQueue=o,c._logger=l,c._pushNotificationAckManager=u,c._deviceTokens=[],c._dispatcher.on((function(e){var t,n,r;if(e instanceof ra){var i=e.stateType;c._currentConnectionStateType=i}else if(e instanceof it&&c.handler&&!c.isSessionKeyRefreshing){if(c._currentConnectionStateType===Zi.CONNECTING)return;(null===(t=e.error)||void 0===t?void 0:t.isSessionInvalidatedError)?c.close():((null===(n=e.error)||void 0===n?void 0:n.isSessionTokenExpiredError)&&c.refreshAuthToken().catch((function(e){if(B(e)&&"foreground"===c._sdkState.appState)throw e})),(null===(r=e.error)||void 0===r?void 0:r.isSessionKeyExpiredError)&&(c._logger.debug("session expired"),c.handler.onSessionExpired&&c.handler.onSessionExpired(),c.refreshSessionKey().catch((function(e){if(B(e)&&"foreground"===c._sdkState.appState)throw e}))))}})),c}return C(t,e),Object.defineProperty(t.prototype,"ekey",{get:function(){return ss.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),t.prototype.indexOfDeviceToken=function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))},t.prototype.hasDeviceToken=function(e,t){return this.indexOfDeviceToken(e,t)>=0},t.prototype.createRefreshWebsocketCommand=function(e,t){return new lt({authToken:e,expiringSession:!0,requestId:t})},t.prototype._refreshSessionKeyByWebSocket=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return t=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(t)];case 1:if(n=s.sent(),r=n.as(ct),i=r.newKey,a=r.error)throw a;return this.session.sessionKey=null!=i?i:this.session.sessionKey,[2]}}))}))},t.prototype._refreshSessionKeyByApi=function(e){return N(this,0,void 0,(function(){var t,n=this;return S(this,(function(r){switch(r.label){case 0:return t=new ot({userId:this._sdkState.userId,authToken:e,services:this.session.services&&this.session.services.length>0?this.session.services:void 0,expiringSession:!0}),[4,Ha((function(e){return N(n,0,void 0,(function(){var n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(t)];case 1:return n=o.sent(),r=n.as(ut),i=r.key,a=r.services,this.session.sessionKey=i,this.session.services=a,[3,3];case 2:if(s=o.sent(),!this._isSessionRelatedError(s))throw s;return e(s),[3,3];case 3:return[2]}}))}))}),3)];case 1:return r.sent(),[2]}}))}))},t.prototype._refreshSessionKey=function(e,t){return void 0===t&&(t=!0),N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:if(this._currentConnectionStateType!==Zi.CONNECTED)return[3,8];i.label=1;case 1:return i.trys.push([1,3,,8]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return i.sent(),this.complete(),[2];case 3:n=i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,this._handleSessionRefreshError(n,t)];case 5:return i.sent(),[2];case 6:return i.sent(),[3,7];case 7:return[3,8];case 8:return i.trys.push([8,10,,12]),[4,this._refreshSessionKeyByApi(e)];case 9:return i.sent(),this.complete(),[3,12];case 10:return r=i.sent(),[4,this._handleSessionRefreshError(r,t)];case 11:return i.sent(),[3,12];case 12:return[2]}}))}))},t.prototype._receiveNewAuthToken=function(){var e,t=this,n=new bt;if(this._isRefreshingAuthToken=!0,this.session.sessionKey=void 0,this.session.authToken=void 0,null===(e=this.handler)||void 0===e?void 0:e.onSessionTokenRequired){var r=null,i=function(){r&&(clearTimeout(r),r=null)},a=function(e){i(),t._isRefreshingAuthToken&&(t._isRefreshingAuthToken=!1,n.resolve(e))},s=function(e){i(),t._isRefreshingAuthToken&&(t._isRefreshingAuthToken=!1,n.reject(e))};r=setTimeout((function(){return s()}),1e3*this._sdkState.sessionTokenRefreshTimeout),Qi((function(){return N(t,0,void 0,(function(){var e;return S(this,(function(t){return(null===(e=this.handler)||void 0===e?void 0:e.onSessionTokenRequired)&&this.handler.onSessionTokenRequired(a,s),[2]}))}))}))}else n.resolve(null);return n.promise},t.prototype._handleSessionRefreshError=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return e instanceof H&&(e.isSessionTokenExpiredError||e.code===M.APPLICATION_NOT_FOUND)?(this.session.authToken=void 0,t?[4,this._receiveNewAuthToken()]:[3,6]):[3,6];case 1:return(n=r.sent())?(this.session.authToken=n,[4,this._refreshSessionKey(this.session.authToken,!1)]):[3,3];case 2:return r.sent(),[3,5];case 3:return[4,this.clear()];case 4:r.sent(),r.label=5;case 5:return[2];case 6:throw e}}))}))},t.prototype._isSessionRelatedError=function(e){return e instanceof H&&(e.isSessionExpiredError||e.isSessionInvalidatedError)},Object.defineProperty(t.prototype,"isSessionKeyRefreshing",{get:function(){return this.session.isRefreshing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiring",{get:function(){return!!this.handler},enumerable:!1,configurable:!0}),t.prototype.authenticate=function(e,t){var n;return N(this,0,void 0,(function(){var r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return this.session.authToken=t,r=0,[4,this._cacheContext.preference.get(_a(this._sdkState.appId))];case 1:return(i=l.sent())&&(r=i.configTs),a=new Ja({appId:this._sdkState.appId,userId:e,includeUIKitConfig:!!(null!==(n=this._sdkState.extensions)&&void 0!==n?n:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:this.isSessionExpiring,configTs:r}),[4,this._requestQueue.commandRouter.send(a)];case 2:return s=l.sent(),(o=s.as($a).logi).error?[3,5]:this.session.hasChatServicePermission?[3,4]:[4,o.applyTo(this._iid)];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:throw o.error;case 6:return[2]}}))}))},t.prototype.login=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return n=e.key,r=e.ekey,i=e.services,a=e.userProfile,s=e.deviceTokenLastDeletedAt,o=void 0===s?0:s,this.session.sessionKey=n,this.session.services=i,ss.set(this,r),this._deviceTokenCacheEnabled=null===(t=null==a?void 0:a.appInfo)||void 0===t?void 0:t.deviceTokenCache,l=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,l.get(is)]:[3,5];case 1:return!(u=c.sent())||u.lastDeletedAt<o?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=o,[4,this.saveDeviceToken()]):[3,3];case 2:return c.sent(),[3,4];case 3:this._deviceTokens=u.tokens.map((function(e){return new as(as.payloadify(e))})),this._deviceTokenLastDeletedAt=u.lastDeletedAt,c.label=4;case 4:return[3,7];case 5:return[4,l.remove(is)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))},t.prototype.complete=function(){var e=this;this.dispatch("refresh"),this._dispatcher.dispatch(new ia),Qi((function(){return N(e,0,void 0,(function(){var e;return S(this,(function(t){return this._logger.debug("session refreshed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionRefreshed)&&this.handler.onSessionRefreshed(),[2]}))}))}))},t.prototype.error=function(e){var t=this;Qi((function(){return N(t,0,void 0,(function(){var t;return S(this,(function(n){return(null===(t=this.handler)||void 0===t?void 0:t.onSessionError)&&this.handler.onSessionError(e),[2]}))}))}))},t.prototype.close=function(){var e=this;this.dispatch("close"),this._dispatcher.dispatch(new sa),Qi((function(){return N(e,0,void 0,(function(){var e;return S(this,(function(t){return this._logger.debug("session closed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionClosed)&&this.handler.onSessionClosed(),[2]}))}))}))},t.prototype.refreshAuthToken=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:if(e=null,!this.isSessionExpiring||this.session.isRefreshing)return[3,9];this.session.isRefreshing=!0,n.label=1;case 1:return n.trys.push([1,7,8,9]),[4,this._receiveNewAuthToken()];case 2:return(e=n.sent())?(this._logger.debug("session refreshing.."),this.session.authToken=e,[4,this._refreshSessionKey(this.session.authToken)]):[3,4];case 3:return n.sent(),[3,6];case 4:return[4,this.clear()];case 5:n.sent(),n.label=6;case 6:return[3,9];case 7:throw n.sent(),t=e?H.sessionTokenRefreshFailed:H.sessionTokenRequestFailed,this._dispatcher.dispatch(new aa),this.error(t),this._logger.debug("refresh auth token error = ",t),t;case 8:return this.session.isRefreshing=!1,[7];case 9:return[2]}}))}))},t.prototype.refreshSessionKey=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:if(!this.isSessionExpiring||this.session.isRefreshing)return[3,5];this.session.isRefreshing=!0,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this._refreshSessionKey(this.session.authToken)];case 2:return t.sent(),[3,5];case 3:throw t.sent(),e=H.sessionTokenRefreshFailed,this._dispatcher.dispatch(new aa),this.error(e),e;case 4:return this.session.isRefreshing=!1,[7];case 5:return[2]}}))}))},t.prototype.setDeviceToken=function(e,t,n){if(this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,t)<0){var r=new as({type:e,token:t,device_os:null==n?void 0:n.deviceOS,device_manufacturer:null==n?void 0:n.deviceManufacturer,system_push_enabled:null==n?void 0:n.systemPushEnabled});return this._deviceTokens.push(r),!0}return!1},t.prototype.unsetDeviceToken=function(e,t){if(this._deviceTokenCacheEnabled){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1)}},t.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((function(t){return t.type!==e})):[])},t.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},t.prototype.saveDeviceToken=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(is,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.currentUser=null,this.session.clear(),this.close(),ss.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),this._pushNotificationAckManager.clear(),[2]}}))}))},t}(ye),ls=function(e,t){var n,r;if(null!==e&&null!==t){var i=Object.keys(e),a=Object.keys(t),s=A([],w(new Set(A(A([],w(i),!1),w(a),!1))),!1),o={};try{for(var l=I(s),u=l.next();!u.done;u=l.next()){var c=u.value,d=typeof e[c],h=typeof t[c];"undefined"===d?o[c]=t[c]:"undefined"===h?o[c]=e[c]:d!==h?o[c]=t[c]:"object"===d&&e[c]&&t[c]?o[c]=ls(e[c],t[c]):o[c]=t[c]}}catch(f){n={error:f}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return o}return t};!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED"}(es||(es={})),function(e){e.DAILY="daily",e.DEFAULT="default",e.REALTIME="realtime"}(ts||(ts={}));var us,cs=100,ds=function(){function e(e){var t=e.deviceId,n=e.cacheContext,r=e.requestQueue;this.queue=[],this.flushWaitQueue=[],this.enabledState=es.PENDING,this.isFlushing=!1,this._sentLogStats=[],this.deviceId=t,this.cacheContext=n,this.requestQueue=r,this.logInfo={deviceId:t,statLogs:[],generation:1,lastFlushedAt:0},this.limit=cs}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledState===es.ENABLED},enumerable:!1,configurable:!0}),e.prototype.init=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(t=n.sent())&&(this.logInfo=t),[2]}}))}))},e.prototype._mergeQueue=function(){this.flushWaitQueue.length>0&&(this.queue=this.queue.concat(this.flushWaitQueue),this.flushWaitQueue=[])},e.prototype._isDuplicateStat=function(e){var t=this._sentLogStats.find((function(t){var n;return t.channelUrl===e.data.channel_url&&t.messageId===(null!==(n=e.data.notificationId)&&void 0!==n?n:e.data.message_id)&&t.action===e.data.action}));return t||this._sentLogStats.push({channelUrl:e.data.channel_url,messageId:e.data.message_id,action:e.data.action}),!!t},e.prototype._save=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=A(A([],w(this.queue),!1),w(this.flushWaitQueue),!1),[4,this.cacheContext.preference.set(this.key,{deviceId:this.logInfo.deviceId,statLogs:e.map((function(e){return mt.payloadify(e)})),generation:this.logInfo.generation++,lastFlushedAt:this.logInfo.lastFlushedAt})];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return this.queue=[],this.flushWaitQueue=[],this.logInfo.generation=1,this._save(),[2]}))}))},e}(),hs=function(e){function t(t){var n,r,i,a,s=t.type,o=t.data,l=t.ts,u=void 0===l?Date.now():l,c=e.call(this,{type:s,data:o,ts:u})||this;return c.date=new Date(u),c.key="".concat((n=c.date,r=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0"),"".concat(r).concat(i).concat(a)),"_").concat(s),c}return C(t,e),t}(mt),fs=function(e){function t(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=Ie.POST,i.path="".concat(je),i.params={device_id:n,log_entries:r.map((function(e){return mt.payloadify(e)}))},i}return C(t,e),t}(tt),ps=function(e){function t(t){var n=t.deviceId,r=t.cacheContext,i=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:r,requestQueue:i})||this}return C(t,e),Object.defineProperty(t.prototype,"_isSendable",{get:function(){return 0!==this.queue.length&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval},enumerable:!1,configurable:!0}),t.prototype.init=function(t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.init.call(this,t+".daily")];case 1:return n.sent(),this.queue=this.logInfo.statLogs.map((function(e){return new mt({type:e.stat_type,ts:e.ts,data:e.data})})),[2]}}))}))},t.prototype.setConfig=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this.statConfig=e,this.statConfig.minInterval=864e5,this._mergeQueue(),t.localCacheStat?(this.enabledState=t.enabledStat?es.ENABLED:es.COLLECT_ONLY,[3,3]):[3,1];case 1:return this.enabledState=es.DISABLED,[4,this.clear()];case 2:s.sent(),s.label=3;case 3:return this.isEnabled&&this._isSendable?[4,this._getUploadStats()]:[3,9];case 4:n=s.sent(),r=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),i=0,s.label=5;case 5:return i<n.length?(a=n.slice(i,1+this.statConfig.maxStatCountPerRequest),[4,Fa(r)]):[3,9];case 6:return s.sent(),[4,this._flush(a)];case 7:s.sent(),s.label=8;case 8:return i+=this.statConfig.maxStatCountPerRequest,[3,5];case 9:return[2]}}))}))},t.prototype.put=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return this.enabledState===es.DISABLED?[2,!0]:(t=this.enabledState===es.PENDING||this.isFlushing?this.flushWaitQueue:this.queue,n=w(t.filter((function(t){return t instanceof hs&&t.key===e.key})),1),(r=n[0])?r.data=ls(r.data,e.data):t.push(e),this.enabledState===es.PENDING?[3,2]:[4,this._save()]);case 1:a.sent(),a.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this._isSendable?[4,this._getUploadStats()]:[3,5]):[3,5];case 3:return i=a.sent(),[4,this._flush(i)];case 4:return[2,a.sent()];case 5:return[2,!0]}}))}))},t.prototype._getUploadStats=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,this.queue.filter((function(e){if(e instanceof hs){var t=new Date,n=w([e.date.getFullYear(),t.getFullYear()],2),r=n[0],i=n[1];if(r<i)return!0;if(r===i){var a=w([e.date.getMonth(),t.getMonth()],2),s=a[0],o=a[1];if(s<o)return!0;if(s===o){var l=w([e.date.getDate(),t.getDate()],2);return l[0]<l[1]}}}return!1}))]}))}))},t.prototype._flush=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,a.label=1;case 1:return a.trys.push([1,4,8,9]),n=A([],w(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),r=new fs({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(r)];case 2:return a.sent(),this.queue=A([],w(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=cs,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return a.sent(),[3,9];case 4:return(i=a.sent())instanceof H?i.code!==M.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return a.sent(),this.enabledState=es.DISABLED,[3,7];case 6:i.code===M.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=es.COLLECT_ONLY),a.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,a.label=11;case 11:return[2,t]}}))}))},t}(ds),_s=function(e){function t(t){var n=t.deviceId,r=t.cacheContext,i=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:r,requestQueue:i})||this}return C(t,e),t.prototype._isSendable=function(e){if(void 0===e&&(e=!1),this.queue.length<this.statConfig.lowerThreshold)return!1;if(e){if(Date.now()-this.logInfo.lastFlushedAt<this.statConfig.minInterval)return!1}else if(this.queue.length<this.statConfig.minStatCount)return!1;return!0},t.prototype._filterQueueByType=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){return[2,t?e.filter((function(e){return e.type!==et.FEATURE_LOCALCACHE_EVENT})):e.filter((function(e){return e.type===et.FEATURE_LOCALCACHE_EVENT}))]}))}))},t.prototype.init=function(t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.init.call(this,t+".default")];case 1:return n.sent(),this.queue=this.logInfo.statLogs.map((function(e){return e.data=T({message_init_policy:"",starting_point:0},e.data),new mt({type:e.stat_type,ts:e.ts,data:e.data})})),[2]}}))}))},t.prototype.setConfig=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this.statConfig=e,this._mergeQueue(),t.requestStat||t.localCacheStat?(this.enabledState=t.enabledStat?es.ENABLED:es.COLLECT_ONLY,n=void 0,t.requestStat||(n=!1),t.localCacheStat||(n=!0),void 0===n?[3,3]:(r=this,[4,this._filterQueueByType(this.queue,n)])):[3,4];case 1:return r.queue=s.sent(),i=this,[4,this._filterQueueByType(this.flushWaitQueue,n)];case 2:i.flushWaitQueue=s.sent(),this._save(),s.label=3;case 3:return[3,6];case 4:return this.enabledState=es.DISABLED,[4,this.clear()];case 5:s.sent(),s.label=6;case 6:return this.isEnabled&&this._isSendable(!0)?(a=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),[4,Fa(a)]):[3,9];case 7:return s.sent(),[4,this._flush(this.queue)];case 8:s.sent(),s.label=9;case 9:return[2]}}))}))},t.prototype.put=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.enabledState===es.DISABLED?[2,!0]:((t=this.enabledState===es.PENDING||this.isFlushing?this.flushWaitQueue:this.queue).push(e),this.enabledState===es.PENDING?[3,2]:[4,this._save()]);case 1:n.sent(),n.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this._isSendable()?[4,this._flush(t)]:[3,4]):[3,4];case 3:return[2,n.sent()];case 4:return[2,!0]}}))}))},t.prototype._flush=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,a.label=1;case 1:return a.trys.push([1,4,8,9]),n=A([],w(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),r=new fs({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(r)];case 2:return a.sent(),this.queue=A([],w(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=cs,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return a.sent(),[3,9];case 4:return(i=a.sent())instanceof H?i.code!==M.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return a.sent(),this.enabledState=es.DISABLED,[3,7];case 6:i.code===M.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=es.COLLECT_ONLY),a.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,a.label=11;case 11:return[2,t]}}))}))},t}(ds),ms=function(e){function t(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=Ie.POST,i.path="".concat(Ve),i.params={device_id:n,log_entries:r.map((function(e){return mt.payloadify(e)}))},i}return C(t,e),t}(tt),vs=function(e){function t(t){var n=t.deviceId,r=t.cacheContext,i=t.requestQueue;return e.call(this,{deviceId:n,cacheContext:r,requestQueue:i})||this}return C(t,e),Object.defineProperty(t.prototype,"_isSendable",{get:function(){return this.queue.length>=this.statConfig.minStatCount&&this.queue.length>this.statConfig.lowerThreshold||this.logInfo.lastFlushedAt>0&&Date.now()-this.logInfo.lastFlushedAt>=this.statConfig.minInterval},enumerable:!1,configurable:!0}),t.prototype.init=function(t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.init.call(this,t+".realtime")];case 1:return n.sent(),this.queue=this.logInfo.statLogs.map((function(e){var t;return e.data=Ne(T(T({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),new mt({type:e.stat_type,ts:e.ts,data:e.data})})),this._sentLogStats=this.queue.map((function(e){var t;return{channelUrl:e.data.channelUrl,messageId:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,action:e.data.action}})),[2]}}))}))},t.prototype.setConfig=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return this.statConfig=e,this._mergeQueue(),t.notificationStat?(this.enabledState=t.enabledStat?es.ENABLED:es.COLLECT_ONLY,[3,3]):[3,1];case 1:return this.enabledState=es.DISABLED,[4,this.clear()];case 2:r.sent(),r.label=3;case 3:return this.isEnabled&&this._isSendable?(n=Math.max(Math.floor(Math.random()*this.statConfig.requestDelayRange),100),[4,Fa(n)]):[3,6];case 4:return r.sent(),[4,this._flush(this.queue)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},t.prototype.put=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.enabledState===es.DISABLED?[2,!0]:(t=this.enabledState===es.PENDING||this.isFlushing?this.flushWaitQueue:this.queue,this._isDuplicateStat(e)?[2,!0]:(t.push(e),this.enabledState===es.PENDING?[3,2]:[4,this._save()]));case 1:n.sent(),n.label=2;case 2:return this.isEnabled?(this._mergeQueue(),this.isEnabled&&this._isSendable?[4,this._flush(t)]:[3,4]):[3,4];case 3:return[2,n.sent()];case 4:return[2,!0]}}))}))},t.prototype._flush=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:if(t=!0,!(e.length>0))return[3,10];if(this.isFlushing)return[3,9];this.isFlushing=!0,a.label=1;case 1:return a.trys.push([1,4,8,9]),n=A([],w(e),!1).slice(0,Math.min(this.limit,this.statConfig.maxStatCountPerRequest)),r=new ms({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(r)];case 2:return a.sent(),this.queue=A([],w(e),!1).slice(n.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=cs,this.logInfo.lastFlushedAt=Date.now(),[4,this._save()];case 3:return a.sent(),[3,9];case 4:return(i=a.sent())instanceof H?i.code!==M.NON_AUTHORIZED?[3,6]:[4,this.clear()]:[3,7];case 5:return a.sent(),this.enabledState=es.DISABLED,[3,7];case 6:i.code===M.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=es.COLLECT_ONLY),a.label=7;case 7:return this.limit=this.limit+20,t=!1,[3,9];case 8:return this.isFlushing=!1,[7];case 9:return[3,11];case 10:this.isFlushing=!1,a.label=11;case 11:return[2,t]}}))}))},t}(ds),gs=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.logger;this._collectRequestStat=!0,this._collectFeatureLocalCacheStat=!0,this._collectionNotificationStat=!0,this._retryCount=0,this.deviceId=Ee(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.logger=i,this._dailyStatCollector=new ps({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._defaultStatCollector=new _s({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue}),this._notificationStatCollector=new vs({deviceId:this.deviceId,cacheContext:this.cacheContext,requestQueue:this.requestQueue})}return e.prototype._migration=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return[4,this.cacheContext.preference.get(this.key)];case 1:return(e=i.sent())?(t=[],e.statLogs.forEach((function(e){e.stat_type===et.FEATURE_LOCALCACHE&&t.push(new mt({type:e.stat_type,ts:e.ts,data:e.data}))})),[4,this.cacheContext.preference.set(this.key+".daily",{deviceId:e.deviceId,statLogs:t.map((function(e){return mt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})]):[3,6];case 2:return i.sent(),n=[],e.statLogs.forEach((function(e){e.stat_type!==et.FEATURE_LOCALCACHE&&e.stat_type!==et.NOTIFICATION&&(e.stat_type===et.FEATURE_LOCALCACHE_EVENT&&(e.data=T({message_init_policy:"",starting_point:0},e.data)),n.push(new mt({type:e.stat_type,ts:e.ts,data:e.data})))})),[4,this.cacheContext.preference.set(this.key+".default",{deviceId:e.deviceId,statLogs:n.map((function(e){return mt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})];case 3:return i.sent(),r=[],e.statLogs.forEach((function(e){var t;e.stat_type===et.NOTIFICATION&&(e.data=Ne(T(T({},e.data),{message_id:null!==(t=e.data.notificationId)&&void 0!==t?t:e.data.message_id,notificationId:void 0})),r.push(new mt({type:e.stat_type,ts:e.ts,data:e.data})))})),[4,this.cacheContext.preference.set(this.key+".realtime",{deviceId:e.deviceId,statLogs:r.map((function(e){return mt.payloadify(e)})),generation:e.generation,lastFlushedAt:e.lastFlushedAt})];case 4:return i.sent(),[4,this.cacheContext.preference.remove(this.key)];case 5:i.sent(),i.label=6;case 6:return[2]}}))}))},e.prototype.init=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this.key=e,[4,this._migration()];case 1:return n.sent(),[4,this._dailyStatCollector.init(this.key)];case 2:return n.sent(),[4,this._defaultStatCollector.init(this.key)];case 3:return n.sent(),[4,this._notificationStatCollector.init(this.key)];case 4:return n.sent(),this.commandEventContext||(this.commandEventContext=this.dispatcher.on((function(e){return N(t,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){return e instanceof dt?(t=e.statLog,this.put(t)):e instanceof Ra&&(n=e.request,r=e.features,i=e.options,a=e.statConfigInfo,this._retryCount=0,this._collectRequestStat=n,this._collectFeatureLocalCacheStat=null==r?void 0:r.localCache,this._collectionNotificationStat=null==r?void 0:r.notification,this._statConfig=a,this._dailyStatCollector.setConfig(this._statConfig.default,{localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:i.ingestion}),this._defaultStatCollector.setConfig(this._statConfig.default,{requestStat:this._collectRequestStat,localCacheStat:this._collectFeatureLocalCacheStat,enabledStat:i.ingestion}),this._notificationStatCollector.setConfig(null!==(s=this._statConfig.realTime)&&void 0!==s?s:this._statConfig.default,{notificationStat:this._collectionNotificationStat,enabledStat:i.ingestion})),[2]}))}))}))),[2]}}))}))},e.prototype.put=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=!0,e instanceof hs?this._collectFeatureLocalCacheStat?[4,this._dailyStatCollector.put(e)]:[3,2]:[3,3];case 1:t=n.sent(),n.label=2;case 2:return[3,13];case 3:switch(e.type){case et.API_RESULT:case et.WEBSOCKET_CONNECT:return[3,4];case et.FEATURE_LOCALCACHE:case et.FEATURE_LOCALCACHE_EVENT:return[3,7];case et.NOTIFICATION:return[3,10]}return[3,13];case 4:return this._collectRequestStat?[4,this._defaultStatCollector.put(e)]:[3,6];case 5:t=n.sent(),n.label=6;case 6:return[3,13];case 7:return this._collectFeatureLocalCacheStat?[4,this._defaultStatCollector.put(e)]:[3,9];case 8:t=n.sent(),n.label=9;case 9:return[3,13];case 10:return this._collectionNotificationStat?[4,this._notificationStatCollector.put(e)]:[3,12];case 11:t=n.sent(),n.label=12;case 12:return[3,13];case 13:return t?this._retryCount=0:(this._retryCount++,this._retryCount>20&&(this._dailyStatCollector.enabledState=es.COLLECT_ONLY,this._defaultStatCollector.enabledState=es.COLLECT_ONLY,this._notificationStatCollector.enabledState=es.COLLECT_ONLY,this.logger.debug(H.statLogUploadLimitExceededError))),[2]}}))}))},e.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},e}(),Es=function(){function e(e){var t=e.limit,n=void 0===t?5:t;this.workersByKey={},this.limit=n}return e.prototype.run=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return this.workersByKey[e]||(this.workersByKey[e]=[]),this.workersByKey[e].length<this.limit?(this.workersByKey[e].push(t),[4,t()]):[3,2];case 1:return n=r.sent(),this.workersByKey[e].pop(),[2,n];case 2:throw H.tooManyRequests}}))}))},e.prototype.clear=function(e){this.workersByKey[e]=[]},e}();!function(e){e.DELIVERY_RECEIPT="delivery_receipt",e.PUSH_ACKNOWLEDGEMENT="push_acknowledgement"}(us||(us={}));var bs,ys,Cs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pushAckedCache={},t}return C(t,e),t.prototype.isAcked=function(e,t){var n,r="".concat(e,"_").concat(t);return null!==(n=this._pushAckedCache[r])&&void 0!==n&&n},t.prototype.markAsAcked=function(e,t){var n="".concat(e,"_").concat(t);this._pushAckedCache[n]=!0},t.prototype.clear=function(){As.of(this._iid).logger.debug("clear push acked cache"),this._pushAckedCache={}},t.prototype.parseData=function(e){var t,n,r,i,a=As.of(this._iid).logger,s=e.sendbird;if("string"==typeof s)try{s=JSON.parse(s)}catch(_){throw a.info("push notification payload does not contain sendbird payload in JSON format."),H.malformedDataError}if(!s||"object"!=typeof s)throw a.info("push notification payload does not contain sendbird payload in JSON format."),H.malformedDataError;var o=null!==(t=s.push_tracking_id)&&void 0!==t?t:"",l=s.notification_message_id,u=s.notification_channel_key,c=s.notification_template_key,d=s.notification_event_deadline,h=null!==(n=s.session_key)&&void 0!==n?n:{},f=null!==(r=null==h?void 0:h.key)&&void 0!==r?r:"",p=null!==(i=null==h?void 0:h.topics)&&void 0!==i?i:[];if("string"!=typeof o||0===o.length)throw a.info("push tracking id is not available"),H.malformedDataError;if("string"!=typeof l||0===l.length)throw a.info("message id is not available"),H.malformedDataError;return{pushTrackingId:o,sessionKey:f,sessionTopics:p,messageId:l,channelKey:u,templateKey:c,notificationEventDeadline:d}},t}(ma),Ts=function(e){this.name=e.name,this._custom=e.custom,this._usedByModerationEngine=e.used_by_moderation_engine},Ns=function(e){function t(){var t=e.call(this)||this;return t.method=Ie.GET,t.path=Ye,t}return C(t,e),t}(tt),Ss=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reportCategories=n.categories,r}return C(t,e),t}(nt),Is=function(e){function t(t){var n=e.call(this,t)||this;return n._categories=[],n}return C(t,e),t.prototype.categories=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return 0!==this._categories.length?[3,2]:[4,this._fetchCategories()];case 1:e.sent(),e.label=2;case 2:return[2,this._categories]}}))}))},t.prototype._fetchCategories=function(){return N(this,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return e=As.of(this._iid).requestQueue,t=new Ns,[4,e.send(t)];case 1:return n=a.sent(),(r=n.as(Ss).reportCategories)&&(i=this._categories).push.apply(i,A([],w(r.map((function(e){return new Ts(e)}))),!1)),[2]}}))}))},t}(ma),ws={},As=function(){function e(e,t){var n,r,i,a,s,o,l,u,c;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!ws[e]){ws[e]=this;var d=null!==(n=t.options)&&void 0!==n?n:new J,h=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(i=t.apiHost)&&void 0!==i?i:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(a=t.websocketHost)&&void 0!==a?a:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new Ba,responseTimeout:d.websocketResponseTimeout},sessionTokenRefreshTimeout:d.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var f=this.logger=t.logger;this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var p=this.cacheContext=new te({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(s=t.localCacheEnabled)&&void 0!==s&&s,localCacheConfig:null!==(o=t.localCacheConfig)&&void 0!==o?o:new ie});this.debugMode=null!==(l=t.debugMode)&&void 0!==l&&l,this.maxSuperGroupChannelUnreadCount=D.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=d.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=d.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=d.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var _=this.dispatcher=new Ce,m=new ge;this.requestQueue=new rs(e,{session:m,sdkState:h,dispatcher:_,logger:f,useFetchCompat:t.useFetchCompat}),this.pushNotificationAckManager=new Cs(e),this.sessionManager=new os({_iid:e,session:m,cacheContext:p,sdkState:h,dispatcher:_,requestQueue:this.requestQueue,logger:f,pushNotificationAckManager:this.pushNotificationAckManager}),this.connectionManager=new Va(e,{sdkState:h,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:_,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(u=t.disableWebSocketCloseEventHandling)&&void 0!==u&&u,logger:f}),this.statManager=new gs({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:this.dispatcher,logger:f}),this.appStateToggleEnabled=null===(c=t.appStateToggleEnabled)||void 0===c||c,this.messageBackgroundSyncThrottleController=new Es({limit:5}),this.reportCategoryManager=new Is(e)}return ws[e]}return e.of=function(e){if(ws[e])return ws[e];throw H.lostInstance},e.clear=function(e){ws[e]&&delete ws[e]},e.prototype.hasExtension=function(e){return this.sdkState.extensions&&this.sdkState.extensions[e]},e}(),Ms=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,a=t.requestQueue,s=t.logger;t.onlineDetector;var o=t.cacheContext;this._iid=e,this._cacheContext=o,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=a,this._logger=s},e}();!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",e.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",e.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",e.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",e.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",e.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",e.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.REFRESH_CHANNEL="REFRESH_CHANNEL",e.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",e.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",e.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.EVENT_THREAD_INFO_UPDATED="EVENT_THREADINFO_UPDATED",e.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",e.EVENT_POLL_VOTED="EVENT_POLL_VOTED",e.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"}(bs||(bs={})),T({},bs);var Os=function(e){return e.startsWith("EVENT_")||e.startsWith("LOCAL_MESSAGE_")||e===bs.SYNC_MESSAGE_FILL||e===bs.SYNC_MESSAGE_CHANGELOGS||e===bs.SYNC_POLL_CHANGELOGS},Rs=function(e){function t(t){var n=t.messages,r=t.source,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=e.call(this)||this;return s.messages=n,s.source=r,s.isWebSocketEventComing=a,s}return C(t,e),t}(Te),Ds=function(e){function t(t){var n=t.messageIds,r=t.source,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=e.call(this)||this;return s.messageIds=n,s.source=r,s.isWebSocketEventComing=a,s}return C(t,e),t}(Te),ks=function(e){function t(t){var n=t.messageDeletionTimestamp,r=t.channelUrl,i=t.source,a=e.call(this)||this;return a.messageDeletionTimestamp=n,a.channelUrl=r,a.source=i,a}return C(t,e),t}(Te),Ls=function(e){function t(t){var n=t.event,r=t.source,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=e.call(this)||this;return s.event=n,s.source=r,s.isWebSocketEventComing=a,s}return C(t,e),t}(Te),xs=function(e){function t(t){var n=t.event,r=t.source,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=e.call(this)||this;return s.event=n,s.source=r,s.isWebSocketEventComing=a,s}return C(t,e),t}(Te),Us=function(e){function t(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return C(t,e),t}(Te),Ps=function(e){function t(t){var n=t.polls,r=t.source,i=e.call(this)||this;return i.polls=n,i.source=r,i}return C(t,e),t}(Te),Fs=function(e){function t(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return C(t,e),t}(Te),Bs=function(e){function t(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return C(t,e),t}(Te);!function(e){e.OPEN="open",e.CLOSED="closed"}(ys||(ys={}));var Hs,Gs="removed",js=function(e){switch(e){case"open":return ys.OPEN;case"closed":return ys.CLOSED;default:return null}},Vs=function(e){return!e||!!e.text&&q("string",e.text)},qs=function(e){function t(t,n){var r,i,a,s,o,l,u,c=this;return(c=e.call(this,t)||this).pollId=0,c.id=0,c.text=null,c.voteCount=0,c.createdBy=null,c.createdAt=0,c.updatedAt=0,c._lastVotedAt=0,c.pollId=null!==(r=n.poll_id)&&void 0!==r?r:0,c.id=null!==(i=n.id)&&void 0!==i?i:0,c.text=null!==(a=n.text)&&void 0!==a?a:null,c.voteCount=null!==(s=n.vote_count)&&void 0!==s?s:0,c.createdBy=null!==(o=n.created_by)&&void 0!==o?o:null,c.createdAt=null!==(l=n.created_at)&&void 0!==l?l:0,c.updatedAt=null!==(u=n.updated_at)&&void 0!==u?u:0,c}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})))},t}(ma),zs=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m=this;return(m=e.call(this,t)||this).id=0,m.title=null,m.createdAt=0,m.updatedAt=0,m.closeAt=-1,m.status=ys.CLOSED,m.messageId=0,m.data=null,m.voterCount=-1,m.options=[],m.createdBy=null,m.allowUserSuggestion=!1,m.allowMultipleVotes=!1,m.votedPollOptionIds=[],m.id=null!==(r=n.id)&&void 0!==r?r:0,m.title=null!==(i=n.title)&&void 0!==i?i:null,m.createdAt=null!==(a=n.created_at)&&void 0!==a?a:0,m.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,m.closeAt=null!==(o=n.close_at)&&void 0!==o?o:-1,m.status=null!==(l=js(n.status))&&void 0!==l?l:ys.CLOSED,m.messageId=null!==(u=n.message_id)&&void 0!==u?u:0,m.data=null!==(c=n.data)&&void 0!==c?c:null,m.voterCount=null!==(d=n.voter_count)&&void 0!==d?d:-1,m.options=n.options?n.options.map((function(e){return new qs(m._iid,e)})):[],m.createdBy=null!==(h=n.created_by)&&void 0!==h?h:null,m.allowUserSuggestion=null!==(f=n.allow_user_suggestion)&&void 0!==f&&f,m.allowMultipleVotes=null!==(p=n.allow_multiple_votes)&&void 0!==p&&p,m.votedPollOptionIds=null!==(_=n.voted_option_ids)&&void 0!==_?_:[],m}return C(t,e),t.prototype._applyPollUpdatePayload=function(e){var t,n,r,i,a,s,o,l,u=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(i=js(e.status))&&void 0!==i?i:this.status,this.data=null!==(a=e.data)&&void 0!==a?a:this.data,this.voterCount=null!==(s=e.voter_count)&&void 0!==s?s:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new qs(u._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(l=e.allow_multiple_votes)&&void 0!==l?l:this.allowMultipleVotes},t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((function(e){return qs.payloadify(e)})),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})))},t.prototype.applyPollUpdateEvent=function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt||(this._applyPollUpdatePayload(t),0))},t.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,i=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var a=t[r];i>=a._lastVotedAt&&(a.voteCount=e.vote_count,a._lastVotedAt=i)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),"number"==typeof r.voter_count&&(this.voterCount=r.voter_count),!0},t.prototype.serialize=function(){return Na(this)},t}(ma),Ks=function(){function e(e,t){var n;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return q("number",this.limit)&&this.limit>0},e}(),Ys=function(e){function t(t,n,r,i){var a=e.call(this,t,i)||this;return a.channelUrl=n,a.channelType=r,a}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("string",this.channelUrl)&&z(ae,this.channelType)},t}(Ks),Ws=function(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e},Qs=function(e){function t(t){var n=t.title,r=t.optionTexts,i=t.data,a=t.allowUserSuggestion,s=t.allowMultipleVotes,o=t.closeAt,l=e.call(this)||this;return l.method=Ie.POST,l.path=Be,l.params={title:n,options:r,data:i,allow_user_suggestion:a,allow_multiple_votes:s,close_at:o},l}return C(t,e),t}(tt),Xs=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),Zs=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,a=e.call(this)||this;return a.method=Ie.GET,a.path="".concat(Be,"/").concat(encodeURIComponent(i)),a.params={channel_url:n,channel_type:r},a}return C(t,e),t}(tt),Js=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),$s=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,a=t.pollOptionId,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Be,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(a)),s.params={channel_url:n,channel_type:r},s}return C(t,e),t}(tt),eo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pollOption=new qs(t,n),r}return C(t,e),t}(nt),to=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,a=t.token,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/polls/changelogs"),s.params=Ne({change_ts:i,token:a}),s}return C(t,e),t}(tt),no=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedPolls=n.updated.map((function(e){return new zs(t,e)})),r.deletedPollIds=n.deleted.map((function(e){return e})),r.hasMore=n.has_more,r.nextToken=n.next,r}return C(t,e),t}(nt),ro={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},io=function(e){return q("string",e.title)&&(t=e.optionTexts,Y("string",t)&&t.every((function(e){return""!==e.trim()})))&&Vs(e.data)&&q("boolean",e.allowUserSuggestion,!0)&&q("boolean",e.allowMultipleVotes,!0)&&q("number",e.closeAt,!0);var t},ao={channelUrl:"",channelType:ae.BASE,pollId:0,pollOptionId:0},so=function(e){return q("string",e.channelUrl)&&""!==e.channelUrl&&z(ae,e.channelType)&&q("number",e.pollId)&&e.pollId>0&&q("number",e.pollOptionId)&&e.pollOptionId>0},oo={channelUrl:"",channelType:ae.BASE,pollId:0},lo=function(e){return q("string",e.channelUrl)&&""!==e.channelUrl&&z(ae,e.channelType)&&q("number",e.pollId)},uo={},co=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,a=t.requestQueue,s=t.logger;this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=a,this._dispatcher=r,this._logger=s,uo[e]=this}return e.of=function(e){return uo[e]},e.prototype.buildPollFromSerializedData=function(e){var t=Sa(e);return new zs(this._iid,zs.payloadify(t))},e.prototype.get=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return Ia(lo(e)).throw(H.invalidParameters),t=new Zs(T({},e)),[4,this._requestQueue.send(t)];case 1:return[2,n.sent().as(Js).poll]}}))}))},e.prototype.create=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return Ia(io(e)).throw(H.invalidParameters),t=new Qs(T({},e)),[4,this._requestQueue.send(t)];case 1:return[2,n.sent().as(Xs).poll]}}))}))},e.prototype.getOption=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return Ia(so(e)).throw(H.invalidParameters),t=new $s(T({},e)),[4,this._requestQueue.send(t)];case 1:return[2,n.sent().as(eo).pollOption]}}))}))},e.prototype.getPollChangeLogs=function(e,t,n,r){return void 0===r&&(r=bs.SYNC_POLL_CHANGELOGS),N(this,0,void 0,(function(){var i,a,s,o,l,u,c;return S(this,(function(d){switch(d.label){case 0:return i=new to(Se({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),[4,this._requestQueue.send(i)];case 1:return a=d.sent(),s=a.as(no),o=s.updatedPolls,l=s.deletedPollIds,u=s.hasMore,c=s.nextToken,o.length>0&&this._dispatcher.dispatch(new Ps({polls:o,source:r})),[2,{updatedPolls:o,deletedPollIds:l,hasMore:u,token:c}]}}))}))},e}(),ho=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.token,a=t.limit,s=e.call(this)||this;return s.method=Ie.GET,s.path=Be,s.params={channel_url:n,channel_type:r,token:i,limit:a},s}return C(t,e),t}(tt),fo=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).polls=(null!==(r=n.polls)&&void 0!==r?r:[]).map((function(e){return new zs(t,e)})),i.token=n.next,i}return C(t,e),t}(nt),po=function(e){function t(t,n){return e.call(this,t,n.channelUrl,n.channelType,n)||this}return C(t,e),t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new ho(T(T({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(fo),i=r.polls,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),_o=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,a=t.pollOptionId,s=t.token,o=t.limit,l=e.call(this)||this;return l.method=Ie.GET,l.path="".concat(Be,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(a),"/voters"),l.params={channel_url:n,channel_type:r,token:s,limit:o},l}return C(t,e),t}(tt),mo=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).voters=(null!==(r=n.voters)&&void 0!==r?r:[]).map((function(e){return new Aa(t,e)})),i.token=n.next,i}return C(t,e),t}(nt),vo=function(e){function t(t,n){var r=e.call(this,t,n.channelUrl,n.channelType,n)||this;return r.pollId=n.pollId,r.pollOptionId=n.pollOptionId,r}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("number",this.pollId)&&q("number",this.pollOptionId)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new _o(T(T({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(mo),i=r.voters,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),go=function(){function e(e,t,n){var r,i;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=e,this.plainUrl=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(r=t.real_width)&&void 0!==r?r:t.width,this.realHeight=null!==(i=t.real_height)&&void 0!==i?i:t.height,this._requireAuth=n}return e.payloadify=function(t){return Ne(Se(t instanceof e?{url:t.plainUrl,width:t.width,height:t.height,real_width:t.realWidth,real_height:t.realHeight}:{url:"",width:t.maxWidth,height:t.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(e.prototype,"url",{get:function(){var e=As.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),e}(),Eo=function(e){function t(t){var n=e.call(this)||this;if(n.method=Ie.POST,n.path="".concat(Oe),n.params=Ne({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var i=t.thumbnailSizes[r],a=i.maxWidth,s=i.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(a,",").concat(s)}return n.requestId=t.requestId,n}return C(t,e),t}(tt),bo=function(e){function t(t,n){var r,i,a,s,o=this;return(o=e.call(this,t,n)||this).url=n.url,o.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,o.thumbnails=null!==(a=null===(i=n.thumbnails)||void 0===i?void 0:i.map((function(e){return new go(t,e,!1)})))&&void 0!==a?a:[],o.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,o}return C(t,e),t}(nt),yo=function(e){function t(t,n){var r,i,a,s,o,l=this;return(l=e.call(this,t)||this).replyCount=0,l.memberCount=0,l.lastRepliedAt=0,l.updatedAt=0,l.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,l.memberCount=null!==(i=n.member_count)&&void 0!==i?i:0,l.mostRepliedUsers=n.most_replies&&Y("object",n.most_replies)?n.most_replies.map((function(e){return new Aa(l._iid,e)})):[],l.unreadReplyCount=null!==(a=n.unread_message_count)&&void 0!==a?a:0,l.isPushNotificationEnabled="number"==typeof n.push_enabled?n.push_enabled>0:void 0,l.lastRepliedAt=null!==(s=n.last_replied_at)&&void 0!==s?s:0,l.updatedAt=null!==(o=n.updated_at)&&void 0!==o?o:0,l}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{reply_count:t.replyCount,unread_message_count:t.unreadReplyCount,member_count:t.memberCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return Aa.payloadify(e)})):[],push_enabled:"boolean"==typeof t.isPushNotificationEnabled?t.isPushNotificationEnabled?1:0:void 0,last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})))},Object.defineProperty(t.prototype,"_isUpdateRequired",{get:function(){return void 0===this.unreadReplyCount||void 0===this.isPushNotificationEnabled},enumerable:!1,configurable:!0}),t.prototype._updateFrom=function(e){var t,n;this.unreadReplyCount=null!==(t=e.unreadReplyCount)&&void 0!==t?t:this.unreadReplyCount,this.isPushNotificationEnabled=null!==(n=e.isPushNotificationEnabled)&&void 0!==n?n:this.isPushNotificationEnabled},t}(ma);!function(e){e.ADD="add",e.DELETE="delete"}(Hs||(Hs={}));var Co,To=function(e){var t;this.messageId=0,this.operation=null,this.updatedAt=0;var n=q("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,r=e.user_id,i=e.operation?e.operation.toLowerCase():null,a=e.reaction,s=e.updated_at,o=e.count,l=e.sampled_user_ids,u=null!==(t=e.sampled_user_info)&&void 0!==t?t:{};n&&q("string",r)&&q("string",i)&&z(Hs,i)&&q("string",a)&&a&&q("number",s)&&(this.messageId=n,this.userId=r,this.key=a,this.operation=i,this.updatedAt=s,this._count=o,this._sampledUserIds=l,this._sampledUserInfoList=u)},No=function(e){function t(t,n,r){var i,a=this;return(a=e.call(this,t)||this).userId=n,a.nickname=r.nickname,a.plainProfileUrl=r.profile_url,a.requireAuth=null!==(i=r.require_auth_for_profile_image)&&void 0!==i&&i,a}return C(t,e),Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=As.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.payloadify=function(e){return{nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth}},t}(ma),So=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h=this;(h=e.call(this,t)||this)._sampledUserInfoList=[],h._count=0,h._hasCurrentUserReacted=!1;var f=n.key,p=A([],w(null!==(s=null!==(a=n.sampled_user_ids)&&void 0!==a?a:n.user_ids)&&void 0!==s?s:[]),!1),_=null!==(l=null!==(o=n.last_ts)&&void 0!==o?o:n.updated_at)&&void 0!==l?l:0,m=null!==(u=n.is_self_included)&&void 0!==u?u:p.includes(As.of(t).sdkState.userId),v=null!==(c=n.sampled_user_info)&&void 0!==c?c:{};q("string",f)&&f&&Y("string",p)&&p.length>0&&q("number",_)&&(h.key=f,h._sampledUserIds=p,h._updatedAt=_,h._count=null!==(d=n.count)&&void 0!==d?d:p.length,h._hasCurrentUserReacted=m,Object.keys(v).forEach((function(e){h._sampledUserInfoList.push(new No(t,e,v[e]))})));var g={};try{for(var E=I(h.sampledUserIds),b=E.next();!b.done;b=E.next())g[b.value]=h.updatedAt}catch(y){r={error:y}}finally{try{b&&!b.done&&(i=E.return)&&i.call(E)}finally{if(r)throw r.error}}return h._version=g,h}return C(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userIds",{get:function(){return this._sampledUserIds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sampledUserIds",{get:function(){return this._sampledUserIds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sampledUserInfoList",{get:function(){return this._sampledUserInfoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updatedAt",{get:function(){return this._updatedAt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentUserReacted",{get:function(){return this._hasCurrentUserReacted},enumerable:!1,configurable:!0}),t.payloadify=function(e){var t={};return e._sampledUserInfoList.forEach((function(e){t[e.userId]=No.payloadify(e)})),Ne(Se({key:e.key,sampled_user_ids:e._sampledUserIds,sampled_user_info:t,count:e._count,is_self_included:e._hasCurrentUserReacted,last_ts:e._updatedAt}))},t.prototype.applyEvent=function(e){var t=this;if(e.key===this.key&&this.updatedAt<=e.updatedAt)if(e._sampledUserIds)this._sampledUserIds=e._sampledUserIds,this._sampledUserInfoList=[],Object.keys(e._sampledUserInfoList).forEach((function(n){t._sampledUserInfoList.push(new No(t._iid,n,e._sampledUserInfoList[n]))})),this._count=e._count,void 0!==e._hasCurrentUserReacted&&(this._hasCurrentUserReacted=e._hasCurrentUserReacted),this._updatedAt=e.updatedAt;else{if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var n=this._sampledUserIds.indexOf(e.userId);switch(e.operation){case Hs.ADD:n<0&&this._sampledUserIds.push(e.userId);break;case Hs.DELETE:n>=0&&this._sampledUserIds.splice(n,1)}this._count=this._sampledUserIds.length,this._version[e.userId]=e.updatedAt}this._updatedAt=Math.max(this.updatedAt,e.updatedAt)}},t}(ma),Io=function(){function e(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return Ne(Se({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}))},e}(),wo=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new Io(e["og:image"]))}return e.payloadify=function(e){return Ne(Se({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Io.payloadify(e.defaultImage):null}))},e}(),Ao=function(){function e(e){var t,n;this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.prototype.serialize=function(){return{name:this.name,volume:this.volume}},e.payloadify=function(e){return Ne(Se({name:e.name,volume:e.volume}))},e}();!function(e){e.GOOD="good",e.BAD="bad"}(Co||(Co={}));var Mo=function(){function e(e){this.id=e.id,this.rating=e.rating,this.comment=e.comment}return e._getStatus=function(e){return e?"id"in e?"SUBMITTED":"NO_FEEDBACK":"NOT_APPLICABLE"},e._isSubmitted=function(t){return"SUBMITTED"===e._getStatus(t)},e._getPayloadByStatus=function(e){return"NO_FEEDBACK"===e?{}:null},e.payloadify=function(e){return Ne(Se({id:e.id,rating:e.rating,comment:e.comment}))},e}(),Oo=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).isBlockedByMe=!1,i.role=z(se,n.role)?n.role:se.NONE,i.isBlockedByMe=null!==(r=n.is_blocked_by_me)&&void 0!==r&&r,i}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{role:t.role,is_blocked_by_me:t.isBlockedByMe})))},t}(Aa),Ro=function(){function e(e){this.key=e.key,this.value=Y("string",e.value)?A([],w(e.value),!1):[]}return e.payloadify=function(e){var t;return Ne(Se({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}))},e}(),Do=function(e){switch(e){case le.BASE:return"";case le.USER:return"MESG";case le.FILE:return"FILE";case le.ADMIN:return"ADMM"}},ko=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h=this;(h=e.call(this,t)||this).channelType=ae.BASE,h.messageType=le.BASE,h.mentionType=null,h.mentionedUsers=null,h.mentionedUserIds=null,h.metaArrays=[],h.extendedMessage={},h.createdAt=0,h.updatedAt=0,h.channelUrl=n.channel_url,h.channelType=z(ae,n.channel_type)?n.channel_type:ae.GROUP,n.channel&&(n.channel.channel_url&&(h.channelUrl=n.channel.channel_url),n.channel.channel_type&&(h.channelType=n.channel.channel_type)),h.data=null!==(r=n.data)&&void 0!==r?r:"",h.customType=null!==(i=n.custom_type)&&void 0!==i?i:"",h.mentionType=z(de,n.mention_type)?n.mention_type:null,h.mentionedUsers=n.mentioned_users?n.mentioned_users.map((function(e){return new Aa(h._iid,e)})):null,h.mentionedUserIds=null!==(a=n.mentioned_user_ids)&&void 0!==a?a:null,h.mentionedUsers&&!h.mentionedUserIds&&(h.mentionedUserIds=h.mentionedUsers.map((function(e){return e.userId})));var f=null!==(s=n.metaarray)&&void 0!==s?s:{},p=null!==(o=n.metaarray_key_order)&&void 0!==o?o:Object.keys(f).sort((function(e,t){return e.localeCompare(t)}));h.metaArrays=[];for(var _=0;_<p.length;_++){var m=p[_];h.metaArrays.push(new Ro({key:m,value:f[m]||[]}))}return n.sorted_metaarray&&(h.metaArrays=n.sorted_metaarray.map((function(e){return new Ro(e)}))),h.extendedMessage=null!==(l=n.extended_message)&&void 0!==l?l:{},h.extendedMessagePayload=n.extended_message_payload,h.createdAt=null!==(c=null!==(u=n.created_at)&&void 0!==u?u:n.ts)&&void 0!==c?c:0,h.updatedAt=null!==(d=n.updated_at)&&void 0!==d?d:0,h}return C(t,e),t.payloadify=function(t){var n,r;return Ne(Se(T(T({},e.payloadify.call(this,t)),{channel_url:t.channelUrl,channel_type:t.channelType,type:Do(t.messageType),data:t.data,custom_type:t.customType,mention_type:t.mentionType,mentioned_user_ids:t.mentionedUserIds,mentioned_users:null===(n=t.mentionedUsers)||void 0===n?void 0:n.map((function(e){return Aa.payloadify(e)})),sorted_metaarray:null===(r=t.metaArrays)||void 0===r?void 0:r.map((function(e){return Ro.payloadify(e)})),extended_message:t.extendedMessage,extended_message_payload:t.extendedMessagePayload,created_at:t.createdAt,updated_at:t.updatedAt})))},t.prototype.isIdentical=function(e){return!0},t.prototype.isEqual=function(e){return V(this,e)},t.prototype.isUserMessage=function(){return this.messageType===le.USER},t.prototype.isFileMessage=function(){return this.messageType===le.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isMultipleFilesMessage=function(){return this.messageType===le.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isAdminMessage=function(){return this.messageType===le.ADMIN},t.prototype.serialize=function(){return Na(this)},t.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},t}(ma),Lo=function(e){function t(t,n){var r,i,a=this;return(a=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",a.channelType=null!==(i=n.channel_type)&&void 0!==i?i:ae.GROUP,a.reader=new Aa(a._iid,n.user),a.readAt=n.ts,a}return C(t,e),t}(ma),xo=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return C(t,e),t}(st);!function(e){function t(t){var n=e.call(this)||this,r=t.channelUrl,i=t.channelType,a=t.userId,s=t.notificationIds;return n.method=Ie.PUT,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/messages/mark_as_read"),n.params=Ne(Se({user_id:a,message_ids:s})),n}C(t,e)}(tt);var Uo=function(e){function t(t,n,r){var i=e.call(this,t,"READ",r)||this;return i.readStatus=new Lo(t,r),i}return C(t,e),t}(at);!function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.readAt=n.ts,r.unreadMessageCount=n.unread_message_count,r}C(t,e)}(nt);var Po=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n,parent_message_id:r}})||this}return C(t,e),t}(st),Fo=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.pushEnabled,s=e.call(this)||this;return s.method=Ie.PUT,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/thread_push"),s.params={push_enabled:a},s}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var Bo=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.rating,s=t.comment,o=e.call(this)||this;return o.method=Ie.POST,o.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/feedbacks"),o.params={rating:a,comment:s},o}return C(t,e),t}(tt),Ho=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.feedback=new Mo(n),r}return C(t,e),t}(nt),Go=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.feedbackId,s=t.rating,o=t.comment,l=e.call(this)||this;return l.method=Ie.PUT,l.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/feedbacks/").concat(a),l.params={rating:s,comment:o},l}return C(t,e),t}(tt),jo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.feedback=new Mo(n),r}return C(t,e),t}(nt),Vo=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.feedbackId,s=e.call(this)||this;return s.method=Ie.DELETE,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/feedbacks/").concat(a),s}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.feedback=new Mo(n),r}),e)}(nt);var qo,zo,Ko=function(e){function t(t,n){var r,i,a,s,o,l=this;return(l=e.call(this,t)||this).plainUrl="",l.fileName=null,l.mimeType=null,l.fileSize=0,l.thumbnails=[],l._requireAuth=!1,l.plainUrl=null!==(r=n.url)&&void 0!==r?r:"",l.fileName=null!==(i=n.file_name)&&void 0!==i?i:null,l.mimeType=null!==(a=n.file_type)&&void 0!==a?a:null,l.fileSize=null!==(s=n.file_size)&&void 0!==s?s:0,l._requireAuth=null!==(o=n.require_auth)&&void 0!==o&&o,l.thumbnails=n.thumbnails?n.thumbnails.map((function(e){var t;return new go(l._iid,"string"==typeof e?{url:e,width:0,height:0}:T(T({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),l._requireAuth)})):[],l}return C(t,e),t.payloadify=function(e){var t;return Ne(Se({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){var t;return{url:(null!==(t=e.plainUrl)&&void 0!==t?t:"").split("auth=")[0],width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}))},Object.defineProperty(t.prototype,"url",{get:function(){var e=As.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t}(ma),Yo=function(e){var t=e.channelUrl,n=e.channelType,r=e.parentMessage;this.channelUrl=t,this.channelType=n,this.parentMessage=r};!function(e){e.NUMBER="number",e.ENUM="enum",e.TEXT="text",e.REGEX="regex",e.DECIMAL_PLACE="decimal_place"}(qo||(qo={})),function(e){e.TEXT="text",e.TEXTAREA="textarea",e.NUMBER="number",e.PHONE="phone",e.EMAIL="email",e.CHIP="chip"}(zo||(zo={}));var Wo,Qo,Xo=function(){function e(e,t){var n=t.id,r=t.name,i=t.items,a=t.version,s=t.is_submitted;this.messageId=e,this.id=n,this.name=r,this.items=i.map((function(e){return new Zo(e)})).sort((function(e,t){return e.sortOrder-t.sortOrder})),this.version=null!=a?a:1,this._isSubmitted=s}return Object.defineProperty(e.prototype,"isSubmitted",{get:function(){var e;return null!==(e=this._isSubmitted)&&void 0!==e?e:this.items.some((function(e){return Array.isArray(e.submittedValues)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSubmittable",{get:function(){return this.items.every((function(e){return e.required?!!(Array.isArray(e.draftValues)&&e.draftValues.length>0)&&e.isValid(e.draftValues):!(Array.isArray(e.draftValues)&&e.draftValues.length>0)||e.isValid(e.draftValues)}))},enumerable:!1,configurable:!0}),e.payloadify=function(e){return Ne(Se({id:e.id,name:e.name,items:e.items.map((function(e){return Zo.payloadify(e)})),version:e.version,is_submitted:e._isSubmitted}))},e.isMessageFormPayload=function(e){return Boolean(null==e?void 0:e.message_form)},e}(),Zo=function(){function e(e){var t=e.id,n=e.name,r=e.required,i=e.sort_order,a=e.placeholder,s=e.style,o=e.item_type,l=e.validators,u=e.value,c=e.values;this.id=t,this.name=n,this.required=r,this.sortOrder=i,this.placeholder=a,0===Object.keys(s).length?this.style={layout:o}:this.style=Ne({layout:s.layout,options:s.options,defaultOptions:s.default_options,resultCount:s.result_count}),c?this.submittedValues=c:u&&(this.submittedValues=[u]),this._validators=l}return e.prototype.isValid=function(e){var t=this;return e.every((function(e){var n;return n=e,t._validators.every((function(e){switch(e.key){case qo.NUMBER:var t=Number(n);return!(isNaN(t)||e.min&&"number"!=typeof e.min||e.max&&"number"!=typeof e.max||"number"==typeof e.min&&t<e.min||"number"==typeof e.max&&t>e.max);case qo.ENUM:return"string"==typeof n&&(!(e.enums&&Array.isArray(e.enums)&&e.enums.length>0&&!e.enums.includes(n))||e.allow_other);case qo.TEXT:return!("string"!=typeof n||"number"==typeof e.min_length&&n.length<e.min_length||"number"==typeof e.max_length&&n.length>e.max_length);case qo.REGEX:if("string"!=typeof n)return!1;if(e.regex){if("string"!=typeof e.regex)return!1;if(!new RegExp(e.regex).test(n))return!1}return!0;case qo.DECIMAL_PLACE:return 0!==n.length&&(t=Number(n),!(isNaN(t)||(!e.max_decimal_place||"number"==typeof e.max_decimal_place)&&e.max_decimal_place&&(r=t,i=e.max_decimal_place,a=r.toString(),s=a.indexOf("."),!(-1===s||a.slice(s+1).length<=i))));default:return!0}var r,i,a,s}))}))},e.payloadify=function(e){return Ne(Se({id:e.id,name:e.name,required:e.required,sort_order:e.sortOrder,placeholder:e.placeholder,style:Ne({layout:e.style.layout,options:e.style.options,default_options:e.style.defaultOptions,result_count:e.style.resultCount}),item_type:e.style.layout,validators:e._validators,values:e.submittedValues}))},e}(),Jo=function(e){function t(t){var n=e.call(this)||this;return n.method=Ie.POST,n.path="".concat(Ke,"/").concat(t.formId,"/submit"),n.params=Ne({message_id:t.messageId,items:t.items}),n}return C(t,e),t}(tt);!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}(Wo||(Wo={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(Qo||(Qo={}));var $o,el=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h=this;return(h=e.call(this,t,n)||this).parentMessage=null,h.silent=!1,h.isOperatorMessage=!1,h.threadInfo=null,h.reactions=[],h.appleCriticalAlertOptions=null,h.scheduledInfo=null,h.suggestedReplies=null,h.myFeedback=null,h.myFeedbackStatus="NOT_APPLICABLE",h.messageForm=null,h._isContinuousMessages=!1,h._scheduledStatus=null,h._poll=null,h.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,h.parentMessageId=null!==(a="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==a?a:0,h.threadInfo=n.thread_info?new yo(h._iid,n.thread_info):null,n.reactions_summary?h.reactions=n.reactions_summary.map((function(e){return new So(t,e)})):n.reactions?h.reactions=n.reactions.map((function(e){return new So(t,e)})):h.reactions=[],h.ogMetaData=n.og_tag?new wo(n.og_tag):null,h.silent=null!==(s=n.silent)&&void 0!==s&&s,h.isOperatorMessage=null!==(o=n.is_op_msg)&&void 0!==o&&o,h.appleCriticalAlertOptions=n.apple_critical_alert_options?new Ao(n.apple_critical_alert_options):null,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(h.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},h._scheduledStatus=n.scheduled_status),h._isContinuousMessages=null!==(l=n.is_continuous_messages)&&void 0!==l&&l,h.myFeedback=Mo._isSubmitted(n.feedback)?new Mo(n.feedback):null,h.myFeedbackStatus=Mo._getStatus(n.feedback),h.suggestedReplies=null!==(c=null===(u=n.extended_message_payload)||void 0===u?void 0:u.suggested_replies)&&void 0!==c?c:null,h.messageForm=Xo.isMessageFormPayload(n.extended_message_payload)?new Xo(h.messageId,n.extended_message_payload.message_form):null,h.message=null!==(d=n.message)&&void 0!==d?d:"",h._poll=n.poll?new zs(h._iid,n.poll):null,h}return C(t,e),t.payloadify=function(t){var n,r;return Ne(Se(T(T({},e.payloadify.call(this,t)),{message_id:t.messageId,parent_message_id:t.parentMessageId,thread_info:t.threadInfo?yo.payloadify(t.threadInfo):null,reactions_summary:t.reactions.map((function(e){return So.payloadify(e)})),og_tag:t.ogMetaData?wo.payloadify(t.ogMetaData):null,silent:t.silent,is_op_msg:t.isOperatorMessage,apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,scheduled_message_id:null===(n=t.scheduledInfo)||void 0===n?void 0:n.scheduledMessageId,scheduled_at:null===(r=t.scheduledInfo)||void 0===r?void 0:r.scheduledAt,scheduled_status:t._scheduledStatus,feedback:t.myFeedback?Mo.payloadify(t.myFeedback):Mo._getPayloadByStatus(t.myFeedbackStatus),message:t.message,poll:t._poll?zs.payloadify(t._poll):null})))},t._getParentMessageInfoPayload=function(e){return Ne(Se({type:Do(e.messageType),ts:e.createdAt,user:e.sender?Oo.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map((function(e){return Ko.payloadify(e)})):null}))},t.prototype.isIdentical=function(e){return this.messageId===e.messageId},t.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(e.threadInfo._isUpdateRequired&&this.threadInfo&&e.threadInfo._updateFrom(this.threadInfo),this.threadInfo=e.threadInfo,!0)},t.prototype._findReactionIndex=function(e){for(var t=0;t<this.reactions.length;t++)if(this.reactions[t].key===e)return t;return-1},t.prototype.applyReactionEvent=function(e){var t=As.of(this._iid).sdkState;if(this.messageId===e.messageId)switch(e.operation){case Hs.ADD:e.userId===t.userId&&(e._hasCurrentUserReacted=!0),-1!==(n=this._findReactionIndex(e.key))?this.reactions[n].applyEvent(e):e._sampledUserIds?this.reactions.push(new So(this._iid,{key:e.key,sampled_user_ids:e._sampledUserIds,sampled_user_info:e._sampledUserInfoList,count:e._count,is_self_included:e._hasCurrentUserReacted,last_ts:e.updatedAt})):this.reactions.push(new So(this._iid,{key:e.key,user_ids:[e.userId],updated_at:e.updatedAt}));break;case Hs.DELETE:var n;-1!==(n=this._findReactionIndex(e.key))&&(e._sampledUserIds?0===e._count?this.reactions.splice(n,1):(e.userId===t.userId&&(e._hasCurrentUserReacted=!1),this.reactions[n].applyEvent(e)):(this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1)))}},t.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},t.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt||(this._poll=e,0))},Object.defineProperty(t.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),t.prototype._triggerThreadInfoUpdatedEvent=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){return(e=As.of(this._iid).dispatcher).dispatch(new Yo({channelType:ae.GROUP,channelUrl:this.channelUrl,parentMessage:this})),e.dispatch(new Rs({messages:[this],source:bs.EVENT_MESSAGE_THREADINFO_UPDATED})),[2]}))}))},t.prototype.markThreadAsRead=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new Po({channelUrl:this.channelUrl,messageId:this.messageId}),[4,e.send(t)];case 1:return n.sent(),this.threadInfo&&0!==this.threadInfo.unreadReplyCount?(this.threadInfo.unreadReplyCount=0,[4,this._triggerThreadInfoUpdatedEvent()]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.setPushNotificationEnabled=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new Fo({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,pushEnabled:e}),[4,t.send(n)];case 1:return r.sent(),this.threadInfo&&this.threadInfo.isPushNotificationEnabled!==e&&(this.threadInfo.isPushNotificationEnabled=e),[2]}}))}))},t.prototype.submitMessageForm=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:if(t=As.of(this._iid).requestQueue,n=null,r=null,i=this.messageForm,!e&&i){if(!i.isSubmittable)throw new H({code:M.INVALID_PARAMETER,message:"The form is not submittable. Please check all form items are valid before submitting."});if(i.isSubmitted)throw new H({code:M.INVALID_PARAMETER,message:"The form has already been submitted."});n=i.id,r=i.items.reduce((function(e,t){return e.push({form_item_id:t.id,values:Array.isArray(t.draftValues)?t.draftValues:[]}),e}),[])}else e&&(n=e.formId,r=Object.entries(e.answers).reduce((function(e,t){var n=w(t,2),r=n[0],i=n[1],a=Number(r);if(Number.isNaN(a))throw new H({code:M.INVALID_PARAMETER,message:"Keys in answers must be numeric string."});return e.push({form_item_id:a,value:i}),e}),[]));if(!n||!r)throw new H({code:M.INVALID_PARAMETER,message:"Missing one or more required inputs: formId, answers."});return a=new Jo({messageId:this.messageId,formId:n,items:r}),[4,t.send(a)];case 1:return s.sent(),[2]}}))}))},t.prototype.submitFeedback=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return t=As.of(this._iid),n=t.requestQueue,r=t.dispatcher,i=new Bo({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,rating:e.rating,comment:e.comment}),[4,n.send(i)];case 1:return a=o.sent(),s=a.as(Ho),this.myFeedback=s.feedback,this.myFeedbackStatus="SUBMITTED",r.dispatch(new Rs({messages:[this],source:bs.EVENT_MESSAGE_FEEDBACK_ADDED})),[2]}}))}))},t.prototype.updateFeedback=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return t=As.of(this._iid),n=t.requestQueue,r=t.dispatcher,i=new Go({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e.id,rating:e.rating,comment:e.comment}),[4,n.send(i)];case 1:return a=o.sent(),s=a.as(jo),this.myFeedback=s.feedback,this.myFeedbackStatus="SUBMITTED",r.dispatch(new Rs({messages:[this],source:bs.EVENT_MESSAGE_FEEDBACK_UPDATED})),[2]}}))}))},t.prototype.deleteFeedback=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=As.of(this._iid),n=t.requestQueue,r=t.dispatcher,i=new Vo({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e}),[4,n.send(i)];case 1:return a.sent(),this.myFeedback=null,this.myFeedbackStatus="NO_FEEDBACK",r.dispatch(new Rs({messages:[this],source:bs.EVENT_MESSAGE_FEEDBACK_DELETED})),[2]}}))}))},t}(ko),tl=function(e){function t(t,n){var r,i,a,s,o=this;if((o=e.call(this,t,n)||this).reqId="",o.replyToChannel=!1,o.errorCode=0,o.sender=n.user?new Oo(o._iid,n.user):n.sender_id,o.reqId=null!==(i=null!==(r=n.req_id)&&void 0!==r?r:n.request_id)&&void 0!==i?i:"",o.replyToChannel=null!==(a=n.is_reply_to_channel)&&void 0!==a&&a,n.request_state&&z(pe,n.request_state)&&(o.sendingStatus=n.request_state),!o.sendingStatus)if(o.messageId>0)o.sendingStatus=pe.SUCCEEDED;else if(o.scheduledInfo)switch(n.scheduled_status&&(o._scheduledStatus=n.scheduled_status),n.scheduled_status){case Qo.SENT:case Qo.IN_QUEUE:o.sendingStatus=pe.SUCCEEDED;break;case Qo.PENDING:o.sendingStatus=pe.SCHEDULED;break;case Qo.FAILED:case Qo.REMOVED:o.sendingStatus=pe.FAILED;break;case Qo.CANCELED:o.sendingStatus=pe.CANCELED}else o.sendingStatus=pe.PENDING;return o.errorCode=null!==(s=n.error_code)&&void 0!==s?s:0,o._messageToken=n.mesg_token,o}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{user:Oo.payloadify(t.sender),req_id:t.reqId,is_reply_to_channel:t.replyToChannel,request_state:t.sendingStatus,error_code:t.errorCode,mesg_token:t._messageToken})))},Object.defineProperty(t.prototype,"isResendable",{get:function(){return(this.sendingStatus===pe.FAILED||this.sendingStatus===pe.CANCELED)&&function(e){return e>0&&G.indexOf(e)>=0}(this.errorCode)},enumerable:!1,configurable:!0}),t.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},t}(el),nl={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:ue.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},rl=function(e){return q("number",e.prevResultSize)&&q("number",e.nextResultSize)&&q("boolean",e.isInclusive)&&q("boolean",e.reverse)&&q("string",e.messageTypeFilter)&&z(ue,e.messageTypeFilter)&&Y("string",e.customTypesFilter,!0)&&Y("string",e.senderUserIdsFilter,!0)&&q("boolean",e.includeMetaArray)&&q("boolean",e.includeReactions)&&q("boolean",e.includeParentMessageInfo)},il=function(e){function t(t,n){var r,i,a,s=this;if((s=e.call(this,t,n)||this).translations={},s.messageType=le.ADMIN,s.translations=null!==(r=n.translations)&&void 0!==r?r:{},n.parent_message_info){var o=n.parent_message_info;s.parentMessage=hl(t,Ne(Se(T(T({},o),{message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:o.file,url:null===(i=o.file)||void 0===i?void 0:i.url,require_auth:null===(a=o.file)||void 0===a?void 0:a.require_auth}))))}return s}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{translations:t.translations,parent_message_info:t.parentMessage?e._getParentMessageInfoPayload.call(this,t.parentMessage):null})))},t.prototype.getThreadedMessagesByTimestamp=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},nl),t),Ia(this.messageId>0&&q("number",e)&&rl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},t}(el),al=function(){function e(e){var t,n;this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.detail&&q("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return Ne(Se({type:e.type,vendor:e.vendor,detail:e.detail}))},e}(),sl=function(){function e(e){this.status=e.status,e.original_message_info&&(this.originalMessageInfo={createdAt:e.original_message_info.ts,messageId:e.original_message_info.id})}return e.payloadify=function(e){return Ne({status:e.status,original_message_info:e.originalMessageInfo?{id:e.originalMessageInfo.messageId,ts:e.originalMessageInfo.createdAt}:void 0})},e}(),ol=function(e){function t(t,n){var r,i,a,s,o,l,u,c=this;if((c=e.call(this,t,n)||this).messageParams=null,c.mentionedMessageTemplate=void 0,c.translations={},c.translationTargetLanguages=[],c.messageSurvivalSeconds=-1,c.plugins=[],c.messageType=le.USER,c.translations=null!==(a=n.translations)&&void 0!==a?a:{},c.translationTargetLanguages=null!==(s=n.target_langs)&&void 0!==s?s:[],0===Object.keys(c.translations).length&&c.translationTargetLanguages.length>0)try{for(var d=I(c.translationTargetLanguages),h=d.next();!h.done;h=d.next()){var f=h.value;c.translations[f]=""}}catch(O){r={error:O}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}if(c.mentionedMessageTemplate=n.mentioned_message_template,c.messageSurvivalSeconds=null!==(o=n.message_survival_seconds)&&void 0!==o?o:-1,c.plugins=n.plugins?n.plugins.map((function(e){return new al(e)})):[],n.parent_message_info){var p=n.parent_message_info;c.parentMessage=hl(t,Ne(Se(T(T({},p),{created_at:p.ts,message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:p.file,url:null===(l=p.file)||void 0===l?void 0:l.url,require_auth:null===(u=p.file)||void 0===u?void 0:u.require_auth}))))}return n.review_info&&(c.messageReviewInfo=new sl(n.review_info)),c}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{translations:t.translations,message_survival_seconds:t.messageSurvivalSeconds,mentioned_message_template:t.mentionedMessageTemplate,plugins:t.plugins.map((function(e){return al.payloadify(e)})),parent_message_info:t.parentMessage?e._getParentMessageInfoPayload.call(this,t.parentMessage):null,review_info:t.messageReviewInfo?sl.payloadify(t.messageReviewInfo):void 0})))},t.prototype.getThreadedMessagesByTimestamp=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},nl),t),Ia(this.messageId>0&&q("number",e)&&rl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},t}(tl),ll=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d=this;if((d=e.call(this,t,n)||this).messageParams=null,d.fileInfoList=[],d.messageSurvivalSeconds=-1,d.messageType=le.FILE,d.data=null!==(a=null!==(i=null===(r=n.file)||void 0===r?void 0:r.data)&&void 0!==i?i:n.custom)&&void 0!==a?a:"",d.fileInfoList=null!==(o=null===(s=n.files)||void 0===s?void 0:s.map((function(e){return new Ko(t,e)})))&&void 0!==o?o:[],d.messageSurvivalSeconds=null!==(l=n.message_survival_seconds)&&void 0!==l?l:-1,n.parent_message_info){var h=n.parent_message_info;d.parentMessage=hl(t,Ne(Se(T(T({},h),{created_at:h.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:h.file,url:null===(u=h.file)||void 0===u?void 0:u.url,require_auth:null===(c=h.file)||void 0===c?void 0:c.require_auth}))))}return d}return C(t,e),t.prototype.getThreadedMessagesByTimestamp=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},nl),t),Ia(this.messageId>0&&q("number",e)&&rl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},t.payloadify=function(t){var n,r,i,a,s,o;return Ne(Se(T(T({},e.payloadify.call(this,t)),{file:{name:null!==(r=null===(n=t.fileInfoList[0])||void 0===n?void 0:n.fileName)&&void 0!==r?r:"",size:null!==(a=null===(i=t.fileInfoList[0])||void 0===i?void 0:i.fileSize)&&void 0!==a?a:0,type:null!==(o=null===(s=t.fileInfoList[0])||void 0===s?void 0:s.mimeType)&&void 0!==o?o:"",data:t.data},files:Array.isArray(t.fileInfoList)?t.fileInfoList.map((function(e){return Ko.payloadify(e)})):null,message_survival_seconds:t.messageSurvivalSeconds,parent_message_info:t.parentMessage?e._getParentMessageInfoPayload.call(this,t.parentMessage):null})))},t._isMultipleFilesMessagePayload=function(e){var t=e.files;return Array.isArray(t)&&t.length>=2},t._isMultipleFilesMessageSerializedData=function(e){var t=e.fileInfoList;return Array.isArray(t)},t}(tl);!function(e){e.SENT="SENT",e.READ="READ"}($o||($o={}));var ul,cl=function(e){function t(t,n){var r,i,a=this;if((a=e.call(this,t,n)||this).notificationData=null,a.notificationId=n.notification_message_id,a.messageType=le.ADMIN,a.messageStatus=null!==(r=n.message_status)&&void 0!==r?r:$o.SENT,a.priority=null!==(i=n.priority)&&void 0!==i?i:me.NORMAL,a.notificationEventDeadline=n.notification_event_deadline,0===a.extendedMessage.sub_type)try{var s=JSON.parse(a.extendedMessage.sub_data),o=s.label,l=s.tags,u=void 0===l?[]:l,c=s.template_key,d=s.template_variables;a.notificationData={label:o,tags:u,templateKey:c,templateVariables:d}}catch(h){}return a}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{notification_message_id:t.notificationId,message_status:t.messageStatus,priority:t.priority,notification_event_deadline:t.notificationEventDeadline})))},t.prototype.isIdentical=function(e){return this.notificationId===e.notificationId},t}(ko),dl=function(e){if(e.notificationId)return cl.payloadify(e);switch(e.messageType){case le.USER:return ol.payloadify(e);case le.FILE:return e.fileInfoList?ll.payloadify(e):fl.payloadify(e);case le.ADMIN:return il.payloadify(e);default:throw H.unknown}},hl=function(e,t){if(t.notification_message_id)return new cl(e,t);switch(t.type){case"MESG":return new ol(e,t);case"FILE":return ll._isMultipleFilesMessagePayload(t)?new ll(e,t):new fl(e,t);case"ADMM":case"BRDM":return new il(e,t);default:return null}},fl=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v=this;(v=e.call(this,t,n)||this).messageParams=null,v.plainUrl="",v.requireAuth=!1,v.thumbnails=[],v.messageSurvivalSeconds=-1,v.messageType=le.FILE;var g=n.file;if(v.plainUrl=(null!==(i=null!==(r=null==g?void 0:g.url)&&void 0!==r?r:n.url)&&void 0!==i?i:"").split("?auth=")[0],v.name=null!==(s=null!==(a=null==g?void 0:g.name)&&void 0!==a?a:n.name)&&void 0!==s?s:"File",v.size=null!==(l=null!==(o=null==g?void 0:g.size)&&void 0!==o?o:n.size)&&void 0!==l?l:0,v.data=null!==(c=null!==(u=null==g?void 0:g.data)&&void 0!==u?u:n.custom)&&void 0!==c?c:"",v.type=g?null!==(d=g.type)&&void 0!==d?d:"":null!==(h=n.type)&&void 0!==h?h:"",v.requireAuth=null!==(f=n.require_auth)&&void 0!==f&&f,v.thumbnails=n.thumbnails?n.thumbnails.map((function(e){var t;return new go(v._iid,"string"==typeof e?{url:e,width:0,height:0}:T(T({},e),{url:(null!==(t=e.url)&&void 0!==t?t:"").split("auth=")[0]}),v.requireAuth)})):[],v.messageSurvivalSeconds=null!==(p=n.message_survival_seconds)&&void 0!==p?p:-1,n.parent_message_info){var E=n.parent_message_info;v.parentMessage=hl(t,Ne(Se(T(T({},E),{created_at:E.ts,message_id:v.parentMessageId,channel_url:v.channelUrl,channel_type:v.channelType,file:E.file,url:null===(_=E.file)||void 0===_?void 0:_.url,require_auth:null===(m=E.file)||void 0===m?void 0:m.require_auth}))))}return v}return C(t,e),t.payloadify=function(t){var n;return Ne(Se(T(T({},e.payloadify.call(this,t)),{url:t.plainUrl,require_auth:t.requireAuth,file:{name:t.name,size:t.size,type:t.type,data:t.data},thumbnails:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return{url:e.plainUrl,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:t.messageSurvivalSeconds,parent_message_info:t.parentMessage?e._getParentMessageInfoPayload.call(this,t.parentMessage):null})))},Object.defineProperty(t.prototype,"url",{get:function(){var e=As.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t.prototype.getThreadedMessagesByTimestamp=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},nl),t),Ia(this.messageId>0&&q("number",e)&&rl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,r.sent()]}}))}))},t}(tl),pl=function(e){function t(t,n){var r=n.file,i=n.fileUrl,a=n.fileName,s=n.fileSize,o=n.mimeType,l=n.thumbnailSizes,u=n._uploadedMetaData,c=n._thumbnails,d=e.call(this,t)||this;return d._plainUrl=i,d.file=r,d.fileName=a,d.fileSize=s,d.mimeType=o,d.thumbnailSizes=l,d._uploadedMetaData=u,d._thumbnails=c,d}return C(t,e),t.getPlainUrl=function(e){return e instanceof t?e._plainUrl:e.fileUrl},Object.defineProperty(t.prototype,"fileUrl",{get:function(){var e,t=As.of(this._iid).sessionManager;return this._plainUrl&&(null===(e=this._uploadedMetaData)||void 0===e?void 0:e.requireAuth)&&t.ekey?"".concat(this._plainUrl,"?auth=").concat(t.ekey):this._plainUrl},set:function(e){this._plainUrl=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_thumbnails:this._thumbnails,_uploadedMetaData:this._uploadedMetaData}},t}(ma),_l=function(e){function t(t){var n,r,i,a,s=[];return t.mentionType===de.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FILE",ackRequired:!0,payload:Ne(Se({channel_url:t.channelUrl,files:t.files?El(t.files):null,url:t.url,name:null!==(n=t.fileName)&&void 0!==n?n:"",type:null!==(r=t.mimeType)&&void 0!==r?r:"",size:null!==(i=t.fileSize)&&void 0!==i?i:0,custom:t.data,custom_type:t.customType,thumbnails:null===(a=t._thumbnails)||void 0===a?void 0:a.map((function(e){return go.payloadify(e)})),require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:s,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==fe.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId?t.parentMessageId:null,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage,message:t.message}))})||this}return C(t,e),t}(st),ml=function(e){function t(t){var n,r,i=this;i=e.call(this)||this;var a=[];return t.mentionType===de.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map((function(e){return e.userId})))),i.method=Ie.POST,i.path="".concat(Qe(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),i.params=Ne(Se({message_type:le.FILE,user_id:t.userId,files:t.files?El(t.files):null,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:a,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:null===(n=t._thumbnails)||void 0===n?void 0:n.map((function(e){return go.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(r=t.metaArrays)||void 0===r?void 0:r.map((function(e){return Ro.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId?t.parentMessageId:null,apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,reply_to_channel:t.isReplyToChannel,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage})),i}return C(t,e),t}(tt),vl=function(e){function t(t,n,r){var i,a,s,o,l=this;(l=e.call(this,t,"FILE",r)||this).message=r.files&&r.files.length>=2?new ll(t,r):new fl(t,r);var u=As.of(t).sdkState;return l.isMentioned=Ze(l.message.mentionType,null!==(s=null!==(i=l.message.mentionedUserIds)&&void 0!==i?i:null===(a=l.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})))&&void 0!==s?s:[],u.userId),l.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,l}return C(t,e),t}(at),gl=function(e){function t(t,n){var r,i,a,s,o=this;(o=e.call(this,t,n)||this).message=n.files&&n.files.length>=2?new ll(t,n):new fl(t,n);var l=As.of(t).sdkState;return o.isMentioned=Ze(o.message.mentionType,null!==(a=null!==(r=o.message.mentionedUserIds)&&void 0!==r?r:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})))&&void 0!==a?a:[],l.userId),o.forceUpdateLastMessage=null!==(s=n.force_update_last_message)&&void 0!==s&&s,o}return C(t,e),t}(nt);function El(e){return e.map((function(e){var t,n;return Ne(Se({url:pl.getPlainUrl(e),file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e._thumbnails)||void 0===t?void 0:t.map((function(e){return go.payloadify(e)})),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth}))}))}!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(ul||(ul={}));var bl,yl,Cl=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,a=t.onlineDetector,s=t.cacheContext,o=this;this._queueMap=new Map,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=s,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof ra&&(o._connectionState=e.stateType)})),this._onlineDetector=a}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===Zi.CONNECTED||this._connectionState===Zi.CONNECTING||this._connectionState===Zi.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return n=this._createSendFileMessageRequestParams(e,t),this._shouldSendThroughWebSocket?(r=new _l(n),[4,this._requestQueue.send(r)]):[3,2];case 1:return[2,i.sent().as(vl).message];case 2:return r=new ml(T(T({},n),{userId:this._sdkState.userId})),[4,this._requestQueue.send(r)];case 3:return[2,i.sent().as(gl).message]}}))}))},e.prototype._createSendFileMessageRequestParams=function(e,t){var n=T(T({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var r=t.params;n.files=r.fileInfoList}else r=t.params,n.url=r.fileUrl,n.requireAuth=r.requireAuth;return n},e.prototype._resolveMessageQueue=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d,h,f,p;return S(this,(function(_){switch(_.label){case 0:if(!(n=this._queueMap.get(e.url)))return[3,21];if(n.isResolving)return[3,20];n.isResolving=!0,r=[],i=!0,_.label=1;case 1:_.trys.push([1,15,16,17]),a=I(n.messageQueue),s=a.next(),_.label=2;case 2:if(s.done)return[3,14];switch((o=s.value).state){case ul.PENDING:case ul.UPLOADING:return[3,3];case ul.UPLOADED:return[3,4];case ul.FAILED:return[3,12]}return[3,13];case 3:return i=!1,r.push(o),[3,13];case 4:if(!i)return[3,10];_.label=5;case 5:return _.trys.push([5,8,,9]),o.state=ul.SENDING,[4,this._sendFileMessage(e,o)];case 6:return l=_.sent(),o.deferred.resolve(l),[4,Fa(100)];case 7:return _.sent(),[3,9];case 8:return u=_.sent(),o.deferred.reject(u),[3,9];case 9:return[3,11];case 10:r.push(o),_.label=11;case 11:return[3,13];case 12:return c=null!==(t=o.error)&&void 0!==t?t:H.unknown,o.deferred.reject(c.code===M.REQUEST_CANCELED?H.fileUploadCanceled:c),[3,13];case 13:return s=a.next(),[3,2];case 14:return[3,17];case 15:return d=_.sent(),f={error:d},[3,17];case 16:try{s&&!s.done&&(p=a.return)&&p.call(a)}finally{if(f)throw f.error}return[7];case 17:return h=n.isResolveRequestPending,n.messageQueue=r,n.isResolving=!1,n.isResolveRequestPending=!1,h?[4,this._resolveMessageQueue(e)]:[3,19];case 18:_.sent(),_.label=19;case 19:return[3,21];case 20:n.isResolveRequestPending=!0,_.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d;return S(this,(function(h){switch(h.label){case 0:return(n=this._queueMap.get(e.url))&&(r=n.messageQueue.find((function(e){return e.state===ul.PENDING})))?r.multipleFileUploadInfo?(i=r.multipleFileUploadInfo,a=i.uploadIndex,s=i.uploadCount,o=i.requestHandler,d=r.params,l=d.fileInfoList[a],!X(l.file)||(null===(t=l._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]):[3,4]:[3,9];case 1:return h.sent(),[3,3];case 2:r.state=a<s-1?ul.PENDING:ul.UPLOADED,h.label=3;case 3:return u=d.fileInfoList[a],c=r.multipleFileUploadInfo.uploadIndex++,r.multipleFileUploadInfo.isCopy||null==o||o._triggerOnFileUploaded(r.requestId,c,u,r.error),[3,7];case 4:return d=r.params,X(d.file)?[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]:[3,6];case 5:return h.sent(),[3,7];case 6:d.thumbnailSizes=[],r.state=ul.UPLOADED,h.label=7;case 7:return this._uploadNextPendingItem(e),[4,this._resolveMessageQueue(e)];case 8:h.sent(),h.label=9;case 9:return[2]}}))}))},e.prototype._tryUploadNextItemAndUpdateItemState=function(e,t,n){return N(this,0,void 0,(function(){var r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(r=u.sent(),!As.of(this._iid).sessionManager.currentUser||!r)return n.error=H.connectionRequired,n.state=ul.FAILED,[2];if(!(t.uploadQueue.length<6))return[3,9];n.state=ul.UPLOADING,t.uploadQueue.push(n),u.label=2;case 2:return u.trys.push([2,7,,8]),n.multipleFileUploadInfo?(i=n.multipleFileUploadInfo,a=i.uploadIndex,s=i.uploadCount,o=n.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,n,o)]):[3,4];case 3:return u.sent(),n.state=a<s-1?ul.PENDING:ul.UPLOADED,[3,6];case 4:return o=n.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(e,n,o)];case 5:u.sent(),n.state=ul.UPLOADED,u.label=6;case 6:return[3,8];case 7:switch((l=u.sent()).code){case M.REQUEST_FAILED:n.error=new H({code:M.NETWORK_ERROR,message:"Failed to upload a file."});break;case M.REQUEST_CANCELED:n.error=H.fileUploadCanceled;break;default:n.error=l}return n.state=ul.FAILED,[3,8];case 8:this._dequeueUploadItem(t,n),u.label=9;case 9:return[2]}}))}))},e.prototype._dequeueUploadItem=function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1)},e.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(e,t,n){var r,i,a;return N(this,0,void 0,(function(){var s,o,l,u,c,d,h,f,p,_;return S(this,(function(m){switch(m.label){case 0:return s=new Eo({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(s)];case 1:return o=m.sent(),l=o.as(bo),u=l.url,c=l.fileSize,d=void 0===c?n.fileSize:c,h=l.thumbnails,f=void 0===h?[]:h,p=l.requireAuth,_=void 0!==p&&p,n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(i=n.mimeType)&&void 0!==i?i:n.file.type,n.fileSize=null!==(a=n.fileSize)&&void 0!==a?a:n.file.size,n.fileUrl=u,n.fileSize=d,n.requireAuth=_,n._thumbnails=f,[2]}}))}))},e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(e,t,n){var r,i,a;return N(this,0,void 0,(function(){var s,o,l,u,c,d,h,f,p,_,m;return S(this,(function(v){switch(v.label){case 0:return s=t.multipleFileUploadInfo.uploadIndex,o=n.fileInfoList[s],l=new Eo({file:o.file,channelUrl:e.url,thumbnailSizes:o.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(l)];case 1:return u=v.sent(),c=u.as(bo),d=c.url,h=c.fileSize,f=void 0===h?o.fileSize:h,p=c.thumbnails,_=c.requireAuth,m=void 0!==_&&_,o.fileName=null!==(r=o.fileName)&&void 0!==r?r:o.file.name,o.mimeType=null!==(i=o.mimeType)&&void 0!==i?i:o.file.type,o.fileSize=null!==(a=o.fileSize)&&void 0!==a?a:o.file.size,o.file=void 0,o.fileUrl=d,o.fileSize=f,o._thumbnails=p,o._uploadedMetaData=T(T({},o._uploadedMetaData),{requireAuth:m,isUploaded:!0}),o instanceof pl||(n.fileInfoList[s]=new pl(this._iid,o)),[2]}}))}))},e.prototype.request=function(e,t,n,r){return void 0===r&&(r={}),N(this,0,void 0,(function(){var i,a,s,o,l;return S(this,(function(u){return this._queueMap.has(e.url)||(i={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,i)),a=this._queueMap.get(e.url),s=new bt,o={requestId:t,params:n,state:ul.PENDING,deferred:s},"fileInfoList"in n&&(l=T({uploadIndex:0,uploadCount:n.fileInfoList.length},r),o.multipleFileUploadInfo=l),a.messageQueue.push(o),this._uploadNextPendingItem(e),[2,s.promise]}))}))},e.prototype.cancel=function(e,t){var n,r,i=this._queueMap.get(e.url);if(i){var a=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:A([],w(i.messageQueue),!1);try{for(var s=I(a),o=s.next();!o.done;o=s.next()){var l=o.value;if(l)switch(l.state){case ul.PENDING:if(l.state=ul.FAILED,l.error=H.requestCanceled,l.multipleFileUploadInfo&&!l.multipleFileUploadInfo.isCopy){var u=l.multipleFileUploadInfo,c=u.uploadIndex,d=u.requestHandler,h=l.params.fileInfoList[c];null==d||d._triggerOnFileUploaded(l.requestId,c,h,H.fileUploadCanceled)}this._resolveMessageQueue(e);break;case ul.UPLOADING:this._requestQueue.cancel(l.requestId),this._dispatcher.dispatch(new yt({requestId:l.requestId}))}}}catch(f){n={error:f}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}else t&&(this._requestQueue.cancel(t),this._dispatcher.dispatch(new yt({requestId:t})))},e}(),Tl={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:ue.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:he.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},Nl=function(e){return q("number",e.prevResultSize)&&q("number",e.nextResultSize)&&q("boolean",e.isInclusive)&&q("boolean",e.reverse)&&q("string",e.messageTypeFilter)&&z(ue,e.messageTypeFilter)&&Y("string",e.customTypesFilter,!0)&&Y("string",e.senderUserIdsFilter,!0)&&z(he,e.replyType)&&q("boolean",e.includeMetaArray)&&q("boolean",e.includeReactions)&&q("boolean",e.includeParentMessageInfo)&&q("boolean",e.includeThreadInfo)&&q("boolean",e.showSubchannelMessagesOnly)},Sl={replyType:he.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Il=function(e){return z(he,e.replyType)&&q("boolean",e.includeReactions)&&q("boolean",e.includeMetaArray)&&q("boolean",e.includeParentMessageInfo)&&q("boolean",e.includeThreadInfo)};!function(e){e.MESSAGE="message"}(bl||(bl={})),function(e){e.INTERNAL_BACKSYNC="internal_backsync",e.INTERNAL_FILL_GAP="internal_fill_gap",e.EXTERNAL_LEGACY="external_legacy",e.EXTERNAL_COLLECTION="external_collection"}(yl||(yl={}));var wl,Al=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.includeMetaArray,s=t.includeReactions,o=t.includeThreadInfo,l=t.includeParentMessageInfo,u=e.call(this)||this;return u.method=Ie.GET,u.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i)),u.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions_summary:null!=s&&s,include_thread_info:o,include_parent_message_info:l,include_poll_details:!0},u}return C(t,e),t}(tt),Ml=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=n?hl(t,T({},n)):null,r}return C(t,e),t}(nt),Ol=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,a=t.token,s=t.prevResultSize,o=t.nextResultSize,l=t.isInclusive,u=t.reverse,c=t.messageTypeFilter,d=t.customTypesFilter,h=t.senderUserIdsFilter,f=t.replyType,p=t.includeMetaArray,_=t.includeReactions,m=t.parentMessageId,v=t.includeThreadInfo,g=t.includeParentMessageInfo,E=t.showSubchannelMessagesOnly,b=t.checkingHasNext,y=t.checkingContinuousMessages,C=t.sdkSource,T=e.call(this)||this;return T.method=Ie.GET,T.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages"),T.params=Ne(Se({is_sdk:!0,prev_limit:s,next_limit:o,include:l,reverse:u,message_ts:i,message_id:a,message_type:null!=c?c:null,custom_types:d,sender_ids:h,include_reply_type:f,with_sorted_meta_array:p,include_reactions_summary:_,parent_message_id:m,include_thread_info:v,include_parent_message_info:g,show_subchannel_message_only:E,include_poll_details:!0,checking_has_next:b,checking_continuous_messages:y,sdk_source:C})),T}return C(t,e),t}(tt),Rl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return void 0!==n.is_continuous_messages&&(r.isContinuousMessages=n.is_continuous_messages),void 0!==n.has_next&&(r.hasNext=n.has_next),r.messages=n.messages.map((function(e){return hl(t,e)})),r}return C(t,e),t}(nt),Dl=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,a=t.token,s=t.replyType,o=t.includeMetaArray,l=t.includeReactions,u=t.includeThreadInfo,c=t.includeParentMessageInfo,d=e.call(this)||this;return d.method=Ie.GET,d.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),d.params={change_ts:i,token:a,with_sorted_meta_array:o,include_reactions_summary:l,include_thread_info:u,include_reply_type:s,include_parent_message_info:c,include_poll_details:!0},d}return C(t,e),t}(tt),kl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return hl(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r.forceUseNextToken=n.force_use_next_token||!1,r}return C(t,e),t}(nt),Ll=function(e){function t(t){var n=t.channelUrl,r=t.scheduledMessageId,i=e.call(this)||this;return i.method=Ie.GET,i.path="".concat(Re,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),i.params={},i}return C(t,e),t}(tt),xl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=n?hl(t,T({},n)):null,r}return C(t,e),t}(nt);!function(e){e.MUTED="muted",e.BANNED="banned"}(wl||(wl={}));var Ul=function(){function e(e){var t,n,r,i;this.restrictionType=null,z(wl,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1,this.remainingDuration=null!==(i=e.remaining_duration)&&void 0!==i?i:-1}return e.payloadify=function(e){return Ne(Se({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt,remaining_duration:e.remainingDuration}))},e}(),Pl=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.restrictionInfo=new Ul(n),r}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),Ul.payloadify(t.restrictionInfo))))},t}(Aa),Fl=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).isMuted=!1,i.isMuted=null!==(r=n.is_muted)&&void 0!==r&&r,i}return C(t,e),t}(Aa),Bl=function(){function e(){this._onPending=St,this._onFailed=St,this._onSucceeded=St}return e.prototype._trigger=function(e){switch(null==e?void 0:e.sendingStatus){case pe.PENDING:0===e.errorCode&&this._onPending(e);break;case pe.SCHEDULED:case pe.SUCCEEDED:this._onSucceeded(e)}},e.prototype._triggerFailed=function(e,t){switch(null==t?void 0:t.sendingStatus){case pe.FAILED:case pe.CANCELED:this._onFailed(e,t.scheduledInfo?null:t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Hl={data:void 0,customType:void 0,mentionType:de.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1,pollId:void 0},Gl=function(e){return q("string",e.data,!0)&&q("string",e.customType,!0)&&z(de,e.mentionType)&&Y("string",e.mentionedUserIds,!0)&&Y(Aa,e.mentionedUsers,!0)&&Y(Ro,e.metaArrays,!0)&&q("number",e.parentMessageId,!0)&&q("boolean",e.isReplyToChannel)&&z(fe,e.pushNotificationDeliveryOption,!0)&&q(Ao,e.appleCriticalAlertOptions,!0)&&q("boolean",e.isPinnedMessage,!0)&&q("number",e.pollId,!0)},jl=function(e){return{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}},Vl=T(T({},Hl),{message:"",mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,extendedMessagePayload:void 0});function ql(e){var t,n,r;return null!==(t=e.messageParams)&&void 0!==t?t:Se(T(T({},e),{mentionType:e.mentionType,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),mentionedMessageTemplate:e.mentionedMessageTemplate,translationTargetLanguages:Object.keys(e.translations),pushNotificationDeliveryOption:fe.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var zl,Kl=function(e){var t;return Ne(Se({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations),extendedMessagePayload:e.extendedMessagePayload}))},Yl=function(e){return Gl(e)&&q("string",e.message)&&q("string",e.mentionedMessageTemplate,!0)&&Y("string",e.translationTargetLanguages,!0)&&q("object",e.extendedMessagePayload,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(zl||(zl={}));var Wl=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},Ql=function(e){return e===zl.BLOB||e===zl.FILE},Xl=function(e){return{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}},Zl=T(T({},Hl),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1,message:void 0});function Jl(e){var t,n,r,i;return null!==(t=e.messageParams)&&void 0!==t?t:Se(T(T({},e),{fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,mentionType:e.mentionType,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),pushNotificationDeliveryOption:fe.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(i=e.thumbnails)||void 0===i?void 0:i.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:e.requireAuth,isPinnedMessage:!1,_thumbnails:e.thumbnails,message:e.message}))}var $l,eu=function(e,t){var n,r;return e.messageParams?(!e.url&&X(t)&&(e.messageParams.file=t),e.messageParams):Ne(Se({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),message:e.message,pollId:null===(r=e.poll)||void 0===r?void 0:r.id}))},tu=function(e){return Gl(e)&&(X(e.file)||q("string",e.fileUrl))&&q("string",e.fileName,!0)&&q("string",e.mimeType,!0)&&q("number",e.fileSize,!0)&&q("string",e.message,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return q("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},nu={data:void 0,customType:void 0,mentionType:de.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},ru=function(e){return q("string",e.data,!0)&&q("string",e.customType,!0)&&z(de,e.mentionType)&&Y("string",e.mentionedUserIds,!0)&&Y(Aa,e.mentionedUsers,!0)&&Y(Ro,e.metaArrays,!0)&&z(fe,e.pushNotificationDeliveryOption,!0)&&q(Ao,e.appleCriticalAlertOptions,!0)},iu=T(T({},nu),{message:void 0,mentionedMessageTemplate:void 0,translationTargetLanguages:void 0,pollId:void 0}),au=function(e){return ru(e)&&q("string",e.mentionedMessageTemplate,!0)&&q("string",e.message,!0)&&Y("string",e.translationTargetLanguages,!0)&&q("number",e.pollId,!0)},su=T({},nu),ou=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.token,a=t.limit,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Qe(r),"/").concat(encodeURIComponent(n),"/operators"),s.params={token:i,limit:a},s}return C(t,e),t}(tt),lu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.operators=n.operators.map((function(e){return new Aa(t,e)})),r.token=n.next,r}return C(t,e),t}(nt),uu=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=As.of(this._iid).requestQueue,n=new ou(T(T({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n)]):[3,2]):[3,5];case 1:return r=o.sent(),i=r.as(lu),a=i.operators,s=i.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,a];case 2:return[2,e];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),cu=function(e){function t(t,n,r,i){var a,s,o,l,u,c,d,h,f,p,_=this;return(_=e.call(this,t,n,r,i)||this).reverse=!1,_.messageTypeFilter=ue.ALL,_.customTypesFilter=null,_.senderUserIdsFilter=null,_.replyType=he.NONE,_.includeMetaArray=!1,_.includeReactions=!1,_.includeParentMessageInfo=!1,_.includeThreadInfo=!1,_.showSubchannelMessagesOnly=!1,_._edge=Number.MAX_SAFE_INTEGER,_.reverse=null!==(a=i.reverse)&&void 0!==a&&a,_.messageTypeFilter=null!==(s=i.messageTypeFilter)&&void 0!==s?s:ue.ALL,_.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,_.senderUserIdsFilter=null!==(l=i.senderUserIdsFilter)&&void 0!==l?l:null,_.replyType=null!==(u=i.replyType)&&void 0!==u?u:he.NONE,_.includeMetaArray=null!==(c=i.includeMetaArray)&&void 0!==c&&c,_.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,_.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,_.includeThreadInfo=null!==(f=i.includeThreadInfo)&&void 0!==f&&f,_.showSubchannelMessagesOnly=null!==(p=i.showSubchannelMessagesOnly)&&void 0!==p&&p,_}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("boolean",this.reverse)&&z(ue,this.messageTypeFilter)&&z(he,this.replyType)&&Y("string",this.customTypesFilter,!0)&&Y("string",this.senderUserIdsFilter,!0)&&q("boolean",this.includeMetaArray)&&q("boolean",this.includeReactions)&&q("boolean",this.includeParentMessageInfo)&&q("boolean",this.includeThreadInfo)&&q("boolean",this.showSubchannelMessagesOnly)},t.prototype.load=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Sh.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,Se({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,A([Number.MAX_SAFE_INTEGER],w(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),du=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.limit,s=t.token;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={limit:a,token:s},n}return C(t,e),t}(tt),hu=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.mutedUsers=[];var i=n.next,a=n.muted_list;return r.token=i,a&&a.length>0&&(r.mutedUsers=a.map((function(e){return new Pl(t,e)}))),r}return C(t,e),t}(nt),fu=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return C(t,e),t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new du(T(T({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(hu),i=r.mutedUsers,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),pu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.limit,s=t.token;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=Ne({limit:a,token:s}),n}return C(t,e),t}(tt),_u=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.bannedUsers=[];var i=n.next,a=n.banned_list;return r.token=i,a&&a.length>0&&(r.bannedUsers=a.map((function(e){return new Pl(t,e.user)}))),r}return C(t,e),t}(nt),mu=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new pu(T(T({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(_u),i=r.bannedUsers,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}($l||($l={}));var vu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.operatorUserIds;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var gu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.operatorUserIds;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var Eu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/mute/").concat(a),n}return C(t,e),t}(tt),bu=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.isMuted=!1,r.startAt=0,r.endAt=0;var i=n.is_muted,a=n.start_at,s=n.end_at,o=n.remaining_duration,l=n.description;return r.isMuted=i,r.startAt=a,r.endAt=s,r.remainingDuration=o,r.description=l,r}return C(t,e),t}(nt),yu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.keys;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={keys:a,include_ts:!0},n}return C(t,e),t}(tt),Cu=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.metadata,a=n.ts;return r.metadata=i,r.ts=a,r}return C(t,e),t}(nt),Tu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metadata;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:a,include_ts:!0},n}return C(t,e),t}(tt),Nu=function(e){function t(t,n){var r,i,a=this;return(a=e.call(this,t,n)||this).metaData=null!==(r=n.metadata)&&void 0!==r?r:{},a.ts=null!==(i=n.ts)&&void 0!==i?i:null,a}return C(t,e),t}(nt),Su=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metadata,s=t.upsert;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:a,include_ts:!0,upsert:null!=s&&s},n}return C(t,e),t}(tt),Iu=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.metadata,a=n.ts;return r.metadata=i,r.ts=a,r}return C(t,e),t}(nt),wu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return C(t,e),t}(at),Au=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.key;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metadata/").concat(a),n.params={include_ts:!0},n}return C(t,e),t}(tt),Mu=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts;return r.ts=i,r}return C(t,e),t}(nt),Ou=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={include_ts:!0},n}return C(t,e),t}(tt),Ru=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts;return r.ts=i,r}return C(t,e),t}(nt),Du=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.keys;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={keys:a},n}return C(t,e),t}(tt),ku=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return C(t,e),t}(nt),Lu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metaCounter;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a},n}return C(t,e),t}(tt),xu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return C(t,e),t}(nt),Uu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metaCounter,s=t.upsert,o=void 0!==s&&s,l=t.mode,u=void 0===l?"set":l;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a,upsert:o,mode:u},n}return C(t,e),t}(tt),Pu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return C(t,e),t}(nt),Fu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return C(t,e),t}(at),Bu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.key;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metacounter/").concat(a),n.params={},n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var Hu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={},n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Gu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId,s=t.seconds,o=t.description;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={user_id:a,seconds:s,description:o},n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var ju=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Pl(t,r.data),i}return C(t,e),t}(at),Vu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(a)),n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var qu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Pl(t,r.data),i}return C(t,e),t}(at),zu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId,s=t.seconds,o=t.description;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=Ne({user_id:a,seconds:s,description:o}),n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Ku=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Pl(t,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return C(t,e),t}(at),Yu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/ban/").concat(encodeURIComponent(a)),n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Wu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Pl(t,r.data),i}return C(t,e),t}(at),Qu=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.freezing;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/freeze"),n.params={freeze:a},n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Xu=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return C(t,e),t}(at),Zu=function(e){return e instanceof Ts?e._custom?"custom":e.name:e},Ju=function(e){if(e instanceof Ts&&e._custom)return e.name},$u=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.description;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Xe(i),"/").concat(encodeURIComponent(r)),n.params=Ne({report_category:Zu(a),reporting_user_id:s,report_description:o,custom_report_category_name:Ju(a)}),n}return C(t,e),t}(tt),ec=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.offendingUserId,l=t.description;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Ue,"/users/").concat(o),n.params=Ne({channel_url:r,channel_type:i===ae.OPEN?"open_channels":"group_channels",report_category:Zu(a),reporting_user_id:s,report_description:l,custom_report_category_name:Ju(a)}),n}return C(t,e),t}(tt),tc=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.offendingUserId,l=t.messageId,u=t.description;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Xe(i),"/").concat(encodeURIComponent(r),"/messages/").concat(l),n.params=Ne({report_category:Zu(a),reporting_user_id:s,report_description:u,offending_user_id:o,custom_report_category_name:Ju(a)}),n}return C(t,e),t}(tt),nc=function(e){function t(t){var n=[];return t.mentionType===de.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"MESG",ackRequired:!0,payload:Ne(Se({channel_url:t.channelUrl,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:n,mentioned_message_template:t.mentionedMessageTemplate,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==fe.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId?t.parentMessageId:null,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage,extended_message_payload:t.extendedMessagePayload}))})||this}return C(t,e),t}(st),rc=function(e){function t(t,n,r){var i,a,s,o,l=this;(l=e.call(this,t,"MESG",r)||this).message=new ol(t,r);var u=As.of(t).sdkState;return l.isMentioned=Ze(l.message.mentionType,null!==(s=null!==(i=l.message.mentionedUserIds)&&void 0!==i?i:null===(a=l.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})))&&void 0!==s?s:[],u.userId),l.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,l}return C(t,e),t}(at),ic=function(e){function t(t){var n=null;return t.mentionType===de.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"MEDI",ackRequired:!0,payload:Ne(Se({channel_url:t.channelUrl,msg_id:t.messageId,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:n,mentioned_message_template:t.mentionedMessageTemplate,apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,poll_id:t.pollId}))})||this}return C(t,e),t}(st),ac=function(e){function t(t,n,r){var i,a,s,o,l,u=this;(u=e.call(this,t,"MEDI",r)||this).message=new ol(t,r);var c=As.of(t).sdkState;return u.mentionCountChange=Je({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(s=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==s?s:[]},Se({mentionType:u.message.mentionType,mentionedUserIds:null!==(o=u.message.mentionedUserIds)&&void 0!==o?o:null===(l=u.message.mentionedUsers)||void 0===l?void 0:l.map((function(e){return e.userId}))}),c.userId),u}return C(t,e),t}(at),sc=function(e){function t(t){var n=null;return t.mentionType===de.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FEDI",ackRequired:!0,payload:Ne(Se({channel_url:t.channelUrl,msg_id:t.messageId,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:n,apple_critical_alert_options:t.appleCriticalAlertOptions}))})||this}return C(t,e),t}(st),oc=function(e){function t(t,n,r){var i,a,s,o,l,u=this;(u=e.call(this,t,"FEDI",r)||this).message=new fl(t,r);var c=As.of(t).sdkState;return u.mentionCountChange=Je({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(s=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==s?s:[]},Se({mentionType:u.message.mentionType,mentionedUserIds:null!==(o=u.message.mentionedUserIds)&&void 0!==o?o:null===(l=u.message.mentionedUsers)||void 0===l?void 0:l.map((function(e){return e.userId}))}),c.userId),u}return C(t,e),t}(at),lc=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.reactionKey,s=e.call(this)||this;return s.method=Ie.POST,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),s.params={reaction:a},s}return C(t,e),t}(tt),uc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new To(n),r}return C(t,e),t}(nt),cc=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.reactionKey,s=e.call(this)||this;return s.method=Ie.DELETE,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),s.params={reaction:a},s}return C(t,e),t}(tt),dc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new To(T({},n)),r}return C(t,e),t}(nt),hc=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.translationTargetLanguages,s=e.call(this)||this;return s.method=Ie.POST,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i),"/translation"),s.params={target_langs:a},s}return C(t,e),t}(tt),fc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new ol(t,n),r}return C(t,e),t}(nt),pc=function(e){function t(t){var n,r=this;r=e.call(this)||this;var i=[];t.mentionType===de.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId}))));var a=t.channelType,s=t.channelUrl;return r.method=Ie.POST,r.path="".concat(Qe(a),"/").concat(encodeURIComponent(s),"/scheduled_messages"),r.params=Ne(Se({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:ce.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return Ro.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption})),r}return C(t,e),t}(tt),_c=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new ol(t,n),r}return C(t,e),t}(nt),mc=function(e){function t(t){var n,r,i=this;i=e.call(this)||this;var a=[];t.mentionType===de.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map((function(e){return e.userId}))));var s=t.channelType,o=t.channelUrl;return i.method=Ie.POST,i.path="".concat(Qe(s),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params=Se({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:ce.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:null===(n=t._thumbnails)||void 0===n?void 0:n.map((function(e){return go.payloadify(e)})),custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(r=t.metaArrays)||void 0===r?void 0:r.map((function(e){return Ro.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,push_option:t.pushNotificationDeliveryOption}),i}return C(t,e),t}(tt),vc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new fl(t,n),r}return C(t,e),t}(nt),gc=function(e){function t(t){var n=t.pollId,r=t.title,i=t.data,a=t.allowUserSuggestion,s=t.allowMultipleVotes,o=t.closeAt,l=e.call(this)||this;return l.method=Ie.PUT,l.path="".concat(Be,"/").concat(encodeURIComponent(n)),l.params={title:r,data:i,allow_user_suggestion:a,allow_multiple_votes:s,close_at:o},l}return C(t,e),t}(tt),Ec=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),bc=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=Ie.DELETE,r.path="".concat(Be,"/").concat(encodeURIComponent(n)),r}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var yc=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=Ie.PUT,r.path="".concat(Be,"/").concat(encodeURIComponent(n),"/close"),r}return C(t,e),t}(tt),Cc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),Tc=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,a=t.optionText,s=e.call(this)||this;return s.method=Ie.POST,s.path="".concat(Be,"/").concat(encodeURIComponent(i),"/options"),s.params={channel_url:n,channel_type:r,text:a},s}return C(t,e),t}(tt),Nc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),Sc=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=t.optionText,a=e.call(this)||this;return a.method=Ie.PUT,a.path="".concat(Be,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),a.params={text:i},a}return C(t,e),t}(tt),Ic=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new zs(t,n),r}return C(t,e),t}(nt),wc=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Be,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Ac=function(e){function t(t){var n=t.reqId,r=t.channelType,i=t.channelUrl,a=t.pollId,s=t.pollOptionIds;return e.call(this,{code:"VOTE",ackRequired:!0,payload:Ne({req_id:n,channel_type:r===ae.OPEN?"open_channels":"group_channels",channel_url:i,poll_id:a,option_ids:s})})||this}return C(t,e),t}(st),Mc=function(e){function t(t,n,r){var i=e.call(this,t,"VOTE",r)||this;return i.event=new Ws(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return C(t,e),t}(at),Oc="GroupChannel",Rc="Message",Dc="NotificationMessage",kc="UserInfo";var Lc=T(T({},Hl),{fileInfoList:[],message:""}),xc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onFileUploaded=St,t}return C(t,e),t.prototype._triggerOnFileUploaded=function(e,t,n,r){this._onFileUploaded(e,t,n,r)},t.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},t.prototype.onPending=function(t){return e.prototype.onPending.call(this,t),this},t.prototype.onFailed=function(t){return e.prototype.onFailed.call(this,t),this},t.prototype.onSucceeded=function(t){return e.prototype.onSucceeded.call(this,t),this},t}(Bl),Uc=function(e){function t(t,n){var r=e.call(this,t)||this;return r.message=null,r.message=hl(t,n.message),r}return C(t,e),t}(ma),Pc=function(e){function t(t){var n=this,r=t.channelType,i=t.channelUrl,a=t.limit,s=t.token,o=t.includeReactions,l=t.includeMetaArray,u=t.includeParentMessageInfo,c=t.includeThreadInfo,d=t.includePollDetails;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(r),"/").concat(encodeURIComponent(i),"/pinned_messages"),n.params=Ne({limit:a,token:s,include_reactions_summary:o,with_sorted_meta_array:l,include_thread_info:c,include_parent_message_info:u,include_poll_details:d}),n}return C(t,e),t}(tt),Fc=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.pinned_messages,a=n.has_more,s=n.next;return r.pinnedMessages=i.map((function(e){return new Uc(t,e)})),r.hasMore=a,r.token=s,r}return C(t,e),t}(nt),Bc=function(e){function t(t,n,r,i){var a=e.call(this,t,n,r,i)||this;return a.includeMetaArray=i.includeMetaArray,a.includeReactions=i.includeReactions,a.includeParentMessageInfo=i.includeParentMessageInfo,a.includeThreadInfo=i.includeThreadInfo,a.includePollDetails=i.includePollDetails,a}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("boolean",this.includeMetaArray,!0)&&q("boolean",this.includeReactions,!0)&&q("boolean",this.includeParentMessageInfo,!0)&&q("boolean",this.includeThreadInfo,!0)&&q("boolean",this.includePollDetails,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new Pc(T(T({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(Fc),i=r.pinnedMessages,a=r.hasMore,s=r.token,this._token=s,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),Hc=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=e.call(this)||this;return a.method=Ie.POST,a.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/pin"),a}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var Gc=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=e.call(this)||this;return a.method=Ie.DELETE,a.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/pin"),a}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var jc;!function(e){e.SEND="send",e.RESEND="resend",e.COPY="copy"}(jc||(jc={}));var Vc,qc=function(e){function t(t,n){var r,i,a,s,o,l,u,c=this;return(c=e.call(this,t)||this)._name="",c._createdAt=0,c.pinnedMessageIds=[],c.channelType=ae.BASE,c.coverUrl="",c.customType="",c.data="",c.isFrozen=!1,c.isEphemeral=!1,c.creator=null,c._messageCollectionLastAccessedAt=0,c._url=n.channel_url,c._name=null!==(r=n.name)&&void 0!==r?r:"",c._createdAt=1e3*n.created_at,c.coverUrl=null!==(i=n.cover_url)&&void 0!==i?i:"",c.customType=null!==(a=n.custom_type)&&void 0!==a?a:"",c.data=null!==(s=n.data)&&void 0!==s?s:"",c.isFrozen=null!==(o=n.freeze)&&void 0!==o&&o,c.isEphemeral=null!==(l=n.is_ephemeral)&&void 0!==l&&l,c.creator=n.created_by?new Aa(c._iid,n.created_by):null,n.metadata&&Object.keys(n.metadata).length>0&&n.ts?(c._cachedMetaData=new Map,Object.keys(n.metadata).forEach((function(e){c._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})}))):"string"==typeof n.metadata&&(c._cachedMetaData=new Map(Object.entries(JSON.parse(n.metadata)))),c.pinnedMessageIds=null!==(u=n.pinned_message_ids)&&void 0!==u?u:[],c}return C(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return T(T({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{channel_url:t.url,name:t.name,cover_url:t.coverUrl,custom_type:t.customType,data:t.data,freeze:t.isFrozen,is_ephemeral:t.isEphemeral,created_by:t.creator?Aa.payloadify(t.creator):null,created_at:t.createdAt/1e3,metadata:t.cachedMetaData,pinned_message_ids:t.pinnedMessageIds})))},t.prototype.isGroupChannel=function(){return this.channelType===ae.GROUP},t.prototype.isOpenChannel=function(){return this.channelType===ae.OPEN},t.prototype.isFeedChannel=function(){return this.channelType===ae.FEED},Object.defineProperty(t.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData?(this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e):e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),t.prototype._serializeCachedMetaData=function(){return this._cachedMetaData?{cachedMetaData:JSON.stringify(Object.fromEntries(this._cachedMetaData))}:{}},t.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},t.prototype._update=function(e){Object.assign(this,e)},t.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){n._cachedMetaData||(n._cachedMetaData=new Map);var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},t.prototype._updateCachedMetaData=function(e,t){var n=this,r=!1;return this._cachedMetaData?this._cachedMetaData.forEach((function(i,a){var s;i.updatedAt<=t&&(n._cachedMetaData.set(a,{value:null!==(s=e[a])&&void 0!==s?s:i.value,isRemoved:!e[a],updatedAt:t}),r=!0)})):(this._cachedMetaData=new Map,Object.keys(e).forEach((function(r){n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})})),r=!0),{isUpdated:r}},t.prototype._removeFromCachedMetaData=function(e,t){var n=this;this._cachedMetaData&&e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!0,r.updatedAt=t)}))},t.prototype._clearCachedMetaData=function(){this._cachedMetaData&&this._cachedMetaData.clear()},t.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},t.prototype._generateRequestId=function(){return"rq-".concat(Ee())},t.prototype.isIdentical=function(e){return e&&this.url===e.url},t.prototype.isEqual=function(e){return V(this,e)},t.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new uu(this._iid,this.url,this.channelType,e)},t.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new fu(this._iid,this.url,this.channelType,e)},t.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new mu(this._iid,this.url,this.channelType,e)},t.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new cu(this._iid,this.url,this.channelType,e)},t.prototype.createPinnedMessageListQuery=function(e){return void 0===e&&(e={}),new Bc(this._iid,this.url,this.channelType,e)},t.prototype.addOperators=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new vu({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.removeOperators=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new gu({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.getMyMutedInfo=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l,u,c;return S(this,(function(d){switch(d.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Eu({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=d.sent(),a=i.as(bu),s=a.isMuted,o=a.startAt,l=a.endAt,u=a.remainingDuration,c=a.description,[2,{isMuted:s,startAt:o,endAt:l,remainingDuration:u,description:c}]}}))}))},t.prototype.getMetaData=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new yu({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=o.sent(),i=r.as(Cu),a=i.metadata,s=i.ts,this._upsertCachedMetaData(a,s),[2,a]}}))}))},t.prototype.getAllMetaData=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return e=As.of(this._iid).requestQueue,t=new yu({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(Cu),i=r.metadata,a=r.ts,this._updateCachedMetaData(i,a),[2,i]}}))}))},t.prototype.createMetaData=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=As.of(this._iid).requestQueue,n=new Tu({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=a.sent(),i=r.as(Nu).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},t.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return n=As.of(this._iid).requestQueue,r=new Su({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=l.sent(),a=i.as(Iu),s=a.metadata,o=a.ts,this._upsertCachedMetaData(s,o),[2,s]}}))}))},t.prototype.deleteMetaData=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Au({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=a.sent(),i=r.as(Mu).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},t.prototype.deleteAllMetaData=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid).requestQueue,t=new Ou({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(Ru).ts,this._removeFromCachedMetaData(A([],w(this._cachedMetaData.keys()),!1),r),[2]}}))}))},t.prototype.getMetaCounters=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Du({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return[2,r.sent().as(ku).metaCounter]}}))}))},t.prototype.getAllMetaCounters=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new Du({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return[2,n.sent().as(ku).metaCounter]}}))}))},t.prototype.createMetaCounters=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new Lu({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return[2,r.sent().as(xu).metaCounter]}}))}))},t.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return n=As.of(this._iid).requestQueue,r=new Uu({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return[2,i.sent().as(Pu).metaCounter]}}))}))},t.prototype.increaseMetaCounters=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new Uu({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,r.sent().as(Pu).metaCounter]}}))}))},t.prototype.decreaseMetaCounters=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new Uu({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,r.sent().as(Pu).metaCounter]}}))}))},t.prototype.deleteMetaCounter=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Bu({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.deleteAllMetaCounters=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new Hu({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},t.prototype.muteUser=function(e,t,n){return N(this,0,void 0,(function(){return S(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},t.prototype.muteUserWithUserId=function(e,t,n){return N(this,0,void 0,(function(){var r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("string",e)&&q("number",t,!0)&&q("string",n,!0)).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new Gu({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},t.prototype.unmuteUser=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},t.prototype.unmuteUserWithUserId=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Vu({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.banUser=function(e,t,n){return N(this,0,void 0,(function(){return S(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},t.prototype.banUserWithUserId=function(e,t,n){return N(this,0,void 0,(function(){var r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("string",e)&&q("number",t,!0)&&q("string",n,!0)).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new zu({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},t.prototype.unbanUser=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},t.prototype.unbanUserWithUserId=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Yu({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.freeze=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new Qu({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},t.prototype.unfreeze=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new Qu({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},t.prototype.getMessagesByMessageId=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Tl),t),Ia(q("number",e)&&Nl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getMessagesByTimestamp=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Tl),t),Ia(q("number",e)&&Nl(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Sl),t),Ia(q("number",e)&&Il(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getMessageChangeLogsSinceToken=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Sl),t),Ia(q("string",e)&&Il(n)).throw(H.invalidParameters),[4,Sh.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype._createPendingSendableMessagePayload=function(e,t,n){var r,i=As.of(this._iid).sessionManager;return Ne(Se({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return Ro.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?Ao.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:i.currentUser?Oo.payloadify(i.currentUser):null,req_id:t,request_state:pe.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return Aa.payloadify(e)}))}))},t.prototype._createPendingUserMessage=function(e,t,n){var r,i,a={};if(e.translationTargetLanguages)try{for(var s=I(e.translationTargetLanguages),o=s.next();!o.done;o=s.next())a[o.value]=""}catch(O){r={error:O}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}var l=Ne(T(T({},this._createPendingSendableMessagePayload(e,t,n)),{type:le.USER,message:e.message,translations:a,extended_message_payload:e.extendedMessagePayload})),u=new ol(this._iid,l);return u.messageParams=e,u},t.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},t.prototype._createPendingFileMessage=function(e,t,n){var r,i,a,s,o,l,u,c=Ne(T(T({},this._createPendingSendableMessagePayload(e,t,n)),{type:le.FILE,url:e.fileUrl,file:{name:null!==(r=e.fileName)&&void 0!==r?r:null===(i=e.file)||void 0===i?void 0:i.name,size:null!==(a=e.fileSize)&&void 0!==a?a:null===(s=e.file)||void 0===s?void 0:s.size,type:null!==(o=e.mimeType)&&void 0!==o?o:null===(l=e.file)||void 0===l?void 0:l.type,data:e.data},thumbnails:null===(u=e._thumbnails)||void 0===u?void 0:u.map((function(e){return go.payloadify(e)})),message:e.message})),d=new fl(this._iid,c);return d.messageParams=e,d},t.prototype._createPendingMultipleFilesMessage=function(e,t,n){var r=Ne(T(T({},this._createPendingSendableMessagePayload(e,t,n)),{type:le.FILE,file:e.fileInfoList.length>0?{name:e.fileInfoList[0].fileName,size:e.fileInfoList[0].fileSize,type:e.fileInfoList[0].mimeType,data:e.data}:void 0,message:e.message})),i=new ll(this._iid,r);return i.messageParams=e,i},t.prototype._validateFailedFileMessageHasFile=function(e,t){var n;return Boolean(e.url)||X(t)||X(null===(n=e.messageParams)||void 0===n?void 0:n.file)},t.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},t.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===M.REQUEST_CANCELED||t.code===M.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=pe.CANCELED:n||(e.sendingStatus=pe.FAILED)},t.prototype.sendUserMessage=function(e){var t=T(T({},Vl),e);return Ia(Yl(t)).throw(H.invalidParameters),this._sendUserMessage(t)},t.prototype._sendUserMessage=function(e,t,n){var r=this;void 0===t&&(t=jc.SEND);var i=As.of(this._iid),a=i.dispatcher,s=i.requestQueue,o=null!=n?n:this._generateRequestId(),l=Date.now(),u=new Bl;return Fa(2).then((function(){var n=r._createPendingUserMessage(e,o,l);a.dispatch(new Rs({messages:[n],source:t===jc.RESEND?bs.LOCAL_MESSAGE_RESEND_STARTED:bs.EVENT_MESSAGE_SENT_PENDING})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,u._trigger(n)]}))}))}));var i=new nc(T(T({},e),{channelUrl:r.url,channelType:r.channelType,reqId:o}));s.send(i).then((function(e){var t=e.as(rc).message;a.dispatch(new Rs({messages:[t],source:bs.EVENT_MESSAGE_SENT_SUCCESS})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,u._trigger(t)]}))}))}))})).catch((function(t){if(B(t))throw t;Fa(2).then((function(){var n=r._createPendingUserMessage(e,o,l),i=As.of(r._iid).cacheContext,s=i.localCacheEnabled&&i.localCacheConfig.enableAutoResend&&Q(t.code);r._markMessageAsFailed(n,t,s),a.dispatch(new Rs({messages:[n],source:n.sendingStatus===pe.PENDING?bs.REQUEST_RESEND_MESSAGE:bs.EVENT_MESSAGE_SENT_FAILED})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,u._triggerFailed(t,n)]}))}))}))}))}))})),u},t.prototype._autoResendUserMessage=function(e){return Ia(e instanceof ol&&!!e.messageParams).throw(H.invalidParameters),this._sendUserMessage(e.messageParams,jc.SEND,e.reqId)},t.prototype.resendUserMessage=function(e){var t;return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){return Ia(e instanceof ol&&!e.scheduledInfo).throw(H.invalidParameters),n=new bt,r=null!==(t=e.messageParams)&&void 0!==t?t:Kl(e),this._sendUserMessage(r,jc.RESEND,e.reqId).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},t.prototype.updateUserMessage=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return n=T(T({},iu),t),Ia(q("number",e)&&au(n)).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new ic(T({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:n.metaArrays?{array:n.metaArrays,mode:"add",upsert:!0}:void 0},n)),[4,r.send(i)];case 1:return[2,a.sent().as(ac).message]}}))}))},t.prototype.copyUserMessage=function(e,n){var r,i,a;return N(this,0,void 0,(function(){var s,o;return S(this,(function(l){return Ia(e instanceof t&&n instanceof ol&&n.sendingStatus===pe.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(H.invalidParameters),Ia(!n.poll).throw(H.notSupportedError),s=new bt,o=null!==(r=n.messageParams)&&void 0!==r?r:Se(T(T({},n),{mentionType:n.mentionType,mentionedUserIds:null!==(i=n.mentionedUserIds)&&void 0!==i?i:null===(a=n.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:fe.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(o).onSucceeded((function(e){s.resolve(e)})).onFailed((function(e){return s.reject(e)})),[2,s.promise]}))}))},t.prototype.translateUserMessage=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return Ia(e instanceof ol&&e.messageId>0&&Y("string",t)).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new hc({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return[2,i.sent().as(fc).message]}}))}))},t.prototype._createScheduledUserMessage=function(e,t){var n=this,r=As.of(this._iid).requestQueue,i=Date.now(),a=this._generateRequestId();Fa(2).then((function(){var r=n._createPendingScheduledUserMessage(e,a,i);Qi((function(){return N(n,0,void 0,(function(){return S(this,(function(e){return[2,t._trigger(r)]}))}))}))}));var s=new pc(T({reqId:a,channelType:this.channelType,channelUrl:this.url},e));r.send(s).then((function(e){var r=e.as(_c).message;Qi((function(){return N(n,0,void 0,(function(){return S(this,(function(e){return[2,t._trigger(r)]}))}))}))})).catch((function(r){if(B(r))throw r;Fa(2).then((function(){var s=n._createPendingScheduledUserMessage(e,a,i);n._markMessageAsFailed(s,r),Qi((function(){return N(n,0,void 0,(function(){return S(this,(function(e){return[2,t._triggerFailed(r,s)]}))}))}))}))}))},t.prototype.sendFileMessage=function(e){var t=T(T({},Zl),e);return Ia(tu(t)).throw(H.invalidParameters),this._sendFileMessage(t)},t.prototype.sendMultipleFilesMessage=function(e){var t,n,r,i=T(T({},Lc),e),a=As.of(this._iid);Ia((n=i,r=null===(t=a.appInfo)||void 0===t?void 0:t.multipleFilesMessageFileCountLimit,void 0===r&&(r=5),Gl(n)&&q("string",n.message,!0)&&Array.isArray(n.fileInfoList)&&n.fileInfoList.length>=2&&n.fileInfoList.length<=r&&n.fileInfoList.every((function(e){return function(e){return(X(e.file)||q("string",e.fileUrl))&&q("string",e.fileName,!0)&&q("string",e.mimeType,!0)&&q("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return e.maxWidth>0&&e.maxHeight>0})))}(e)})))).throw(H.invalidParameters);var s=!!e.fileInfoList.find((function(e){var t=a.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return Ia(!s).throw(H.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)},t.prototype._sendFileMessage=function(e,t,n){var r=this;void 0===t&&(t=jc.SEND);var i=As.of(this._iid).dispatcher,a=Sh.of(this._iid).fileMessageQueue,s=null!=n?n:this._generateRequestId(),o=Date.now(),l=new Bl;return Fa(2).then((function(){var n=r._createPendingFileMessage(e,s,o);i.dispatch(new Rs({messages:[n],source:t===jc.RESEND?bs.LOCAL_MESSAGE_RESEND_STARTED:bs.EVENT_MESSAGE_SENT_PENDING})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,l._trigger(n)]}))}))})),a.request(r,s,e).then((function(e){i.dispatch(new Rs({messages:[e],source:bs.EVENT_MESSAGE_SENT_SUCCESS})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(t){return[2,l._trigger(e)]}))}))}))})).catch((function(t){if(B(t))throw t;Fa(2).then((function(){var n=r._createPendingFileMessage(e,s,o),a=As.of(r._iid).cacheContext,u=a.localCacheEnabled&&a.localCacheConfig.enableAutoResend&&Q(t.code);r._markMessageAsFailed(n,t,u),i.dispatch(new Rs({messages:[n],source:n.sendingStatus===pe.PENDING?bs.REQUEST_RESEND_MESSAGE:t.code===M.FILE_UPLOAD_CANCEL_FAILED?bs.LOCAL_MESSAGE_CANCELED:bs.EVENT_MESSAGE_SENT_FAILED})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,l._triggerFailed(t,n)]}))}))}))}))}))})),l},t.prototype._autoResendFileMessage=function(e){Ia(e instanceof fl&&!!e.messageParams).throw(H.invalidParameters);var t=As.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,jc.SEND,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},t.prototype._sendMultipleFilesMessage=function(e,t,n){var r=this,i=As.of(this._iid).dispatcher,a=Sh.of(this._iid).fileMessageQueue,s=null!=n?n:this._generateRequestId(),o=Date.now(),l=new xc;return Fa(2).then((function(){var n=r._createPendingMultipleFilesMessage(e,s,o);i.dispatch(new Rs({messages:[n],source:t===jc.RESEND?bs.LOCAL_MESSAGE_RESEND_STARTED:bs.EVENT_MESSAGE_SENT_PENDING})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,l._trigger(n)]}))}))})),a.request(r,s,e,{requestHandler:l,isCopy:t===jc.COPY}).then((function(e){i.dispatch(new Rs({messages:[e],source:bs.EVENT_MESSAGE_SENT_SUCCESS})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(t){return[2,l._trigger(e)]}))}))}))})).catch((function(t){if(B(t))throw t;Fa(2).then((function(){var n=r._createPendingMultipleFilesMessage(e,s,o);r._markMessageAsFailed(n,t),i.dispatch(new Rs({messages:[n],source:bs.EVENT_MESSAGE_SENT_FAILED})),Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,l._triggerFailed(t,n)]}))}))}))}))}))})),l},t.prototype._createScheduledFileMessage=function(e,t,n,r){var i=this,a=As.of(this._iid).requestQueue,s=new mc(T(T({reqId:n,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(s).then((function(e){var n=e.as(vc).message;Qi((function(){return N(i,0,void 0,(function(){return S(this,(function(e){return[2,t._trigger(n)]}))}))}))})).catch((function(a){if(B(a))throw a;Fa(2).then((function(){var s=i._createPendingScheduledFileMessage(e,n,r);i._markMessageAsFailed(s,a),Qi((function(){return N(i,0,void 0,(function(){return S(this,(function(e){return[2,t._triggerFailed(a,s)]}))}))}))}))}))},t.prototype.sendFileMessages=function(e){var t,n;Ia(e.every((function(e){return tu(T(T({},Zl),e))}))).throw(H.invalidParameters);var r=new Bl;try{for(var i=I(e),a=i.next();!a.done;a=i.next()){var s=a.value;this.sendFileMessage(s).onPending((function(e){return r._trigger(e)})).onFailed((function(e,t){return r._triggerFailed(e,t)})).onSucceeded((function(e){return r._trigger(e)}))}}catch(o){t={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},t.prototype.resendFileMessage=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){return n=this._validateFailedFileMessageHasFile(e,t),Ia(e instanceof fl&&n&&!e.scheduledInfo).throw(H.invalidParameters),r=new bt,i=eu(e,t),this._sendFileMessage(i,jc.RESEND,e.reqId).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),[2,r.promise]}))}))},t.prototype.resendMessage=function(e,t){var n,r;if(Ia(e instanceof tl&&!e.scheduledInfo&&e.isResendable).throw(H.invalidParameters),e.isUserMessage()){var i=null!==(n=e.messageParams)&&void 0!==n?n:Kl(e);return this._sendUserMessage(i,jc.RESEND,e.reqId)}if(e.isFileMessage()){var a=this._validateFailedFileMessageHasFile(e,t);return Ia(a).throw(H.invalidParameters),i=null!==(r=e.messageParams)&&void 0!==r?r:eu(e,t),this._sendFileMessage(i,jc.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw H.channelTypeNotSupportedError},t.prototype.updateFileMessage=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return n=T(T({},su),t),Ia(q("number",e)&&(s=n,ru(s))).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new sc(T({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:n.metaArrays?{array:n.metaArrays,mode:"add",upsert:!0}:void 0},n)),[4,r.send(i)];case 1:return[2,a.sent().as(oc).message]}var s}))}))},t.prototype.uploadFile=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return t=As.of(this._iid).requestQueue,n=Ee(),(r=new Eo({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:n})).uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(n),[4,t.send(r)];case 1:return i=l.sent(),a=i.as(bo),s=a.url,o=a.thumbnails,[2,{requestId:n,url:s,thumbnails:o}]}}))}))},t.prototype.cancelUploadingFileMessage=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(q("string",e)).throw(H.invalidParameters),Sh.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},t.prototype.copyFileMessage=function(e,n){var r,i,a;return N(this,0,void 0,(function(){var s,o;return S(this,(function(l){return Ia(e instanceof t&&n instanceof fl&&n.sendingStatus===pe.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(H.invalidParameters),s=new bt,o=Se(T(T({},n),{fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:null!==(r=n.mentionedUserIds)&&void 0!==r?r:null===(i=n.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:fe.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(a=n.thumbnails)||void 0===a?void 0:a.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:n.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(o).onSucceeded((function(e){return s.resolve(e)})).onFailed((function(e){return s.reject(e)})),[2,s.promise]}))}))},t.prototype.copyMessage=function(e,n){Ia(e instanceof t&&n instanceof tl&&n.sendingStatus===pe.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(H.invalidParameters);var r=n,i=e;if(r.isUserMessage()){Ia(!r.poll).throw(H.notSupportedError);var a=ql(r);return i._sendUserMessage(a)}if(r.isFileMessage())return a=Jl(r),i._sendFileMessage(a);if(n.isMultipleFilesMessage())throw H.channelTypeNotSupportedError},t.prototype.deleteMessage=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(e instanceof el).throw(H.invalidParameters),e.messageId>0?(t=As.of(this._iid).requestQueue,n=new Ct({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,messageToken:e instanceof tl?e._messageToken:void 0}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.addReaction=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return Ia(e instanceof el&&e.messageId>0&&q("string",t)).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new lc({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return[2,i.sent().as(uc).reactionEvent]}}))}))},t.prototype.deleteReaction=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return Ia(e instanceof el&&e.messageId>0&&q("string",t)).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new cc({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return[2,i.sent().as(dc).reactionEvent]}}))}))},t.prototype._updateUserMessageMetaArray=function(e,t,n,r){return N(this,0,void 0,(function(){var i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return i=As.of(this._iid),a=i.dispatcher,s=i.requestQueue,o=new ic({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,s.send(o)];case 1:return l=c.sent(),u=l.as(ac).message,a.dispatch(new Rs({messages:[u],source:bs.EVENT_MESSAGE_UPDATED})),[2,u]}}))}))},t.prototype._updateFileMessageMetaArray=function(e,t,n,r){return N(this,0,void 0,(function(){var i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return i=As.of(this._iid),a=i.dispatcher,s=i.requestQueue,o=new sc({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,s.send(o)];case 1:return l=c.sent(),u=l.as(oc).message,a.dispatch(new Rs({messages:[u],source:bs.EVENT_MESSAGE_UPDATED})),[2,u]}}))}))},t.prototype.createMessageMetaArrayKeys=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){return Ia(e instanceof el&&e.messageId>0&&Y("string",t)).throw(H.invalidParameters),n=t.map((function(e){return new Ro({key:e})})),e instanceof fl?[2,this._updateFileMessageMetaArray(e.messageId,n,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"add",!0)]}))}))},t.prototype.deleteMessageMetaArrayKeys=function(e,t){return N(this,0,void 0,(function(){var n;return S(this,(function(r){return Ia(e instanceof el&&e.messageId>0&&Y("string",t)).throw(H.invalidParameters),n=t.map((function(e){return new Ro({key:e})})),e instanceof fl?[2,this._updateFileMessageMetaArray(e.messageId,n,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},t.prototype.addMessageMetaArrayValues=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){return Ia(e instanceof el&&e.messageId>0&&t.every((function(e){return e instanceof Ro}))).throw(H.invalidParameters),e instanceof fl?[2,this._updateFileMessageMetaArray(e.messageId,t,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"add",!0)]}))}))},t.prototype.removeMessageMetaArrayValues=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){return Ia(e instanceof el&&e.messageId>0&&t.every((function(e){return e instanceof Ro}))).throw(H.invalidParameters),e instanceof fl?[2,this._updateFileMessageMetaArray(e.messageId,t,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},t.prototype.report=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return Ia((z($l,e)||e instanceof Ts)&&q("string",t)).throw(H.invalidParameters),n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new $u({channelUrl:this.url,channelType:this.channelType,userId:r.userId,category:e,description:t}),[4,i.send(a)];case 1:return s.sent(),[2]}}))}))},t.prototype.reportUser=function(e,t,n){return N(this,0,void 0,(function(){var r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(e instanceof Aa&&(z($l,t)||t instanceof Ts)&&q("string",n)).throw(H.invalidParameters),r=As.of(this._iid),i=r.sdkState,a=r.requestQueue,s=new ec({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.userId,category:t,description:n}),[4,a.send(s)];case 1:return o.sent(),[2]}}))}))},t.prototype.reportMessage=function(e,t,n){return N(this,0,void 0,(function(){var r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(e instanceof tl&&(z($l,t)||t instanceof Ts)&&q("string",n)).throw(H.invalidParameters),r=As.of(this._iid),i=r.sdkState,a=r.requestQueue,s=new tc({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:n,messageToken:e._messageToken}),[4,a.send(s)];case 1:return o.sent(),[2]}}))}))},t.prototype.updatePoll=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return Ia(q("number",e)&&(a=t,q("string",a.title,!0)&&Vs(a.data)&&q("boolean",a.allowUserSuggestion,!0)&&q("boolean",a.allowMultipleVotes,!0)&&q("number",a.closeAt,!0))).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new gc(T({pollId:e},t)),[4,n.send(r)];case 1:return[2,i.sent().as(Ec).poll]}var a}))}))},t.prototype.deletePoll=function(e){return N(this,0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return t=q("number",e),Ia(t).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new bc({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},t.prototype.closePoll=function(e){return N(this,0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return t=q("number",e),Ia(t).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new yc({pollId:e}),[4,n.send(r)];case 1:return[2,i.sent().as(Cc).poll]}}))}))},t.prototype.addPollOption=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return n=q("number",e)&&q("string",t)&&""!==t.trim(),Ia(n).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new Tc({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return[2,a.sent().as(Nc).poll]}}))}))},t.prototype.updatePollOption=function(e,t,n){return N(this,0,void 0,(function(){var r,i,a;return S(this,(function(s){switch(s.label){case 0:return r=q("number",e)&&q("number",t)&&q("string",n)&&""!==n.trim(),Ia(r).throw(H.invalidParameters),i=As.of(this._iid).requestQueue,a=new Sc({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(a)];case 1:return[2,s.sent().as(Ic).poll]}}))}))},t.prototype.deletePollOption=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return n=q("number",e)&&q("number",t),Ia(n).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new wc({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},t.prototype.votePoll=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return n=q("number",e)&&Y("number",t),Ia(n).throw(H.invalidParameters),r=As.of(this._iid),i=r.requestQueue,a=r.dispatcher,s=new Ac({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,i.send(s)];case 1:return o=u.sent(),l=o.as(Mc).event,a.dispatch(new Bs({event:l,source:bs.EVENT_POLL_VOTED})),[2,l]}}))}))},t.prototype.getPollChangeLogsSinceTimestamp=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return Ia(q("number",e)).throw(H.invalidParameters),[4,co.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getPollChangeLogsSinceToken=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return Ia(q("string",e,!0)),[4,co.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},t.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new po(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},t.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new vo(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},t.prototype.pinMessage=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(q("number",e)&&e>0).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Hc({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.unpinMessage=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return Ia(q("number",e)&&e>0).throw(H.invalidParameters),t=As.of(this._iid).requestQueue,n=new Gc({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},t}(ma),zc=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return C(t,e),t}((function(){this.onConnected=St,this.onReconnectStarted=St,this.onReconnectSucceeded=St,this.onReconnectFailed=St,this.onDisconnected=St})),Kc=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return C(t,e),t}((function(){this.onSessionExpired=St,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=St,this.onSessionRefreshed=St,this.onSessionClosed=St})),Yc=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return C(t,e),t}((function(){this.onFriendsDiscovered=St,this.onTotalUnreadMessageCountChanged=St,this.onTotalUnreadMessageCountUpdated=St})),Wc=function(e){function t(t){var n=t.limit,r=t.token,i=t.userIdsFilter,a=t.metaDataKeyFilter,s=t.metaDataValuesFilter,o=t.nicknameStartsWithFilter,l=e.call(this)||this;return l.method=Ie.GET,l.path=Ae,l.params=Ne({limit:n,token:r,user_ids:i,metadatakey:a,metadatavalues_in:s,nickname_startswith:o}),l}return C(t,e),t}(tt),Qc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new Aa(t,e)})),r.next=n.next,r}return C(t,e),t}(nt),Xc=function(e){function t(t,n){var r,i,a,s=this;return(s=e.call(this,t,n)||this).userIdsFilter=null,s.metaDataKeyFilter=null,s.metaDataValuesFilter=null,s.nicknameStartsWithFilter=null,s.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,s.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,s.metaDataValuesFilter=null!==(a=n.metaDataValuesFilter)&&void 0!==a?a:null,s.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,s}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&Y("string",this.userIdsFilter,!0)&&q("string",this.metaDataKeyFilter,!0)&&Y("string",this.metaDataValuesFilter,!0)&&q("string",this.nicknameStartsWithFilter,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new Wc(Se(T(T({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(Qc),i=r.users,a=r.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),Zc=function(e){function t(t){var n=t.userId,r=t.limit,i=t.token,a=t.userIdsFilter,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Ae,"/").concat(n,"/block"),s.params=Ne({limit:r,token:i,user_ids:a}),s}return C(t,e),t}(tt),Jc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new Aa(t,e)})),r.next=n.next,r}return C(t,e),t}(nt),$c=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&Y("string",this.userIdsFilter,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Zc(Se(T(T({},this),{userId:t.userId,token:this._token}))),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),a=i.as(Jc),s=a.users,o=a.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),ed=function(e){function t(t){var n=t.userId,r=t.limit,i=t.token,a=e.call(this)||this;return a.method=Ie.GET,a.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friends"),a.params={limit:r,token:i},a}return C(t,e),t}(tt),td=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(e){return new Aa(t,e)})),r.next=n.next,r}return C(t,e),t}(nt),nd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ed(T(T({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),a=i.as(td),s=a.users,o=a.hasMore,l=a.next,this._token=l,this._hasNext=o,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),rd={},id=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,a=void 0===i?256:i,s=e.blockHashBase,o=void 0===s?2:s,l=e.blockHashMultiplier,u=void 0===l?10:l,c=e.blockHashConstant,d=void 0===c?11:c,h=e.transactionApplyDelay,f=void 0===h?200:h,p=e.disableLogger,_=void 0!==p&&p;return rd[t]||(this.itemSizeLimit=r,this.cacheLimit=a,this.blockHashBase=o,this.blockHashMultiplier=u,this.blockHashConstant=d,this.transactionApplyDelay=f,this.disableLogger=_,rd[t]=this),rd[t]}return e.get=function(e){return rd[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Vc||(Vc={}));var ad,sd=function(e){function t(n){var r=n.code,i=void 0===r?Vc.UNKNOWN_ERROR:r,a=n.message,s=void 0===a?"Unknown error occurred.":a,o=e.call(this,s)||this;return o.code=i,Object.setPrototypeOf(o,t.prototype),o}return C(t,e),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:Vc.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:Vc.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:Vc.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:Vc.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotInitialized",{get:function(){return new t({code:Vc.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:Vc.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:Vc.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:Vc.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:Vc.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:Vc.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:Vc.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:Vc.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:Vc.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:Vc.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:Vc.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:Vc.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:Vc.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:Vc.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:Vc.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:Vc.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:Vc.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:Vc.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:Vc.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:Vc.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:Vc.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(ad||(ad={}));var od,ld=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw sd.circularReferenceFound;var n;return t.set(e,!0),Array.isArray(e)?n=e.map((function(e){return ld(e,t)})):e instanceof RegExp||e instanceof Date?n=e:(n={},Object.keys(e).forEach((function(r){n[r]=ld(e[r],t)}))),t.delete(e),n}return e},ud=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw sd.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},cd=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},dd=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},hd=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!hd(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!hd(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var a in i)switch(a){case"/eq":case"=":if((s=t[r])!==(o=i[a]))return!1;break;case"/neq":case"!=":if((s=t[r])===(o=i[a]))return!1;break;case"/gt":case">":var s=t[r],o=i[a];if(!(ud(s,o)>0))return!1;break;case"/gte":case">=":if(s=t[r],o=i[a],!(ud(s,o)>=0))return!1;break;case"/lt":case"<":if(s=t[r],o=i[a],!(ud(s,o)<0))return!1;break;case"/lte":case"<=":if(s=t[r],o=i[a],!(ud(s,o)<=0))return!1;break;case"/in":if(s=t[r],!(o=i[a]).includes(s))return!1;break;case"/nin":if(s=t[r],(o=i[a]).includes(s))return!1;break;case"/contain":if(s=t[r],o=i[a],!s.includes(o))return!1;break;case"/regex":if(s=t[r],!(o=i[a]).test(s))return!1;break;case"/where":if(s=t[r],!(0,i[a])(s))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}return!0}return e(t)},fd=function(){},pd=function(){return Promise.resolve()},_d=function(e){return e},md=function(e,t){t()};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(od||(od={}));var vd,gd,Ed,bd=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,a=e.iterator,s=e.map,o=void 0===s?_d:s,l=e.backward,u=void 0===l?pd:l,c=e.forward,d=void 0===c?pd:c,h=e.complete,f=void 0===h?fd:h;this._prevValue=n,this._nextValue=i,this._error=null,this._map=o,this._backward=u,this._forward=d,this._iterator=a,this._complete=f}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),yd=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,a=e.blockManager,s=e.indexer;this.condition=n,this.backward=i,this._blockManager=a,this._indexer=s}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(h=0;h<this._indexer.fields.length;h++){var i=this._indexer.fields[h],a=1;if("-"===i[0]&&(i=i.slice(1),a=-1),this.condition[i])if("object"==typeof this.condition[i]){var s=a>0?n:t;for(var o in this.condition[i])if(s.includes(o))for(var l=r;l>=0;l--)if(a*ud(this._indexer.origin[l].columnValues[h],this.condition[i][o])<=0){r=l;break}}else for(l=r;l>=0;l--)if(a*ud(this._indexer.origin[l].columnValues[h],this.condition[i])<=0){r=l;break}}return Math.min(r+1,this._indexer.origin.length-1)}var u=0;if("function"!=typeof this.condition)for(var c=function(r){var i=d._indexer.fields[r],a=1;if("-"===i[0]&&(i=i.slice(1),a=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(s){if((a>0?t:n).includes(s))for(var o=u;o<e._indexer.origin.length;o++)if(a*ud(e._indexer.origin[o].columnValues[r],e.condition[i][s])>=0){u=o;break}}));else for(var s=u;s<d._indexer.origin.length;s++)if(a*ud(d._indexer.origin[s].columnValues[r],d.condition[i])>=0){u=s;break}},d=this,h=0;h<this._indexer.fields.length;h++)c(h);return Math.max(u-1,0)},e.prototype.each=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l=this;return S(this,(function(u){switch(u.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(l._indexer.origin[t]){if(!l._indexer.origin[t].keys[++n]){if(!l._indexer.origin[++t])return!1;n=0}return!0}return!1},i=function(){if(l._indexer.origin[t]){if(!l._indexer.origin[t].keys[--n]){if(!l._indexer.origin[--t])return!1;n=l._indexer.origin[t].keys.length-1}return!0}return!1},a=null,!this._indexer.origin[t])return[3,4];s=this.backward?i:r,u.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if((o=u.sent())&&hd(this.condition,o))return a=o,[3,4];u.label=3;case 3:if(s())return[3,1];u.label=4;case 4:return[4,new Promise((function(s){var o=new bd({initialNextValue:ld(a),iterator:e,forward:function(){return N(l,0,void 0,(function(){var e,a;return S(this,(function(s){switch(s.label){case 0:e=this.backward?i:r,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(a=s.sent())&&hd(this.condition,a)?[2,ld(a)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return N(l,0,void 0,(function(){var e,a;return S(this,(function(s){switch(s.label){case 0:e=this.backward?r:i,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return(a=s.sent())&&hd(this.condition,a)?[2,ld(a)]:[3,1];case 3:return[2,null]}}))}))},complete:s});e(o)}))];case 5:return[2,u.sent()]}}))}))},e}(),Cd=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,a=e.mutex,s=e.blockManager,o=e.indexer;this._mutex=a,this._iterator=new yd({condition:n,backward:i,blockManager:s,indexer:o})}return e.prototype.fetch=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){var t,n,r,i,a=this;return S(this,(function(s){switch(s.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw sd.collectionQueryNotValid;s.label=1;case 1:return s.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return s.sent(),[4,this._iterator.each((function(e){return N(a,0,void 0,(function(){return S(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return s.sent(),this._mutex.unlock(),[2,r];case 4:throw i=s.sent(),this._mutex.unlock(),i;case 5:return[2]}}))}))},e.prototype.count=function(){return N(this,0,void 0,(function(){var e,t,n=this;return S(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return N(n,0,void 0,(function(){return S(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),Td=function(e){return"".concat("nest","@").concat(e)},Nd=function(e,t){return"".concat(Td(e),"/").concat(t)},Sd=function(e,t){return"".concat(Nd(e,t),".metadata")},Id=function(e,t){return"".concat(Nd(e,t),"/block.")},wd=function(e,t){return"".concat(Nd(e,t),"/blob.")},Ad=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this.store=r}return e.prototype.get=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return[4,this.store.get(e)];case 1:return(t=c.sent())?(n=t.data,r=t.type,"undefined"==typeof fetch?[3,4]:[4,fetch(n)]):[3,5];case 2:return[4,c.sent().blob()];case 3:return[2,c.sent()];case 4:for(i=[],a=atob(n.split(",")[1]),s=0;s<a.length;s+=512){for(o=a.slice(s,s+512),l=new Array(o.length),u=0;u<o.length;u++)l[u]=o.charCodeAt(u);i.push(new Uint8Array(l))}return[2,new Blob(i,{type:r})];case 5:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),N(this,0,void 0,(function(){var n,r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(n){var r,i,a,o,l=(r=s.dbname,i=s.collectionName,a=t,void 0===o&&(o=0),"".concat(wd(r,i)).concat(a,".").concat(o)),u=new FileReader;u.onload=function(){n({blobId:l,data:u.result,type:e.type})},u.readAsDataURL(e)}))];case 1:return n=o.sent(),r=n.blobId,i=n.data,a=n.type,[4,this.store.set({key:r,value:{data:i,type:a}})];case 2:return o.sent(),[2,r]}}))}))},e.prototype.remove=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){var e,t,n=this;return S(this,(function(r){switch(r.label){case 0:return e=wd(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return t=r.sent(),[4,Promise.all(t.filter((function(t){return t.startsWith(e)})).map((function(e){return N(n,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return[2,t.sent()]}}))}))})))];case 2:return r.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(vd||(vd={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(gd||(gd={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(Ed||(Ed={}));var Md,Od,Rd=[gd.PENDING,gd.VOLATILE],Dd={},kd=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return Dd[t]||(this.dbname=t,this._items=[],this._limit=r,Dd[t]=this),Dd[t]}return e.get=function(e){return Dd[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=Ed.DEFAULT),N(this,0,void 0,(function(){var r,i;return S(this,(function(a){switch(a.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=a.sent())&&(r={key:t,value:i,state:n===Ed.PERSISTENT?gd.PERSISTENT:gd.VOLATILE},this.put(r)),[3,3];case 2:n===Ed.PERSISTENT&&(r.state=gd.PERSISTENT),a.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=Ed.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===Ed.PERSISTENT&&(r.state=gd.PERSISTENT),t!==Ed.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)Rd.includes(this._items[r].state)&&Rd.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===gd.VOLATILE})).length-this._limit;if(i>0){var a=[];try{for(var s=I(this._items),o=s.next();!o.done;o=s.next()){var l=o.value;l.state===gd.VOLATILE&&i>0?i--:a.push(l)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}this._items=a}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clearForDatabase=function(e){this.clearByCondition((function(t){return t.key.startsWith(Td(e))}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==gd.VOLATILE}))},e}(),Ld=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(Nd(t,n),"/trans.metadata"),this.recordsetKey=function(e,t){return"".concat(Nd(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,A([],w(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],a=[],s=i.requests.length-1;s>=0;s--){var o=i.requests[s],l=o.data;n[l.key]||(a.unshift(o),n[l.key]=!0)}a.length>0&&(i.requests=a,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c;return S(this,(function(d){switch(d.label){case 0:n=kd.get(this.dbname),r=t.generation,i=t.requests,a=null,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return T(T({},e.data),{generation:r})})))];case 2:for(s=d.sent(),o=0;o<i.length;o++)s[o]instanceof Error&&(a||(a=s[o]),l=i[o].data,n.put(T(T({},l),{state:gd.PERSISTENT})));return[3,4];case 3:return u=d.sent(),a=u,[3,4];case 4:return a?[3,6]:(c=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:c})]);case 5:return d.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){a&&e(a)})),d.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=l.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=l.sent(),l.label=3;case 3:l.trys.push([3,8,9,10]),n=I(t),r=n.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:l.sent(),l.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return a=l.sent(),s={error:a},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case vd.COMMIT:this._onCommit.set(t,n);break;case vd.WRITE:this._onWrite.set(t,n);break;case vd.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t}),kd.get(this.dbname).put(T({state:gd.PENDING},e))},e.prototype.requestMultipleWrite=function(e,t){var n,r,i=kd.get(this.dbname);try{for(var a=I(e),s=a.next();!s.done;s=a.next()){var o=s.value;this._requests.push({data:o,options:t}),i.put(T({state:gd.PENDING},o))}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return kd.get(this.dbname).clearByCondition((function(e){return e.state===gd.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l,u,c,d,h=this;return S(this,(function(f){switch(f.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},o=e.length-1;o>=0;o--)r=e[o],u=r.data,n[u.key]||(n[u.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return a=f.sent(),[4,this._store.set({key:this.recordsetKey,value:a})];case 2:return f.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(f.sent(),s=kd.get(this.dbname),o=0;o<t.length;o++)l=t[o],u=l.data,c=l.options,s.put(T(T({},u),{state:c&&c.persistent?gd.PERSISTENT:gd.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),d=id.get(this.dbname),setTimeout((function(){try{h._applyRecord(a,i)}catch(e){h._onError.forEach((function(t){return t(e)}))}}),d.transactionApplyDelay),f.label=4;case 4:return[2]}}))}))},e}(),xd=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,a=e.limit;this.blockId=t,this.keyName=n,this.limit=a,this._items=A([],w(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this,n=this._items.find((function(n){var r=n[t.keyName];return e===r}));return null!=n?n:null},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t=0;t<this._items.length;t++)if(this._items[t][this.keyName]===e)return this._items.splice(t,1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),Ud=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,a=void 0===i?cd:i,s=e.transaction,o=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=a,this.metadata=r,this._transaction=s,this._store=o}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),s=this.dbname,o=this.collectionName,l=t,u="".concat((n=e,r=t,i={hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant},a=i.base*Math.pow(i.multiplier,r)+i.constant,(i.hashFunction||cd)(n,a))),"".concat(Id(s,o)).concat(l,".").concat(u);var n,r,i,a,s,o,l,u},e.prototype._findBlock=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:t=kd.get(this.dbname),n=this.metadata.blockLevel,s.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=s.sent())&&(null==(a=xd.createFromCacheItem(i))?void 0:a.getItemByKey(e)))return[2,a];s.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return n=id.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,kd.get(this.dbname).find(this._store,r)];case 1:return a=o.sent(),(null==(s=a?xd.createFromCacheItem(a):new xd({blockId:r,keyName:this.keyName,items:[],limit:i}))?void 0:s.add(t))?(this._transaction.requestWrite({key:s.blockId,value:s.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return e=Id(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=r.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:return r.sent(),[4,this._transaction.clear()];case 3:return r.sent(),kd.get(this.dbname).clearByCondition((function(t){return t.key.startsWith(e)})),[2]}}))}))},e}(),Pd=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,a=e.transaction,s=e.store,o=this;this._origin=[],this._table=[];var l,u,c,d=(l=t,u=n,c=i.join(">"),"".concat(Nd(l,u),"/index.").concat(c));this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=d,this._store=s,this._transaction=a,this._transaction.on(vd.COMMIT,this.indexerKey,(function(){return o.commit()})),this._transaction.on(vd.ERROR,this.indexerKey,(function(){return o.abort()}))}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=w(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=w(this.indexOf(n),2),i=r[0];if(r[1]){var a=this._table[i].keys.indexOf(t);if(a>-1)return this._table[i].keys.splice(a,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,a=[];try{for(var s=I(this.fields),o=s.next();!o.done;o=s.next()){var l=o.value;if("-"===l[0]&&(l=l.slice(1)),r=e[l],void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw sd.indexTypesNotMatch;a.push(e[l])}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=ud(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},e.prototype.ensure=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m;return S(this,(function(v){switch(v.label){case 0:return[4,(e=kd.get(this.dbname)).find(this._store,this.indexerKey,Ed.PERSISTENT)];case 1:return(t=v.sent())?[3,11]:(n=Id(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=v.sent(),v.label=3;case 3:v.trys.push([3,8,9,10]),i=I(r),a=i.next(),v.label=4;case 4:return a.done?[3,7]:(s=a.value).startsWith(n)?[4,e.find(this._store,s,Ed.NO_CACHE)]:[3,6];case 5:if(o=v.sent(),l=xd.createFromCacheItem(o))try{for(_=void 0,u=I(l.items),c=u.next();!c.done;c=u.next())d=c.value,this._addItem(d)}catch(g){_={error:g}}finally{try{c&&!c.done&&(m=u.return)&&m.call(u)}finally{if(_)throw _.error}}v.label=6;case 6:return a=i.next(),[3,4];case 7:return[3,10];case 8:return h=v.sent(),f={error:h},[3,10];case 9:try{a&&!a.done&&(p=i.return)&&p.call(i)}finally{if(f)throw f.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=ld(this._origin),v.label=12;case 12:return[2]}}))}))},e.prototype.drop=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return kd.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=ld(this._origin)},e.prototype.abort=function(){this._table=ld(this._origin)},e}(),Fd=function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product},Bd=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Md||(Md={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Od||(Od={}));var Hd,Gd={},jd=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=Md.PROCESSING,this._queue=[],this._activationQueue=[],Gd[e]&&!t.forceCreate||(this.nodeId=Bd(),this.key=e,Fd()&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data;if(null==i?void 0:i.isNestDbMessage){var a=i.nodeId,s=i.requestId,o=i.key,l=i.op,u=i.data;if(a!==n.nodeId&&o===n.key)switch(l){case Od.NEWNODE:n._sendSync();break;case Od.CLAIM_HOST:n._sendSync(),n._hostId=a;break;case Od.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var c=u,d=c.currentItemRequestId,h=c.queue,f=function(e){n._queue.findIndex((function(t){return t.requestId===e.requestId}))<0&&n._requestLock({isNestDbMessage:!0,nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Od.REQUEST_LOCK,ts:e.ts})};try{for(var p=I(h),_=p.next();!_.done;_=p.next())f(_.value)}catch(v){t={error:v}}finally{try{_&&!_.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===d})),n._completeSync()}break;case Od.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=void 0,n._acquire(n._queue[0]));break;case Od.REQUEST_LOCK:n._requestLock(i);break;case Od.ACQUIRE_LOCK:var m=n._queue.find((function(e){return e.requestId===s}));n._acquire(m);break;case Od.RELEASE_LOCK:n._release(s)}}})),window.addEventListener("beforeunload",(function(){n._send(Od.REMOVENODE)}))),Gd[e]=this),Gd[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==Md.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n;void 0===t&&(t={});var r={isNestDbMessage:!0,nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:Bd(),key:this.key,op:e,data:t.data,ts:Date.now()};return Fd()&&window.postMessage(r,"*"),r},e.prototype._acquire=function(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(Od.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased&&t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){for(var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Od.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1,a=0;a<t._queue.length;a++)if(t._queue[a].ts>r.ts){t._queue.splice(a,0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Od.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return N(this,0,void 0,(function(){var e=this;return S(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=Md.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(Od.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Od.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Od.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId)},e}(),Vd=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,a=e.indexes,s=e.store,o=this;this._state=ad.INIT,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=A([[r]],w(a.filter((function(e){return Pd.createKey(e)!==o.keyName}))),!1),this._keyHash=i,this._store=s,this._mutex=new jd("".concat(Nd(t,n),".lock")),this._blobContainer=new Ad({dbname:t,collectionName:n,store:s}),this._transaction=new Ld({dbname:t,collectionName:n,store:s})}return e.metadataOf=function(e,t,n){return N(this,0,void 0,(function(){var r;return S(this,(function(i){switch(i.label){case 0:return r=Sd(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===ad.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_=this;return S(this,(function(m){switch(m.label){case 0:return[4,this._mutex.lock()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,9,,10]),t=id.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=m.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:m.sent(),this._blockManager=new Ud({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=A([],w(this.indexes),!1),i=[],a=r.map((function(e){return Pd.createKey(e)})),s=n?n.indexes.map((function(e){return Pd.createKey(e)})):[];try{for(o=I(s),l=o.next();!l.done;l=o.next())u=l.value,a.includes(u)||i.push(Pd.parseKey(u))}catch(v){f={error:v}}finally{try{l&&!l.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}}return(c=[]).push.apply(c,A([],w(r.map((function(e){var t=new Pd({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),c.push.apply(c,A([],w(i.map((function(e){return new Pd({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(c)];case 5:return m.sent(),[4,this._transaction.commit()];case 6:return m.sent(),a.sort().join(",")===s.sort().join(",")?[3,8]:(d=Sd(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:m.sent(),m.label=8;case 8:return this._state=ad.READY,this._mutex.unlock(),[3,10];case 9:throw h=m.sent(),this._mutex.unlock(),h;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=ad.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=Pd.createKey(e);try{for(var i=I(this._indexers),a=i.next();!a.done;a=i.next()){var s=a.value;if(r===Pd.createKey(s.fields))return s}}catch(o){t={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}throw sd.indexTableIsRequired},e.prototype._upgradeBlockLevel=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=Sd(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return o.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return o.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return o.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:o.sent(),o.label=5;case 5:o.trys.push([5,10,11,12]),n=I(this._indexers),r=n.next(),o.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:o.sent(),o.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=o.sent(),a={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}return[7];case 12:return[3,14];case 13:throw sd.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=p.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return p.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return p.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:p.sent(),p.label=5;case 5:p.trys.push([5,10,11,12]),r=I(this._indexers),i=r.next(),p.label=6;case 6:return i.done?[3,9]:[4,(l=i.value).addItem(e)];case 7:p.sent(),p.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return a=p.sent(),c={error:a},[3,12];case 11:try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(c)throw c.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:p.sent(),p.label=15;case 15:p.trys.push([15,21,22,23]),s=I(this._indexers),o=s.next(),p.label=16;case 16:return o.done?[3,20]:0===(l=o.value).diff(l.getColumnValues(n),l.getColumnValues(e))?[3,19]:[4,l.removeItem(n)];case 17:return p.sent(),[4,l.addItem(e)];case 18:p.sent(),p.label=19;case 19:return o=s.next(),[3,16];case 20:return[3,23];case 21:return u=p.sent(),h={error:u},[3,23];case 22:try{o&&!o.done&&(f=s.return)&&f.call(s)}finally{if(h)throw h.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=u.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:u.sent(),u.label=3;case 3:u.trys.push([3,9,10,11]),r=I(this._indexers),i=r.next(),u.label=4;case 4:return i.done?[3,8]:0===(a=i.value).diff(a.getColumnValues(n),a.getColumnValues(e))?[3,7]:[4,a.removeItem(n)];case 5:return u.sent(),[4,a.addItem(e)];case 6:u.sent(),u.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return s=u.sent(),o={error:s},[3,11];case 10:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(o)throw o.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=o.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:o.sent(),o.label=3;case 3:o.trys.push([3,8,9,10]),n=I(this._indexers),r=n.next(),o.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:o.sent(),o.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=o.sent(),a={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return N(this,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:a.sent(),a.label=2;case 2:a.trys.push([2,7,8,9]),e=I(this._indexers),t=e.next(),a.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:a.sent(),a.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=a.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,ld(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw sd.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){if(void 0===e&&(e={}),this.isReady)return new Cd({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw sd.collectionNotReady},e.prototype.insertOne=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw sd.collectionKeyNotGiven;return[4,this._requestInsert(ld(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw sd.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l=this;return S(this,(function(u){switch(u.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:u.sent(),u.label=2;case 2:if(u.trys.push([2,12,,14]),e.some((function(e){return!l._hasPropertyOfKeyName(e)})))throw sd.collectionKeyNotGiven;u.label=3;case 3:u.trys.push([3,8,9,10]),t=I(e),n=t.next(),u.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(ld(r))]);case 5:u.sent(),u.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=u.sent(),s={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return u.sent(),this._mutex.unlock(),[2,e];case 12:return a=u.sent(),[4,this._transaction.clear()];case 13:throw u.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw sd.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw sd.collectionKeyNotGiven;return[4,this._requestUpsert(ld(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw sd.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l=this;return S(this,(function(u){switch(u.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:u.sent(),u.label=2;case 2:if(u.trys.push([2,12,,14]),e.some((function(e){return!l._hasPropertyOfKeyName(e)})))throw sd.collectionKeyNotGiven;u.label=3;case 3:u.trys.push([3,8,9,10]),t=I(e),n=t.next(),u.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(ld(r))]);case 5:u.sent(),u.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=u.sent(),s={error:i},[3,10];case 9:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return u.sent(),this._mutex.unlock(),[2,e];case 12:return a=u.sent(),[4,this._transaction.clear()];case 13:throw u.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw sd.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw sd.collectionKeyNotGiven;return[4,this._requestUpdate(ld(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw sd.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d,h,f,p,_,m=this;return S(this,(function(v){switch(v.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:v.sent(),v.label=2;case 2:return v.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,i=e.index,a=void 0===i?null:i,s=e.backward,o=void 0!==s&&s,l=[],[4,new yd({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(a)}).each((function(e){return N(m,0,void 0,(function(){var n;return S(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(n=e.nextValue,hd(r,n)&&t.set&&("function"!=typeof t.set?Object.keys(t.set).forEach((function(e){var r;n[e]=null===(r=t.set)||void 0===r?void 0:r[e]})):t.set(n),l.push(n)),e.next()):e.stop(),[2]}))}))}))];case 3:v.sent(),v.label=4;case 4:v.trys.push([4,9,10,11]),u=I(l),c=u.next(),v.label=5;case 5:return c.done?[3,8]:(d=c.value,[4,this._requestUpdate(ld(d))]);case 6:v.sent(),v.label=7;case 7:return c=u.next(),[3,5];case 8:return[3,11];case 9:return h=v.sent(),p={error:h},[3,11];case 10:try{c&&!c.done&&(_=u.return)&&_.call(u)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return v.sent(),this._mutex.unlock(),[2,l];case 13:return f=v.sent(),[4,this._transaction.clear()];case 14:throw v.sent(),this._mutex.unlock(),f;case 15:return[3,17];case 16:throw this._transaction.clear(),sd.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw sd.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_=this;return S(this,(function(m){switch(m.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,i=void 0===r?null:r,a=e.backward,s=void 0!==a&&a,o=[],[4,new yd({condition:n,blockManager:this._blockManager,backward:s,indexer:this._getIndexerBy(i)}).each((function(e){return N(_,0,void 0,(function(){var t,r;return S(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,hd(n,t)&&(r=t[this.keyName],o.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:m.sent(),m.label=4;case 4:m.trys.push([4,9,10,11]),l=I(o),u=l.next(),m.label=5;case 5:return u.done?[3,8]:(c=u.value,[4,this._requestRemove(c)]);case 6:m.sent(),m.label=7;case 7:return u=l.next(),[3,5];case 8:return[3,11];case 9:return d=m.sent(),f={error:d},[3,11];case 10:try{u&&!u.done&&(p=l.return)&&p.call(l)}finally{if(f)throw f.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return m.sent(),this._mutex.unlock(),[2,o];case 13:throw h=m.sent(),this._mutex.unlock(),h;case 14:return[3,16];case 15:throw this._transaction.clear(),sd.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw sd.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),qd=function(){function e(){}return e.off=function(){0},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}(),zd=[{},{a:700400,n:"error"}],Kd=function(){function e(e){var t,n,r;this.encryption=null!==(t=e.encryption)&&void 0!==t?t:$,this.itemSizeLimit=null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304,this.metadataBuffer=null!==(r=e.metadataBuffer)&&void 0!==r?r:256}return Object.defineProperty(e.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),e.prototype._getRawKey=function(e,t){return void 0===t&&(t=""),"".concat(e).concat(t)},e.prototype._generateShardPostfixArray=function(e){return void 0===e&&(e=1),A([],w(Array(e).keys()),!1)},e.prototype._shardify=function(e){var t=this,n=e.key,r=e.value,i=JSON.stringify(this.encryption.encrypt(r)),a=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(a).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:i.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:a}),r}))},e.prototype._resetIfEncryptionChanged=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l,u=this;return S(this,(function(c){switch(c.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(e=c.sent(),t={encrypted:zd.map((function(e){var t;return null===(t=u.encryption)||void 0===t?void 0:t.encrypt(e)}))},!e)return[3,8];if(!e.encrypted||!Array.isArray(e.encrypted))return[3,6];for(i in n=e.encrypted,r=[],n)r.push(i);a=0,c.label=2;case 2:return a<r.length?(i=r[a])in n?(s=i,o=JSON.stringify(e.encrypted[s]),l=JSON.stringify(t.encrypted[s]),o===l?[3,4]:(qd.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return c.sent(),[3,5];case 4:return a++,[3,2];case 5:return[3,8];case 6:return[4,this.clear()];case 7:c.sent(),c.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:t})];case 9:return c.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),e.prototype.usage=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return e=0,[4,this._getAllRawKeys()];case 1:t=u.sent(),u.label=2;case 2:u.trys.push([2,7,8,9]),n=I(t),r=n.next(),u.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._getRaw(i)]);case 4:(a=u.sent())&&(e+=JSON.stringify(a).length),u.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=u.sent(),o={error:s},[3,9];case 8:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}return[7];case 9:return[2,e]}}))}))},e.prototype.getAllKeys=function(){return N(this,0,void 0,(function(){var e=this;return S(this,(function(t){switch(t.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,t.sent().filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})).filter((function(t){return!e._reservedKeys.includes(t)}))]}}))}))},e.prototype.get=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:if(!(n=l.sent()))return[3,7];l.label=2;case 2:return l.trys.push([2,6,,7]),r=n.data,(null==(i=n.metadata)?void 0:i.shards)&&i.shards>1?[4,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return N(o,0,void 0,(function(){var n,i;return S(this,(function(a){switch(a.label){case 0:return t>0?(n=this._getRawKey(e,".".concat(t)),[4,this._getRaw(n)]):[3,2];case 1:if(!(i=a.sent()))throw sd.storeBrokenIntegrity;return[2,i.data];case 2:return[2,r]}}))}))})))]:[3,4];case 3:return s=l.sent(),[3,5];case 4:s=[r],l.label=5;case 5:return a=s,[2,this.encryption.decrypt(JSON.parse(a.join("")))];case 6:return l.sent(),[2,null];case 7:return[2,null]}}))}))},e.prototype.set=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=this._shardify(e),[4,this._setRaw(t)];case 1:return n.sent(),[2,T({},e.value)]}}))}))},e.prototype.setMany=function(e){return N(this,0,void 0,(function(){var t,n=this;return S(this,(function(r){switch(r.label){case 0:return t=[],[4,this._setRaw(t.concat.apply(t,A([],w(e.map((function(e){return n._shardify(e)}))),!1)))];case 1:return r.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:return(n=o.sent())?(r=n.metadata,i=this._generateShardPostfixArray(null==r?void 0:r.shards).map((function(t){return s._getRawKey(e,".".concat(t))})),[4,this._removeRaw(i)]):[3,3];case 2:return o.sent(),null==(a=kd.get(this.dbname))||a.remove(e),[2,!0];case 3:return[2,!1]}}))}))},e.prototype.removeMany=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d=this;return S(this,(function(h){switch(h.label){case 0:t=kd.get(this.dbname),n=[],r=function(e){var r,a,s;return S(this,(function(o){switch(o.label){case 0:return r=i._getRawKey(e,".0"),[4,i._getRaw(r)];case 1:return(a=o.sent())&&(s=a.metadata,n.push.apply(n,A([],w(i._generateShardPostfixArray(null==s?void 0:s.shards).map((function(t){return d._getRawKey(e,".".concat(t))}))),!1))),null==t||t.remove(e),[2]}}))},i=this,h.label=1;case 1:h.trys.push([1,6,7,8]),a=I(e),s=a.next(),h.label=2;case 2:return s.done?[3,5]:(o=s.value,[5,r(o)]);case 3:h.sent(),h.label=4;case 4:return s=a.next(),[3,2];case 5:return[3,8];case 6:return l=h.sent(),u={error:l},[3,8];case 7:try{s&&!s.done&&(c=a.return)&&c.call(a)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this._removeRaw(n)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2,e]}}))}))},e.prototype.clear=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){return null==(e=kd.get(this.dbname))||e.clearForDatabase(this.dbname),[2]}))}))},e}(),Yd={},Wd=function(e){function t(t){void 0===t&&(t={});var n,r=this;r=e.call(this,T(T({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:4194304}))||this;var i=t.delay,a=void 0===i?1:i;return r.delay=a,r.observer={},r}return C(t,e),Object.defineProperty(t.prototype,"rawData",{get:function(){return Yd[this.dbname]},set:function(e){Yd[this.dbname]=e},enumerable:!1,configurable:!0}),t.prototype._getAllRawKeys=function(){return N(this,0,void 0,(function(){return S(this,(function(e){if(Yd[this.dbname])return[2,Object.keys(Yd[this.dbname])];throw sd.storeNotAvailable}))}))},t.prototype._getRaw=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return Yd[this.dbname]?[4,dd(this.delay)]:[3,2];case 1:return t.sent(),[2,Yd[this.dbname][e]?T({key:e},Yd[this.dbname][e]):null];case 2:throw sd.storeNotAvailable}}))}))},t.prototype._setRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return Yd[this.dbname]?[4,dd(this.delay)]:[3,2];case 1:u.sent();try{for(t=I(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,a=r.data,s=r.metadata,Yd[this.dbname][i]=Object.freeze({data:a,metadata:s})}catch(c){o={error:c}}finally{try{n&&!n.done&&(l=t.return)&&l.call(t)}finally{if(o)throw o.error}}return[3,3];case 2:throw sd.storeNotAvailable;case 3:return[2]}}))}))},t.prototype._removeRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return Yd[this.dbname]?[4,dd(this.delay)]:[3,2];case 1:s.sent();try{for(t=I(e),n=t.next();!n.done;n=t.next())r=n.value,Yd[this.dbname][r]&&delete Yd[this.dbname][r]}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}}return[3,3];case 2:throw sd.storeNotAvailable;case 3:return[2]}}))}))},t.prototype.observe=function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))},t.prototype.checkAvailability=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},t.prototype.init=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this.dbname=e,Yd[this.dbname]||(Yd[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.set=function(t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){if((n=this.observer[t.key])&&"function"==typeof n.set&&(r=n.set()))throw r;return[2,e.prototype.set.call(this,t)]}))}))},t.prototype.setMany=function(t){return N(this,0,void 0,(function(){var n,r,i,a,s,o,l;return S(this,(function(u){try{for(n=I(t),r=n.next();!r.done;r=n.next())if(i=r.value,(a=this.observer[i.key])&&"function"==typeof a.set&&(s=a.set()))throw s}catch(c){o={error:c}}finally{try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}return[2,e.prototype.setMany.call(this,t)]}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return t.sent(),[4,dd(this.delay)];case 2:return t.sent(),Yd[this.dbname]={},[2]}}))}))},t}(Kd),Qd="NestDBStore";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED"}(Hd||(Hd={}));var Xd,Zd=function(e){function t(t){void 0===t&&(t={});var n,r=this;return(r=e.call(this,T(T({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:104857600}))||this)._storeName=Qd,r._state=Hd.UNINITIALIZED,r._openJobQueue=[],r._window="undefined"!=typeof window?window:void 0,r._indexedDb=r._window?r._window.indexedDB||r._window.mozIndexedDB||r._window.webkitIndexedDB||r._window.msIndexedDB:void 0,r}return C(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.isTransactionInactiveError=function(e){return e instanceof Error&&e.message.includes("The transaction is inactive")},t.prototype._putToObjectStore=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){return[2,new Promise((function(n,r){var i=e.put(t);i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",(function(){r("Failed to write.")}))}))]}))}))},t.prototype._deleteFromObjectStore=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){return[2,new Promise((function(n,r){var i=e.delete(t);i.addEventListener("success",(function(){return n(t)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))]}))}))},t.prototype._openDatabase=function(e){var t=this;return new Promise((function(n,r){if(t._indexedDb){t._state=Hd.OPENING;var i=t._indexedDb.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(Qd,{keyPath:"key"})})),i.addEventListener("success",(function(r){t._state=Hd.OPEN,t._database=r.target.result,t._openJobQueue.forEach((function(e){return e()})),t._openJobQueue=[],t._database.onclose=function(){t._database=void 0,t._state=Hd.OPENING,setTimeout((function(){t._openDatabase(e)}),5)},n(t._database)})),i.addEventListener("error",(function(e){t._state=Hd.UNINITIALIZED,r(e.target.error)}))}else r(sd.storeNotAvailable)}))},t.prototype._getObjectStore=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case Hd.UNINITIALIZED:case Hd.OPEN:return[3,2];case Hd.OPENING:case Hd.CLOSED:return[3,3]}return[3,4];case 2:throw sd.storeNotInitialized;case 3:return[2,new Promise((function(n){t._openJobQueue.push((function(){return n(t._getObjectStore(e))}))}))];case 4:return[4,this._getObjectStore(e)];case 5:return[2,n.sent()]}}))}))},t.prototype._getAllRawKeys=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=t.sent(),[4,new Promise((function(t,n){var r=e.getAllKeys();r.addEventListener("success",(function(e){t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 2:return[2,t.sent()]}}))}))},t.prototype._getRaw=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return t=n.sent(),[4,new Promise((function(n,r){var i=t.get(e);i.addEventListener("success",(function(e){var t;n(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 2:return[2,n.sent()]}}))}))},t.prototype._setRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u=this;return S(this,(function(c){switch(c.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:t=c.sent(),c.label=2;case 2:return c.trys.push([2,4,,15]),[4,Promise.all(e.map((function(e){return u._putToObjectStore(t,e)})))];case 3:return c.sent(),[3,15];case 4:if(n=c.sent(),!this.isTransactionInactiveError(n))return[3,13];c.label=5;case 5:c.trys.push([5,10,11,12]),r=I(e),i=r.next(),c.label=6;case 6:return i.done?[3,9]:(a=i.value,[4,this._putToObjectStore(t,a)]);case 7:c.sent(),c.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=c.sent(),o={error:s},[3,12];case 11:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw n;case 14:return[3,15];case 15:return[2]}}))}))},t.prototype._removeRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u=this;return S(this,(function(c){switch(c.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:t=c.sent(),c.label=2;case 2:return c.trys.push([2,4,,15]),[4,Promise.all(e.map((function(e){return u._deleteFromObjectStore(t,e)})))];case 3:return c.sent(),[3,15];case 4:if(n=c.sent(),!this.isTransactionInactiveError(n))return[3,13];c.label=5;case 5:c.trys.push([5,10,11,12]),r=I(e),i=r.next(),c.label=6;case 6:return i.done?[3,9]:(a=i.value,[4,this._deleteFromObjectStore(t,a)]);case 7:c.sent(),c.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=c.sent(),o={error:s},[3,12];case 11:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw n;case 14:return[3,15];case 15:return[2]}}))}))},t.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},t.prototype.checkAvailability=function(){return N(this,0,void 0,(function(){var e,t=this;return S(this,(function(n){switch(n.label){case 0:if(!((null==(e="undefined"!=typeof window?window:null)?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!Fd())return[3,4];if(!(Fd()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw sd.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise((function(e,n){if(t._indexedDb)try{var r=t._indexedDb.open("_testMozilla");r.onerror=function(){return n(sd.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(r){if(r.target.result.close(),t._indexedDb){var i=t._indexedDb.deleteDatabase("_testMozilla");i.onerror=function(){return e()},i.onsuccess=function(){return e()}}else n(sd.storeNotAvailable)}}catch(i){n(sd.storeNotAvailableInPrivateBrowsing)}else n(sd.storeNotAvailable)}))];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:throw sd.storeNotAvailable;case 5:return[3,7];case 6:throw sd.storeNotAvailable;case 7:return[2]}}))}))},t.prototype.init=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return t.sent(),[4,this._openDatabase(e)];case 2:return t.sent(),[4,this._resetIfEncryptionChanged()];case 3:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,this._getObjectStore("readwrite")];case 2:return t=n.sent(),[4,new Promise((function(e,n){var r=t.clear();r.addEventListener("success",(function(){return e()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 3:return[2,n.sent()]}}))}))},t}(Kd),Jd=function(e){function t(t){var n=this,r=t.AsyncStorage,i=t.itemSizeLimit,a=void 0===i?2097152:i,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["AsyncStorage","itemSizeLimit"]);return(n=e.call(this,T(T({},s),{itemSizeLimit:a}))||this)._asyncStorage=r,n}return C(t,e),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return N(this,0,void 0,(function(){var e=this;return S(this,(function(t){switch(t.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return[2,t.sent().filter((function(t){return e._isBelonging(t)})).map((function(t){return t.substring("".concat(e.dbname,"/").length)}))]}}))}))},t.prototype._getRaw=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},t.prototype._setRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:t=[];try{for(n=I(e),r=n.next();!r.done;r=n.next())i=r.value,a=i.key,i.data.length<=this.adjustedItemSizeLimit&&t.push([this._getActualKey(a),JSON.stringify(i)])}catch(u){s={error:u}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(s)throw s.error}}return[4,this._asyncStorage.multiSet(t)];case 1:return l.sent(),[2]}}))}))},t.prototype._removeRaw=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2]}}))}))},t.prototype.checkAvailability=function(){return N(this,0,void 0,(function(){return S(this,(function(e){if(!this._asyncStorage)throw sd.storeNotAvailable;return[2]}))}))},t.prototype.init=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,this.getAllKeys()];case 2:return t=n.sent(),[4,this.removeMany(t)];case 3:return n.sent(),[2]}}))}))},t}(Kd),$d=function(e){function t(t){var n,r=this;return(r=e.call(this,T(T({},t),{itemSizeLimit:null!==(n=t.itemSizeLimit)&&void 0!==n?n:6291456}))||this)._mmkv=t.MMKV,r}return C(t,e),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return N(this,0,void 0,(function(){var e=this;return S(this,(function(t){switch(t.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return[2,t.sent().filter((function(t){return e._isBelonging(t)})).map((function(t){return t.substring("".concat(e.dbname,"/").length)}))]}}))}))},t.prototype._getRaw=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},t.prototype._setRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){try{for(t=I(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,r.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(i),JSON.stringify(r))}catch(l){a={error:l}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}}return[2]}))}))},t.prototype._removeRaw=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){try{for(t=I(e),n=t.next();!n.done;n=t.next())r=n.value,this._mmkv.delete(this._getActualKey(r))}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}}return[2]}))}))},t.prototype.checkAvailability=function(){return N(this,0,void 0,(function(){return S(this,(function(e){if(!this._mmkv)throw sd.storeNotAvailable;return[2]}))}))},t.prototype.init=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.clear.call(this)];case 1:return n.sent(),[4,this.getAllKeys()];case 2:return t=n.sent(),[4,this.removeMany(t)];case 3:return n.sent(),[2]}}))}))},t}(Kd);!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(Xd||(Xd={}));var eh,th=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=Xd.INIT,this._config=i||new id({dbname:t}),this._store=r,this._event={success:fd,error:fd,storeReplaced:fd,upgrade:md},this._collections=new Map,this._globalMutex=new jd("".concat(this.name,".lock")),this._config.disableLogger&&qd.off(),new kd({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),e.prototype._initializeCollection=function(e,t){var n;return N(this,0,void 0,(function(){var r,i,a;return S(this,(function(s){switch(s.label){case 0:return i=this._collections.get(e),t?(r=new Vd({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:null!==(n=t.index)&&void 0!==n?n:[[t.keyName]],store:this._store}),[3,3]):[3,1];case 1:return i&&i.state===ad.READY?[3,3]:[4,Vd.metadataOf(this.name,e,this._store)];case 2:(a=s.sent())&&(r=new Vd({dbname:this.name,collectionName:e,keyName:a.keyName,indexes:a.indexes,store:this._store})),s.label=3;case 3:return r?(this._collections.set(e,r),[4,r.init()]):[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}}))}))},e.prototype.estimateUsage=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,(t=this._store,N(void 0,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,t.usage()];case 1:return[2,e.sent()]}}))})))];case 1:return[2,e.sent()]}var t}))}))},e.prototype.commitSchema=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this._state!==Xd.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return N(t,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._initializeCollection(e.collectionName,e)];case 1:return t.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw sd.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d=this;return S(this,(function(h){switch(h.label){case 0:return[4,this._globalMutex.lock()];case 1:if(h.sent(),this._state===Xd.OPENED)return[3,20];this._state=Xd.OPENING,h.label=2;case 2:return h.trys.push([2,13,,20]),[4,this._store.init(this.name)];case 3:return h.sent(),f=this.name,t="".concat(Td(f),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:r=null!==(e=h.sent())&&void 0!==e?e:n,h.label=5;case 5:h.trys.push([5,10,11,12]),i=I(r.collectionNames),a=i.next(),h.label=6;case 6:return a.done?[3,9]:(s=a.value,[4,this._initializeCollection(s)]);case 7:h.sent(),h.label=8;case 8:return a=i.next(),[3,6];case 9:return[3,12];case 10:return o=h.sent(),u={error:o},[3,12];case 11:try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 12:return[2,new Promise((function(e,n){var i=function(e){r.version<d._version?d._event.upgrade(r.version,(function(n){return N(d,0,void 0,(function(){var i;return S(this,(function(a){switch(a.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r})];case 2:return a.sent(),e({continued:!0}),[3,4];case 3:return i=a.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),a.label=6;case 6:return[2]}}))}))})):e({continued:!1})},a=function(t){var s=t.continued,o=void 0!==s&&s,l=t.err,u=void 0===l?null:l;o?setTimeout((function(){return i(a)}),10):u?(qd.error(u.message),d._globalMutex.unlock(),d._event.error(u),n(u)):Promise.all(r.collectionNames.map((function(e){return d._initializeCollection(e)}))).then((function(){d._state=Xd.OPENED,d._globalMutex.unlock(),d._event.success(),e()})).catch((function(e){qd.error(e.message),d._globalMutex.unlock(),d._event.error(e),n(e)}))};i(a)}))];case 13:switch((l=h.sent()).code){case Vc.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,14];case Vc.STORE_NOT_AVAILABLE:return[3,16]}return[3,18];case 14:return qd.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new Wd({}),this._globalMutex.unlock(),this._event.error(l),this._event.storeReplaced(this._store),[4,this.open()];case 15:return h.sent(),[3,19];case 16:return qd.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Wd({}),this._globalMutex.unlock(),this._event.error(l),this._event.storeReplaced(this._store),[4,this.open()];case 17:return h.sent(),[3,19];case 18:throw qd.error(l.message),this._globalMutex.unlock(),this._event.error(l),l;case 19:return[3,20];case 20:return[2]}var f}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=Xd.CLOSED},e.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return(e=kd.get(this.name))&&e.clearForDatabase(this.name),[4,this._store.clear()];case 1:return t.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?md:fd)},e.prototype.collection=function(e){var t=this._collections.get(e);if(t)return t;throw sd.collectionNotReady},e}();!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.NONE=5]="NONE"}(eh||(eh={}));var nh,rh=function(){function e(){this.level=eh.WARN}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level,eh.VERBOSE},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level,eh.DEBUG},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level,eh.INFO},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level,eh.WARN},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level,eh.ERROR},e}(),ih=function(){function e(e){var t,n,r,i;this.messageTypeFilter=null!==(t=null==e?void 0:e.messageTypeFilter)&&void 0!==t?t:ue.ALL,this.customTypesFilter=null!==(n=null==e?void 0:e.customTypesFilter)&&void 0!==n?n:null,this.senderUserIdsFilter=null!==(r=null==e?void 0:e.senderUserIdsFilter)&&void 0!==r?r:null,this.replyType=null!==(i=null==e?void 0:e.replyType)&&void 0!==i?i:he.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case ue.USER:if(e.messageType!==le.USER)return!1;break;case ue.FILE:if(e.messageType!==le.FILE)return!1;break;case ue.ADMIN:if(e.messageType!==le.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof tl))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}if(e instanceof el)switch(this.replyType){case he.NONE:if(e.parentMessageId>0)return!1;break;case he.ONLY_REPLY_TO_CHANNEL:if(e instanceof tl&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(nh||(nh={}));var ah,sh=function(e){switch(e){case nh.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case nh.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},oh=T(T({},Vl),{scheduledAt:void 0}),lh=T(T({},Hl),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),uh="UnsentMessage",ch={},dh=function(e){function t(t){var n=e.call(this,t)||this;return n._mutex=new jd("unsendmessagecache.lock"),ch[t]=n,n}return C(t,e),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return As.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,n){return void 0===n&&(n=!1),ch[e]&&!n||(ch[e]=new t(e)),ch[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,t=null==e?void 0:e.collection(uh);if(!t)throw H.databaseError;return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){if(e.messageId>0)throw H.invalidParameters;var t,n,r=T({},e.serialize());return e instanceof ol?(e.messageParams&&(r.messageParams=jl(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,T(T({},jl(t)),{scheduledAt:t.scheduledAt})))):e instanceof fl?(e.messageParams&&(r.messageParams=Xl(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=function(e){return T(T({},Xl(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof ll&&e.messageParams&&(r.messageParams=(n=e.messageParams,Ne({fileInfoList:n.fileInfoList.map((function(e){return{file:e.file,fileUrl:pl.getPlainUrl(e),fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:e.thumbnailSizes,_thumbnails:e._thumbnails,_uploadedMetaData:e._uploadedMetaData}})),isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption}))),r},t.prototype._deserialize=function(e){return e=T(T({},e),{messageId:parseInt(e.messageId)}),Sh.of(this._iid).buildMessageFromSerializedData(e)},t.prototype._deserializeWithMessageCreateParams=function(e){var t,n,r;return N(this,0,void 0,(function(){var i,a,s,o,l,u,c=this;return S(this,(function(d){switch(d.label){case 0:return i=Sh.of(this._iid),a=this._deserialize(e),e.messageParams?a instanceof ol?(o=e.messageParams,a.messageParams=i.buildUserMessageCreateParamsFromSerializedData(o,a),[3,6]):[3,1]:[3,6];case 1:return a instanceof fl?(o=e.messageParams).fileKey&&"string"==typeof o.fileKey&&Ql(null!==(t=o.fileType)&&void 0!==t?t:"")?(s=o,[4,this.collection.getBlob(o.fileKey)]):[3,3]:[3,4];case 2:s.file=null!==(n=d.sent())&&void 0!==n?n:void 0,d.label=3;case 3:return a.messageParams=i.buildFileMessageCreateParamsFromSerializedData(o,a),[3,6];case 4:return a instanceof ll&&(o=e.messageParams)&&o.fileInfoList?(a.messageParams=i.buildMultipleFilesMessageCreateParamsFromSerializedData(o,a),[4,Promise.all(a.messageParams.fileInfoList.map((function(e){return N(c,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return"string"==typeof(null===(n=e._uploadedMetaData)||void 0===n?void 0:n.fileKey)&&Ql(null!==(i=null===(r=e._uploadedMetaData)||void 0===r?void 0:r.fileType)&&void 0!==i?i:"")?(t=e,[4,this.collection.getBlob(e._uploadedMetaData.fileKey)]):[3,2];case 1:t.file=null!==(a=s.sent())&&void 0!==a?a:void 0,s.label=2;case 2:return[2]}}))}))})))]):[3,6];case 5:d.sent(),d.label=6;case 6:return a.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?a instanceof ol?(l=e.scheduledInfo.scheduledMessageParams,a.scheduledInfo.scheduledMessageParams=i.buildScheduledUserMessageCreateParamsFromSerializedData(l,a),[3,10]):[3,7]:[3,10];case 7:return a instanceof fl?(l=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof l.fileKey&&"string"==typeof l.fileType&&Ql(l.fileType)?(u=l,[4,this.collection.getBlob(l.fileKey)]):[3,9]:[3,10];case 8:u.file=null!==(r=d.sent())&&void 0!==r?r:void 0,d.label=9;case 9:a.scheduledInfo.scheduledMessageParams=i.buildScheduledFileMessageCreateParamsFromSerializedData(l,a),d.label=10;case 10:return[2,a]}}))}))},t.prototype._getFileInfoBlobKey=function(e,t){return"".concat(e,".").concat(t)},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,void 0]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.filter,r=void 0===n?new ih:n,i=e.order,a=void 0===i?nh.CHANNEL_LATEST:i,s=e.sendingStatus,o=e.backward,l=void 0!==o&&o,u=e.parentMessageId;return N(this,0,void 0,(function(){var e,n,i,o,c=this;return S(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=sh(a),n={"/where":function(e){return!!(a!==nh.NEWEST_CHILD_MESSAGE||u&&0!==e.parentMessageId&&e.parentMessageId===u)&&r.match(c._deserialize(e))}},t&&(n.channelUrl=t),s&&(n.sendingStatus=s),i={where:n,index:e,backward:l},[4,this.collection.query(i)]):[3,3];case 1:return[4,d.sent().fetch({})];case 2:return o=d.sent(),[2,Promise.all(o.map((function(e){return N(c,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},t.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new ih),N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:nh.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},t.prototype.upsert=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return N(t,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return e instanceof fl||e instanceof ll?[4,this._mutex.lock()]:[3,4];case 1:return n.sent(),[4,this.saveBlob(e)];case 2:return n.sent(),[4,this._mutex.unlock()];case 3:n.sent(),n.label=4;case 4:return t=this._serialize(e),[4,this.collection.upsertOne(t)];case 5:return n.sent(),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.upsertChildMessages=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return N(t,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=[],e.threadInfo&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=I(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),a={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.saveBlob=function(e){return N(this,0,void 0,(function(){var t,n,r,i=this;return S(this,(function(a){switch(a.label){case 0:return e instanceof fl?e.messageParams&&(r=e.messageParams).file&&Wl(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,2]:[3,5];case 1:n=a.sent(),r.fileKey=n,r.fileType=zl.BLOB,a.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(t=e.scheduledInfo.scheduledMessageParams).file&&Wl(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,4];case 3:n=a.sent(),t.fileKey=n,t.fileType=zl.BLOB,a.label=4;case 4:return[3,7];case 5:return e instanceof ll&&(r=e.messageParams)&&r.fileInfoList&&Array.isArray(r.fileInfoList)?[4,Promise.all(r.fileInfoList.map((function(t,n){return N(i,0,void 0,(function(){var r;return S(this,(function(i){switch(i.label){case 0:return t.file&&Wl(t.file)?[4,this.collection.saveBlob(t.file,this._getFileInfoBlobKey(e.reqId,n))]:[3,2];case 1:r=i.sent(),t._uploadedMetaData||(t._uploadedMetaData={}),t._uploadedMetaData.fileKey=r,t._uploadedMetaData.fileType=zl.BLOB,i.label=2;case 2:return[2]}}))}))})))]:[3,7];case 6:a.sent(),a.label=7;case 7:return[2]}}))}))},t}(ma),hh={},fh=function(e){function t(t){var n=e.call(this,t)||this;return hh[t]=n,n}return C(t,e),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return As.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return As.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return dh.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,n){return void 0===n&&(n=!1),hh[e]&&!n||(hh[e]=new t(e)),hh[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return Ia(!!e).throw(H.databaseError),e.collection(Rc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return T(T({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=T(T({},e),{messageId:parseInt(e.messageId)}),Sh.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,void 0]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,a=e.filter,s=void 0===a?new ih:a,o=e.order,l=void 0===o?nh.CHANNEL_LATEST:o,u=e.backward,c=void 0!==u&&u,d=e.parentMessageId,h=e.isPollOnly,f=void 0!==h&&h,p=e.exactMatch,_=void 0!==p&&p,m=e.inclusive,v=void 0===m||m;return N(this,0,void 0,(function(){var e,r,a,o=this;return S(this,(function(u){switch(u.label){case 0:return this.localCacheEnabled?(e=sh(l),r={where:{channelUrl:t,"/where":function(e){if(null!=n&&""!==n)switch(l){case nh.CHANNEL_LATEST:if(_&&e.createdAt!==n)return!1;if(c){if(v&&e.createdAt<n||!v&&e.createdAt<=n)return!1}else if(v&&e.createdAt>n||!v&&e.createdAt>=n)return!1;break;case nh.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return!1}return!(f&&!e._poll)&&s.match(o._deserialize(e))}},index:e,backward:c},[4,this.collection.query(r)]):[3,3];case 1:return[4,u.sent().fetch({limit:null!=i?i:void 0})];case 2:return a=u.sent(),[2,Promise.all(a.map((function(e){return N(o,0,void 0,(function(){return S(this,(function(t){return[2,this._deserialize(e)]}))}))})))];case 3:return[2,[]]}}))}))},t.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new ih),N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:nh.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},t.prototype.upsert=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c=this;return S(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,13];case 1:d.sent(),d.label=2;case 2:d.trys.push([2,7,8,9]),n=I(e),r=n.next(),d.label=3;case 3:return r.done?[3,6]:(i=r.value,(null===(t=i.threadInfo)||void 0===t?void 0:t._isUpdateRequired)?[4,this.get(i.messageId)]:[3,5]);case 4:(null==(a=d.sent())?void 0:a.threadInfo)&&i.threadInfo._updateFrom(a.threadInfo),d.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=d.sent(),l={error:s},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(l)throw l.error}return[7];case 9:return o=e.map((function(e){return c._serialize(e)})),[4,this.collection.upsertMany(o)];case 10:return d.sent(),[4,this.upsertChildMessages(e)];case 11:return d.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 12:d.sent(),d.label=13;case 13:return[2]}}))}))},t.prototype.upsertChildMessages=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return N(t,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=I(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),a={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:sh(nh.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.removeUnderOffset=function(e,t,n){return void 0===n&&(n=!1),N(this,0,void 0,(function(){return S(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:n?{"<=":t}:{"<":t}},index:sh(nh.CHANNEL_LATEST)})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.countBetween=function(e,t,n){return N(this,0,void 0,(function(){var r,i=this;return S(this,(function(a){switch(a.label){case 0:return this.localCacheEnabled?(r=sh(nh.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}}))}))},t.prototype.saveBlobs=function(e){return N(this,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return N(t,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return e instanceof fl&&e.messageParams&&(t=e.messageParams).file&&Wl(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},t.prototype._getGroupChannelPreferenceSize=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return t=0,[4,(n=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return r=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return i=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return a=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return s=o.sent(),r&&(t+=JSON.stringify(r).length),i&&(t+=JSON.stringify(i).length),a&&(t+=JSON.stringify(a).length),s&&(t+=JSON.stringify(s).length),[2,t]}}))}))},t}(ma),ph={},_h=function(e){function t(t){var n=e.call(this,t)||this;return ph[t]=n,n}return C(t,e),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return As.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return As.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,n){return void 0===n&&(n=!1),ph[e]&&!n||(ph[e]=new t(e)),ph[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return Ia(!!e).throw(H.databaseError),e.collection(Dc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return T({},e.serialize())},t.prototype._deserialize=function(e){return Sh.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,void 0]}}))}))},t.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,a=e.filter,s=void 0===a?new ih:a,o=e.backward,l=void 0!==o&&o,u=e.exactMatch,c=void 0!==u&&u,d=e.inclusive,h=void 0===d||d;return N(this,0,void 0,(function(){var e,r=this;return S(this,(function(a){switch(a.label){case 0:return this.localCacheEnabled?(e={where:{channelUrl:t,"/where":function(e){if(n){if(c&&e.createdAt!==n)return!1;if(l){if(h&&e.createdAt<n||!h&&e.createdAt<=n)return!1}else if(h&&e.createdAt>n||!h&&e.createdAt>=n)return!1}return s.match(r._deserialize(e))}},index:["channelUrl","-createdAt","-notificationId"],backward:l},[4,this.collection.query(e)]):[3,3];case 1:return[4,a.sent().fetch({limit:null!=i?i:void 0})];case 2:return[2,a.sent().map((function(e){return r._deserialize(e)}))];case 3:return[2,[]]}}))}))},t.prototype.upsert=function(e){return N(this,0,void 0,(function(){var t,n=this;return S(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?(t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return[3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=I(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=o.sent(),a={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},t.prototype.markAsReadByTimestamp=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,messageStatus:$o.SENT,createdAt:{"<":t}}},{set:{messageStatus:$o.READ}})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.markAsReadByMessageIds=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":t},messageStatus:$o.SENT}},{set:{messageStatus:$o.READ}})]:[3,2];case 1:return[2,n.sent().length];case 2:return[2,0]}}))}))},t.prototype.removeMessagesOfChannel=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.removeUnderOffset=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:sh(nh.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.countBetween=function(e,t,n){return N(this,0,void 0,(function(){var r,i=this;return S(this,(function(a){switch(a.label){case 0:return this.localCacheEnabled?(r=["channelUrl","-createdAt","-notificationId"],[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}}))}))},t}(ma),mh={},vh=function(e){function t(t){var n=e.call(this,t)||this;return n._observers=new Map,n._dispatcherContext=n._dispatcher.on((function(e){return N(n,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C=this;return S(this,(function(T){switch(T.label){case 0:return e instanceof Rs?(t=e.messages,y=e.source,s=e.isWebSocketEventComing,n=t.filter((function(e){return e instanceof el&&e.channelType!==ae.OPEN&&e.messageId>0})),r=t.filter((function(e){return e instanceof el&&e.channelType!==ae.OPEN&&0===e.messageId})),i=t.filter((function(e){return e instanceof cl})),n.length>0?[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(n)];case 1:return e.sent(),[4,this._unsentMessageCache.remove(n.map((function(e){return e instanceof tl?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,7];case 1:T.sent(),s||this._broadcastUpdateEvent(n,y),T.label=2;case 2:return r.length>0?[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.upsert(r)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:T.sent(),s||this._broadcastUpdateEvent(r,y),T.label=4;case 4:return i.length>0?[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._notificationCache.upsert(i)];case 1:return e.sent(),[2]}}))}))}))]:[3,6];case 5:T.sent(),s||this._broadcastUpdateEvent(i,y),T.label=6;case 6:return[3,24];case 7:return e instanceof Ds?(a=e.messageIds,y=e.source,s=e.isWebSocketEventComing,o=a.filter((function(e){return"number"==typeof e})),l=a.filter((function(e){return"string"==typeof e})),[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return o.length>0?[4,this._messageCache.remove(o)]:[3,2];case 1:e.sent(),e.label=2;case 2:return l.length>0?[4,this._notificationCache.remove(l)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}))]):[3,9];case 8:return T.sent(),s||this._broadcastRemoveEvent(a,y),[3,24];case 9:return e instanceof Us?(u=e.reqId,y=e.source,[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._unsentMessageCache.remove([u])];case 1:return e.sent(),[2]}}))}))}))]):[3,11];case 10:return T.sent(),this._broadcastRemoveUnsentEvent(u,y),[3,24];case 11:return e instanceof Ps?(c=e.polls,y=e.source,this._cacheContext.localCacheEnabled?(d=c.map((function(e){return e.messageId})),[4,Promise.all(d.map((function(e){return C._messageCache.get(e)})))]):[3,14]):[3,15];case 12:return(h=T.sent().filter((function(e){return e}))).length>0&&c.forEach((function(e){var t=h.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert(h)];case 1:return[2,e.sent()]}}))}))}))];case 13:T.sent(),T.label=14;case 14:return this._broadcastPollChangeLogEvent(c,y),[3,24];case 15:return e instanceof Fs?(f=e.event,y=e.source,[4,this._messageCache.get(f.messageId)]):[3,19];case 16:return(p=T.sent())&&p.isUserMessage()&&p.poll&&p.poll.applyPollUpdateEvent(f)?[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([p])];case 1:return[2,e.sent()]}}))}))}))]:[3,18];case 17:T.sent(),T.label=18;case 18:return this._broadcastPollUpdateEvent(f,y),[3,24];case 19:return e instanceof Bs?(_=e.event,y=e.source,[4,this._messageCache.get(_.messageId)]):[3,23];case 20:return(m=T.sent())&&m.isUserMessage()&&m.poll&&m.poll.applyPollVoteEvent(_)?[4,Xi((function(){return N(C,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._messageCache.upsert([m])];case 1:return[2,e.sent()]}}))}))}))]:[3,22];case 21:T.sent(),T.label=22;case 22:return this._broadcastPollVoteEvent(_,y),[3,24];case 23:e instanceof Ls?(v=e.event,y=e.source,v.messageId>0&&this._broadcastReactionUpdateEvent(v,y)):e instanceof xs?(g=e.event,y=e.source,this._broadcastThreadUpdateEvent(g,y)):e instanceof ks&&(E=e.messageDeletionTimestamp,b=e.channelUrl,y=e.source,this._broadcastMessageRetentionEvent(E,b,y)),T.label=24;case 24:return[2]}}))}))})),n}return C(t,e),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return As.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dispatcher",{get:function(){return As.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return fh.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return dh.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_notificationCache",{get:function(){return _h.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,n){var r;return void 0===n&&(n=!1),mh[e]&&!n||(mh[e]&&(null===(r=mh[e]._dispatcherContext)||void 0===r||r.close()),mh[e]=new t(e)),mh[e]},t.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onUpdate&&s.onUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onPollChangeLogUpdate&&s.onPollChangeLogUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onPollUpdate&&s.onPollUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onPollVote&&s.onPollVote(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onRemove&&s.onRemove(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onRemoveUnsent&&s.onRemoveUnsent(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastReactionUpdateEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onReactionUpdate&&s.onReactionUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastThreadUpdateEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onThreadInfoUpdate&&s.onThreadInfoUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype._broadcastMessageRetentionEvent=function(e,t,n){var r,i;try{for(var a=I(this._observers.values()),s=a.next();!s.done;s=a.next()){var o=s.value;o.onDeletedByRetentionPolicy&&o.onDeletedByRetentionPolicy(e,t,n)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},t.prototype.subscribe=function(e,t){this._observers.set(e,t)},t.prototype.unsubscribe=function(e){this._observers.delete(e)},t.prototype.unsubscribeAll=function(){this._observers.clear()},t}(ma),gh={},Eh=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,a=e.call(this,t)||this;return a._users=new Map,a._sdkState=r,a._cacheContext=i,gh[t]=a,a}return C(t,e),t.of=function(e){return gh[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return Ia(!!e).throw(H.databaseError),e.collection(kc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"users",{get:function(){return A([],w(this._users.values()),!1)},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,t){return T(T({},e.serialize()),{updatedAt:t})},t.prototype._deserialize=function(e){return Aa._buildUserFromSerializedData(e)},t.prototype.isCachedInMemory=function(e){return this._users.has(e)},t.prototype.getUserInfoFromCache=function(e){if(this._users.has(e))return this._users.get(e)},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return this._users.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._users.set(n.userId,n),[2,n];r.label=2;case 2:return[2,void 0];case 3:return[2,this._users.get(e)]}}))}))},t.prototype.fetch=function(e){var t=e.limit,n=void 0===t?100:t,r=e.backward,i=void 0!==r&&r;return N(this,0,void 0,(function(){var e,t,r,a=this;return S(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[2,[]];s.label=1;case 1:return s.trys.push([1,4,,5]),e={index:["-userId","-updatedAt"],backward:i},[4,this.collection.query(e)];case 2:return[4,s.sent().fetch({limit:n})];case 3:return t=s.sent(),(r=t.map((function(e){return a._deserialize(e)}))).forEach((function(e){a._users.has(e.userId)||a._users.set(e.userId,e)})),[2,r];case 4:return s.sent(),[2,[]];case 5:return[2]}}))}))},t.prototype.upsert=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:if(!this.localCacheEnabled)return[3,2];if(n=this._serialize(e,t),r=this._users.get(e.userId)){if(r._hashValue===e._hashValue)return[2];if(r._updatedAt>t)return[2]}return this._users.set(e.userId,Aa._buildUserFromSerializedData(n)),[4,this.collection.upsertOne(n)];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return this._users.has(e)&&this._users.delete(e),this.localCacheEnabled?[4,this.collection.remove(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.clearMemoryCache=function(){this._users.clear()},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t}(ma),bh=function(e){function t(t){var n=this,r=t.reverse,i=void 0!==r&&r,a=t.limit,s=void 0===a?20:a,o=t.keys,l=t.token;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(qe),n.params=Ne({token:l,limit:s,reverse:i,order:ve.UPDATED_AT,show_ui_template:!0,show_color_variables:!0,keys:o}),n}return C(t,e),t}(tt),yh=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.next,a=n.has_more,s=void 0!==a&&a,o=n.templates;return r.nextToken=i,r.hasMore=s,r.templates=o.map((function(e){return{template:JSON.stringify(e)}})),r}return C(t,e),t}(nt),Ch=function(e){function t(t){var n=this,r=t.key;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(qe,"/").concat(r),n}return C(t,e),t}(tt),Th=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.template=JSON.stringify(n),r}return C(t,e),t}(nt),Nh={},Sh=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,a=t.onlineDetector,s=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=s,fh.of(e),dh.of(e),vh.of(e),this.fileMessageQueue=new Cl(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:a,cacheContext:s}),Nh[e]=this}return e.of=function(e){return Nh[e]},e.prototype._setSenderInfo=function(e){if(this._cacheContext.localCacheEnabled&&(e.messageType===le.USER||e.messageType===le.FILE)){var t=e.sender;if(t){var n=Eh.of(this._iid).getUserInfoFromCache(t.user_id);n&&(e.sender=Aa.payloadify(n))}}},e.prototype.buildMessageFromSerializedData=function(e){var t=Sa(e);if(t.notificationId)return new cl(this._iid,cl.payloadify(t));switch(this._setSenderInfo(t),t.messageType){case le.USER:return new ol(this._iid,ol.payloadify(t));case le.FILE:return ll._isMultipleFilesMessageSerializedData(t)?new ll(this._iid,ll.payloadify(t)):new fl(this._iid,fl.payloadify(t));case le.ADMIN:return new il(this._iid,il.payloadify(t))}throw H.invalidParameters},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return Ne(Se({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId}))},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){var n;return Ne(Se({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth}))},e.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(e,t){var n=this;return Ne({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList.map((function(e){return new pl(n._iid,e)}))})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return T(T({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return T(T({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=Sa(e);return new Oo(this._iid,Oo.payloadify(t))},e.prototype.getMessage=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=new Al(e),[4,this._requestQueue.send(t)];case 1:return[2,n.sent().as(Ml).message]}}))}))},e.prototype.getScheduledMessage=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=new Ll(e),[4,this._requestQueue.send(t)];case 1:return[2,n.sent().as(xl).message]}}))}))},e.prototype.getMessagesByMessageId=function(e,t,n,r,i){return void 0===i&&(i=bs.REQUEST_MESSAGE),N(this,0,void 0,(function(){var a,s,o;return S(this,(function(l){switch(l.label){case 0:return a=new Ol(T(T(T({channelType:t,channelUrl:e,token:String(n)},Tl),r),{sdkSource:yl.EXTERNAL_LEGACY})),[4,this._requestQueue.send(a)];case 1:return s=l.sent(),o=s.as(Rl).messages,this._dispatcher.dispatch(new Rs({messages:o,source:i})),[2,o]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,n,r,i){return void 0===i&&(i=bs.REQUEST_MESSAGE),N(this,0,void 0,(function(){var a,s,o;return S(this,(function(l){switch(l.label){case 0:return a=new Ol(T(T(T({channelType:t,channelUrl:e,timestamp:n},Tl),r),{sdkSource:yl.EXTERNAL_LEGACY})),[4,this._requestQueue.send(a)];case 1:return s=l.sent(),o=s.as(Rl).messages,this._dispatcher.dispatch(new Rs({messages:o,source:i})),[2,o]}}))}))},e.prototype._getMessagesByTimestampForCollection=function(e,t,n,r,i,a,s,o){return void 0===i&&(i=bs.REQUEST_MESSAGE),N(this,0,void 0,(function(){var l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return l=new Ol(T(T(T({channelType:t,channelUrl:e,timestamp:n},Tl),r),{checkingHasNext:a,checkingContinuousMessages:s,sdkSource:o})),[4,this._requestQueue.send(l)];case 1:return u=p.sent(),c=u.as(Rl),d=c.messages,h=c.isContinuousMessages,f=c.hasNext,this._dispatcher.dispatch(new Rs({messages:d,source:i})),[2,{messages:d,isContinuousMessages:h,hasNext:f}]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,n,r){return void 0===r&&(r=bs.REQUEST_THREADED_MESSAGE),N(this,0,void 0,(function(){var i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return i=new Ol(T(T(T({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},nl),n),{replyType:he.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return a=l.sent(),s=a.as(Rl).messages,(o=s.slice(1)).forEach((function(t){t.parentMessage=e})),this._dispatcher.dispatch(new Rs({messages:o,source:r})),[2,{parentMessage:s[0],threadedMessages:o}]}}))}))},e.prototype.getMessageTemplatesByToken=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return n=new bh(T({token:e},t)),[4,this._requestQueue.send(n)];case 1:return r=l.sent(),i=r.as(yh),a=i.hasMore,s=i.nextToken,o=i.templates,[2,{hasMore:a,token:s,templates:o}]}}))}))},e.prototype.getMessageTemplate=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=new Ch({key:e}),[4,this._requestQueue.send(t)];case 1:return[2,{template:n.sent().as(Th).template}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,n,r,i){return void 0===i&&(i=bs.REQUEST_MESSAGE_CHANGELOGS),N(this,0,void 0,(function(){var a,s,o,l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return a=new Dl(Ne(Se(T(T({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null},Sl),r)))),[4,this._requestQueue.send(a)];case 1:return s=p.sent(),o=s.as(kl),l=o.updatedMessages,u=o.deletedMessagesInfo,c=o.hasMore,d=o.nextToken,h=o.forceUseNextToken,f=u.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new Rs({messages:l,source:i})),f.length>0&&this._dispatcher.dispatch(new Ds({messageIds:f,source:i})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:c,token:d,forceUseNextToken:h}]}}))}))},e}(),Ih=function(e){function t(t,n){var r=e.call(this,t)||this;r.targetMessageId=0;var i=n.thread_info,a=n.parent_message_id,s=n.channel_url,o=n.channel_type;return i&&q("object",i)&&q("number",a)&&q("string",s)&&q("string",o)&&(r.threadInfo=new yo(t,i),r.targetMessageId=a,r.channelUrl=s,r.channelType=o),r}return C(t,e),t}(ma),wh={channelUrl:"",channelType:ae.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Ah=function(e){function t(t){var n=t.channelCustomType,r=t.keyword,i=t.limit,a=t.reverse,s=t.exactMatch,o=t.channelUrl,l=t.order,u=t.messageTimestampFrom,c=t.messageTimestampTo,d=t.advancedQuery,h=t.targetFields,f=t.nextToken,p=e.call(this)||this;return p.method=Ie.GET,p.path="".concat(xe,"/messages"),p.params=Ne({custom_type:n,query:r,limit:i,reverse:a,exact_match:s,channel_url:o,message_ts_from:u,message_ts_to:c,sort_field:l,advanced_query:d,target_fields:h,after:f}),p}return C(t,e),t}(tt),Mh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return hl(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return C(t,e),t}(nt);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(ah||(ah={}));var Oh,Rh,Dh,kh=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h=this;return(h=e.call(this,t,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl=null,h.channelCustomType=null,h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=ah.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(a=n.channelUrl)&&void 0!==a?a:null,h.channelCustomType=null!==(s=n.channelCustomType)&&void 0!==s?s:null,h.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,h.messageTimestampTo=null!==(l=n.messageTimestampTo)&&void 0!==l?l:null,h.order=null!==(u=n.order)&&void 0!==u?u:ah.SCORE,h.advancedQuery=null!==(c=n.advancedQuery)&&void 0!==c&&c,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("string",this.keyword)&&this.keyword.length>0&&q("boolean",this.reverse)&&q("boolean",this.exactMatch)&&q("string",this.channelUrl,!0)&&q("string",this.channelCustomType,!0)&&q("number",this.messageTimestampFrom,!0)&&q("number",this.messageTimestampTo,!0)&&z(ah,this.order)&&q("boolean",this.advancedQuery)&&Y("string",this.targetFields,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new Ah(Se(T(T({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=l.sent(),r=n.as(Mh),i=r.messages,a=r.hasNext,s=r.nextToken,o=r.totalCount,this._nextToken=s,this._hasNext=a,this._isLoading=!1,this.totalCount=o,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),Lh=function(e){function t(t){var n=t.channelType,r=t.channelUrl,i=t.limit,a=t.token,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Qe(n),"/").concat(encodeURIComponent(r),"/messages/parent_thread_message"),s.params=Ne(Se({limit:i,token:a})),s}return C(t,e),t}(tt),xh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.token=n.next,r.messages=n.messages.map((function(e){return hl(t,e)})),r}return C(t,e),t}(nt),Uh=function(e){function t(t,n,r,i){var a=e.call(this,t,n,r,i)||this;return a._edge="",a}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.load=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new Lh({channelType:this.channelType,channelUrl:this.channelUrl,token:this._edge,limit:this.limit}),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(xh),i=r.messages,a=r.token,this._edge=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),Ph={channelUrl:"",scheduledMessageId:0},Fh={reverse:!1,limit:20},Bh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return C(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,a=n.sessionManager,s=n.requestQueue,o=n.logger,l=n.onlineDetector,u=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:a,requestQueue:s,logger:o,onlineDetector:l,cacheContext:u}),this._manager=new Sh(t,{sdkState:r,dispatcher:i,requestQueue:s,onlineDetector:l,cacheContext:u})},t.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},t.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},t.prototype.getMessage=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=T(T({},wh),e),Ia((i=t,q("string",i.channelUrl)&&z(ae,i.channelType)&&q("number",i.messageId)&&q("boolean",i.includeReactions,!0)&&q("boolean",i.includeMetaArray,!0)&&q("boolean",i.includeParentMessageInfo,!0)&&q("boolean",i.includeThreadInfo,!0))).throw(H.invalidParameters),[4,this._manager.getMessage(t)];case 1:if((n=r.sent())instanceof el||n instanceof cl||null===n)return[2,n];throw"Unknown message type is given."}var i}))}))},t.prototype.getScheduledMessage=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},Ph),e),Ia((r=t,q("string",r.channelUrl)&&""!==r.channelUrl&&q("number",r.scheduledMessageId)&&r.scheduledMessageId>0)).throw(H.invalidParameters),[2,this._manager.getScheduledMessage(t)];var r}))}))},t.prototype.getMessageTemplatesByToken=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n;return S(this,(function(r){return n=T(T({},Fh),t),Ia(q("string",e,!0)&&(i=n,q("boolean",i.reverse,!0)&&q("number",i.limit,!0)&&Y("string",i.keys,!0))).throw(H.invalidParameters),[2,this._manager.getMessageTemplatesByToken(e,n)];var i}))}))},t.prototype.getMessageTemplate=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(q("string",e)).throw(H.invalidParameters),[2,this._manager.getMessageTemplate(e)]}))}))},t}(Ms);!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(Oh||(Oh={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(Rh||(Rh={})),function(e){e.CREATED_AT="created_at",e.SCHEDULED_AT="scheduled_at"}(Dh||(Dh={}));var Hh,Gh=function(e){switch(e){case Oh.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Oh.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Oh.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},jh=function(e){function t(t){var n=t.message,r=e.call(this)||this;return r.message=n,r}return C(t,e),t}(Te),Vh={},qh=function(){function e(e,t){var n=t.localCacheEnabled,r=t.enableAutoResend,i=t.dispatcher,a=t.sdkState,s=t.logger,o=this;this._iid=e,Vh[e]=this,this._localCacheEnabled=n,this._enableAutoResend=r,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=i,this._logger=s,this._sdkState=a,this._localCacheEnabled&&i.on((function(e){if(e instanceof ra)switch(e.stateType){case Zi.CONNECTED:o._isProcessingAutoResend||o.processAutoResendRegisteredPendingMessages().then((function(){return o._processNextAutoResend()}));break;case Zi.INTERNAL_DISCONNECTED:case Zi.EXTERNAL_DISCONNECTED:o._isProcessingAutoResend=!1}}))}return e.of=function(e){return Vh[e]},e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._enableAutoResend?[4,this._fetchAllCachedPendingMessages()]:[2];case 1:e=s.sent();try{for(t=I(e),n=t.next();!n.done;n=t.next())0===(r=n.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",r.reqId),r.sendingStatus=pe.FAILED,r.errorCode=M.ACK_TIMEOUT,this._dispatcher.dispatch(new Rs({messages:[r],source:bs.LOCAL_MESSAGE_FAILED})))}catch(o){i={error:o}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}}return[2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=l.sent();try{for(t=I(e),n=t.next();!n.done;n=t.next())r=n.value,this._enableAutoResend&&r.errorCode&&Q(r.errorCode)&&(i=(new Date).getTime(),a=r.createdAt+2592e5,this._enableAutoResend&&i<=a?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(r.reqId)<0&&this._autoResendQueue.push(r):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),r.sendingStatus=pe.FAILED,this._dispatcher.dispatch(new Rs({messages:[r],source:bs.LOCAL_MESSAGE_FAILED}))))}catch(u){s={error:u}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}}return[2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&this._enableAutoResend&&(e.sendingStatus===pe.SUCCEEDED||e.sendingStatus===pe.FAILED&&!Q(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend()}},e.prototype._fetchAllCachedPendingMessages=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=dh.of(this._iid),(t=new ih).replyType=he.ALL,[4,e.fetch({sendingStatus:pe.PENDING,backward:!0,filter:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){if(this._localCacheEnabled&&this._enableAutoResend&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new jh({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(n){this._logger.warn("process auto-resend error: ",n),this._isProcessingAutoResend=!1}return[2]}))}))},e}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(Hh||(Hh={}));var zh,Kh=function(){function e(e){this.category=e.cat,this.data=e.data}return e.getDataAsUserBlockEvent=function(e,t){var n=t.data,r=n.blocker,i=n.blockee;return{blocker:new Aa(e,r),blockee:new Aa(e,i)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new Aa(e,t)})):[]}},e}(),Yh=function(e){function t(t,n){var r=n.userId,i=e.call(this)||this;return i._iid=t,i.userId=r,i}return C(t,e),t}(Te),Wh=function(e){function t(){return e.call(this)||this}return C(t,e),t}(Te),Qh=function(e){function t(t){var n=t.configTs,r=e.call(this)||this;return r.configTs=n,r}return C(t,e),t}(Te),Xh=function(e){function t(t,n,r){var i=e.call(this,t,"USEV",r)||this;return i.event=new Kh(r),i}return C(t,e),t}(at),Zh=function(e){function t(t){var n=t.appConfigsInfo,r=t.configTs,i=e.call(this)||this;return i.appConfigsInfo={},i.configTs=0,i.appConfigsInfo=n,i.configTs=r,i}return C(t,e),t}(Te);!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(zh||(zh={}));var Jh,$h=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a._state=zh.IDLE,a._retryCount=0,a._retryLimit=3,a.priority=0,a._worker=n,a}return C(t,e),Object.defineProperty(t.prototype,"isIdle",{get:function(){return this._state===zh.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._state===zh.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._state===zh.END},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),t.prototype._run=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},t.prototype.start=function(e){this.isIdle&&(this._state=zh.RUNNING,this._run(e))},t.prototype.stop=function(){this._state=zh.IDLE,this.dispatch("stop")},t.prototype.end=function(){this._state=zh.END,this.dispatch("end")},t}(ye),ef=function(e,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=e,this._payload=t};!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",e[e.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"}(Jh||(Jh={}));var tf,nf=function(){function e(e){var t;this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=null!==(t=e.data)&&void 0!==t?t:{},this.ts=e.ts}return Object.defineProperty(e.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===ae.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===ae.OPEN},enumerable:!1,configurable:!0}),e}(),rf=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.event=new nf(r),i}return C(t,e),t}(at),af=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data.operators,s=void 0===a?[]:a;return i.operators=s.map((function(e){return new Aa(i._iid,e)})),i}return C(t,e),t}(rf),sf=function(e){function t(t,n,r){var i,a=this;return(a=e.call(this,t,"SYEV",r)||this).pinnedMessageIds=[],a.latestPinnedMessage=null,a.ts=0,r.data&&(a.pinnedMessageIds=null!==(i=r.data.pinned_message_ids)&&void 0!==i?i:[],a.latestPinnedMessage=r.data.latest_pinned_message?hl(t,T({},r.data.latest_pinned_message)):null),a.ts=r.ts,a}return C(t,e),t}(at),of=function(e){function t(t,n){var r=e.call(this,t)||this;return r._logger=n.logger,r._sdkState=n.sdkState,r._sessionManager=n.sessionManager,r._requestQueue=n.requestQueue,r._dispatcher=n.dispatcher,r._cacheContext=n.cacheContext,r._channelType=n.channelType,r}return C(t,e),Object.defineProperty(t.prototype,"_messageBroadcast",{get:function(){return vh.of(this._iid)},enumerable:!1,configurable:!0}),t.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},t.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},t.prototype.getMessageFromCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,null]}))}))},t.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,t,n){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,[]]}))}))},t.prototype.getMessagesFromCache=function(e,t,n,r,i,a){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,[]]}))}))},t.prototype.getPollMessagesFromCache=function(e,t,n,r){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,[]]}))}))},t.prototype.getCachedMessageCountBetween=function(e,t,n,r){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,0]}))}))},t.prototype.getUnsentMessagesFromCache=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,[]]}))}))},t.prototype.removeFailedMessageFromCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(e){return[2]}))}))},t}(ma),lf=function(e){function t(t,n,r){var i,a,s,o,l=this;(l=e.call(this,t,"ADMM",r)||this).message=new il(t,r);var u=As.of(t).sdkState;return l.isMentioned=Ze(l.message.mentionType,null!==(s=null!==(i=l.message.mentionedUserIds)&&void 0!==i?i:null===(a=l.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})))&&void 0!==s?s:[],u.userId),l.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,l}return C(t,e),t}(at),uf=function(e){function t(t,n,r){var i,a,s,o,l,u=this;(u=e.call(this,t,"AEDI",r)||this).message=new il(t,r);var c=As.of(t).sdkState;return u.mentionCountChange=Je({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(s=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==s?s:[]},Se({mentionType:u.message.mentionType,mentionedUserIds:null!==(o=u.message.mentionedUserIds)&&void 0!==o?o:null===(l=u.message.mentionedUsers)||void 0===l?void 0:l.map((function(e){return e.userId}))}),c.userId),u}return C(t,e),t}(at),cf=function(e){function t(t,n,r){var i=e.call(this,t,"MRCT",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.event=new To(r),i}return C(t,e),t}(at),df=function(e){function t(t,n,r){var i=e.call(this,t,"MTHD",r)||this;return i.event=new Ih(t,r),i}return C(t,e),t}(at),hf=function(e){function t(t,n,r){var i=e.call(this,t,"MCNT",r)||this;return i.groupChannelMemberCounts=r.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),i.openChannelMemberCounts=r.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),i}return C(t,e),t}(at),ff=function(e){function t(t,n,r){var i=e.call(this,t,"PEDI",r)||this;return i.event=new ef(t,r),i.status=js(r.poll.status)||r.poll.status,i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return C(t,e),t}(at);!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited",e.LEFT="left"}(tf||(tf={}));var pf,_f,mf,vf,gf,Ef,bf,yf,Cf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.state=null,r.role=null,r.isMuted=!1,r.isBlockedByMe=!1,r.isBlockingMe=!1,r.state=z(tf,n.state)?n.state:null,r.role=z(se,n.role)?n.role:null,"boolean"==typeof n.is_muted&&(r.isMuted=n.is_muted),"boolean"==typeof n.is_blocked_by_me&&(r.isBlockedByMe=n.is_blocked_by_me),"boolean"==typeof n.is_blocking_me&&(r.isBlockingMe=n.is_blocking_me),r}return C(t,e),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{state:t.state,role:t.role,is_muted:t.isMuted,is_blocked_by_me:t.isBlockedByMe,is_blocking_me:t.isBlockingMe})))},t}(Pl),Tf=function(e){function t(t,n){var r,i,a=this;return(a=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",a.channelType=null!==(i=n.channel_type)&&void 0!==i?i:ae.GROUP,a.member=new Aa(a._iid,n.user),a.deliveryAt=n.ts,a}return C(t,e),t}(ma);!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(pf||(pf={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(_f||(_f={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(mf||(mf={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(vf||(vf={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(gf||(gf={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Ef||(Ef={})),function(e){e.AND="AND",e.OR="OR"}(bf||(bf={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(yf||(yf={}));var Nf,Sf=function(){function e(e){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_;this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=null!==(t=null==e?void 0:e.includeEmpty)&&void 0!==t&&t,this.nicknameContainsFilter=null!==(n=null==e?void 0:e.nicknameContainsFilter)&&void 0!==n?n:null,this.nicknameStartsWithFilter=null!==(r=null==e?void 0:e.nicknameStartsWithFilter)&&void 0!==r?r:null,this.nicknameExactMatchFilter=null!==(i=null==e?void 0:e.nicknameExactMatchFilter)&&void 0!==i?i:null,this.channelNameContainsFilter=null!==(a=null==e?void 0:e.channelNameContainsFilter)&&void 0!==a?a:"",this.myMemberStateFilter=null!==(s=null==e?void 0:e.myMemberStateFilter)&&void 0!==s?s:_f.ALL,this.customTypesFilter=null!==(o=null==e?void 0:e.customTypesFilter)&&void 0!==o?o:null,this.channelUrlsFilter=null!==(l=null==e?void 0:e.channelUrlsFilter)&&void 0!==l?l:null,this.superChannelFilter=null!==(u=null==e?void 0:e.superChannelFilter)&&void 0!==u?u:mf.ALL,this.publicChannelFilter=null!==(c=null==e?void 0:e.publicChannelFilter)&&void 0!==c?c:pf.ALL,this.customTypeStartsWithFilter=null!==(d=null==e?void 0:e.customTypeStartsWithFilter)&&void 0!==d?d:null,this.unreadChannelFilter=null!==(h=null==e?void 0:e.unreadChannelFilter)&&void 0!==h?h:vf.ALL,this.hiddenChannelFilter=null!==(f=null==e?void 0:e.hiddenChannelFilter)&&void 0!==f?f:gf.UNHIDDEN,this.includeFrozen=null===(p=null==e?void 0:e.includeFrozen)||void 0===p||p,(null==e?void 0:e.createdAfter)&&(this.createdAfter=e.createdAfter),(null==e?void 0:e.createdBefore)&&(this.createdBefore=e.createdBefore),this.includeMetaData=null===(_=null==e?void 0:e.includeMetaData)||void 0===_||_}return e.prototype._isFriend=function(e){return!(!e||!e.friendDiscoveryKey&&!e.friendName)},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=bf.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t,n=new e;this.searchFilter&&n.setSearchFilter(this.searchFilter.fields,null!==(t=this.searchFilter.query)&&void 0!==t?t:void 0),this.userIdsFilter&&n.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var r=JSON.parse(JSON.stringify(this));return Object.keys(r).forEach((function(e){n[e]=r[e]})),n},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,i=n.fields;if(r&&i&&i.length>0&&!i.some((function(t){switch(t){case yf.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case yf.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var a=this._userIdsFilter,s=a.userIds,o=a.includeMode,l=a.queryType,u=e.members.map((function(e){return e.userId}));if(o){if(s.length>0)switch(l){case bf.AND:if(s.some((function(e){return!u.includes(e)})))return!1;break;case bf.OR:if(s.every((function(e){return!u.includes(e)})))return!1}}else{if(s.includes(t)||s.push(t),e.members.length>s.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=A([],w(e),!1).sort(),r=A([],w(t),!1).sort(),i=0;i<n.length;++i)if(n[i]!==r[i])return!1;return!0}(s,u))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var c=this.nicknameContainsFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().includes(c)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var h=this.nicknameExactMatchFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase()!=h})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case _f.ALL:if("none"===e.myMemberState)return!1;break;case _f.JOINED:if("joined"!==e.myMemberState)return!1;break;case _f.INVITED:if("invited"!==e.myMemberState)return!1;break;case _f.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case _f.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case gf.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case gf.HIDDEN:if(!e.isHidden)return!1;break;case gf.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case gf.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===vf.UNREAD_MESSAGE&&0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case pf.PUBLIC:if(!e.isPublic)return!1;break;case pf.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case mf.SUPER:if(!e.isSuper)return!1;break;case mf.NON_SUPER:if(e.isSuper)return!1}return!(this.createdAfter&&e.createdAt<this.createdAfter||this.createdBefore&&e.createdAt>this.createdBefore)},e}(),If=function(e){function t(t,n){var r=n.sdkState,i=n.cacheContext,a=e.call(this,t)||this;return a._channels=new Map,a._sdkState=r,a._cacheContext=i,a}return C(t,e),Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return Ia(!!e).throw(H.databaseError),e.collection(Oc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,t){return void 0===t&&(t=0),T(T({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},t.prototype._deserialize=function(e){return xp.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(t.prototype,"channels",{get:function(){return A([],w(this._channels.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.isCachedInMemory=function(e){return this._channels.has(e)},t.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}}))}))},t.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?100:n,i=e.backward,a=void 0!==i&&i,s=e.filter,o=void 0===s?new Sf:s,l=e.order,u=void 0===l?Oh.LATEST_LAST_MESSAGE:l,c=e.borderlineChannelUrl;return N(this,0,void 0,(function(){var e,n,i,s,l,d=this;return S(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=!!c,n=Gh(u),i={where:function(n){if(t)switch(u){case Oh.CHANNEL_NAME_ALPHABETICAL:if(!a&&n.name.localeCompare(t)<0||a&&n.name.localeCompare(t)>0)return!1;break;case Oh.CHRONOLOGICAL:if(!a&&n.createdAt>t||a&&n.createdAt<t)return!1;break;case Oh.LATEST_LAST_MESSAGE:if(!a&&n.lastMessageUpdatedAt>t||a&&n.lastMessageUpdatedAt<t)return!1}return e&&c&&c===n.url?(e=!1,!1):!e&&o.match(d._deserialize(n),d._sdkState.userId)},index:n,backward:a},[4,this.collection.query(i)]):[3,3];case 1:return[4,h.sent().fetch({limit:r})];case 2:return s=h.sent(),(l=s.map((function(e){return d._deserialize(e)}))).forEach((function(e){!o.includeMetaData&&e.cachedMetaData&&e._clearCachedMetaData(),d._channels.has(e.url)||d._channels.set(e.url,e)})),[2,l];case 3:return[2,[]]}}))}))},t.prototype.upsert=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a=this;return S(this,(function(s){switch(s.label){case 0:if(n=[],e.forEach((function(e){if(a._channels.has(e.url)){var r=a._channels.get(e.url);r._pinnedMessagesUpdatedAt<e._pinnedMessagesUpdatedAt&&(r._pinnedMessagesUpdatedAt=e._pinnedMessagesUpdatedAt),r._messageCollectionLastAccessedAt>e._messageCollectionLastAccessedAt&&(e._messageCollectionLastAccessedAt=r._messageCollectionLastAccessedAt),e.cachedMetaData instanceof Map&&e.cachedMetaData.size>0&&t&&(r._updateCachedMetaData(e.cachedMetaData,t).isUpdated||Object.assign(e,{_cachedMetaData:r.cachedMetaData})),r._update(e),n.push(r)}else a._channels.set(e.url,e),n.push(e)})),!this.localCacheEnabled)return[3,2];for(r=[],i=0;i<n.length;i++)r.push(this._serialize(n[i],i));return[4,this.collection.upsertMany(r)];case 1:s.sent(),s.label=2;case 2:return[2,n]}}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=I(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i=o.sent(),a={error:i},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}return[7];case 7:return[2]}}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.clearMemoryCache=function(){this._channels.clear()},t.prototype._setBlockStateOfAllChannels=function(e,t,n){return N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y;return S(this,(function(C){switch(C.label){case 0:if(r=[],e===this._sdkState.userId)try{for(i=I(this._channels.values()),a=i.next();!a.done;a=i.next()){c=a.value;try{for(m=void 0,s=I(c.members),o=s.next();!o.done;o=s.next())if((f=o.value).userId===t){f.isBlockedByMe=n,r.push(c);break}}catch(T){m={error:T}}finally{try{o&&!o.done&&(v=s.return)&&v.call(s)}finally{if(m)throw m.error}}}}catch(T){p={error:T}}finally{try{a&&!a.done&&(_=i.return)&&_.call(i)}finally{if(p)throw p.error}}else if(t===this._sdkState.userId)try{for(l=I(this._channels.values()),u=l.next();!u.done;u=l.next()){c=u.value;try{for(b=void 0,d=I(c.members),h=d.next();!h.done;h=d.next())if((f=h.value).userId===e){f.isBlockingMe=n,r.push(c);break}}catch(T){b={error:T}}finally{try{h&&!h.done&&(y=d.return)&&y.call(d)}finally{if(b)throw b.error}}}}catch(T){g={error:T}}finally{try{u&&!u.done&&(E=l.return)&&E.call(l)}finally{if(g)throw g.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:C.sent(),C.label=2;case 2:return[2]}}))}))},t.prototype.block=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},t.prototype.unblock=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},t.prototype.markAsRead=function(e,t){return void 0===t&&(t=A([],w(this._channels.keys()),!1)),N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:n=[],c.label=1;case 1:c.trys.push([1,6,7,8]),r=I(t),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[4,this.get(a)]);case 3:(null==(s=c.sent())?void 0:s._updateUnreadMemberState(this._sdkState.userId,e))&&(s._updateUnreadCount(0,0),n.push(s)),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),l={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(l)throw l.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:c.sent(),c.label=10;case 10:return[2]}}))}))},t}(ma),wf={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Af=function(e){return Y("string",e.invitedUserIds,!0)&&q("string",e.channelUrl,!0)&&q("string",e.coverUrl,!0)&&(X(e.coverImage)||q("string",e.coverImage,!0))&&q("boolean",e.isDistinct,!0)&&q("boolean",e.isSuper,!0)&&q("boolean",e.isBroadcast,!0)&&q("boolean",e.isExclusive,!0)&&q("boolean",e.isPublic,!0)&&q("boolean",e.isStrict,!0)&&q("boolean",e.isDiscoverable,!0)&&q("boolean",e.isEphemeral,!0)&&q("string",e.accessCode,!0)&&q("string",e.name,!0)&&q("string",e.data,!0)&&q("string",e.customType,!0)&&Y("string",e.operatorUserIds,!0)&&q("number",e.messageSurvivalSeconds,!0)},Mf={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1},Of=function(e){return Y("string",e.customTypes,!0)&&q("boolean",e.includeEmpty,!0)&&q("boolean",e.includeFrozen,!0)&&q("boolean",e.includeMetaData,!0)&&q("boolean",e.includeChatNotification,!0)},Rf={myMemberStateFilter:_f.ALL},Df=function(e){return z(_f,e.myMemberStateFilter)};!function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(Nf||(Nf={}));var kf,Lf={keys:[Nf.GROUP_CHANNEL_UNREAD_MENTION_COUNT,Nf.NONSUPER_UNREAD_MENTION_COUNT,Nf.SUPER_UNREAD_MENTION_COUNT,Nf.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT,Nf.NONSUPER_UNREAD_MESSAGE_COUNT,Nf.SUPER_UNREAD_MESSAGE_COUNT,Nf.GROUP_CHANNEL_INVITATION_COUNT,Nf.NONSUPER_INVITATION_COUNT,Nf.SUPER_INVITATION_COUNT],customTypeFilters:void 0,customTypesFilter:void 0},xf={channelCustomTypesFilter:void 0,superChannelFilter:mf.ALL},Uf={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:ue.ALL},Pf=T({},bs),Ff=function(e){return e.startsWith("EVENT_")||e===bs.SYNC_CHANNEL_CHANGELOGS||e===bs.REFRESH_CHANNEL},Bf=function(e){function t(t){var n=t.channels,r=t.context,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=t.ts,o=e.call(this)||this;return o.channels=n,o.context=r,o.isWebSocketEventComing=a,o.ts=s,o}return C(t,e),t}(Te),Hf=function(e){function t(t){var n=t.channelUrls,r=t.context,i=t.isWebSocketEventComing,a=void 0!==i&&i,s=e.call(this)||this;return s.channelUrls=n,s.context=r,s.isWebSocketEventComing=a,s}return C(t,e),t}(Te),Gf=function(e){function t(t){var n=t.channel,r=e.call(this)||this;return r.channel=n,r}return C(t,e),t}(Te),jf=function(){function e(e){var t=e.groupChannelCache,n=e.userInfoCache,r=e.messageCache,i=e.unsentMessageCache,a=e.dispatcher,s=this;this._observers=new Map,a.on((function(e){return N(s,0,void 0,(function(){var a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T=this;return S(this,(function(w){switch(w.label){case 0:if(!(e instanceof Bf))return[3,19];if(a=e.channels,v=e.context,g=e.isWebSocketEventComing,s=a.filter((function(e){return e instanceof O_})),v.source!==bs.EVENT_CHANNEL_RESET_HISTORY&&v.source!==bs.EVENT_CHANNEL_HIDDEN)return[3,9];w.label=1;case 1:w.trys.push([1,6,7,8]),o=I(s),l=o.next(),w.label=2;case 2:return l.done?[3,5]:(f=l.value,[4,r.removeUnderOffset(f.url,f.messageOffsetTimestamp)]);case 3:w.sent(),w.label=4;case 4:return l=o.next(),[3,2];case 5:return[3,8];case 6:return u=w.sent(),E={error:u},[3,8];case 7:try{l&&!l.done&&(b=o.return)&&b.call(o)}finally{if(E)throw E.error}return[7];case 8:return[3,17];case 9:c=t.filterOffsetChanged(s),w.label=10;case 10:w.trys.push([10,15,16,17]),d=I(c),h=d.next(),w.label=11;case 11:return h.done?[3,14]:(f=h.value,[4,r.removeUnderOffset(f.url,f.messageOffsetTimestamp)]);case 12:w.sent(),w.label=13;case 13:return h=d.next(),[3,11];case 14:return[3,17];case 15:return p=w.sent(),y={error:p},[3,17];case 16:try{h&&!h.done&&(C=d.return)&&C.call(d)}finally{if(y)throw y.error}return[7];case 17:return[4,t.upsert(s,e.ts)];case 18:return _=w.sent(),g||this._broadcastUpdateEvent(_,v),[3,25];case 19:return e instanceof Hf?(m=e.channelUrls,v=e.context,g=e.isWebSocketEventComing,[4,t.remove(m)]):[3,22];case 20:return w.sent(),[4,Xi((function(){return N(T,0,void 0,(function(){var e,t,n,a,s,o;return S(this,(function(l){switch(l.label){case 0:l.trys.push([0,6,7,8]),e=I(m),t=e.next(),l.label=1;case 1:return t.done?[3,5]:(n=t.value,[4,r.removeMessagesOfChannel(n)]);case 2:return l.sent(),[4,i.removeMessagesOfChannel(n)];case 3:l.sent(),l.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return a=l.sent(),s={error:a},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))}))];case 21:return w.sent(),g||this._broadcastRemoveEvent(m,v),[3,25];case 22:return e instanceof Yh?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,25];case 23:return w.sent(),[4,n.fetch({limit:Number.MAX_SAFE_INTEGER})];case 24:w.sent(),w.label=25;case 25:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onUpdate&&s.onUpdate(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=I(this._observers.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.onRemove&&s.onRemove(e,t)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),Vf=function(e){function t(t){var n=t.userId,r=t.ts,i=t.token,a=t.filter,s=t.includeChatNotification,o=void 0!==s&&s,l=e.call(this)||this,u=T(T({},Mf),a),c=u.customTypes,d=u.includeEmpty,h=u.includeFrozen;return l.method=Ie.GET,l.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),l.params=Ne(Se({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:r||null,token:i,custom_types:c,show_empty:d,show_frozen:h,include_chat_notification:o})),l}return C(t,e),t}(tt),qf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedChannels=n.updated.map((function(e){return new O_(t,Object.assign(e,{ts:n.ts}))})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r.ts=n.ts,r}return C(t,e),t}(nt),zf=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,i=t.showLatestMessage,a=e.call(this)||this;return a.method=Ie.GET,a.path="".concat(r?De:Re,"/").concat(encodeURIComponent(n)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_latest_message:null!=i&&i},a}return C(t,e),t}(tt),Kf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r}return C(t,e),t}(nt),Yf={includeEmpty:!1,myMemberStateFilter:_f.ALL,unreadChannelFilter:vf.ALL,superChannelFilter:mf.ALL,publicChannelFilter:pf.ALL,hiddenChannelFilter:gf.ALL,userIdsFilter:{queryType:bf.AND},order:Oh.LATEST_LAST_MESSAGE},Wf=function(e){function t(t){var n=this,r=t.userId,i=t.token,a=t.limit,s=t.order,o=t.includeEmpty,l=t.myMemberStateFilter,u=t.superChannelFilter,c=t.publicChannelFilter,d=t.unreadChannelFilter,h=t.nicknameContainsFilter,f=t.nicknameStartsWithFilter,p=t.nicknameExactMatchFilter,_=t.channelNameContainsFilter,m=t.channelUrlsFilter,v=t.customTypesFilter,g=t.customTypeStartsWithFilter,E=t.hiddenChannelFilter,b=t.metadataOrderKeyFilter,y=t.metadataKey,C=t.metadataValues,T=t.metadataValueStartsWith,N=t.includeFrozen,S=t.includeMetaData,I=t.searchFilter,w=t.userIdsFilter,A=t.includeChatNotification,M=void 0!==A&&A,O=t.includeLeftChannel,R=void 0!==O&&O,D=t.createdAfter,k=t.createdBefore;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Ae,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=Ne({token:i,limit:a,order:null!=s?s:Yf.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:null!=o?o:Yf.includeEmpty,member_state_filter:null!=l?l:Yf.myMemberStateFilter,super_mode:null!=u?u:Yf.superChannelFilter,public_mode:null!=c?c:Yf.publicChannelFilter,unread_filter:null!=d?d:Yf.unreadChannelFilter,members_nickname_contains:h,members_nickname_startswith:f,members_nickname:p,name_contains:_,channel_urls:m,custom_types:v,custom_type_startswith:g,hidden_mode:E,metadata_order_key:b,metadata_key:y,metadata_values:C,metadata_value_startswith:T,show_frozen:N,show_metadata:S,include_chat_notification:M,include_left_channel:R,created_after:D,created_before:k}),I&&I.query&&I.fields&&(n.params.search_query=I.query,n.params.search_fields=I.fields),w&&w.userIds&&w.userIds.length>0&&(w.includeMode?(n.params.members_include_in=w.userIds,n.params.query_type=w.queryType.toUpperCase()):n.params.members_exactly_in=w.userIds),n}return C(t,e),t}(tt),Qf=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.channels=[];var i=n.next,a=n.channels,s=n.ts;return r.token=i,a&&a.length>0&&(r.channels=a.map((function(e){return e.ts=s,new O_(t,e)}))),r.ts=null!=s?s:0,r}return C(t,e),t}(nt),Xf=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,a=r.myMemberStateFilter;return i.method=Ie.GET,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/group_channel_count"),i.params={state:null!=a?a:_f.ALL},i}return C(t,e),t}(tt),Zf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.groupChannelCount=n.group_channel_count,r}return C(t,e),t}(nt),Jf=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,a=r.keys,s=r.customTypeFilters,o=r.customTypesFilter;return i.method=Ie.GET,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/unread_item_count"),i.params=Ne({item_keys:a,custom_types:null!=o?o:s}),i}return C(t,e),t}(tt),$f=function(e){function t(t,n){var r=e.call(this,t,n)||this;return"number"==typeof n[Nf.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[Nf.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[Nf.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[Nf.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Nf.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[Nf.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[Nf.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[Nf.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Nf.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[Nf.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Nf.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[Nf.SUPER_INVITATION_COUNT]),"number"==typeof n[Nf.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[Nf.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[Nf.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[Nf.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[Nf.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[Nf.NONSUPER_INVITATION_COUNT]),r}return C(t,e),t}(nt),ep=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return C(t,e),t}(tt),tp=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return C(t,e),t}(nt),np=function(e){function t(t){var n=t.userId,r=t.filter,i=t.includeFeedChannel,a=void 0!==i&&i,s=e.call(this)||this,o=r.channelCustomTypesFilter,l=r.superChannelFilter;return s.method=Ie.GET,s.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/unread_message_count"),s.params={super_mode:null!=l?l:mf.ALL,custom_types:o,include_feed_channel:a},s}return C(t,e),t}(tt),rp=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r.unreadFeedCount=n.unread_feed_count,r}return C(t,e),t}(nt),ip=function(e){function t(t){var n=t.channelUrl,r=t.scheduledStatus,i=t.messageTypeFilter,a=e.call(this)||this;return a.method=Ie.GET,a.path="".concat(He,"/count"),a.params={channel_url:n,status:sp(r)},i&&(a.params.message_type=i),a}return C(t,e),t}(tt),ap=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.count=n.count,r}return C(t,e),t}(nt),sp=function(e){if(!e)return[];var t=[];return e.forEach((function(e){switch(e){case Wo.PENDING:t.push(Qo.PENDING);break;case Wo.SENT:t.push(Qo.IN_QUEUE),t.push(Qo.SENT);break;case Wo.CANCELED:t.push(Qo.CANCELED);break;case Wo.FAILED:t.push(Qo.FAILED)}})),t},op=function(e){function t(t){var n=this,r=t.userId,i=t.channelUrl,a=t.coverUrl,s=t.coverImage,o=t.isDistinct,l=t.isSuper,u=t.isBroadcast,c=t.isPublic,d=t.isExclusive,h=t.isDiscoverable,f=t.isStrict,p=t.isEphemeral,_=t.accessCode,m=t.name,v=t.data,g=t.customType,E=t.messageSurvivalSeconds,b=t.invitedUserIds,y=t.operatorUserIds;return(n=e.call(this)||this).method=Ie.POST,n.path=Re,n.params=Ne({user_ids:A([r],w(null!=b?b:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:i,cover_url:a,cover_file:s,is_distinct:o,is_super:l,is_broadcast:u,is_exclusive:d,is_public:c,is_discoverable:h,strict:f,is_ephemeral:p,access_code:_,name:m,data:v,custom_type:g,operator_ids:y,message_survival_seconds:E}),n}return C(t,e),t}(tt),lp=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this).channel=new O_(t,n),i.isCreated=null===(r=n.is_created)||void 0===r||r,i}return C(t,e),t}(nt),up=function(e){function t(t){var n=t.userId,r=t.channelUrls,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),i.params={channel_urls:r},i}return C(t,e),t}(tt);C((function(){return null!==kf&&kf.apply(this,arguments)||this}),kf=nt);var cp=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.accessCode;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:i,access_code:a},n}return C(t,e),t}(tt),dp=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r}return C(t,e),t}(nt),hp=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data,s=a.member_count,o=void 0===s?0:s,l=a.joined_member_count,u=void 0===l?0:l,c=a.users,d=void 0===c?null:c;return i.memberCount=o,i.joinedMemberCount=u,i.members=Array.isArray(d)?d.map((function(e){return new Cf(t,e)})):[new Cf(t,r.data)],i}return C(t,e),t}(rf),fp=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.shouldRemoveOperatorStatus;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:i,should_remove_operator_status:a},n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var pp=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data,s=a.member_count,o=void 0===s?0:s,l=a.joined_member_count,u=void 0===l?0:l;return i.memberCount=o,i.joinedMemberCount=u,i.member=new Cf(i._iid,r.data),i}return C(t,e),t}(rf),_p=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userIds;return(n=e.call(this)||this).method=Ie.POST,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:i},n}return C(t,e),t}(tt),mp=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r}return C(t,e),t}(nt),vp=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;i.inviter=null;var a=r.data,s=a.member_count,o=void 0===s?0:s,l=a.joined_member_count,u=void 0===l?0:l,c=a.inviter,d=a.invitees,h=void 0===d?[]:d;return i.memberCount=o,i.joinedMemberCount=u,c&&Object.keys(c).length>0&&(i.inviter=new Aa(t,c)),i.invitees=h.map((function(e){return new Cf(t,e)})),i}return C(t,e),t}(rf),gp=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:i},n}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r.channel.myMemberState=tf.NONE,r}),e)}(nt);var Ep=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data,s=a.member_count,o=a.joined_member_count,l=a.inviter,u=a.invitee;return i.memberCount=null!=s?s:0,i.joinedMemberCount=null!=o?o:0,i.inviter=new Aa(t,l),i.invitee=new Cf(t,u),i}return C(t,e),t}(rf),bp={hidePreviousMessages:!1,allowAutoUnhide:!0},yp=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.hidePreviousMessages,s=t.allowAutoUnhide;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:i,hide_previous_messages:null!=a?a:bp.hidePreviousMessages,allow_auto_unhide:null!=s?s:bp.allowAutoUnhide},n}return C(t,e),t}(tt),Cp=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts_message_offset;return r.messageOffsetTimestamp=i,r}return C(t,e),t}(nt),Tp=function(e){function t(t,n,r){var i,a,s,o=this;return(o=e.call(this,t,"SYEV",r)||this).allowAutoUnhide=null,o.hidePreviousMessages=null,o.messageOffsetTimestamp=null,r.data&&(o.allowAutoUnhide=null!==(i=r.data.allow_auto_unhide)&&void 0!==i?i:null,o.hidePreviousMessages=null!==(a=r.data.hide_previous_messages)&&void 0!==a?a:null),o.messageOffsetTimestamp=null!==(s=r.ts_message_offset)&&void 0!==s?s:null,o}return C(t,e),t}(at),Np=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return C(t,e),t}(st),Sp=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Aa(t,r.data),i}return C(t,e),t}(at),Ip=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return C(t,e),t}(st),wp=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Aa(t,r.data),i}return C(t,e),t}(at),Ap=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return C(t,e),t}(st),Mp=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N,S,I=this;return(I=e.call(this,t,n)||this).includeEmpty=!1,I.includeFrozen=!0,I.includeMetaData=!0,I.includeChatNotification=!1,I.channelUrlsFilter=null,I.customTypesFilter=null,I.customTypeStartsWithFilter=null,I.nicknameContainsFilter=null,I.nicknameStartsWithFilter=null,I.nicknameExactMatchFilter=null,I.channelNameContainsFilter="",I.myMemberStateFilter=_f.ALL,I.unreadChannelFilter=vf.ALL,I.superChannelFilter=mf.ALL,I.publicChannelFilter=pf.ALL,I.hiddenChannelFilter=gf.UNHIDDEN,I.searchFilter={fields:[],query:null},I.userIdsFilter={userIds:[],includeMode:!0,queryType:bf.AND},I.metadataKey=null,I.metadataValues=null,I.metadataOrderKeyFilter=null,I.metadataValueStartsWith=null,I.order=Oh.LATEST_LAST_MESSAGE,I.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,I.includeFrozen=null===(i=n.includeFrozen)||void 0===i||i,I.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,I.includeChatNotification=null!==(s=n.includeChatNotification)&&void 0!==s&&s,I.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,I.customTypesFilter=null!==(l=n.customTypesFilter)&&void 0!==l?l:null,I.customTypeStartsWithFilter=null!==(u=n.customTypeStartsWithFilter)&&void 0!==u?u:"",I.nicknameContainsFilter=null!==(c=n.nicknameContainsFilter)&&void 0!==c?c:null,I.nicknameStartsWithFilter=null!==(d=n.nicknameStartsWithFilter)&&void 0!==d?d:null,I.nicknameExactMatchFilter=null!==(h=n.nicknameExactMatchFilter)&&void 0!==h?h:null,I.channelNameContainsFilter=null!==(f=n.channelNameContainsFilter)&&void 0!==f?f:"",I.myMemberStateFilter=null!==(p=n.myMemberStateFilter)&&void 0!==p?p:_f.ALL,I.unreadChannelFilter=null!==(_=n.unreadChannelFilter)&&void 0!==_?_:vf.ALL,I.superChannelFilter=null!==(m=n.superChannelFilter)&&void 0!==m?m:mf.ALL,I.publicChannelFilter=null!==(v=n.publicChannelFilter)&&void 0!==v?v:pf.ALL,I.hiddenChannelFilter=null!==(g=n.hiddenChannelFilter)&&void 0!==g?g:gf.UNHIDDEN,I.searchFilter=null!==(E=n.searchFilter)&&void 0!==E?E:{fields:[],query:null},I.userIdsFilter=null!==(b=n.userIdsFilter)&&void 0!==b?b:{userIds:[],includeMode:!0,queryType:bf.AND},I.metadataKey=null!==(y=n.metadataKey)&&void 0!==y?y:null,I.metadataValues=null!==(C=n.metadataValues)&&void 0!==C?C:null,I.metadataOrderKeyFilter=null!==(T=n.metadataOrderKeyFilter)&&void 0!==T?T:null,I.metadataValueStartsWith=null!==(N=n.metadataValueStartsWith)&&void 0!==N?N:null,I.order=null!==(S=n.order)&&void 0!==S?S:Oh.LATEST_LAST_MESSAGE,n.createdAfter&&(I.createdAfter=n.createdAfter),n.createdBefore&&(I.createdBefore=n.createdBefore),I}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("boolean",this.includeEmpty)&&q("boolean",this.includeFrozen)&&q("boolean",this.includeMetaData)&&q("string",this.channelNameContainsFilter)&&Y("string",this.channelUrlsFilter,!0)&&Y("string",this.customTypesFilter,!0)&&q("string",this.customTypeStartsWithFilter)&&q("string",this.nicknameContainsFilter,!0)&&q("string",this.nicknameStartsWithFilter,!0)&&q("string",this.nicknameExactMatchFilter,!0)&&z(_f,this.myMemberStateFilter)&&z(mf,this.superChannelFilter)&&z(pf,this.publicChannelFilter)&&z(vf,this.unreadChannelFilter)&&z(gf,this.hiddenChannelFilter)&&Y(yf,this.searchFilter.fields)&&q("string",this.searchFilter.query,!0)&&Y("string",this.userIdsFilter.userIds)&&q("boolean",this.userIdsFilter.includeMode)&&z(bf,this.userIdsFilter.queryType)&&z(Oh,this.order)&&q("string",this.metadataOrderKeyFilter,!0)&&q("string",this.metadataKey,!0)&&Y("string",this.metadataValues,!0)&&q("string",this.metadataValueStartsWith,!0)&&W(this.createdAfter)&&W(this.createdBefore)},t.prototype.serialize=function(){return Na(this)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,xp.of(this._iid).getMyGroupChannels(this._token,Se(T({},this)),this.limit,bs.REQUEST_CHANNEL,!0)]):[3,2]:[3,5];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),Op=function(e){function t(t){var n=t.channelUrl,r=t.userId,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Re,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),i.params=Ne({user_id:r}),i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Rp,Dp=function(e){function t(t,n,r){var i=e.call(this,t,"DLVR",r)||this;return i.channelUrl=r.channel_url,i.deliveredStateUpdate=r.updated,i}return C(t,e),t}(at),kp=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom,i=void 0===r?0:r;this.top=n,this.bottom=i}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.intersect=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,A([this.top],w(e),!1)),this.bottom=Math.max.apply(Math,A([this.bottom],w(e),!1))},e}(),Lp={},xp=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,T(T({},n),{channelType:ae.GROUP}))||this)._leftChannels=new Map,i._markAsReadAllLastSentAt=0,i._forceDisableMack=null!==(r=n.forceDisableMack)&&void 0!==r&&r,i._groupChannelHandlers=new Map,i._groupChannelCache=new If(i._iid,{sdkState:n.sdkState,cacheContext:n.cacheContext}),i._userInfoCache=new Eh(i._iid,{sdkState:n.sdkState,cacheContext:n.cacheContext}),i._groupChannelBroadcast=new jf({dispatcher:n.dispatcher,groupChannelCache:i._groupChannelCache,userInfoCache:i._userInfoCache,messageCache:fh.of(i._iid),unsentMessageCache:dh.of(i._iid)}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(i._dispatcher.dispatch(new Bf({channels:[e],context:{source:bs.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),i._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated&&t.onTypingStatusUpdated(e)})))};try{for(var r=I(i._groupChannelCache.channels),a=r.next();!a.done;a=r.next())n(a.value)}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),1e3),i._dispatcher.on((function(e){if(e instanceof at)i._handleEvent(e).catch((function(e){if(B(e)&&"foreground"===i._sdkState.appState)throw e}));else if(e instanceof jh)N(i,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannelFromCache(t.channelUrl)];case 1:return(n=r.sent())&&!n.isFrozen?[3,3]:[4,this.getChannelWithoutCache(t.channelUrl,!0)];case 2:n=r.sent(),r.label=3;case 3:return n.isFrozen||(t instanceof ol?n._autoResendUserMessage(t):t instanceof fl&&n._autoResendFileMessage(t)),[2]}}))}));else if(e instanceof Wh)i.reduceDBSize();else if(e instanceof Zh){var t=e.appConfigsInfo,n=e.configTs,r=t.message_purge_offset;r&&i._messageDataRetention(r),i._dispatcher.dispatch(new Qh({configTs:n}))}else e instanceof Yo&&N(i,0,void 0,(function(){var t,n,r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return t=e.channelUrl,n=e.channelType,r=e.parentMessage,i=new Ih(this._iid,{channel_type:ae.GROUP,channel_url:t,parent_message_id:r.messageId,thread_info:yo.payloadify(r.threadInfo)}),n!==ae.GROUP?[3,2]:[4,this.getChannel(t,!0)];case 1:a=o.sent(),Qi((function(){return N(s,0,void 0,(function(){var e,t,n,r,s;return S(this,(function(o){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(a,i)}catch(l){r={error:l}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),o.label=2;case 2:return[2]}}))}))})),Lp[t]||(Lp[t]=i),i}return C(t,e),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return fh.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return dh.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e){return Lp[e]||(Lp[e]=new t(e,As.of(e))),Lp[e]},t.clear=function(e){Lp[e]&&delete Lp[e]},Object.defineProperty(t.prototype,"handlers",{get:function(){return A([],w(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.buildGroupChannelFromSerializedData=function(e){var t=Sa(e);return new O_(this._iid,O_.payloadify(t))},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=Sa(e);return new Mp(this._iid,t)},t.prototype.buildMemberFromSerializedData=function(e){var t=Sa(e);return new Cf(this._iid,Cf.payloadify(t))},t.prototype.getChannelFromCache=function(e){var t;return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},t.prototype.getChannelsFromCache=function(e,t,n,r,i){return N(this,0,void 0,(function(){return S(this,(function(a){switch(a.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:r,borderlineChannelUrl:i})];case 1:return[2,a.sent()]}}))}))},t.prototype.upsertChannelsToCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.removeChannelsFromCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.clearChannelsFromCache=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}}))}))},t.prototype.reduceDBSize=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l,u,c,d,h,f,p;return S(this,(function(_){switch(_.label){case 0:return e=fh.of(this._iid),t=As.of(this._iid).cacheContext,n=t.localCacheConfig,r=t.nestdb,t.localCacheEnabled&&r&&r.state==Xd.OPENED?(i=1024*n.maxSize*1024,[4,r.estimateUsage()]):[2];case 1:if((a=_.sent())<i)return[2];s=[],o=this._groupChannelCache.channels,l={},h=0,_.label=2;case 2:return h<o.length?[4,this.getMessagesFromCache(o[h].url,0,"prev",new ih)]:[3,5];case 3:u=_.sent(),l[o[h].url]=JSON.stringify(u).length,c=new re({channel:o[h],cachedMessageCount:u.length}),s.push(c),_.label=4;case 4:return h++,[3,2];case 5:d=s.sort(n.clearOrderComparator),h=0,_.label=6;case 6:return h<d.length?[4,e.removeMessagesOfChannel(d[h].channel.url)]:[3,10];case 7:return _.sent(),[4,e._getGroupChannelPreferenceSize(d[h].channel.url)];case 8:if(f=_.sent(),p=l[d[h].channel.url]+f,(a-=p)<i)return[3,10];_.label=9;case 9:return h++,[3,6];case 10:return[4,Eh.of(this._iid).clear()];case 11:return _.sent(),[2]}}))}))},t.prototype._messageDataRetention=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d,h=this;return S(this,(function(f){switch(f.label){case 0:n=[],r=fh.of(this._iid),i=function(i){var s,o;return S(this,(function(l){switch(l.label){case 0:return s=i.customType,o=null!==(t=e[s])&&void 0!==t?t:e.global,[4,r.removeUnderOffset(i.url,o,!0)];case 1:return l.sent(),i.lastMessage&&i.lastMessage.createdAt<=o&&(i.lastMessage=null,n.push(i),Qi((function(){return N(h,0,void 0,(function(){var e,t,n,r,a;return S(this,(function(s){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(i)}catch(o){r={error:o}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),a._dispatcher.dispatch(new ks({channelUrl:i.url,messageDeletionTimestamp:o,source:bs.EVENT_MESSAGE_OFFSET_UPDATED})),[2]}}))},a=this,f.label=1;case 1:f.trys.push([1,6,7,8]),s=I(this._groupChannelCache.channels),o=s.next(),f.label=2;case 2:return o.done?[3,5]:(l=o.value,[5,i(l)]);case 3:f.sent(),f.label=4;case 4:return o=s.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{o&&!o.done&&(d=s.return)&&d.call(s)}finally{if(c)throw c.error}return[7];case 8:return n.length>0&&this._dispatcher.dispatch(new Bf({channels:n,context:{source:bs.EVENT_CHANNEL_UPDATED}})),[2]}}))}))},t.prototype._isSuperGroupMackDisabled=function(e){var t=As.of(this._iid).appInfo;return!(!e.isSuper||e.isBroadcast||!(null==t?void 0:t.disableSuperGroupMack))},t.prototype._getCachedUserInfo=function(e){return this._userInfoCache.getUserInfoFromCache(e)},t.prototype._upsertCachedUserInfo=function(e,t){As.of(this._iid).useMemberInfoInMessage&&this._userInfoCache.upsert(e,t)},t.prototype._handleEvent=function(e){var t,n;return N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,w,A,M,O,R,D,k,L,x,U,P,F,H,G,j,V,q,z,K,Y,W,Q,X,Z,J,$,ee,te,ne,re,ie,le,ue,ce,de,he,fe,pe,_e,me,ve,ge,Ee,be,ye,Ce,Te,Ne,Se,Ie,we,Ae,Me,Oe,Re,De,ke,Le,xe,Ue,Pe,Fe,Be,He,Ge,je,Ve,qe,ze,Ke,Ye,We,Qe,Xe,Ze,Je,$e,et,tt,nt,rt,it,at,st,ot,lt,ut,ct,dt,ht,ft,pt,_t,mt,vt,gt,Et,bt,yt,Ct,Nt,St,It,wt,At,Mt,Ot,Rt,Dt,kt,Lt,xt,Ut,Pt,Ft,Bt,Ht,Gt,jt,Vt,qt,zt,Kt,Yt,Wt,Qt,Xt,Zt,Jt,$t,en,tn,nn,rn,an,sn,on,ln,un,cn,dn,hn=this;return S(this,(function(fn){switch(fn.label){case 0:switch(fn.trys.push([0,88,,89]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,27];case"MCNT":return[3,31];case"PEDI":return[3,40];case"VOTE":return[3,43];case"SYEV":return[3,46];case"USEV":return[3,86]}return[3,87];case 1:return c=null,"MESG"===e.code?c=e.as(rc):"FILE"===e.code?c=e.as(vl):"ADMM"!==e.code&&"BRDM"!=e.code||(c=e.as(lf)),c?(r=c.message,i=c.isMentioned,a=c.forceUpdateLastMessage,r.channelType!==ae.GROUP?[3,3]:(U=this._groupChannelCache.isCachedInMemory(r.channelUrl),O=r instanceof tl&&r.sender.userId===this._sdkState.userId,[4,this.getChannel(r.channelUrl,!0)])):[3,3];case 2:if(s=fn.sent(),f=As.of(this._iid).useMemberInfoInMessage,this._forceDisableMack||this._isSuperGroupMackDisabled(s)||r instanceof il||O||Xi((function(){return N(hn,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=new Ap(r),[4,this._requestQueue.send(e)];case 1:return t.sent(),[2]}}))}))})),r instanceof tl){o=r.sender,s.isSuper&&this._upsertCachedUserInfo(o,r.createdAt);try{for(l=I(s.members),u=l.next();!u.done;u=l.next())if((ot=u.value).userId===r.sender.userId){f&&(ot.nickname=r.sender.nickname,ot.plainProfileUrl=r.sender.plainProfileUrl,ot.metaData=r.sender.metaData,ot.isBlockedByMe=r.sender.isBlockedByMe);break}}catch(pn){Yt={error:pn}}finally{try{u&&!u.done&&(Wt=l.return)&&Wt.call(l)}finally{if(Yt)throw Yt.error}}f&&i&&(null===(t=r.mentionedUsers)||void 0===t||t.forEach((function(e){var t,n;try{for(var r=I(s.members),i=r.next();!i.done;i=r.next()){var a=i.value;if(e.userId===a.userId){a.nickname=e.nickname,a.plainProfileUrl=e.plainProfileUrl,a.metaData=e.metaData;break}}}catch(o){t={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}))),O&&(E=this._sessionManager.currentUser)&&(E.nickname=r.sender.nickname,E.plainProfileUrl=r.sender.plainProfileUrl,E.metaData=r.sender.metaData)}r.silent&&!O||(s.isEphemeral||U)&&(s._updateLastMessage(r),O||s._shouldUpdateUnreadCountWith(r)&&s._updateUnreadCount(s.unreadMessageCount+1,s.unreadMentionCount+(i?1:0))),a&&s._updateLastMessage(r),this._dispatcher.dispatch(new Bf({channels:[s],context:{source:bs.EVENT_MESSAGE_RECEIVED}})),r.silent&&!O||Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(s)}catch(o){r={error:o}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),this._dispatcher.dispatch(new Rs({messages:[r],source:bs.EVENT_MESSAGE_RECEIVED})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,a,o;return S(this,(function(l){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageReceived&&n.onMessageReceived(s,r),i&&n.onMentionReceived&&n.onMentionReceived(s,r)}catch(u){a={error:u}}finally{try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),fn.label=3;case 3:return[3,87];case 4:return c=null,"MEDI"===e.code?c=e.as(ac):"FEDI"===e.code?c=e.as(oc):"AEDI"===e.code&&(c=e.as(uf)),c?(d=c.message,h=c.mentionCountChange,f=As.of(this._iid).useMemberInfoInMessage,d.threadInfo&&(d.threadInfo.unreadReplyCount=void 0),d.channelType!==ae.GROUP?[3,6]:(U=this._groupChannelCache.isCachedInMemory(d.channelUrl),[4,this.getChannel(d.channelUrl,!0)])):[3,6];case 5:if(p=fn.sent(),O=!1,d instanceof tl){O=d.sender.userId===this._sdkState.userId,p.isSuper&&this._upsertCachedUserInfo(d.sender,d.updatedAt);try{for(_=I(p.members),m=_.next();!m.done;m=_.next())if((ot=m.value).userId===d.sender.userId){f&&(ot.nickname=d.sender.nickname,ot.plainProfileUrl=d.sender.plainProfileUrl,ot.metaData=d.sender.metaData,ot.isBlockedByMe=d.sender.isBlockedByMe);break}}catch(pn){Qt={error:pn}}finally{try{m&&!m.done&&(Xt=_.return)&&Xt.call(_)}finally{if(Qt)throw Qt.error}}}v=!1,O?(g=d.sender,(E=this._sessionManager.currentUser)&&(E.nickname=g.nickname,E.plainProfileUrl=g.plainProfileUrl,E.metaData=g.metaData)):p.isReadMessage(d)||0!==h&&!d.silent&&U&&(p._updateUnreadCount(p.unreadMessageCount,p.unreadMentionCount+h),v=!0),p._updateLastMessage(d)?v=!0:(null===(n=p.lastMessage)||void 0===n?void 0:n.isIdentical(d))&&(U?p._updateLastMessage(d)&&(v=!0):v=!0),b=!1,p.lastPinnedMessage&&p.lastPinnedMessage.messageId===d.messageId&&(p.lastPinnedMessage=d,v=!0,b=!0),v&&(this._dispatcher.dispatch(new Bf({channels:[p],context:{source:b?bs.EVENT_PINNED_MESSAGE_UPDATED:bs.EVENT_MESSAGE_UPDATED}})),d.silent&&!O||Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(p)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),b&&Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPinnedMessageUpdated&&n.onPinnedMessageUpdated(p)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),this._dispatcher.dispatch(new Rs({messages:[d],source:bs.EVENT_MESSAGE_UPDATED})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated&&n.onMessageUpdated(p,d),h>0&&n.onMentionReceived&&n.onMentionReceived(p,d)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),fn.label=6;case 6:return[3,87];case 7:return y=e.as(Tt),me=y.channelUrl,ve=y.channelType,C=y.messageId,T=y.silent,w=y.messageCreatedAt,A=y.senderId,ve!==ae.GROUP?[3,9]:[4,this.getChannel(me,!0)];case 8:M=fn.sent(),O=A===this._sdkState.userId,T||O||w>0&&M.myLastRead<w&&M.unreadMessageCount>0&&M._updateUnreadCount(M.unreadMessageCount-1,0),this._dispatcher.dispatch(new Ds({messageIds:[C],source:bs.EVENT_MESSAGE_DELETED})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageDeleted&&n.onMessageDeleted(M,C)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),fn.label=9;case 9:return[3,87];case 10:return(R=e.as(Uo).readStatus).channelType!==ae.GROUP?[3,12]:(U=this._groupChannelCache.isCachedInMemory(R.channelUrl),[4,this.getChannel(R.channelUrl,!0)]);case 11:D=fn.sent(),U&&D._updateUnreadMemberState(R.reader.userId,R.readAt),R.reader.userId===this._sdkState.userId?U?(D.unreadMessageCount>0||D.unreadMentionCount>0)&&(D._updateUnreadCount(0,0),this._dispatcher.dispatch(new Bf({channels:[D],context:{source:bs.EVENT_CHANNEL_READ}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(D)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):0!==D.unreadMessageCount&&0!==D.unreadMentionCount||(this._dispatcher.dispatch(new Bf({channels:[D],context:{source:bs.EVENT_CHANNEL_READ}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(D)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new Bf({channels:[D],context:{source:bs.EVENT_CHANNEL_READ}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUnreadMemberStatusUpdated&&n.onUnreadMemberStatusUpdated(D)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),fn.label=12;case 12:return[3,87];case 13:return k=e.as(Dp),me=k.channelUrl,L=k.deliveredStateUpdate,x=void 0===L?{}:L,U=this._groupChannelCache.isCachedInMemory(me),[4,this.getChannel(me,!0)];case 14:return P=fn.sent(),U&&Object.keys(x).forEach((function(e){P._updateUndeliveredMemberState(e,x[e])})),Object.keys(x).some((function(e){return e!==hn._sdkState.userId}))&&(this._dispatcher.dispatch(new Bf({channels:[P],context:{source:bs.EVENT_CHANNEL_DELIVERED}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUndeliveredMemberStatusUpdated&&n.onUndeliveredMemberStatusUpdated(P)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),[3,87];case 15:return F=e.as(cf),me=F.channelUrl,ve=F.channelType,H=F.event,ve!==ae.GROUP?[3,26]:[4,this.getChannel(me,!0)];case 16:return G=fn.sent(),[4,this.getMessageFromCache(H.messageId)];case 17:if(X=fn.sent(),!G.isSuper)return[3,25];fn.label=18;case 18:fn.trys.push([18,23,24,25]),j=I(Object.keys(H._sampledUserInfoList)),V=j.next(),fn.label=19;case 19:return V.done?[3,22]:(q=V.value,[4,this._userInfoCache.get(q)]);case 20:(z=fn.sent())?(z.plainProfileUrl=H._sampledUserInfoList[q].profile_url,z.nickname=H._sampledUserInfoList[q].nickname,this._upsertCachedUserInfo(z,H.updatedAt)):(K=new Aa(this._iid,{user_id:q,nickname:H._sampledUserInfoList[q].nickname,profile_url:H._sampledUserInfoList[q].profile_url,require_auth_for_profile_image:H._sampledUserInfoList[q].require_auth_for_profile_image}),this._upsertCachedUserInfo(K,H.updatedAt)),fn.label=21;case 21:return V=j.next(),[3,19];case 22:return[3,25];case 23:return Y=fn.sent(),Zt={error:Y},[3,25];case 24:try{V&&!V.done&&(Jt=j.return)&&Jt.call(j)}finally{if(Zt)throw Zt.error}return[7];case 25:X?X instanceof el&&(X.applyReactionEvent(H),this._dispatcher.dispatch(new Rs({messages:[X],source:bs.EVENT_MESSAGE_REACTION_UPDATED}))):this._dispatcher.dispatch(new Ls({event:H,source:bs.EVENT_MESSAGE_REACTION_UPDATED})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onReactionUpdated&&n.onReactionUpdated(G,H)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),fn.label=26;case 26:return[3,87];case 27:return(W=e.as(df).event).channelType!==ae.GROUP?[3,30]:[4,this.getChannel(W.channelUrl,!0)];case 28:return Q=fn.sent(),[4,this.getMessageFromCache(W.targetMessageId)];case 29:if((X=fn.sent())?X instanceof el&&(X.applyThreadInfoUpdateEvent(W),this._dispatcher.dispatch(new Rs({messages:[X],source:bs.EVENT_MESSAGE_THREADINFO_UPDATED}))):this._dispatcher.dispatch(new xs({event:W,source:bs.EVENT_MESSAGE_THREADINFO_UPDATED})),Q.isSuper)try{for(Z=I(W.threadInfo.mostRepliedUsers),J=Z.next();!J.done;J=Z.next())tt=J.value,this._upsertCachedUserInfo(tt,W.threadInfo.updatedAt)}catch(pn){$t={error:pn}}finally{try{J&&!J.done&&(en=Z.return)&&en.call(Z)}finally{if($t)throw $t.error}}Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(Q,W)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),fn.label=30;case 30:return[3,87];case 31:$=e.as(hf).groupChannelMemberCounts,ee=[],fn.label=32;case 32:fn.trys.push([32,37,38,39]),te=I($),ne=te.next(),fn.label=33;case 33:return ne.done?[3,36]:(re=ne.value,me=re.channelUrl,Qe=re.memberCount,Xe=re.joinedMemberCount,ie=re.updatedAt,[4,this.getChannelFromCache(me)]);case 34:(le=fn.sent())&&le._setLatestMemberCount(Qe,Xe,ie)&&ee.push(le),fn.label=35;case 35:return ne=te.next(),[3,33];case 36:return[3,39];case 37:return ue=fn.sent(),tn={error:ue},[3,39];case 38:try{ne&&!ne.done&&(nn=te.return)&&nn.call(te)}finally{if(tn)throw tn.error}return[7];case 39:return ee.length>0&&(this._dispatcher.dispatch(new Bf({channels:ee,context:{source:bs.EVENT_CHANNEL_MEMBER_COUNT_UPDATED}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelMemberCountChanged&&n.onChannelMemberCountChanged(ee)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),[3,87];case 40:return ce=e.as(ff),de=ce.event,he=ce.status,me=ce.channelUrl,ve=ce.channelType,me&&ve===ae.GROUP?[4,this.getChannel(me,!0)]:[3,42];case 41:fe=fn.sent(),this._dispatcher.dispatch(new Fs({event:de,source:bs.EVENT_POLL_UPDATED})),Qi(he===Gs?function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollDeleted&&n.onPollDeleted(fe,de.pollId)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}:function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollUpdated&&n.onPollUpdated(fe,de)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}),fn.label=42;case 42:return[3,87];case 43:return pe=e.as(Mc),_e=pe.event,me=pe.channelUrl,ve=pe.channelType,me&&ve===ae.GROUP?[4,this.getChannel(me,!0)]:[3,45];case 44:ge=fn.sent(),this._dispatcher.dispatch(new Bs({event:_e,source:bs.EVENT_POLL_VOTED})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollVoted&&n.onPollVoted(ge,_e)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),fn.label=45;case 45:return[3,87];case 46:if(!(Ee=e.as(rf).event).isGroupChannelEvent)return[3,85];switch(Ee.category){case Jh.CHANNEL_JOIN:return[3,47];case Jh.CHANNEL_LEAVE:return[3,49];case Jh.CHANNEL_OPERATOR_UPDATE:return[3,53];case Jh.CHANNEL_INVITE:return[3,55];case Jh.CHANNEL_DECLINE_INVITE:return[3,57];case Jh.TYPING_START:case Jh.TYPING_END:return[3,59];case Jh.USER_CHANNEL_MUTE:case Jh.USER_CHANNEL_UNMUTE:return[3,61];case Jh.USER_CHANNEL_BAN:return[3,63];case Jh.USER_CHANNEL_UNBAN:return[3,67];case Jh.CHANNEL_FREEZE:case Jh.CHANNEL_UNFREEZE:return[3,69];case Jh.CHANNEL_HIDE:return[3,71];case Jh.CHANNEL_UNHIDE:return[3,73];case Jh.CHANNEL_DELETED:return[3,75];case Jh.CHANNEL_PROP_CHANGED:return[3,77];case Jh.CHANNEL_META_DATA_CHANGED:return[3,79];case Jh.CHANNEL_META_COUNTERS_CHANGED:return[3,81];case Jh.PINNED_MESSAGE_CHANGED:return[3,83]}return[3,85];case 47:return[4,this.getChannel(Ee.channelUrl,!0)];case 48:if(be=fn.sent(),ye=e.as(hp),Ce=ye.memberCount,Te=ye.joinedMemberCount,Ne=ye.members,Se=!1,Ne.forEach((function(e){be.isExclusive||be.isSuper||be.isBroadcast?Se=Se||be._setLatestMemberCount(Ce,Te,Ee.ts):(e.state=tf.JOINED,be.addMember(e,Ee.ts),hn._updateJoinedMemberCount(be)),e.userId===hn._sdkState.userId&&(be.myMemberState=tf.JOINED)})),be.isSuper)try{for(Ie=I(Ne),we=Ie.next();!we.done;we=Ie.next())ot=we.value,this._upsertCachedUserInfo(ot,Ee.ts)}catch(pn){rn={error:pn}}finally{try{we&&!we.done&&(an=Ie.return)&&an.call(Ie)}finally{if(rn)throw rn.error}}return this._dispatcher.dispatch(new Bf({channels:[be],context:{source:bs.EVENT_CHANNEL_JOINED,users:Ne}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=I(Ne),i=r.next();!i.done;i=r.next()){var a=i.value;e.onUserJoined&&e.onUserJoined(be,a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}be.isBroadcast&&Se&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([be])})),[2]}))}))})),[3,85];case 49:return(lt=this._leftChannels.get(Ee.channelUrl))?(Me=lt.channel,[3,52]):[3,50];case 50:return[4,this.getChannel(Ee.channelUrl,!0)];case 51:Me=fn.sent(),fn.label=52;case 52:return Ae=Me,Oe=e.as(pp),Qe=Oe.memberCount,Xe=Oe.joinedMemberCount,Re=Oe.member,De=!1,ke=As.of(this._iid).appInfo,Ae.isExclusive||Ae.isSuper||Ae.isBroadcast?De=Ae._setLatestMemberCount(Qe,Xe,Ee.ts):((null==ke?void 0:ke.enabledChannelMemberShipHistory)?((Le=Ae.members.find((function(e){return e.userId===Re.userId})))&&(Le.state=tf.LEFT),Ae.memberCount=Qe):Ae.removeMember(Re),this._updateJoinedMemberCount(Ae)),Re.userId===this._sdkState.userId?(Ae.myMemberState=tf.NONE,Ae.invitedAt=0,Ae.joinedAt=0,Ae._updateUnreadCount(0,0),Ae.isPublic?this._dispatcher.dispatch(new Bf({channels:[Ae],context:{source:bs.EVENT_CHANNEL_LEFT,user:Re}})):(this._markAsLeave(Ae),this._dispatcher.dispatch(new Hf({channelUrls:[Ae.url],context:{source:bs.EVENT_CHANNEL_LEFT,user:Re}})))):this._dispatcher.dispatch(new Bf({channels:[Ae],context:{source:bs.EVENT_CHANNEL_LEFT,user:Re}})),Ae.isSuper&&this._upsertCachedUserInfo(Re,Ee.ts),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft&&e.onUserLeft(Ae,Re),Ae.isBroadcast&&De&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([Ae])})),[2]}))}))})),[3,85];case 53:return[4,this.getChannel(Ee.channelUrl,!0)];case 54:xe=fn.sent(),Ue=e.as(af).operators,Pe=Ue.map((function(e){return e.userId}));try{for(Fe=I(xe.members),Be=Fe.next();!Be.done;Be=Fe.next())(ot=Be.value).role=Pe.includes(ot.userId)?se.OPERATOR:se.NONE}catch(pn){sn={error:pn}}finally{try{Be&&!Be.done&&(on=Fe.return)&&on.call(Fe)}finally{if(sn)throw sn.error}}return xe.myRole=Pe.includes(this._sdkState.userId)?se.OPERATOR:se.NONE,this._dispatcher.dispatch(new Bf({channels:[xe],context:{source:bs.EVENT_CHANNEL_OPERATOR_UPDATED,operators:Ue}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(xe,Ue)})),[2]}))}))})),[3,85];case 55:return[4,this.getChannel(Ee.channelUrl,!0)];case 56:He=fn.sent(),Ge=e.as(vp),Qe=Ge.memberCount,Xe=Ge.joinedMemberCount,je=Ge.inviter,(Ve=Ge.invitees).forEach((function(e){return e.state=tf.INVITED}));try{for(qe=I(Ve),ze=qe.next();!ze.done;ze=qe.next())Ke=ze.value,He.isExclusive||He.isSuper||He.isBroadcast?(He.isSuper&&this._userInfoCache.upsert(Ke,Ee.ts),He._setLatestMemberCount(Qe,Xe,Ee.ts)):He.addMember(Ke,Ee.ts),this._sdkState.userId===Ke.userId&&(He.hiddenState=b_.UNHIDDEN,He.myMemberState!==tf.JOINED&&(He.myMemberState=tf.INVITED),He.invitedAt=Ee.ts)}catch(pn){ln={error:pn}}finally{try{ze&&!ze.done&&(un=qe.return)&&un.call(qe)}finally{if(ln)throw ln.error}}return this._dispatcher.dispatch(new Bf({channels:[He],context:{source:bs.EVENT_CHANNEL_INVITED,inviter:je,invitees:Ve}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation&&e.onUserReceivedInvitation(He,je,Ve)})),[2]}))}))})),[3,85];case 57:return[4,this.getChannel(Ee.channelUrl,!0)];case 58:return Ye=fn.sent(),We=e.as(Ep),Qe=We.memberCount,Xe=We.joinedMemberCount,Ze=We.inviter,Je=We.invitee,Ye.isExclusive||Ye.isSuper||Ye.isBroadcast?(Ye.isSuper&&this._userInfoCache.upsert(Je,Ee.ts),Ye._setLatestMemberCount(Qe,Xe,Ee.ts)):Ye.removeMember(Je),this._sdkState.userId===Je.userId?(Ye.invitedAt=0,Ye.myMemberState=tf.NONE,Ye.isPublic?this._dispatcher.dispatch(new Bf({channels:[Ye],context:{source:bs.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ze,invitee:Je}})):this._dispatcher.dispatch(new Hf({channelUrls:[Ye.url],context:{source:bs.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ze,invitee:Je}}))):this._dispatcher.dispatch(new Bf({channels:[Ye],context:{source:bs.EVENT_CHANNEL_DECLINED_INVITE,inviter:Ze,invitee:Je}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation&&e.onUserDeclinedInvitation(Ye,Ze,Je)})),[2]}))}))})),[3,85];case 59:return[4,this.getChannel(Ee.channelUrl,!0)];case 60:return $e=fn.sent(),et=Ee.category===Jh.TYPING_START,tt=e.as(et?Sp:wp).user,$e._updateTypingStatus(tt,et?Ee.ts:0),this._dispatcher.dispatch(new Bf({channels:[$e],context:{source:bs.EVENT_CHANNEL_TYPING_STATUS_UPDATE}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated($e)})),[2]}))}))})),[3,85];case 61:return[4,this.getChannel(Ee.channelUrl,!0)];case 62:nt=fn.sent(),rt=Ee.category===Jh.USER_CHANNEL_MUTE,(it=e.as(rt?ju:qu).user).userId===this._sdkState.userId&&(nt.myMutedState=rt?oe.MUTED:oe.UNMUTED,nt._myMutedRemainingTime=it.restrictionInfo.remainingDuration);try{for(at=I(nt.members),st=at.next();!st.done;st=at.next())if((ot=st.value).userId===it.userId){ot.isMuted=rt;break}}catch(pn){cn={error:pn}}finally{try{st&&!st.done&&(dn=at.return)&&dn.call(at)}finally{if(cn)throw cn.error}}return nt.isSuper&&this._userInfoCache.upsert(it,Ee.ts),this._dispatcher.dispatch(new Bf({channels:[nt],context:{source:rt?bs.EVENT_CHANNEL_MUTED:bs.EVENT_CHANNEL_UNMUTED,user:it}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){rt?e.onUserMuted&&e.onUserMuted(nt,it):e.onUserUnmuted&&e.onUserUnmuted(nt,it)})),[2]}))}))})),[3,85];case 63:return(lt=this._leftChannels.get(Ee.channelUrl))?(ct=lt.channel,[3,66]):[3,64];case 64:return[4,this.getChannel(Ee.channelUrl,!0)];case 65:ct=fn.sent(),fn.label=66;case 66:return ut=ct,this._markAsLeave(ut),dt=e.as(Ku).user,pt=dt.userId===this._sdkState.userId,ut.isSuper&&this._userInfoCache.upsert(dt,Ee.ts),pt&&this._dispatcher.dispatch(new Hf({channelUrls:[ut.url],context:{source:bs.EVENT_CHANNEL_BANNED,user:dt}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned&&e.onUserBanned(ut,dt)})),[2]}))}))})),[3,85];case 67:return[4,this.getChannel(Ee.channelUrl,!0)];case 68:return ht=fn.sent(),ft=e.as(Wu).user,pt=ft.userId===this._sdkState.userId,ht.isSuper&&this._userInfoCache.upsert(ft,Ee.ts),pt&&this._dispatcher.dispatch(new Hf({channelUrls:[ht.url],context:{source:bs.EVENT_CHANNEL_UNBANNED,user:ft}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned&&e.onUserUnbanned(ht,ft)})),[2]}))}))})),[3,85];case 69:return[4,this.getChannel(Ee.channelUrl,!0)];case 70:return _t=fn.sent(),mt=e.as(Xu).freeze,_t.isFrozen=mt,this._dispatcher.dispatch(new Bf({channels:[_t],context:{source:mt?bs.EVENT_CHANNEL_FROZEN:bs.EVENT_CHANNEL_UNFROZEN}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){mt?e.onChannelFrozen&&e.onChannelFrozen(_t):e.onChannelUnfrozen&&e.onChannelUnfrozen(_t)})),[2]}))}))})),[3,85];case 71:return[4,this.getChannel(Ee.channelUrl,!0)];case 72:return vt=fn.sent(),gt=e.as(Tp),Et=gt.allowAutoUnhide,bt=gt.hidePreviousMessages,yt=gt.messageOffsetTimestamp,null!==Et&&(vt.hiddenState=Et?b_.HIDDEN_ALLOW_AUTO_UNHIDE:b_.HIDDEN_PREVENT_AUTO_UNHIDE),null!==bt&&bt&&vt._updateUnreadCount(0,0),null!==yt&&(vt.messageOffsetTimestamp=yt),this._dispatcher.dispatch(new Bf({channels:[vt],context:{source:bs.EVENT_CHANNEL_HIDDEN}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden&&e.onChannelHidden(vt)})),[2]}))}))})),[3,85];case 73:return[4,this.getChannel(Ee.channelUrl,!0)];case 74:return(Ct=fn.sent()).hiddenState=b_.UNHIDDEN,this._dispatcher.dispatch(new Bf({channels:[Ct],context:{source:bs.EVENT_CHANNEL_UNHIDDEN}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Ct)})),[2]}))}))})),[3,85];case 75:return[4,this.getChannel(Ee.channelUrl,!0)];case 76:return Nt=fn.sent(),this._dispatcher.dispatch(new Hf({channelUrls:[Ee.channelUrl],context:{source:bs.EVENT_CHANNEL_DELETED}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(Nt.url,Nt.channelType)})),[2]}))}))})),[3,85];case 77:return[4,this.getChannelWithoutCache(Ee.channelUrl,!0)];case 78:return St=fn.sent(),this._dispatcher.dispatch(new Bf({channels:[St],context:{source:bs.EVENT_CHANNEL_UPDATED}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(St)})),[2]}))}))})),[3,85];case 79:return[4,this.getChannel(Ee.channelUrl,!0)];case 80:return It=fn.sent(),wt=e.as(wu),At=wt.created,Mt=wt.updated,Ot=wt.deleted,At&&(It._upsertCachedMetaData(At,Ee.ts),this._dispatcher.dispatch(new Bf({channels:[It],context:{source:bs.EVENT_CHANNEL_METADATA_CREATED,metaData:At},ts:Ee.ts}))),Mt&&(It._upsertCachedMetaData(Mt,Ee.ts),this._dispatcher.dispatch(new Bf({channels:[It],context:{source:bs.EVENT_CHANNEL_METADATA_UPDATED,metaData:Mt},ts:Ee.ts}))),Ot&&(It._removeFromCachedMetaData(Ot,Ee.ts),this._dispatcher.dispatch(new Bf({channels:[It],context:{source:bs.EVENT_CHANNEL_METADATA_DELETED,metaDataKeys:Ot},ts:Ee.ts}))),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){At&&e.onMetaDataCreated&&e.onMetaDataCreated(It,At),Mt&&e.onMetaDataUpdated&&e.onMetaDataUpdated(It,Mt),Ot&&e.onMetaDataDeleted&&e.onMetaDataDeleted(It,Ot)})),[2]}))}))})),[3,85];case 81:return[4,this.getChannel(Ee.channelUrl,!0)];case 82:return Rt=fn.sent(),Dt=e.as(Fu),kt=Dt.created,Lt=Dt.updated,xt=Dt.deleted,kt&&this._dispatcher.dispatch(new Bf({channels:[Rt],context:{source:bs.EVENT_CHANNEL_METACOUNTER_CREATED,metaCounters:kt}})),Lt&&this._dispatcher.dispatch(new Bf({channels:[Rt],context:{source:bs.EVENT_CHANNEL_METACOUNTER_UPDATED,metaCounters:Lt}})),xt&&this._dispatcher.dispatch(new Bf({channels:[Rt],context:{source:bs.EVENT_CHANNEL_METACOUNTER_DELETED,metaCounterKeys:xt}})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){kt&&e.onMetaCounterCreated&&e.onMetaCounterCreated(Rt,kt),Lt&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(Rt,Lt),xt&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(Rt,xt)})),[2]}))}))})),[3,85];case 83:return[4,this.getChannel(Ee.channelUrl,!0)];case 84:return Ut=fn.sent(),Pt=e.as(sf),Ft=Pt.pinnedMessageIds,Bt=Pt.latestPinnedMessage,(Ht=Pt.ts)>Ut._pinnedMessagesUpdatedAt&&(Ut.pinnedMessageIds=null!=Ft?Ft:[],Ut.lastPinnedMessage=Bt,Ut._pinnedMessagesUpdatedAt=Ht,this._dispatcher.dispatch(new Bf({channels:[Ut],context:{source:bs.EVENT_PINNED_MESSAGE_UPDATED}})),Qi((function(){return N(hn,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(Ut)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Qi((function(){return N(hn,0,void 0,(function(){return S(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(Ut)})),[2]}))}))}))),[3,85];case 85:return[3,87];case 86:switch((Gt=e.as(Xh).event).category){case Hh.USER_BLOCK:jt=Kh.getDataAsUserBlockEvent(this._iid,Gt),qt=jt.blocker,zt=jt.blockee,this._groupChannelCache.block(qt.userId,zt.userId);break;case Hh.USER_UNBLOCK:Vt=Kh.getDataAsUserBlockEvent(this._iid,Gt),qt=Vt.blocker,zt=Vt.blockee,this._groupChannelCache.unblock(qt.userId,zt.userId)}return[3,87];case 87:return[3,89];case 88:if(Kt=fn.sent(),B(Kt))throw Kt;return[3,89];case 89:return[2]}}))}))},t.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},t.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},t.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},t.prototype.subscribeChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},t.prototype.unsubscribeChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},t.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===tf.JOINED})).length},t.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:Ia(q("string",e)).throw(H.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},t.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),n=new zf({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(r=o.sent(),i=r.as(Kf).channel,a=i.unreadMessageCount,s=i.unreadMentionCount,i.myCountPreference){case E_.UNREAD_MESSAGE_COUNT_ONLY:s=0;break;case E_.UNREAD_MENTION_COUNT_ONLY:a=0;break;case E_.OFF:a=0,s=0}return i._updateUnreadCount(a,s),[4,this.upsertChannelsToCache([i])];case 2:return[2,o.sent()[0]]}}))}))},t.prototype.refreshChannel=function(e,t,n,r){return void 0===t&&(t=!0),void 0===n&&(n=bs.REFRESH_CHANNEL),void 0===r&&(r=!1),N(this,0,void 0,(function(){var i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),i=new zf({channelUrl:e,isInternalCall:t,showLatestMessage:r}),[4,this._requestQueue.send(i)];case 1:return a=u.sent(),(s=a.as(Kf).channel).myMemberState!==tf.NONE?[3,2]:(this._dispatcher.dispatch(new Hf({channelUrls:[s.url],context:{source:n}})),[3,4]);case 2:return[4,this.upsertChannelsToCache([s])];case 3:o=u.sent(),this._dispatcher.dispatch(new Bf({channels:o,context:{source:n}})),u.label=4;case 4:return[3,6];case 5:return(l=u.sent()).code!==M.NON_AUTHORIZED&&l.code!==M.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new Hf({channelUrls:[e],context:{source:n}})),[3,6];case 6:return[2]}}))}))},t.prototype.getMyGroupChannels=function(e,t,n,r,i){return void 0===r&&(r=bs.REQUEST_CHANNEL),void 0===i&&(i=!1),N(this,0,void 0,(function(){var a,s,o,l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return t.createdAfter&&(t.createdAfter=Math.floor(t.createdAfter/1e3)),t.createdBefore&&(t.createdBefore=Math.floor(t.createdBefore/1e3)),a=!1,i&&(s=As.of(this._iid),o=s.appInfo,(l=s.cacheContext)&&!l.localCacheEnabled&&(null==o?void 0:o.enabledChannelMemberShipHistory)&&(null==o?void 0:o.applicationAttributes.includes("left_user_view_support"))&&(a=!0)),u=new Wf(T(T({},t),{userId:this._sdkState.userId,token:e,limit:n,includeLeftChannel:i&&a})),[4,this._requestQueue.send(u)];case 1:return c=p.sent(),d=c.as(Qf),h=d.channels,f=d.token,this._dispatcher.dispatch(new Bf({channels:h,context:{source:r}})),[2,{channels:h,token:f}]}}))}))},t.prototype.getMyGroupChannelChangeLogs=function(e,t,n){return void 0===n&&(n=bs.REQUEST_CHANNEL_CHANGELOGS),N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c;return S(this,(function(d){switch(d.label){case 0:return r=T(T({},Mf),t),Ia((q("string",e)||q("number",e))&&Of(r)).throw(H.invalidParameters),i=new Vf(Se({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:r})),[4,this._requestQueue.send(i)];case 1:return a=d.sent(),s=a.as(qf),o=s.updatedChannels,l=s.deletedChannelUrls,u=s.hasMore,c=s.ts,o.length>0&&this._dispatcher.dispatch(new Bf({channels:o,context:{source:n},ts:c})),l.length>0&&this._dispatcher.dispatch(new Hf({channelUrls:l,context:{source:n}})),[2,{updatedChannels:o,deletedChannelUrls:l,hasMore:u,token:s.token}]}}))}))},t.prototype.getGroupChannelCount=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=T(T({},Rf),e),Ia(Df(t)).throw(H.invalidParameters),n=new Xf({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return[2,r.sent().as(Zf).groupChannelCount]}}))}))},t.prototype.getUnreadItemCount=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m;return S(this,(function(v){switch(v.label){case 0:return t=T(T({},Lf),e),Ia((g=t,Y(Nf,g.keys)&&Y("string",g.customTypeFilters,!0)&&Y("string",g.customTypesFilter,!0))).throw(H.invalidParameters),n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Jf({userId:r.userId,filter:t}),[4,i.send(a)];case 1:return s=v.sent(),o=s.as($f),l=o.groupChannelUnreadMentionCount,u=o.groupChannelUnreadMessageCount,c=o.groupChannelInvitationCount,d=o.superGroupChannelUnreadMentionCount,h=o.superGroupChannelUnreadMessageCount,f=o.superGroupChannelInvitationCount,p=o.nonSuperGroupChannelUnreadMentionCount,_=o.nonSuperGroupChannelUnreadMessageCount,m=o.nonSuperGroupChannelInvitationCount,[2,Ne({groupChannelUnreadMentionCount:l,groupChannelUnreadMessageCount:u,groupChannelInvitationCount:c,superGroupChannelUnreadMentionCount:d,superGroupChannelUnreadMessageCount:h,superGroupChannelInvitationCount:f,nonSuperGroupChannelUnreadMentionCount:p,nonSuperGroupChannelUnreadMessageCount:_,nonSuperGroupChannelInvitationCount:m})]}var g}))}))},t.prototype.getTotalUnreadChannelCount=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ep({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(tp).unreadCount]}}))}))},t.prototype.getTotalUnreadMessageCount=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return t=T(T({},xf),e),Ia(function(e){return Y("string",e.channelCustomTypesFilter,!0)&&z(mf,e.superChannelFilter)}(t)).throw(H.invalidParameters),n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new np({userId:r.userId,filter:t}),[4,i.send(a)];case 1:return[2,s.sent().as(rp).unreadCount]}}))}))},t.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){var t,n,r;return S(this,(function(i){switch(i.label){case 0:return t=T(T({},Uf),e),Ia((a=t,q("string",a.channelUrl,!0)&&Y(Wo,a.scheduledStatus,!0)&&z(ue,a.messageTypeFilter))).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new ip(t),[4,n.send(r)];case 1:return[2,i.sent().as(ap).count]}var a}))}))},t.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=As.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=As.of(this._iid).subscribedUnreadMessageCount;return Object.keys(t.customTypes).forEach((function(n){e+=t.customTypes[n]})),e},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=As.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},t.prototype.createChannel=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=T(T({},wf),e),Ia(Af(t)).throw(H.invalidParameters),t.isPublic||(t.accessCode=void 0),n=new op(T({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=a.sent(),i=r.as(lp).channel,[4,this.upsertChannelsToCache([i])];case 2:return a.sent(),[2,i]}}))}))},t.prototype.markAsReadAll=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return e=Date.now(),Ia(e-this._markAsReadAllLastSentAt>=1e3).throw(H.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new up({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:l.sent(),n=this._groupChannelCache.channels;try{for(r=I(n),i=r.next();!i.done;i=r.next())(a=i.value)._updateUnreadMemberState(this._sdkState.userId,e),a._updateUnreadCount(0,0)}catch(u){s={error:u}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(s)throw s.error}}return n.length>0?[4,this.upsertChannelsToCache(n)]:[3,3];case 2:l.sent(),l.label=3;case 3:return[2]}}))}))},t.prototype.markAsReadWithChannelUrls=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return t=Date.now(),Ia(Y("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(H.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new up({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:c.sent(),r=this._groupChannelCache.channels,i=[];try{for(a=I(r),s=a.next();!s.done;s=a.next())o=s.value,e.includes(o.url)&&(o._updateUnreadMemberState(this._sdkState.userId,t),o._updateUnreadCount(0,0),i.push(o))}catch(d){l={error:d}}finally{try{s&&!s.done&&(u=a.return)&&u.call(a)}finally{if(l)throw l.error}}return i.length>0?[4,this.upsertChannelsToCache(i)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))},t.prototype.markAsDelivered=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},t.prototype.getMessageFromCache=function(e){var t;return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},t.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,t,n){return N(this,0,void 0,(function(){return S(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,filter:n,exactMatch:!0})];case 1:return[2,r.sent()]}}))}))},t.prototype.getMessagesFromCache=function(e,t,n,r,i,a){return void 0===i&&(i=100),void 0===a&&(a=!0),N(this,0,void 0,(function(){return S(this,(function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:i,filter:r,backward:"next"===n,inclusive:a})];case 1:return[2,s.sent()]}}))}))},t.prototype.getPollMessagesFromCache=function(e,t,n,r){return N(this,0,void 0,(function(){return S(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,i.sent()]}}))}))},t.prototype.getCachedMessageCountBetween=function(e,t,n,r){return N(this,0,void 0,(function(){return S(this,(function(i){switch(i.label){case 0:return[4,this._messageCache.countBetween(e,t,new kp({top:n,bottom:r}))];case 1:return[2,i.sent()]}}))}))},t.prototype.getUnsentMessagesFromCache=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}}))}))},t.prototype.removeFailedMessageFromCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},t}(of),Up=function(e,t){return t instanceof tl?e.findIndex((function(e){return e instanceof tl&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},Pp=function(e,t){return e.findIndex((function(e){return e instanceof el?e.messageId===t:e instanceof cl?e.notificationId===t:void 0}))},Fp=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,i=Math.floor((n+r)/2);n<r;){var a=e[i].createdAt-t.createdAt;if(a>0)r=i,i=Math.floor((n+r)/2);else{if(!(a<0))return i;n=i+1,i=Math.floor((n+r)/2)}}return e[i].createdAt>t.createdAt?i:i+1}return e.length},Bp={},Hp=function(){function e(e){var t=e._iid,n=e.channel,r=e.limit,i=void 0===r?100:r,a=this;this.ref=0,this._iid=t,this._channel=n,this._limit=i,this._prevSyncLoopCount=0;var s,o,l=As.of(this._iid),u=l.sdkState,c=l.cacheContext,d=l.dispatcher,h=l.logger,f=l.statManager,p=l.messageBackgroundSyncThrottleController;this._metadataKey=(s=u.userId,o=n.url,"sendbird:".concat(s,"@groupchannel/").concat(o,"/message/sync.meta"));var _,m,v=(_=u.userId,m=n.url,"sendbird:".concat(_,"@groupchannel/").concat(m,"/message/sync"));this._prevSync=new $h(v,(function(e){return N(a,0,void 0,(function(){var t=this;return S(this,(function(r){switch(r.label){case 0:return[4,p.run("message-background-sync-".concat(n.url,"-prev"),(function(){return N(t,0,void 0,(function(){var t,r,i,a,s,o,l,u,d,p,_,m;return S(this,(function(v){switch(v.label){case 0:return t={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata()];case 1:if(v.sent(),h.debug("message background prev sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.top),null===(l=this._metadata)||void 0===l?void 0:l.previousComplete)return[3,10];v.label=2;case 2:return v.trys.push([2,5,8,9]),[4,Sh.of(this._iid)._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,(null===(d=null===(u=this._metadata)||void 0===u?void 0:u.range)||void 0===d?void 0:d.top)?this._metadata.range.top:e,{prevResultSize:this._limit,nextResultSize:0,replyType:he.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0,isInclusive:!0},bs.SYNC_MESSAGE_BACKGROUND,!1,!1,yl.INTERNAL_BACKSYNC)];case 3:return(r=v.sent().messages).length>0&&(i=r.map((function(e){return e.createdAt})),(null===(p=this._metadata)||void 0===p?void 0:(s=p.range).intersect.apply(s,A([],w(i),!1)))?this.extendRange(r):this._metadata={range:new kp({top:Math.min.apply(Math,A([],w(i),!1)),bottom:Math.max.apply(Math,A([],w(i),!1))}),previousComplete:!1}),t.hasNext=r.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(t.nextToken=this._metadata.range.top,this._metadata.previousComplete=r.length<this._limit),h.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return v.sent(),[3,9];case 5:return a=v.sent(),h.debug("message background prev sync error",a),a instanceof H&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:v.sent(),v.label=7;case 7:throw a;case 8:return f.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(m=null===(_=c.localCacheConfig)||void 0===_?void 0:_.maxSize)&&void 0!==m?m:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 9:return[3,11];case 10:t.hasNext=!1,v.label=11;case 11:return[2,t]}}))}))}))];case 1:return[2,r.sent()]}}))}))})),this._nextSync=new $h(v,(function(e){return N(a,0,void 0,(function(){var t=this;return S(this,(function(r){switch(r.label){case 0:return[4,p.run("message-background-sync-".concat(n.url,"-next"),(function(){return N(t,0,void 0,(function(){var t,r,i,a,s,o,l,u,d,p,_;return S(this,(function(m){switch(m.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:m.sent(),h.debug("message background next sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.bottom),m.label=2;case 2:return m.trys.push([2,5,6,7]),[4,Sh.of(this._iid)._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,(null===(u=null===(l=this._metadata)||void 0===l?void 0:l.range)||void 0===u?void 0:u.bottom)?this._metadata.range.bottom:e,{prevResultSize:0,nextResultSize:this._limit,replyType:he.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0,isInclusive:!0},bs.SYNC_MESSAGE_BACKGROUND,!1,!1,yl.INTERNAL_BACKSYNC)];case 3:return(r=m.sent().messages).length>0&&(i=r.map((function(e){return e.createdAt})),(null===(d=this._metadata)||void 0===d?void 0:(s=d.range).intersect.apply(s,A([],w(i),!1)))?this.extendRange(r):this._metadata={range:new kp({top:Math.min.apply(Math,A([],w(i),!1)),bottom:Math.max.apply(Math,A([],w(i),!1))}),previousComplete:!1}),t.hasNext=r.length>=this._limit,this._metadata&&(t.nextToken=this._metadata.range.bottom),h.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return m.sent(),[3,7];case 5:throw a=m.sent(),h.debug("message background next sync error",a),a;case 6:return f.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:n.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:null!==(_=null===(p=c.localCacheConfig)||void 0===p?void 0:p.maxSize)&&void 0!==_?_:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[2,t]}}))}))}))];case 1:return[2,r.sent()]}}))}))})),this._connectionEventContext=d.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?a.resume():a.pause())}))}return e.of=function(t,n){return Bp[t]||(Bp[t]={}),Bp[t][n.url]||(Bp[t][n.url]=new e({_iid:t,channel:n})),Bp[t][n.url].ref++,Bp[t][n.url]},e.clear=function(e,t){Bp[e]&&Bp[e][t]&&(Bp[e][t].close(),delete Bp[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new kp({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,A([],w(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,A([],w(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,As.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{range:new kp(e.range),previousComplete:e.previousComplete}:{range:new kp({}),previousComplete:!1},t.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._metadata?[4,As.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(e){var t,n,r,i;void 0===e&&(e=Date.now());var a=As.of(this._iid),s=a.logger,o=a.sessionManager;a.cacheContext.localCacheEnabled&&o.session.hasSession&&(s.debug("message background sync resume()"),this._prevSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(n=null===(t=this._metadata)||void 0===t?void 0:t.range.top)&&void 0!==n?n:e),this._nextSync.start(null!==(i=null===(r=this._metadata)||void 0===r?void 0:r.range.bottom)&&void 0!==i?i:e))},e.prototype.pause=function(){As.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Bp[this._iid][this._channel.url])},e}(),Gp={},jp=function(){function e(e){var t=e._iid,n=e.channel,r=e.includeParams,i=this;this.ref=0,this._iid=t,this._channel=n,this._includeParams=r;var a,s,o=As.of(this._iid),l=o.logger,u=o.sdkState,c=o.dispatcher;this._metadataKey=(a=u.userId,s=n.url,"sendbird:".concat(a,"@groupchannel/").concat(s,"/message/changelogs.meta"));var d,h,f=(d=u.userId,h=this._channel.url,"sendbird:".concat(d,"@groupchannel/").concat(h,"/message/changelogs"));this._sync=new $h(f,(function(){return N(i,0,void 0,(function(){var e,t,n,r,i,a,s,o,u;return S(this,(function(c){switch(c.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:c.sent(),l.debug("message changelog sync from",null===(u=this._metadata)||void 0===u?void 0:u.token),c.label=2;case 2:return c.trys.push([2,5,,8]),[4,Sh.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,T({replyType:he.ALL},this._includeParams),bs.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=c.sent(),n=t.updatedMessages,r=t.deletedMessageIds,i=t.hasMore,a=t.token,s=t.forceUseNextToken,e.hasNext=i,e.nextToken=a,n.length>0||r.length>0?this._metadata&&(this._metadata.token=a):s&&this._metadata&&(this._metadata.token=a),l.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return c.sent(),[3,8];case 5:return o=c.sent(),l.debug("message changelog sync error",o),o instanceof H&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:c.sent(),c.label=7;case 7:throw o;case 8:return[2,e]}}))}))})),this._connectionEventContext=c.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?i.resume():i.pause())}))}return e.of=function(t,n,r){return Gp[t]||(Gp[t]={}),Gp[t][n.url]||(Gp[t][n.url]=new e({_iid:t,channel:n,includeParams:r})),Gp[t][n.url].ref++,Gp[t][n.url]},e.clear=function(e,t){Gp[e]&&Gp[e][t]&&(Gp[e][t].close(),delete Gp[e])},e.prototype.loadMetadata=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._metadata?[3,2]:(e=As.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n},i.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._metadata?[4,As.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e=As.of(this._iid),t=e.logger;e.sessionManager.session.hasSession&&(t.debug("message changelog sync resume()"),this._sync.start(0))},e.prototype.pause=function(){As.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Gp[this._iid][this._channel.url])},e}(),Vp={},qp=function(){function e(e){var t=e._iid,n=e.channel,r=e.hasPollMessage,i=this;this.ref=0,this._iid=t,this._channel=n;var a,s,o=As.of(this._iid),l=o.logger,u=o.sdkState,c=o.dispatcher;this._metadataKey=(a=u.userId,s=n.url,"sendbird:".concat(a,"@groupchannel/").concat(s,"/poll/changelogs.meta"));var d,h,f=(d=u.userId,h=this._channel.url,"sendbird:".concat(d,"@groupchannel/").concat(h,"/poll/changelogs"));this._sync=new $h(f,(function(){return N(i,0,void 0,(function(){var e,t,n,i,a,s,o,u;return S(this,(function(c){switch(c.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return c.sent(),l.debug("poll changelog sync from",null===(u=this._metadata)||void 0===u?void 0:u.token),(t=!this._metadata||!this._metadata.token)?[4,r()]:[3,3];case 2:t=!c.sent(),c.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=As.of(this._iid).firstConnectedAt,this._metadata={token:n}),c.label=4;case 4:return c.trys.push([4,7,,10]),[4,co.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return i=c.sent(),a=i.hasMore,s=i.token,e.hasNext=a,e.nextToken=s,this._metadata.token=s,l.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return c.sent(),[3,10];case 7:return o=c.sent(),l.debug("poll changelog sync error",o),o instanceof H&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:c.sent(),c.label=9;case 9:throw o;case 10:return[2,e]}}))}))})),this._connectionEventContext=c.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?i.resume():i.pause())}))}return e.of=function(t,n,r){return Vp[t]||(Vp[t]={}),Vp[t][n.url]||(Vp[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),Vp[t][n.url].ref++,Vp[t][n.url]},e.prototype.loadMetadata=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,As.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:void 0,t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._metadata?[4,As.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){As.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){As.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Vp[this._iid][this._channel.url])},e}(),zp=function(e){function t(t){var n,r,i,a,s,o,l,u,c,d,h=this;return(h=e.call(this)||this).method=Ie.GET,h.path="".concat(Qe(t.channelType),"/").concat(t.channelUrl,"/messages_gap"),h.params=Ne({prev_start_ts:t.prevStart,prev_end_ts:t.prevEnd,prev_cache_count:t.prevCount,next_start_ts:t.nextStart,next_end_ts:t.nextEnd,next_cache_count:t.nextCount,huge_gap_threshold:null!==(n=t.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=t.customTypes)&&void 0!==r?r:["*"],message_type:null!==(i=t.messageType)&&void 0!==i?i:null,include_reply_type:null!==(a=t.replyType)&&void 0!==a?a:he.NONE,include_reactions_summary:null===(s=t.includeReactions)||void 0===s||s,include_meta_array:null===(o=t.includeMetaArray)||void 0===o||o,include_thread_info:null===(l=t.includeThreadInfo)||void 0===l||l,include_parent_message_info:null===(u=t.includeParentMessageInfo)||void 0===u||u,with_sorted_meta_array:null===(c=t.includeMetaArray)||void 0===c||c,show_subchannel_messages_only:null!==(d=t.showSubchannelMessagesOnly)&&void 0!==d&&d,include_poll_details:!0,checking_continuous_messages:t.checkingContinuousMessages}),h}return C(t,e),t}(tt),Kp=function(e){function t(t,n){var r,i,a,s,o,l,u=this;return(u=e.call(this,t,n)||this).isHugeGap=n.is_huge_gap,u.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(e){return hl(t,e)})),u.prevHasMore=null!==(i=n.prev_hasmore)&&void 0!==i&&i,u.isContinuousPrevMessages=null!==(a=n.is_continuous_prev_messages)&&void 0!==a&&a,u.nextMessages=(null!==(s=n.next_messages)&&void 0!==s?s:[]).map((function(e){return hl(t,e)})),u.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,u.isContinuousNextMessages=null!==(l=n.is_continuous_next_messages)&&void 0!==l&&l,u}return C(t,e),t}(nt),Yp={includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(Rp||(Rp={}));var Wp,Qp,Xp,Zp=function(){function e(){this._onCacheResult=St,this._onApiResult=St}return e.prototype._invokeResponse=function(e,t,n){var r=this;Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),Jp=function(){function e(e,t){var n=t.filter,r=t.startingPoint,i=t.limit,a=t.prevResultLimit,s=t.nextResultLimit,o=t.channel,l=t.channelManager,u=t.disableBackgroundSync,c=void 0!==u&&u,d=this;this._messages=[],this._unsentMessages=[],this._isLoadingPrevious=!1,this._isLoadingNext=!1,this._iid=e,this._key="mc-".concat(Ee()),this._isDisposed=!1,this.filter=null!=n?n:new ih,this._channel=o,this._syncRange=new kp({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof r&&Number.isFinite(r)?r:Number.MAX_SAFE_INTEGER,this._limit=i||100,this._prevResultLimit=null!=a?a:Math.floor(this._limit/2),this._nextResultLimit=null!=s?s:Math.floor(this._limit/2),this._channelManager=l;var h=As.of(this._iid).statManager;this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(e,t){var n=t.source,r=e.findIndex((function(e){return e.isIdentical(d.channel)}));r>=0&&(d._replaceChannelOfCollection(e[r]),d.channel._runIfHandleableWithGroupChannel((function(e){switch(n){case bs.EVENT_CHANNEL_UPDATED:for(var r=!1,i=0;i<d._messages.length;i++)if(d._messages[i].createdAt>=e.messageOffsetTimestamp){r=!0;var a=i;if(a>0){var s=d._messages.splice(0,a);d._removeMessagesFromView(s.map((function(e){return d.keyOf(e)})),bs.EVENT_MESSAGE_OFFSET_UPDATED)}break}!r&&d._messages.length>0&&d._removeMessagesFromView(d._messages.map((function(e){return d.keyOf(e)})),bs.EVENT_MESSAGE_OFFSET_UPDATED);break;case bs.EVENT_CHANNEL_UNMUTED:var o=As.of(d._iid).sdkState,l=t.user;o.userId===l.userId&&d._clearCheckMyMutedTimer();break;case bs.EVENT_CHANNEL_MUTED:o=As.of(d._iid).sdkState,l=t.user,o.userId===l.userId&&-1!==e._myMutedRemainingTime&&d._startCheckMyMutedTimer(e._myMutedRemainingTime);break;case bs.EVENT_CHANNEL_LEFT:e.isPublic&&d._clearCheckMyMutedTimer()}Qi((function(){return N(d,0,void 0,(function(){var e;return S(this,(function(r){return Ff(n)&&(null===(e=this._handler)||void 0===e?void 0:e.onChannelUpdated)&&this._handler.onChannelUpdated(t,this.channel),[2]}))}))}))})),d._postprocessChannelUpdateEvent(e[r],n))},onRemove:function(e,t){var n=e.indexOf(d.channel.url);n>=0&&d._channel._runIfHandleableWithGroupChannel((function(r){r.myMemberState=tf.NONE,d._clearCheckMyMutedTimer(),Qi((function(){return N(d,0,void 0,(function(){var e;return S(this,(function(n){return(null===(e=this._handler)||void 0===e?void 0:e.onChannelDeleted)&&this._handler.onChannelDeleted(t,this.channel.url),[2]}))}))})),d._postprocessChannelRemoveEvent(e[n])}))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,i=[],a=[];try{for(var s=I(e),o=s.next();!o.done;o=s.next()){var l=o.value;l.channelUrl===d._channel.url&&(d.filter.match(l)?i.push(l):a.push(d.keyOf(l)))}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}if(Os(t)){if(i.length>0)switch(t){case bs.LOCAL_MESSAGE_CANCELED:case bs.LOCAL_MESSAGE_RESEND_STARTED:case bs.EVENT_MESSAGE_SENT_FAILED:case bs.EVENT_MESSAGE_SENT_SUCCESS:case bs.EVENT_MESSAGE_UPDATED:case bs.EVENT_MESSAGE_THREADINFO_UPDATED:case bs.EVENT_MESSAGE_REACTION_UPDATED:case bs.EVENT_MESSAGE_FEEDBACK_ADDED:case bs.EVENT_MESSAGE_FEEDBACK_UPDATED:case bs.EVENT_MESSAGE_FEEDBACK_DELETED:case bs.SYNC_MESSAGE_CHANGELOGS:d._updateMessagesToView(i,t);break;case bs.EVENT_MESSAGE_SENT_PENDING:d._addMessagesToView(i,t);break;case bs.EVENT_MESSAGE_RECEIVED:d.hasNext||d._addMessagesToView(i,t);break;case bs.SYNC_MESSAGE_FILL:d._addMessagesToView(i,t)}a.length>0&&d._removeMessagesFromView(a,t)}d._postprocessMessageUpdateEvent(e,t)},onRemove:function(e,t){d._removeMessagesFromView(e,t),d._postprocessMessageRemoveEvent(e)},onRemoveUnsent:function(e,t){d._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){d._updatePollsToView(e,t)},onPollUpdate:function(e,t){d._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){d._applyPollVoteEventToView(e,t)},onReactionUpdate:function(e,t){d._applyReactionEventToView(e,t)},onThreadInfoUpdate:function(e,t){d._applyThreadInfoEventToView(e,t)},onDeletedByRetentionPolicy:function(e,t,n){t===d.channel.url&&d._messageRetention(e,n)}});var f=As.of(this._iid),p=f.cacheContext,_=f.dispatcher,m=f.messageBackgroundSyncThrottleController;this._channel._updateMessageCollectionLastAccessedAt(),_.dispatch(new Bf({channels:[this._channel],context:{source:bs.CHANNEL_LASTACCESSEDAT_UPDATED}})),this._backgroundSync=Hp.of(this._iid,this._channel),!c&&this._shouldStartBackgroundSync()&&this._backgroundSync.resume(this._startingPoint),this._changelogSync=jp.of(this._iid,this._channel,this.changelogIncludeParams),this._changelogSync.resume(),this._pollChangelogSync=qp.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new $h(this._key,(function(e){return N(d,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return[4,m.run("message-fill-sync-".concat(o.url,"-prev"),(function(){return N(t,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._prevResultLimit,source:bs.SYNC_MESSAGE_FILL,checkingContinuousMessages:p.localCacheEnabled,sdkSource:yl.INTERNAL_FILL_GAP})];case 1:return t=l.sent(),n=t.messages,r=t.isContinuousMessages,n.length>0?(i=Math.min.apply(Math,A([],w(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(i),r&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(i)),[2,{hasNext:n.length>=this._prevResultLimit&&this.viewTop<i,nextToken:this._syncRange.top}]):(p.localCacheEnabled&&h.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(o=null===(s=p.localCacheConfig)||void 0===s?void 0:s.maxSize)&&void 0!==o?o:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))}))];case 1:return[2,n.sent()]}}))}))})),this._nextFill=new $h(this._key,(function(e){return N(d,0,void 0,(function(){var t=this;return S(this,(function(n){switch(n.label){case 0:return[4,m.run("message-fill-sync-".concat(o.url,"-next"),(function(){return N(t,0,void 0,(function(){var t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._nextResultLimit,source:bs.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:p.localCacheEnabled,sdkSource:yl.INTERNAL_FILL_GAP})];case 1:return t=u.sent(),n=t.messages,r=t.isContinuousMessages,i=t.hasNext,n.length>0?(a=Math.max.apply(Math,A([],w(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(a),r&&(null===(s=this._backgroundSync)||void 0===s||s.range.extends(a)),[2,{hasNext:i,nextToken:this._syncRange.bottom}]):(p.localCacheEnabled&&h.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(l=null===(o=p.localCacheConfig)||void 0===o?void 0:o.maxSize)&&void 0!==l?l:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}}))}))}))];case 1:return[2,n.sent()]}}))}))})),this._connectionEventContext=_.on((function(e){if(e instanceof ra)switch(e.stateType){case Zi.CONNECTED:Xi((function(){return N(d,0,void 0,(function(){return S(this,(function(e){return this._activate(),[2]}))}))}));break;case Zi.LOGOUT:d.dispose();break;default:d._clearCheckMyMutedTimer(),d._prevFill.stop(),d._nextFill.stop()}}))}return e.prototype.keyOf=function(e){return 0},Object.defineProperty(e.prototype,"changelogIncludeParams",{get:function(){return{includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0}},enumerable:!1,configurable:!0}),e.prototype._postprocessChannelUpdateEvent=function(e,t){},e.prototype._postprocessChannelRemoveEvent=function(e){},e.prototype._postprocessMessageUpdateEvent=function(e,t){},e.prototype._postprocessMessageRemoveEvent=function(e){},Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return A([],w(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===pe.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===pe.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,A(A([],w(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,A(A([],w(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype._activate=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return As.of(this._iid).logger.debug("check huge gap"),this._checkHugeGap(),[4,this._refreshChannel(bs.SYNC_CHANNEL_CHANGELOGS)];case 1:return e.sent(),[2]}}))}))},e.prototype._replaceChannelOfCollection=function(e){this._channel.isGroupChannel()?this._channel=e:this._channel.isFeedChannel()&&(this._channel._groupChannel=e._groupChannel)},e.prototype._shouldStartBackgroundSync=function(){var e=As.of(this._iid).cacheContext;return this.channel.isGroupChannel()?e.localCacheEnabled&&!this.channel.isSuper:e.localCacheEnabled},e.prototype._setBaseMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n instanceof el&&n.parentMessageId===e.messageId&&n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updatePollsToView=function(e,t){var n,r,i=this,a=[];try{for(var s=I(e),o=s.next();!o.done;o=s.next()){var l=o.value,u=Pp(this._messages,l.messageId);if(u>=0){var c=this._messages[u];c.isUserMessage()&&c.applyPoll(l),a.push(c)}}}catch(d){n={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a.length>0&&Os(t)&&Qi((function(){return N(i,0,void 0,(function(){var e,n,r;return S(this,(function(i){return e={source:t},a.length>0&&(null===(r=(n=this._handler).onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,a)),[2]}))}))})),a},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=Pp(this._messages,e.messageId);if(r>=0){var i=this._messages[r];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollUpdateEvent(e)&&Os(t)&&Qi((function(){return N(n,0,void 0,(function(){var e,n,r;return S(this,(function(a){return e={source:t},null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[i]),[2]}))}))}))}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=Pp(this._messages,e.messageId);if(r>=0){var i=this._messages[r];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollVoteEvent(e)&&Os(t)&&Qi((function(){return N(n,0,void 0,(function(){var e,n,r;return S(this,(function(a){return e={source:t},null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[i]),[2]}))}))}))}},e.prototype._applyReactionEventToView=function(e,t){var n=this,r=Pp(this._messages,e.messageId);if(r>=0){var i=this._messages[r];i&&(i.isUserMessage()||i.isFileMessage()||i.isMultipleFilesMessage())&&Os(t)&&(i.applyReactionEvent(e),Qi((function(){return N(n,0,void 0,(function(){var e,n,r;return S(this,(function(a){return e={source:t},null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[i]),[2]}))}))})))}},e.prototype._applyThreadInfoEventToView=function(e,t){var n=this,r=Pp(this._messages,e.targetMessageId);if(r>=0){var i=this._messages[r];i&&(i.isUserMessage()||i.isFileMessage()||i.isMultipleFilesMessage())&&Os(t)&&(i.applyThreadInfoUpdateEvent(e),Qi((function(){return N(n,0,void 0,(function(){var e,n,r;return S(this,(function(a){return e={source:t},null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[i]),[2]}))}))})))}},e.prototype._removeMessagesFromView=function(e,t){var n,r,i=this,a=[],s=[],o=function(e){var t=l._messages.findIndex((function(t){return i.keyOf(t)===e}));if(t>=0){var n=l._messages[t];a.push(l.keyOf(n)),s.push(n),l._messages.splice(t,1)}},l=this;try{for(var u=I(e),c=u.next();!c.done;c=u.next())o(c.value)}catch(d){n={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return Os(t)&&s.length>0&&Qi((function(){return N(i,0,void 0,(function(){var e,n,r;return S(this,(function(i){return e={source:t},null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesDeleted)||void 0===r||r.call(n,e,this.channel,a,s),[2]}))}))})),a},e.prototype._messageRetention=function(e,t){var n,r,i=[];try{for(var a=I(this._messages),s=a.next();!s.done;s=a.next()){var o=s.value;o.createdAt<=e&&i.push(this.keyOf(o))}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}i.length>0&&this._removeMessagesFromView(i,t)},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,i=t.nextLimit,a=void 0===i?0:i,s=t.inclusive,o=void 0===s||s;return N(this,0,void 0,(function(){var t,n,i,s,l;return S(this,(function(u){switch(u.label){case 0:return t=[],o?[4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,e,this.filter)]:[3,2];case 1:t=u.sent(),u.label=2;case 2:return r>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"prev",this.filter,r,!1)]:[3,4];case 3:return i=u.sent(),[3,5];case 4:i=[],u.label=5;case 5:return n=i,a>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"next",this.filter,a,!1)]:[3,7];case 6:return l=u.sent(),[3,8];case 7:l=[],u.label=8;case 8:return s=l,[2,{messages:A(A(A([],w(t),!1),w(n),!1),w(s),!1).sort((function(e,t){return t.createdAt-e.createdAt})),prevMessagesCount:n.length,nextMessagesCount:s.length}]}}))}))},e.prototype._getRemoteMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,i=t.nextLimit,a=void 0===i?0:i,s=t.source,o=void 0===s?bs.REQUEST_MESSAGE:s,l=t.reverse,u=void 0!==l&&l,c=t.checkingHasNext,d=void 0!==c&&c,h=t.checkingContinuousMessages,f=void 0!==h&&h,p=t.sdkSource;return N(this,0,void 0,(function(){var t,n;return S(this,(function(i){switch(i.label){case 0:return t=Sh.of(this._iid),r>0||a>0?[4,t._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,e,Se(T(T(T({},this.filter),Yp),{isInclusive:!0,reverse:u,prevResultSize:r,nextResultSize:a})),o,d,f,p)]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n={messages:[],isContinuousMessages:!1},i.label=3;case 3:return[2,n]}}))}))},e.prototype._checkHugeGap=function(){var e,t,n,r,i;return N(this,0,void 0,(function(){var a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,I,O,R,D,k,L,x,U=this;return S(this,(function(P){switch(P.label){case 0:return a=As.of(this._iid),s=a.dispatcher,o=a.requestQueue,l=a.cacheContext,u=a.statManager,c=a.logger,this._messages.length>0?(d=this._syncRange.top,h=this.viewTop,f=this._syncRange.bottom,p=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,h,d)]):[3,8];case 1:return _=P.sent(),[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,f,p)];case 2:m=P.sent(),P.label=3;case 3:return P.trys.push([3,5,6,7]),[4,Ha((function(){return N(U,0,void 0,(function(){var e,t,n,r,i,a,u,c,v,g,E,b,y,C,I,M,O,R=this;return S(this,(function(D){switch(D.label){case 0:return e=new zp(T(T({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:h,prevEnd:d,prevCount:_,nextStart:f,nextEnd:p,nextCount:m,checkingContinuousMessages:l.localCacheEnabled},this.filter),Yp)),[4,o.send(e)];case 1:return t=D.sent(),n=t.as(Kp),r=n.isHugeGap,i=n.prevMessages,a=void 0===i?[]:i,u=n.prevHasMore,c=n.isContinuousPrevMessages,v=n.nextMessages,g=void 0===v?[]:v,E=n.nextHasmore,b=n.isContinuousNextMessages,r?Qi((function(){return N(R,0,void 0,(function(){var e;return S(this,(function(t){return(null===(e=this._handler)||void 0===e?void 0:e.onHugeGapDetected)&&this._handler.onHugeGapDetected(),[2]}))}))})):(y=this.viewTop,C=this.viewBottom,I=Math.min.apply(Math,A([Number.MAX_SAFE_INTEGER,y],w(a.map((function(e){return e.createdAt}))),!1)),M=Math.max.apply(Math,A([0,C],w(g.map((function(e){return e.createdAt}))),!1)),s.dispatch(new Rs({messages:a,source:bs.SYNC_MESSAGE_FILL})),s.dispatch(new Rs({messages:g,source:bs.SYNC_MESSAGE_FILL})),this._syncRange.extends(I,M),(c||b)&&(null===(O=this._backgroundSync)||void 0===O||O.range.extends(I,M)),u&&this._prevFill.start(I),E&&this._nextFill.start(M)),[2]}}))}))}),1)];case 4:return P.sent(),[3,7];case 5:return v=P.sent(),c.debug("Failed HugeGap Check ",v),[3,7];case 6:return l.localCacheEnabled&&u.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(t=null===(e=l.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:l.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[3,13];case 8:g=Date.now(),P.label=9;case 9:return P.trys.push([9,11,12,13]),[4,this._getRemoteMessages(g,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,source:bs.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:l.localCacheEnabled,sdkSource:yl.INTERNAL_FILL_GAP})];case 10:if(E=P.sent(),b=E.messages,y=E.isContinuousMessages,C=E.hasNext,b.length>0){for(I=b.map((function(e){return e.createdAt})),O=0,R=0,D=0;D<I.length;D++)(k=I[D])<=g?O++:k>=g&&R++;this._hasPrevious=O>=this._prevResultLimit,this._hasNext=null!=C?C:R>=this._nextResultLimit,(x=this._syncRange).extends.apply(x,A([],w(I),!1)),y&&(null===(n=this._backgroundSync)||void 0===n||n.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(b,bs.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;return[3,13];case 11:return(L=P.sent())instanceof H&&L.code===M.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1),[3,13];case 12:return l.localCacheEnabled&&u.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:null!==(i=null===(r=l.localCacheConfig)||void 0===r?void 0:r.maxSize)&&void 0!==i?i:0,use_local_cache:l.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 13:return[2]}}))}))},e.prototype._loadUnsentMessages=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return e=this,[4,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return e._unsentMessages=t.sent(),[2]}}))}))},e.prototype._hasPollMessage=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},e.prototype._refreshChannel=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r,i=this;return S(this,(function(a){switch(a.label){case 0:n=As.of(this._iid).logger,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._channelManager.refreshChannel(this.channel.url,!0,e,t)];case 2:return a.sent(),this.channel._runIfHandleableWithGroupChannel((function(e){e.myMutedState===oe.MUTED&&Xi((function(){return N(i,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))}))})),[3,4];case 3:return r=a.sent(),n.warn("Failed to refresh channel",r),[3,4];case 4:return[2]}}))}))},e.prototype._startCheckMyMutedTimer=function(e){var t=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout((function(){return N(t,0,void 0,(function(){var e,t,n,r=this;return S(this,(function(i){switch(i.label){case 0:this._checkMyMutedStateTimer=void 0,e=!0,i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this._channel.getMyMutedInfo()];case 2:return t=i.sent(),e=!t.isMuted,[3,5];case 3:return i.sent(),e=!0,[3,5];case 4:return e&&(n=As.of(this._iid).sessionManager,this.channel._runIfHandleableWithGroupChannel((function(e){var t,i;e.myMutedState=oe.UNMUTED;var a={source:bs.EVENT_CHANNEL_UNMUTED,user:n.currentUser};null===(i=null===(t=r._handler)||void 0===t?void 0:t.onChannelUpdated)||void 0===i||i.call(t,a,r.channel)}))),[7];case 5:return[2]}}))}))}),e+1e3)},e.prototype._clearCheckMyMutedTimer=function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)},e.prototype._setHasNextAndHasPrevious=function(e,t){for(var n=e.map((function(e){return e.createdAt})),r=0,i=0,a=0;a<n.length;a++){var s=n[a];s<this._startingPoint?r++:s>this._startingPoint&&i++}this._hasPrevious=r>=this._prevResultLimit,this._hasNext=null!=t?t:i>=this._nextResultLimit},e.prototype.initialize=function(e){var t=this,n=new Zp;this._messages=[],this._unsentMessages=[],this._syncRange=new kp({}),this._hasNext=!0,this._hasPrevious=!0;var r=[],i={messages:[],prevMessagesCount:0,nextMessagesCount:0};return Qi((function(){return N(t,0,void 0,(function(){var t,a,s,o,l,u=this;return S(this,(function(c){switch(c.label){case 0:return[4,null===(l=this._backgroundSync)||void 0===l?void 0:l.loadMetadata()];case 1:return t=c.sent(),a=As.of(this._iid),s=a.cacheContext,o=a.statManager,e===Rp.CACHE_AND_REPLACE_BY_API&&this._getLocalMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit}).then((function(e){return N(u,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return i=e,r=this._filterUnderOffsetMessage(i.messages),this._addMessagesToView(r,bs.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return t.sent(),n._invokeResponse("local",null,r),[2]}}))}))})).catch((function(e){if(B(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){return N(u,0,void 0,(function(){var a,s,l,u,c,d,h,f=this;return S(this,(function(p){switch(p.label){case 0:return a=As.of(this._iid).cacheContext,s=!0,l=!0,u=!1,a.localCacheEnabled&&r.length>0&&(c=t.range).includes.apply(c,A([],w(r.map((function(e){return e.createdAt}))),!1))&&(!t.previousComplete&&i.prevMessagesCount<this._prevResultLimit?l=!0:this._startingPoint>t.range.bottom||i.nextMessagesCount<this._nextResultLimit?u=!0:l=!1),[4,this._refreshChannel(bs.REFRESH_CHANNEL,u)];case 1:return p.sent(),u&&this._channel._runIfHandleableWithGroupChannel((function(e){var t=Math.max.apply(Math,A([],w(r.map((function(e){return e.createdAt}))),!1));e._latestMessageInfo&&t>=e._latestMessageInfo.createdAt&&(l=!1)})),l?(s=!1,this._getRemoteMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:a.localCacheEnabled,sdkSource:yl.EXTERNAL_COLLECTION}).then((function(e){var t,r,i,a=e.messages,s=e.isContinuousMessages,o=e.hasNext,l=f._filterUnderOffsetMessage(a);f._messages=[],l.length>0?(f._setHasNextAndHasPrevious(l,o),(t=f._syncRange).extends.apply(t,A([],w(l.map((function(e){return e.createdAt}))),!1)),s&&(null===(r=f._backgroundSync)||void 0===r?void 0:r.range.overlap(f._syncRange))&&(null===(i=f._backgroundSync)||void 0===i||i.range.extends(f._syncRange.top,f._syncRange.bottom)),f._addMessagesToView(l,bs.REQUEST_MESSAGE)):(f._hasPrevious=!1,f._hasNext=!1),n._invokeResponse("remote",null,l)})).catch((function(e){if(B(e))throw e;n._invokeResponse("remote",e,null)}))):(this._setHasNextAndHasPrevious(r),n._invokeResponse("remote",null,r)),a.localCacheEnabled&&o.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"initial_load",event:s?"cache_hit":"cache_miss",max_db_size:null!==(h=null===(d=a.localCacheConfig)||void 0===d?void 0:d.maxSize)&&void 0!==h?h:0,message_init_policy:e,use_local_cache:a.localCacheEnabled,collection_id:this._key}})),[2]}}))}))})),o.put(new hs({type:et.FEATURE_LOCALCACHE,data:{use_local_cache:s.localCacheEnabled,collection_interface:{message_init_policy:e,message:!0}}})),[2]}}))}))})),n},e.prototype.loadPrevious=function(){var e,t,n;return N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d=this;return S(this,(function(h){switch(h.label){case 0:if(this._isDisposed)throw new H({code:M.COLLECTION_DISPOSED,message:"Collection has been disposed."});return r=As.of(this._iid),i=r.cacheContext,a=r.statManager,s=r.logger,this._hasPrevious?this._isLoadingPrevious?(s.warn("Messages are already fetching."),[2,[]]):(this._isLoadingPrevious=!0,o=this.viewTop,l=[],[4,Xi((function(){return N(d,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this._getLocalMessages(o,{prevLimit:this._prevResultLimit,inclusive:!1})];case 1:return e=t.sent(),l=this._filterUnderOffsetMessage(e.messages),[2]}}))}))}))]):[2,[]];case 1:return h.sent(),u=l.length>=this._prevResultLimit,i.localCacheEnabled&&a.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:u?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=i.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:i.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),u&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(l))?[3,3]:(c=!1,[4,Xi((function(){return N(d,0,void 0,(function(){var e,t,n,r,i,s,u,d=this;return S(this,(function(h){switch(h.label){case 0:return e=As.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{prevLimit:this._prevResultLimit,reverse:!0,checkingContinuousMessages:e.localCacheEnabled,sdkSource:yl.EXTERNAL_COLLECTION})];case 1:return t=h.sent(),(l=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,A([],w(l.map((function(e){return e.createdAt}))),!1)),(null===(r=this._backgroundSync)||void 0===r?void 0:r.range.overlap(this._syncRange))&&t.isContinuousMessages&&(c=!0,null===(i=this._backgroundSync)||void 0===i||i.range.extends(this._syncRange.top))),l=l.filter((function(e){return Up(d._messages,e)<0})),this._hasPrevious=l.length>=this._prevResultLimit,c&&a.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:"cache_fetch",max_db_size:null!==(u=null===(s=e.localCacheConfig)||void 0===s?void 0:s.maxSize)&&void 0!==u?u:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return h.sent(),this._addMessagesToView(l,bs.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=l.length>=this._prevResultLimit,l.length>0&&this._addMessagesToView(l,bs.REQUEST_MESSAGE),h.label=4;case 4:return this._isLoadingPrevious=!1,[2,l]}}))}))},e.prototype.loadNext=function(){var e,t,n;return N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d=this;return S(this,(function(h){switch(h.label){case 0:if(this._isDisposed)throw new H({code:M.COLLECTION_DISPOSED,message:"Collection has been disposed."});return r=As.of(this._iid),i=r.cacheContext,a=r.statManager,s=r.logger,this._hasNext?this._isLoadingNext?(s.warn("Messages are already fetching."),[2,[]]):(this._isLoadingNext=!0,o=this.viewBottom,l=[],[4,Xi((function(){return N(d,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this._getLocalMessages(o,{nextLimit:this._nextResultLimit,inclusive:!1})];case 1:return e=t.sent(),l=this._filterUnderOffsetMessage(e.messages),[2]}}))}))}))]):[2,[]];case 1:return h.sent(),u=l.length>=this._nextResultLimit,i.localCacheEnabled&&a.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:u?"cache_hit":"cache_miss",max_db_size:null!==(t=null===(e=i.localCacheConfig)||void 0===e?void 0:e.maxSize)&&void 0!==t?t:0,use_local_cache:i.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),u&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(l))?[3,3]:(c=!1,[4,Xi((function(){return N(d,0,void 0,(function(){var e,t,n,r,i,s,u,d,h=this;return S(this,(function(f){switch(f.label){case 0:return e=As.of(this._iid).cacheContext,[4,this._getRemoteMessages(o,{nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:e.localCacheEnabled,sdkSource:yl.EXTERNAL_COLLECTION})];case 1:return t=f.sent(),(l=this._filterUnderOffsetMessage(t.messages)).length>0&&((n=this._syncRange).extends.apply(n,A([],w(l.map((function(e){return e.createdAt}))),!1)),(null===(r=this._backgroundSync)||void 0===r?void 0:r.range.overlap(this._syncRange))&&t.isContinuousMessages&&(c=!0,null===(i=this._backgroundSync)||void 0===i||i.range.extends(this._syncRange.bottom))),l=l.filter((function(e){return Up(h._messages,e)<0})),this._hasNext=null!==(s=t.hasNext)&&void 0!==s?s:l.length>=this._nextResultLimit,c&&a.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:"cache_fetch",max_db_size:null!==(d=null===(u=e.localCacheConfig)||void 0===u?void 0:u.maxSize)&&void 0!==d?d:0,use_local_cache:e.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}}))}))}))]);case 2:return h.sent(),this._addMessagesToView(l,bs.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=l.length>=this._nextResultLimit,l.length>0&&this._addMessagesToView(l,bs.REQUEST_MESSAGE),h.label=4;case 4:return this._isLoadingNext=!1,[2,l]}}))}))},e.prototype.removeFailedMessage=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:if(this._isDisposed)throw new H({code:M.COLLECTION_DISPOSED,message:"Collection has been disposed."});return[4,this._channelManager.removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e,t,n,r=this;if(!this._isDisposed){this._isDisposed=!0;var i=As.of(this._iid),a=i.cacheContext,s=i.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._runIfHandleableWithGroupChannel((function(e){e.myMemberState!==tf.NONE&&(r._channel._updateMessageCollectionLastAccessedAt(),s.dispatch(new Bf({channels:[r._channel],context:{source:bs.CHANNEL_LASTACCESSEDAT_UPDATED}})))})),a.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}},e}(),$p=function(e){function t(t,n){return e.call(this,t,T(T({},n),{channelManager:xp.of(t)}))||this}return C(t,e),t.prototype.keyOf=function(e){return e.messageId},t.prototype.initialize=function(t){return e.prototype.initialize.call(this,t)},t.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},t.prototype._addMessagesToView=function(e,t){var n,r,i=this,a=this._filterUnderOffsetMessage(e),s=[],o=[];try{for(var l=I(a),u=l.next();!u.done;u=l.next()){var c=u.value;if(t===bs.SYNC_MESSAGE_FILL)if(c.messageId>0){if((p=Up(this._messages,c))<0){Up(this._unsentMessages,c)<0&&s.push(c);var d=Fp(this._messages,c);this._messages.splice(d,0,c)}}else c instanceof tl&&(p=Up(this._unsentMessages,c))<0&&Up(this._messages,c)<0&&(this._unsentMessages.push(c),s.push(c));else if(c.messageId>0){if((p=Up(this._messages,c))<0){var h=Up(this._unsentMessages,c);h<0?s.push(c):(this._unsentMessages.splice(h,1),o.push(c)),d=Fp(this._messages,c),this._messages.splice(d,0,c)}else o.push(c),this._messages[p]=c;if(c.updatedAt>0){var f=this._updateChildMessagesInView(c);o.push.apply(o,A([],w(f),!1))}}else if(c instanceof tl){var p;(p=Up(this._unsentMessages,c))<0?Up(this._messages,c)<0&&(this._unsentMessages.push(c),s.push(c)):(o.push(c),this._unsentMessages[p]=c)}}}catch(_){n={error:_}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}Os(t)&&Qi((function(){return N(i,0,void 0,(function(){var e,n,r,i,a;return S(this,(function(l){return e={source:t},s.length>0&&(null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesAdded)||void 0===r||r.call(n,e,this.channel,s)),o.length>0&&(null===(a=null===(i=this._handler)||void 0===i?void 0:i.onMessagesUpdated)||void 0===a||a.call(i,e,this.channel,o)),[2]}))}))}))},t.prototype._updateMessagesToView=function(e,t){var n,r,i=this,a=[],s=[],o=[];try{for(var l=I(e),u=l.next();!u.done;u=l.next()){var c,d=u.value;if(d.messageId>0)if((c=Up(this._messages,d))>=0)s.push(d),this._messages[c]=d;else{var h=Up(this._unsentMessages,d);if(h>=0){var f=w(this._unsentMessages.splice(h,1),1)[0];if(this.hasNext&&f)o.push(f);else{s.push(d);var p=Fp(this._messages,d);this._messages.splice(p,0,d)}}else{var _=this._messages.map((function(e){return e.createdAt}));(d.createdAt<Math.min.apply(Math,A([],w(_),!1))&&!this._hasPrevious||d.createdAt>Math.max.apply(Math,A([],w(_),!1))&&!this._hasNext)&&a.push(d)}}else d instanceof tl&&(c=Up(this._unsentMessages,d))>=0&&(s.push(d),this._unsentMessages[c]=d)}}catch(m){n={error:m}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return Os(t)&&Qi((function(){return N(i,0,void 0,(function(){var e,n,r,i,l;return S(this,(function(u){return e={source:t},s.length>0?null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,s):o.length>0?null===(l=null===(i=this._handler)||void 0===i?void 0:i.onMessagesDeleted)||void 0===l||l.call(i,e,this.channel,[],o):a.length>0&&this._addMessagesToView(a,t),[2]}))}))})),s},t}(Jp),e_={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},t_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.token,a=t.limit,s=t.order,o=t.mutedMemberFilter,l=t.memberStateFilter,u=t.nicknameStartsWithFilter,c=t.operatorFilter;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/members"),n.params={token:i,limit:a,order:s,muted_member_filter:o,member_state_filter:l,nickname_startswith:u,operator_filter:c,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return C(t,e),t}(tt),n_=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.members=[];var i=n.next,a=n.members;return r.token=i,a&&a.length>0&&(r.members=a.map((function(e){return new Cf(t,e)}))),r}return C(t,e),t}(nt);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Wp||(Wp={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Qp||(Qp={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Xp||(Xp={}));var r_=function(e){function t(t,n,r){var i,a,s,o,l=this;return(l=e.call(this,t,n,ae.GROUP,r)||this).mutedMemberFilter=Wp.ALL,l.memberStateFilter=Xp.ALL,l.nicknameStartsWithFilter=null,l.operatorFilter=Ef.ALL,l.order=Qp.MEMBER_NICKNAME_ALPHABETICAL,l.mutedMemberFilter=null!==(i=r.mutedMemberFilter)&&void 0!==i?i:Wp.ALL,l.memberStateFilter=null!==(a=r.memberStateFilter)&&void 0!==a?a:Xp.ALL,l.nicknameStartsWithFilter=null!==(s=r.nicknameStartsWithFilter)&&void 0!==s?s:null,l.order=null!==(o=r.order)&&void 0!==o?o:Qp.MEMBER_NICKNAME_ALPHABETICAL,l}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&z(Wp,this.mutedMemberFilter)&&z(Xp,this.memberStateFilter)&&(q("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&z(Ef,this.operatorFilter)&&z(Qp,this.order)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new t_(Se(T(T({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(n_),i=r.members,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),i_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.accessCode;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:i,access_code:a},n}return C(t,e),t}(tt),a_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r.channel.myMemberState=tf.JOINED,r}return C(t,e),t}(nt),s_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.isDistinct,a=t.isPublic,s=t.isDiscoverable,o=t.coverUrl,l=t.coverImage,u=t.accessCode,c=t.name,d=t.data,h=t.customType,f=t.operatorUserIds,p=t.messageSurvivalSeconds;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r)),n.params=Ne({is_distinct:i,is_public:a,is_discoverable:s,name:c,data:d,custom_type:h,cover_url:o,cover_file:l,access_code:u,operator_ids:f,message_survival_seconds:p}),n}return C(t,e),t}(tt),o_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new O_(t,n),r}return C(t,e),t}(nt),l_=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Re,"/").concat(encodeURIComponent(r)),n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var u_=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/hide"),n}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var c_=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.countPreference,a=e.call(this)||this;return a.method=Ie.PUT,a.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),a.params={count_preference:i},a}return C(t,e),t}(tt),d_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.countPreference=n.count_preference,r}return C(t,e),t}(nt),h_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.locale;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(Re,"/").concat(encodeURIComponent(r),"/reset_user_history"),n.params=Ne({locale:i}),n}return C(t,e),t}(tt),f_=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.ts_message_offset;return r.messageOffsetTimestamp=i,r}return C(t,e),t}(nt),p_=T(T({},nu),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),__=T(T({},iu),{scheduledAt:void 0}),m_=function(e){function t(t){var n,r,i=this;i=e.call(this)||this;var a=[];t.mentionType===de.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map((function(e){return e.userId}))));var s=t.channelType,o=t.channelUrl,l=t.scheduledMessageId;return i.method=Ie.PUT,i.path="".concat(Qe(s),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(l)),i.params=Ne(Se({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:ce.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:null===(n=t._thumbnails)||void 0===n?void 0:n.map((function(e){return go.payloadify(e)})),custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(r=t.metaArrays)||void 0===r?void 0:r.map((function(e){return Ro.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,push_option:t.pushNotificationDeliveryOption})),i}return C(t,e),t}(tt),v_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new fl(t,n),r}return C(t,e),t}(nt),g_=function(e){function t(t){var n,r=this;r=e.call(this)||this;var i=[];t.mentionType===de.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId}))));var a=t.channelType,s=t.channelUrl,o=t.scheduledMessageId;return r.method=Ie.PUT,r.path="".concat(Qe(a),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(o)),r.params=Ne(Se({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:ce.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return Ro.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ao.payloadify(t.appleCriticalAlertOptions):null,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption})),r}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.message=new ol(t,n),r}),e)}(nt);var E_,b_,y_=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,a=t.scheduledMessageId;return n.method=Ie.DELETE,n.path="".concat(Qe(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(a)),n}return C(t,e),t}(tt),C_=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,a=t.scheduledMessageId;return n.method=Ie.POST,n.path="".concat(Qe(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(a),"/send_now"),n}return C(t,e),t}(tt),T_=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.pushTriggerOption,a=e.call(this)||this;return a.method=Ie.PUT,a.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),a.params={push_trigger_option:i},a}return C(t,e),t}(tt),N_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return C(t,e),t}(nt),S_=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=e.call(this)||this;return i.method=Ie.GET,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),i}return C(t,e),t}(tt),I_=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return C(t,e),t}(nt),w_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.channelType;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(Qe(i),"/").concat(encodeURIComponent(r),"/message_purge_offset"),n}return C(t,e),t}(tt),A_=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.message_purge_offset;return r.messageDeletionTimestamp=i,r}return C(t,e),t}(nt);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(E_||(E_={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(b_||(b_={}));var M_,O_=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,N,S=this;return(S=e.call(this,t,n)||this)._unreadMemberStateMap=new Map,S._undeliveredMemberStateMap=new Map,S._typingStatus=new Map,S._lastMemberCountUpdated=0,S._typingStarted=0,S._typingEnded=0,S._hasBotInfo={general:!1,ai:!1},S.isDistinct=!1,S.isSuper=!1,S.isBroadcast=!1,S.isExclusive=!1,S.isPublic=!1,S.isDiscoverable=!0,S.isChatNotification=!1,S.isAccessCodeRequired=!1,S.isPushEnabled=!1,S.unreadMessageCount=0,S.unreadMentionCount=0,S.totalUnreadReplyCount=0,S.members=[],S.memberCount=0,S.joinedMemberCount=0,S.hiddenState=b_.UNHIDDEN,S.lastMessage=null,S.messageOffsetTimestamp=0,S.messageSurvivalSeconds=-1,S.myMemberState=tf.NONE,S.myRole=se.NONE,S.myMutedState=oe.UNMUTED,S.myLastRead=0,S.myCountPreference=E_.ALL,S.myPushTriggerOption=L.DEFAULT,S.inviter=null,S.invitedAt=0,S.joinedAt=0,S.lastPinnedMessage=null,S._latestMessageInfo=null,S._pinnedMessagesUpdatedAt=0,S._myMutedRemainingTime=-1,S._messageDeletionTimestamp=0,S.channelType=ae.GROUP,S.isDistinct=null!==(i=n.is_distinct)&&void 0!==i&&i,S.isSuper=null!==(a=n.is_super)&&void 0!==a&&a,S.isBroadcast=null!==(s=n.is_broadcast)&&void 0!==s&&s,S.isExclusive=null!==(o=n.is_exclusive)&&void 0!==o&&o,S.isPublic=null!==(l=n.is_public)&&void 0!==l&&l,S.isDiscoverable=null!==(u=n.is_discoverable)&&void 0!==u?u:S.isPublic,S.isChatNotification=null!==(c=n.is_chat_notification)&&void 0!==c&&c,S.isAccessCodeRequired=null!==(d=n.is_access_code_required)&&void 0!==d&&d,S.isPushEnabled=null!==(h=n.is_push_enabled)&&void 0!==h&&h,Array.isArray(n.members)&&(r=S.members).push.apply(r,A([],w(n.members.map((function(e){return new Cf(S._iid,e)}))),!1)),S.memberCount=null!==(f=n.member_count)&&void 0!==f?f:0,S.joinedMemberCount=null!==(p=n.joined_member_count)&&void 0!==p?p:0,S.hiddenState=z(b_,n.hidden_state)?n.hidden_state:b_.UNHIDDEN,S.messageOffsetTimestamp=null!==(_=n.ts_message_offset)&&void 0!==_?_:0,S.messageSurvivalSeconds=null!==(m=n.message_survival_seconds)&&void 0!==m?m:-1,S.lastMessage=n.last_message?hl(S._iid,T({channel_type:S.channelType},n.last_message)):null,n.read_receipt&&Object.keys(n.read_receipt).forEach((function(e){q("number",n.read_receipt[e])&&S._updateUnreadMemberState(e,n.read_receipt[e])})),n.delivery_receipt&&Object.keys(n.delivery_receipt).forEach((function(e){q("number",n.delivery_receipt[e])&&S._updateUndeliveredMemberState(e,n.delivery_receipt[e])})),S.myMemberState=z(tf,n.member_state)?n.member_state:tf.NONE,S.myRole=z(se,n.my_role)?n.my_role:se.NONE,z(oe,n.is_muted)?S.myMutedState=n.is_muted:q("boolean",n.is_muted)?S.myMutedState=n.is_muted?oe.MUTED:oe.UNMUTED:S.myMutedState=oe.UNMUTED,S.myCountPreference=z(E_,n.count_preference)?n.count_preference:E_.ALL,S.myPushTriggerOption=z(L,n.push_trigger_option)?n.push_trigger_option:L.ALL,S.myLastRead=null!==(v=n.user_last_read)&&void 0!==v?v:0,S.inviter=n.inviter?new Aa(S._iid,n.inviter):null,S.invitedAt=null!==(g=n.invited_at)&&void 0!==g?g:0,S.joinedAt=null!==(E=n.joined_ts)&&void 0!==E?E:0,S._updateUnreadCount(null!==(b=n.unread_message_count)&&void 0!==b?b:0,null!==(y=n.unread_mention_count)&&void 0!==y?y:0),S.totalUnreadReplyCount=null!==(C=n.total_unread_thread_message_count)&&void 0!==C?C:0,S.lastPinnedMessage=n.latest_pinned_message?hl(S._iid,T({channel_type:S.channelType},n.latest_pinned_message)):null,n.latest_message&&(S._latestMessageInfo={messageId:n.latest_message.message_id,createdAt:n.latest_message.created_at}),S._hasBotInfo={general:!!n.has_bot,ai:!!n.has_ai_bot},S._messageDeletionTimestamp=null!==(N=n.message_purge_offset)&&void 0!==N?N:0,S}return C(t,e),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.hiddenState!==b_.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=I(this._unreadMemberStateMap),i=r.next();!i.done;i=r.next()){var a=w(i.value,2),s=a[0],o=a[1];n[s]=o}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=I(this._undeliveredMemberStateMap),i=r.next();!i.done;i=r.next()){var a=w(i.value,2),s=a[0],o=a[1];n[s]=o}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasBot",{get:function(){return this._hasBotInfo.general},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasAiBot",{get:function(){return this._hasBotInfo.ai},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageDeletionTimestamp",{get:function(){return this._messageDeletionTimestamp},enumerable:!1,configurable:!0}),t.payloadify=function(t){return Ne(Se(T(T({},e.payloadify.call(this,t)),{is_access_code_required:t.isAccessCodeRequired,is_distinct:t.isDistinct,is_super:t.isSuper,is_broadcast:t.isBroadcast,is_exclusive:t.isExclusive,is_public:t.isPublic,is_discoverable:t.isDiscoverable,is_muted:t.myMutedState,is_push_enabled:t.isPushEnabled,unread_message_count:t.unreadMessageCount,unread_mention_count:t.unreadMentionCount,total_unread_thread_message_count:t.totalUnreadReplyCount,push_trigger_option:t.myPushTriggerOption,count_preference:t.myCountPreference,hidden_state:t.hiddenState,member_count:t.memberCount,joined_member_count:t.joinedMemberCount,member_state:t.myMemberState,my_role:t.myRole,user_last_read:t.myLastRead,ts_message_offset:t.messageOffsetTimestamp,message_survival_seconds:t.messageSurvivalSeconds,read_receipt:t.cachedUnreadMemberState,delivery_receipt:t.cachedUndeliveredMemberState,members:t.members.map((function(e){return Cf.payloadify(e)})),last_message:t.lastMessage?dl(t.lastMessage):null,inviter:t.inviter?Aa.payloadify(t.inviter):null,invited_at:t.invitedAt,joined_ts:t.joinedAt,latest_pinned_message:t.lastPinnedMessage?dl(t.lastPinnedMessage):null,latest_message:t._latestMessageInfo?{message_id:t._latestMessageInfo.messageId,created_at:t._latestMessageInfo.createdAt}:null,has_bot:t.hasBot,has_ai_bot:t.hasAiBot,message_purge_offset:t.messageDeletionTimestamp})))},t.prototype._shouldUpdateLastMessageWith=function(e){if(e.silent)return!1;var t=As.of(this._iid).appInfo;switch(null==t?void 0:t.lastMessageThreadingPolicy){case na.NONE:case na.INCLUDE_REPLY:break;case na.EXCLUDE_REPLY:if(e.parentMessageId>0)return!1;break;case na.INCLUDE_REPLY_TO_CHANNEL:if(e instanceof tl&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt},t.prototype._tryUpdateLastMessageAndCallEvents=function(e,t){var n=As.of(this._iid).dispatcher,r=xp.of(this._iid);this._updateLastMessage(t),r.handlers.map((function(t){t.onChannelChanged&&t.onChannelChanged(e)})),n.dispatch(new Bf({channels:[e],context:{source:bs.EVENT_MESSAGE_SENT}}))},t.prototype._shouldUpdateUnreadCountWith=function(e){var t=As.of(this._iid).appInfo;switch(null==t?void 0:t.unreadCountThreadingPolicy){case ta.NONE:case ta.INCLUDE_REPLY:break;case ta.EXCLUDE_REPLY:if(e.parentMessageId>0)return!1;break;case ta.INCLUDE_REPLY_TO_CHANNEL:if(e instanceof tl&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},t.prototype._updateLastMessage=function(e){return!!this._shouldUpdateLastMessageWith(e)&&(this.lastMessage=e,!0)},t.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===E_.ALL||this.myCountPreference===E_.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=As.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===E_.ALL||this.myCountPreference===E_.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},t.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),As.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},t.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)},t.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)},t.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},t.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},t.prototype.isReadMessage=function(e){var t=As.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return!!n&&n>=e.createdAt},t.prototype.serialize=function(){var e=this;return Na(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState,Object.assign(t,e._serializeCachedMetaData())}))},t.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new $p(this._iid,T(T({},e),{channel:this}))},t.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new r_(this._iid,this.url,e)},t.prototype.createThreadedParentMessageListQuery=function(e){return void 0===e&&(e={}),new Uh(this._iid,this.url,this.channelType,e)},t.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var r=this.members[n];r.state===tf.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},t.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof Cf?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1},t.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof tl&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=As.of(this._iid).sdkState,i=e.createdAt,a=0;try{for(var s=I(this.members),o=s.next();!o.done;o=s.next()){var l=o.value;r.userId!==l.userId&&l.state===tf.JOINED&&e.sender.userId!==l.userId&&(this.cachedUnreadMemberState[l.userId]||0)<i&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}return 0},t.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof tl&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=As.of(this._iid).sdkState,i=e.createdAt,a=0;try{for(var s=I(this.members),o=s.next();!o.done;o=s.next()){var l=o.value;r.userId!==l.userId&&l.state===tf.JOINED&&e.sender.userId!==l.userId&&(this.cachedUndeliveredMemberState[l.userId]||0)<i&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}return 0},t.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=As.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof tl?e.sender:null,a=[];return this.members.forEach((function(s){if(t||s.userId!==r.userId&&s.userId!==(null==i?void 0:i.userId)){var o=n._unreadMemberStateMap.get(s.userId);o&&o>=e.createdAt&&a.push(s)}})),a},t.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=As.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof tl?e.sender:null,a=[];return this.members.forEach((function(s){if(t||s.userId!==r.userId&&s.userId!==(null==i?void 0:i.userId)){var o=n._unreadMemberStateMap.get(s.userId);o&&o<e.createdAt&&a.push(s)}})),a},t.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=As.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(i){if(e||i.userId!==n.userId){var a=t._unreadMemberStateMap.get(i.userId);r[i.userId]=new Lo(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Cf.payloadify(i),ts:null!=a?a:0})}})),r},t.prototype.getDeliveryStatus=function(e){var t=this;void 0===e&&(e=!0);var n=As.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(i){if(e||i.userId!==n.userId){var a=t._undeliveredMemberStateMap.get(i.userId);r[i.userId]=new Tf(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Cf.payloadify(i),ts:null!=a?a:0})}})),r},t.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e},t.prototype.invalidateTypingStatus=function(){var e=this,t=As.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach((function(i,a){var s=i.ts;n-s>=t&&(e._typingStatus.delete(a),r=!0)})),r},t.prototype.refresh=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return[2,this._refresh()]}))}))},t.prototype._refresh=function(e){return void 0===e&&(e=!1),N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return t=As.of(this._iid),n=t.requestQueue,r=t.dispatcher,i=new zf({channelUrl:this.url}),[4,n.send(i)];case 1:return a=o.sent(),s=a.as(Kf).channel,this._update(s),e||r.dispatch(new Bf({channels:[s],context:{source:bs.REFRESH_CHANNEL}})),[2,this]}}))}))},t.prototype.freeze=function(){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.prototype.freeze.call(this)];case 1:return t.sent(),As.of(this._iid).dispatcher.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_FROZEN},isWebSocketEventComing:!0})),[2]}}))}))},t.prototype.unfreeze=function(){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.prototype.unfreeze.call(this)];case 1:return t.sent(),As.of(this._iid).dispatcher.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_UNFROZEN},isWebSocketEventComing:!0})),[2]}}))}))},t.prototype.updateChannel=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return t=T(T({},e_),e),Ia((u=t,q("string",u.coverUrl,!0)&&(X(u.coverImage)||q("string",u.coverImage,!0))&&q("boolean",u.isDistinct,!0)&&q("boolean",u.isPublic,!0)&&q("boolean",u.isDiscoverable,!0)&&q("string",u.accessCode,!0)&&q("string",u.name,!0)&&q("string",u.data,!0)&&q("string",u.customType,!0)&&Y("string",u.operatorUserIds,!0)&&q("number",u.messageSurvivalSeconds,!0))).throw(H.invalidParameters),n=As.of(this._iid),r=n.dispatcher,i=n.requestQueue,a=new s_(T({channelUrl:this.url},t)),[4,i.send(a)];case 1:return s=l.sent(),o=s.as(o_).channel,this._update(o),r.dispatch(new Bf({channels:[o],context:{source:bs.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,this]}var u}))}))},t.prototype.invite=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(e.every((function(e){return e instanceof Aa}))).throw(H.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},t.prototype.inviteWithUserIds=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.dispatcher,r=t.requestQueue,i=t.sessionManager,a=new _p({channelUrl:this.url,userIds:e}),[4,r.send(a)];case 1:return s=l.sent(),o=s.as(mp).channel,this._update(o),n.dispatch(new Bf({channels:[o],context:{source:bs.EVENT_CHANNEL_INVITED,inviter:i.currentUser,invitees:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},t.prototype.join=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(q("string",e,!0)).throw(H.invalidParameters),t=As.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new cp({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return s=l.sent(),(o=s.as(dp).channel).myMemberState=this.myMemberState=tf.JOINED,this._update(o),n.dispatch(new Bf({channels:[o],context:{source:bs.EVENT_CHANNEL_JOINED,users:[]},isWebSocketEventComing:!0})),[2,this]}}))}))},t.prototype.leave=function(e){return void 0===e&&(e=!1),N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new fp({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(i)];case 1:return a.sent(),this.myMemberState=tf.NONE,[2]}}))}))},t.prototype.acceptInvitation=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(q("string",e,!0)).throw(H.invalidParameters),t=As.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new i_({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return s=l.sent(),(o=s.as(a_).channel).myMemberState=this.myMemberState=tf.JOINED,this._update(o),n.dispatch(new Bf({channels:[o],context:{source:bs.EVENT_CHANNEL_ACCEPTED_INVITE},isWebSocketEventComing:!0})),[2,this]}}))}))},t.prototype.declineInvitation=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new gp({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.myMemberState=tf.NONE,[2,this]}}))}))},t.prototype.sendUserMessage=function(t){var n=this,r=new Bl,i=As.of(this._iid).dispatcher,a=qh.of(this._iid);return e.prototype.sendUserMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(e){a.completeCurrentAndProcessNextAutoResend(e),n._updateLastMessage(e),xp.of(n._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),i.dispatch(new Bf({channels:[n],context:{source:bs.EVENT_MESSAGE_SENT}})),r._trigger(e)})),r},t.prototype.updateUserMessage=function(t,n){return N(this,0,void 0,(function(){var r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:return r=As.of(this._iid).dispatcher,[4,e.prototype.updateUserMessage.call(this,t,n)];case 1:return i=l.sent(),a=this._updateLastMessage(i),s=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===i.messageId&&(this.lastPinnedMessage=i,a=!0,s=!0),a&&(xp.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)})),r.dispatch(new Bf({channels:[this],context:{source:s?bs.EVENT_PINNED_MESSAGE_UPDATED:bs.EVENT_MESSAGE_UPDATED}}))),s&&xp.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(o)})),r.dispatch(new Rs({messages:[i],source:bs.EVENT_MESSAGE_UPDATED})),[2,i]}}))}))},t.prototype._autoResendUserMessage=function(t){var n=this,r=new Bl,i=As.of(this._iid).dispatcher,a=qh.of(this._iid);return e.prototype._autoResendUserMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(e){var t=xp.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n._updateLastMessage(e),t.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),i.dispatch(new Bf({channels:[n],context:{source:bs.EVENT_MESSAGE_SENT}})),r._trigger(e)})),r},t.prototype.sendFileMessage=function(t){var n=this,r=new Bl,i=As.of(this._iid).dispatcher,a=qh.of(this._iid);return e.prototype.sendFileMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(e){var t=xp.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n._updateLastMessage(e),t.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),i.dispatch(new Bf({channels:[n],context:{source:bs.EVENT_MESSAGE_SENT}})),r._trigger(e)})),r},t.prototype.sendMultipleFilesMessage=function(t){var n=this,r=new xc,i=As.of(this._iid).dispatcher;return e.prototype.sendMultipleFilesMessage.call(this,t).onPending((function(e){r._trigger(e)})).onFailed((function(e,t){r._triggerFailed(e,t)})).onSucceeded((function(e){var t=xp.of(n._iid);n._updateLastMessage(e),t.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),i.dispatch(new Bf({channels:[n],context:{source:bs.EVENT_MESSAGE_SENT}})),r._trigger(e)})).onFileUploaded((function(e,t,n,i){r._triggerOnFileUploaded(e,t,n,i)})),r},t.prototype.updateFileMessage=function(t,n){return N(this,0,void 0,(function(){var r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:return r=As.of(this._iid).dispatcher,[4,e.prototype.updateFileMessage.call(this,t,n)];case 1:return i=l.sent(),a=this._updateLastMessage(i),s=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===i.messageId&&(this.lastPinnedMessage=i,a=!0,s=!0),a&&(xp.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)})),r.dispatch(new Bf({channels:[this],context:{source:s?bs.EVENT_PINNED_MESSAGE_UPDATED:bs.EVENT_MESSAGE_UPDATED}}))),s&&xp.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(o)})),r.dispatch(new Rs({messages:[i],source:bs.EVENT_MESSAGE_UPDATED})),[2,i]}}))}))},t.prototype._autoResendFileMessage=function(t){var n=this,r=new Bl,i=As.of(this._iid).dispatcher,a=qh.of(this._iid);return e.prototype._autoResendFileMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(e){var t=xp.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n._updateLastMessage(e),t.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),i.dispatch(new Bf({channels:[n],context:{source:bs.EVENT_MESSAGE_SENT}})),r._trigger(e)})),r},t.prototype.deleteMessage=function(t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,e.prototype.deleteMessage.call(this,t)];case 1:return n.sent(),0===t.messageId&&t instanceof tl&&As.of(this._iid).dispatcher.dispatch(new Us({reqId:t.reqId,source:bs.EVENT_MESSAGE_DELETED})),[2]}}))}))},t.prototype.hide=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return t=T(T({},bp),e),Ia((c=t,q("boolean",c.hidePreviousMessages,!0)&&q("boolean",c.allowAutoUnhide,!0))).throw(H.invalidParameters),n=As.of(this._iid),r=n.dispatcher,i=n.sdkState,a=n.requestQueue,s=new yp(T({channelUrl:this.url,userId:i.userId},t)),[4,a.send(s)];case 1:return o=u.sent(),l=o.as(Cp).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?b_.HIDDEN_ALLOW_AUTO_UNHIDE:b_.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),l&&(this.messageOffsetTimestamp=l),r.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_HIDDEN},isWebSocketEventComing:!0})),[2,this]}var c}))}))},t.prototype.unhide=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new u_({channelUrl:this.url}),[4,n.send(r)];case 1:return i.sent(),this.hiddenState=b_.UNHIDDEN,t.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_UNHIDDEN},isWebSocketEventComing:!0})),[2,this]}}))}))},t.prototype.delete=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new l_({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},t.prototype.markAsRead=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.dispatcher,r=e.requestQueue,i=new xo({channelUrl:this.url}),[4,r.send(i)];case 1:return a=l.sent(),s=a.as(Uo).readStatus,this._updateUnreadMemberState(t.userId,s.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),xp.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)}))),n.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_READ}})),[2]}}))}))},t.prototype.markAsDelivered=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Op({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},t.prototype.startTyping=function(){return N(this,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return e=As.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n?(this._typingStarted=r,this._typingEnded=0,i=new Np({channelUrl:this.url,time:this._typingStarted}),[4,t.send(i)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},t.prototype.endTyping=function(){return N(this,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return e=As.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n?(this._typingStarted=0,this._typingEnded=r,i=new Ip({channelUrl:this.url,time:this._typingStarted}),[4,t.send(i)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))},t.prototype.createScheduledUserMessage=function(e){e=T(T({},oh),e),Ia(function(e){return Yl(e)&&q("number",e.scheduledAt,!0)}(e)).throw(H.invalidParameters);var t=new Bl;return this._createScheduledUserMessage(e,t),t},t.prototype.updateScheduledUserMessage=function(e,t){return N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return n=T(T({},__),t),Ia((s=n,au(s)&&q("number",s.scheduledAt,!0))).throw(H.invalidParameters),r=As.of(this._iid).requestQueue,i=new g_(T({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(i)];case 1:return[2,a.sent().as(_c).message]}var s}))}))},t.prototype.createScheduledFileMessage=function(e){var t=this;e=T(T({},lh),e),Ia(function(e){return Gl(e)&&q("number",e.scheduledAt)&&(X(e.file)||q("string",e.fileUrl))&&q("string",e.fileName,!0)&&q("string",e.mimeType,!0)&&q("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return q("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(H.invalidParameters);var n=Date.now(),r=this._generateRequestId(),i=new Bl;return Fa(2).then((function(){var a=t._createPendingScheduledFileMessage(e,r,n);Qi((function(){return N(t,0,void 0,(function(){return S(this,(function(e){return[2,i._trigger(a)]}))}))}))})),X(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,i,r,n)})):this._createScheduledFileMessage(e,i,r,n),i},t.prototype.updateScheduledFileMessage=function(e,t){return N(this,0,void 0,(function(){var n,r;return S(this,(function(i){switch(i.label){case 0:return n=T(T({},p_),t),Ia((a=n,ru(a)&&q("number",a.scheduledAt,!0)&&(X(a.file)||q("string",a.fileUrl))&&q("string",a.fileName,!0)&&q("string",a.mimeType,!0)&&q("number",a.fileSize,!0)&&(null===a.thumbnailSizes||void 0===a.thumbnailSizes||a.thumbnailSizes.every((function(e){return q("object",e)&&e.maxWidth>0&&e.maxHeight>0}))))).throw(H.invalidParameters),X(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r=new m_(T({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,As.of(this._iid).requestQueue.send(r)];case 3:return[2,i.sent().as(v_).message]}var a}))}))},t.prototype.cancelScheduledMessage=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=new y_({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,As.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},t.prototype.sendScheduledMessageNow=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=new C_({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,As.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},t.prototype.getMyPushTriggerOption=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new S_({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(I_).pushTriggerOption,this.myPushTriggerOption=a,[2,a]}}))}))},t.prototype.setMyPushTriggerOption=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(z(L,e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new T_({userId:r.userId,channelUrl:this.url,pushTriggerOption:e}),[4,i.send(a)];case 1:return s=l.sent(),o=s.as(N_).pushTriggerOption,this.myPushTriggerOption=o,n.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,o]}}))}))},t.prototype.setMyCountPreference=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return Ia(z(E_,e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new c_({channelUrl:this.url,userId:r.userId,countPreference:e}),[4,i.send(a)];case 1:return s=l.sent(),o=s.as(d_).countPreference,this.myCountPreference=o,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_UPDATED},isWebSocketEventComing:!0})),[2,o]}}))}))},t.prototype.resetMyHistory=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return e=As.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=e.sdkState,i=new h_({channelUrl:this.url,locale:r.localeForChatbot}),[4,n.send(i)];case 1:return a=o.sent(),s=a.as(f_).messageOffsetTimestamp,this.messageOffsetTimestamp=s,this.lastMessage&&this.lastMessage.createdAt<s&&(this.lastMessage=null),this._updateUnreadCount(0,0),this.totalUnreadReplyCount=0,t.dispatch(new Bf({channels:[this],context:{source:bs.EVENT_CHANNEL_RESET_HISTORY},isWebSocketEventComing:!0})),[2,this]}}))}))},t.prototype._uploadFileAndUpdateParams=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c;return S(this,(function(d){switch(d.label){case 0:return X(e.file)?(t=As.of(this._iid).requestQueue,n=new Eo({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:r=d.sent(),i=r.as(bo),a=i.url,s=i.fileSize,o=void 0===s?e.fileSize:s,l=i.thumbnails,u=i.requireAuth,c=void 0!==u&&u,e.fileUrl=a,e.fileSize=o,e.requireAuth=c,e._thumbnails=l,d.label=2;case 2:return[2]}}))}))},t.prototype.resendMessage=function(e,t){var n,r=this;if(Ia(e instanceof tl&&!e.scheduledInfo&&e.isResendable).throw(H.invalidParameters),e.isUserMessage()){var i=null!==(n=e.messageParams)&&void 0!==n?n:Kl(e),a=new Bl;return this._sendUserMessage(i,jc.RESEND,e.reqId).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),a._trigger(e)})),a}if(e.isFileMessage()){var s=this._validateFailedFileMessageHasFile(e,t);Ia(s).throw(H.invalidParameters),i=eu(e,t);var o=new Bl;return this._sendFileMessage(i,jc.RESEND,e.reqId).onPending((function(e){o._trigger(e)})).onFailed((function(e,t){o._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),o._trigger(e)})),o}if(e.isMultipleFilesMessage()){i=e.messageParams;var l=new xc;return this._sendMultipleFilesMessage(i,jc.RESEND,e.reqId).onPending((function(e){l._trigger(e)})).onFailed((function(e,t){l._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),l._trigger(e)})).onFileUploaded((function(e,t,n,r){l._triggerOnFileUploaded(e,t,n,r)})),l}},t.prototype.copyMessage=function(e,t){var n=this;if(Ia(e instanceof qc&&t instanceof tl&&t.sendingStatus===pe.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(H.invalidParameters),t.isUserMessage()){Ia(!t.poll).throw(H.notSupportedError);var r=ql(t),i=new Bl;return e._sendUserMessage(r).onPending((function(e){i._trigger(e)})).onFailed((function(e,t){i._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),i._trigger(t)})),i}if(t.isFileMessage()){r=Jl(t);var a=new Bl;return e._sendFileMessage(r).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),a._trigger(t)})),a}if(t.isMultipleFilesMessage()){if(e.isGroupChannel()){r=function(e){var t,n,r;return null!==(t=e.messageParams)&&void 0!==t?t:Se(T(T({},e),{isReplyToChannel:!1,mentionedUserIds:null!==(n=e.mentionedUserIds)&&void 0!==n?n:null===(r=e.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),pushNotificationDeliveryOption:fe.DEFAULT,isPinnedMessage:!1,fileInfoList:e.fileInfoList.map((function(e){var t;return{fileUrl:e.plainUrl,fileName:e.fileName,fileSize:e.fileSize,mimeType:e.mimeType,thumbnailSizes:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),_thumbnails:e.thumbnails,_uploadedMetaData:{requireAuth:e._requireAuth,isUploaded:!0}}}))}))}(t);var s=new xc;return e._sendMultipleFilesMessage(r,jc.COPY).onPending((function(e){s._trigger(e)})).onFailed((function(e,t){s._triggerFailed(e,t)})).onSucceeded((function(t){n._tryUpdateLastMessageAndCallEvents(e,t),s._trigger(t)})).onFileUploaded((function(e,t,n,r){s._triggerOnFileUploaded(e,t,n,r)})),s}throw H.channelTypeNotSupportedError}},t.prototype.getMessageDeletionTimestamp=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return e=As.of(this._iid),t=e.requestQueue,n=e.dispatcher,r=new w_({channelUrl:this.url,channelType:this.channelType}),[4,t.send(r)];case 1:return i=s.sent(),a=i.as(A_).messageDeletionTimestamp,this._messageDeletionTimestamp=a,n.dispatch(new Gf({channel:this})),[2,a]}}))}))},t}(qc),R_=function(){this.onUserMuted=St,this.onUserUnmuted=St,this.onUserBanned=St,this.onUserUnbanned=St,this.onChannelChanged=St,this.onChannelDeleted=St,this.onChannelFrozen=St,this.onChannelUnfrozen=St,this.onOperatorUpdated=St,this.onChannelMemberCountChanged=St,this.onMetaDataCreated=St,this.onMetaDataUpdated=St,this.onMetaDataDeleted=St,this.onMetaCounterCreated=St,this.onMetaCounterUpdated=St,this.onMetaCounterDeleted=St,this.onMessageReceived=St,this.onMessageUpdated=St,this.onMessageDeleted=St,this.onMentionReceived=St,this.onReactionUpdated=St,this.onThreadInfoUpdated=St},D_={},k_=function(){function e(e){var t=e._iid,n=e.limit,r=void 0===n?100:n,i=this;this.ref=0,this._iid=t,this._limit=r;var a,s=As.of(this._iid),o=s.sdkState,l=s.dispatcher,u=s.logger,c=s.cacheContext,d=s.statManager;this._metadataKey=(a=o.userId,"sendbird:".concat(a,"@groupchannel/sync.meta"));var h,f=(h=o.userId,"sendbird:".concat(h,"@groupchannel/sync"));this._sync=new $h(f,(function(){return N(i,0,void 0,(function(){var e,t,n,r,i,a,s,l,h,f,p,_,m,v,g,E;return S(this,(function(b){switch(b.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(b.sent(),u.debug("channel background sync from",null===(h=this._metadata)||void 0===h?void 0:h.token),null===(f=this._metadata)||void 0===f?void 0:f.completed)return[3,14];t={includeEmpty:!0,includeMetaData:!0,hiddenChannelFilter:gf.ALL,order:Oh.CHRONOLOGICAL},b.label=2;case 2:if(b.trys.push([2,9,12,13]),t.order!==Oh.LATEST_LAST_MESSAGE)return[3,6];b.label=3;case 3:return b.trys.push([3,5,,6]),[4,c.preference.get(la(o.appId))];case 4:return n=b.sent(),t.includeChatNotification=Boolean(n),[3,6];case 5:return b.sent(),t.includeChatNotification=!1,[3,6];case 6:return[4,xp.of(this._iid).getMyGroupChannels(null!==(_=null===(p=this._metadata)||void 0===p?void 0:p.token)&&void 0!==_?_:"",t,this._limit,bs.SYNC_CHANNEL_BACKGROUND)];case 7:return r=b.sent(),i=r.channels,a=r.token,e.hasNext=i.length>=this._limit&&!!a,e.nextToken=a,this._metadata&&(this._metadata.token=a,(l=this._metadata.range).extends.apply(l,A([],w(i.map((function(e){return e.createdAt}))),!1)),this._metadata.completed=!e.hasNext),u.debug("channel background sync progress",e),[4,this.saveMetadata()];case 8:return b.sent(),[3,13];case 9:return s=b.sent(),u.debug("channel background sync error",s),s instanceof H&&s.isInvalidTokenError?[4,this.clearMetaData()]:[3,11];case 10:b.sent(),b.label=11;case 11:throw s;case 12:return d.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:"",measured_on:"channel_back_sync",event:"cache_fetch",max_db_size:null!==(v=null===(m=c.localCacheConfig)||void 0===m?void 0:m.maxSize)&&void 0!==v?v:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:null!==(E=null===(g=t.order)||void 0===g?void 0:g.toString())&&void 0!==E?E:"",collection_id:o.userId}})),[7];case 13:return[3,15];case 14:e.hasNext=!1,e.nextToken="",b.label=15;case 15:return[2,e]}}))}))})),this._connectionEventContext=l.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?i.resume():i.pause())}))}return e.of=function(t){return D_[t]||(D_[t]=new e({_iid:t})),D_[t].ref++,D_[t]},e.clear=function(e){D_[e]&&(D_[e].close(),delete D_[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new kp({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,As.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new kp(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._metadata?[4,As.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetaData=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e,t,n=As.of(this._iid),r=n.logger;n.sessionManager.session.hasSession&&(r.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))},e.prototype.pause=function(){As.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete D_[this._iid])},e}(),L_={},x_=function(){function e(e){var t=e._iid,n=this;this.ref=0,this._iid=t;var r,i=As.of(this._iid),a=i.logger,s=i.sdkState,o=i.dispatcher,l=i.cacheContext,u=i.statManager;this._metadataKey=(r=s.userId,"sendbird:".concat(r,"@groupchannel/changelogs.meta")),this._subscribers=new ye;var c,d=(c=s.userId,"sendbird:".concat(c,"@groupchannel/changelogs"));this._sync=new $h(d,(function(){return N(n,0,void 0,(function(){var e,t,n,r,i,o,c,d,h,f,p,_;return S(this,(function(m){switch(m.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:m.sent(),a.debug("channel changelog sync from",null===(f=this._metadata)||void 0===f?void 0:f.token),m.label=2;case 2:m.trys.push([2,9,,12]),t={includeEmpty:!0,includeMetaData:!0},m.label=3;case 3:return m.trys.push([3,5,,6]),[4,l.preference.get(la(s.appId))];case 4:return n=m.sent(),t.includeChatNotification=Boolean(n),[3,6];case 5:return m.sent(),t.includeChatNotification=!1,[3,6];case 6:return[4,xp.of(this._iid).getMyGroupChannelChangeLogs(null!==(_=null===(p=this._metadata)||void 0===p?void 0:p.token)&&void 0!==_?_:"",t,bs.SYNC_CHANNEL_CHANGELOGS)];case 7:return r=m.sent(),i=r.updatedChannels,o=r.deletedChannelUrls,c=r.hasMore,d=r.token,this._subscribers.dispatch("progress",{updatedChannels:i,deletedChannelUrls:o,hasMore:c,token:d}),e.hasNext=c,e.nextToken=d,this._metadata&&(this._metadata.token=d),a.debug("channel changelog sync progress",e),[4,this.saveMetadata()];case 8:return m.sent(),l.localCacheEnabled&&u.put(new mt({type:et.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:"",measured_on:"channel_change_log_sync",event:i.length>0||o.length>0?"cache_miss":"cache_hit",max_db_size:i.length,use_local_cache:l.localCacheEnabled,starting_point:0,message_init_policy:o.length.toString(),collection_id:s.userId}})),[3,12];case 9:return h=m.sent(),a.debug("channel changelog sync error",h),h instanceof H&&h.isInvalidTokenError?[4,this.clearMetadata()]:[3,11];case 10:m.sent(),m.label=11;case 11:throw h;case 12:return[2,e]}}))}))})),this._sync.on("stop",(function(){n._subscribers.dispatch("pause")})),this._connectionEventContext=o.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?n.resume():n.pause())}))}return e.of=function(t){return L_[t]||(L_[t]=new e({_iid:t})),L_[t].ref++,L_[t]},e.clear=function(e){L_[e]&&(L_[e].close(),delete L_[e])},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._sync.isRunning},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return this._metadata?[3,2]:(e=As.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n},i.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return this._metadata?[4,As.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.on=function(e,t){return this._subscribers.on(e,t)},e.prototype.resume=function(){As.of(this._iid).sessionManager.session.hasSession&&this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete L_[this._iid])},e}(),U_=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},P_=function(e,t,n){if(e.length>0){for(var r=U_(e,t),i=0,a=e.length-1,s=Math.floor((i+a)/2);i<a;){var o=F_(e[s],t,n);if(o>0)a=s,s=Math.floor((i+a)/2);else{if(!(o<0))return{place:s,oldPosition:r};i=s+1,s=Math.floor((i+a)/2)}}return{place:F_(e[s],t,n)>=0?s:s+1,oldPosition:r}}return{place:e.length,oldPosition:-1}},F_=function(e,t,n){switch(n){case Oh.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?0==(r=t.lastMessage.createdAt-e.lastMessage.createdAt)?t.createdAt-e.createdAt:r:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case Oh.CHRONOLOGICAL:return t.createdAt-e.createdAt;case Oh.CHANNEL_NAME_ALPHABETICAL:var r;return 0===(r=e.name.localeCompare(t.name))?e.createdAt-t.createdAt:r;default:return 0}},B_=function(){function e(e,t){var n=t.filter,r=void 0===n?new Sf:n,i=t.order,a=void 0===i?Oh.LATEST_LAST_MESSAGE:i,s=t.limit,o=void 0===s?100:s,l=t.includeChangesOnInitialLoad,u=void 0!==l&&l,c=this;this.channels=[],this._isInitialized=!1,this._iid=e,this._key="gcc-".concat(Ee()),this._isDisposed=!1,this._isGetRemoteChannelsSucceeded=!0,this._includeChangesOnInitialLoad=u,this.filter=r,this.order=a,this._hasMore=!0,this._token="",this._limit=o;var d=As.of(this._iid),h=d.sdkState,f=d.cacheContext,p=d.dispatcher;f.localCacheEnabled&&(this._backgroundSync=k_.of(e),this._backgroundSync.resume()),this._changelogSync=x_.of(e),this._changelogSync.resume(),xp.of(this._iid).subscribeChannelEvent(this._key,{onUpdate:function(e,t){var n=t.source;if(Ff(n)){var r=e.filter((function(e){return c.filter.match(e,h.userId)})),i=e.filter((function(e){return!c.filter.match(e,h.userId)})).map((function(e){return e.url}));r.length>0&&c._addChannelsToView(r,t),i.length>0&&c._removeChannelsFromView(i,t)}},onRemove:function(e,t){c._removeChannelsFromView(e,t)}}),p.on((function(e){e instanceof ra&&(e.stateType===Zi.CONNECTED?c._isGetRemoteChannelsSucceeded||N(c,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._revokeLoadMore()];case 1:return e.sent(),[2]}}))})):e.stateType===Zi.LOGOUT&&c.dispose())}))}return Object.defineProperty(e.prototype,"hasMore",{get:function(){return!this._isDisposed&&this._hasMore},enumerable:!1,configurable:!0}),e.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},e.prototype._addChannelsToView=function(e,t,n){var r,i,a,s,o=this;void 0===n&&(n=!1);var l=[],u=[],c=[];try{for(var d=I(e),h=d.next();!h.done;h=d.next()){var f=h.value,p=U_(this.channels,f);p>=0&&this.channels.splice(p,1);var _=P_(this.channels,f,this.order).place;if(p<0)_===this.channels.length?!n&&this._hasMore||(l.push(f),this.channels.push(f)):(l.push(f),this.channels.splice(_,0,f));else switch(t.source){case bs.EVENT_CHANNEL_UPDATED:case bs.EVENT_MESSAGE_RECEIVED:case bs.SYNC_CHANNEL_CHANGELOGS:case bs.EVENT_MESSAGE_SENT:this.order===Oh.CHANNEL_NAME_ALPHABETICAL&&this._hasMore&&_===this.channels.length?c.push(f):(this.channels.splice(_,0,f),u.push(f));break;default:this.channels.splice(_,0,f),u.push(f)}}}catch(E){r={error:E}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}if(c.length>0)try{for(var m=I(c),v=m.next();!v.done;v=m.next()){f=v.value;var g=U_(this.channels,f);-1!==g&&this.channels.splice(g,1)}}catch(E){a={error:E}}finally{try{v&&!v.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}Ff(t.source)&&Qi((function(){return N(o,0,void 0,(function(){var e,n,r;return S(this,(function(i){return l.length>0&&(null===(e=this._handler)||void 0===e?void 0:e.onChannelsAdded)&&this._handler.onChannelsAdded(t,l),u.length>0&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelsUpdated)&&this._handler.onChannelsUpdated(t,u),c.length>0&&(null===(r=this._handler)||void 0===r?void 0:r.onChannelsDeleted)&&this._handler.onChannelsDeleted(t,c.map((function(e){return e.url}))),[2]}))}))}))},e.prototype._removeChannelsFromView=function(e,t){var n,r,i=this,a=[],s=function(e){var t=o.channels.findIndex((function(t){return t.url===e}));t>=0&&(a.push(o.channels[t].url),o.channels.splice(t,1))},o=this;try{for(var l=I(e),u=l.next();!u.done;u=l.next())s(u.value)}catch(c){n={error:c}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return Ff(t.source)&&a.length>0&&Qi((function(){return N(i,0,void 0,(function(){var e;return S(this,(function(n){return(null===(e=this._handler)||void 0===e?void 0:e.onChannelsDeleted)&&this._handler.onChannelsDeleted(t,a),[2]}))}))})),a},e.prototype._getLocalChannels=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=xp.of(this._iid),t=this.channels.length>0?function(e,t){var n,r,i,a;switch(t){case Oh.LATEST_LAST_MESSAGE:return null!==(r=null===(n=e.lastMessage)||void 0===n?void 0:n.createdAt)&&void 0!==r?r:e.createdAt;case Oh.CHRONOLOGICAL:return e.createdAt;case Oh.CHANNEL_NAME_ALPHABETICAL:return e.name;default:return null!==(a=null===(i=e.lastMessage)||void 0===i?void 0:i.createdAt)&&void 0!==a?a:e.createdAt}}(this.channels[this.channels.length-1],this.order):null,[4,e.getChannelsFromCache(t,this.filter,this.order,this._limit,t?this.channels[this.channels.length-1].url:void 0)];case 1:return[2,n.sent()]}}))}))},e.prototype._getRemoteChannels=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return[4,xp.of(this._iid).getMyGroupChannels(this._token,Se(T(T({},this.filter),{userIdsFilter:this.filter.userIdsFilter,searchFilter:this.filter.searchFilter,order:this.order})),this._limit)];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasMore=!!n,[2,t]}}))}))},e.prototype._revokeLoadMore=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:if(this._isDisposed)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._getRemoteChannels()];case 2:return e=t.sent(),this._isGetRemoteChannelsSucceeded=!0,this._addChannelsToView(e,{source:bs.REQUEST_CHANNEL},!0),[3,4];case 3:return t.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,4];case 4:return[2]}}))}))},e.prototype.loadMore=function(){var e;return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b=this;return S(this,(function(y){switch(y.label){case 0:if(this._isDisposed)throw new H({code:M.COLLECTION_DISPOSED,message:"Collection has been disposed."});return t=null,this._includeChangesOnInitialLoad&&0===this.channels.length&&this._changelogSync.isRunning?[4,new Promise((function(e){b._changelogSyncSubscriberContext=b._changelogSync.on("progress",(function(t){return e(t)})).on("pause",(function(){return e(null)}))}))]:[3,2];case 1:t=y.sent(),null===(e=this._changelogSyncSubscriberContext)||void 0===e||e.close(),y.label=2;case 2:return n=As.of(this._iid),r=n.cacheContext,i=n.connectionManager,a=n.statManager,this._isInitialized?[3,5]:(this._isInitialized=!0,r.localCacheEnabled?[4,this._backgroundSync.loadMetadata()]:[3,4]);case 3:y.sent(),y.label=4;case 4:a.put(new hs({type:et.FEATURE_LOCALCACHE,data:{use_local_cache:r.localCacheEnabled,collection_interface:{group_channel:!0}}})),y.label=5;case 5:return s=[],this._hasMore?!r.localCacheEnabled||i.isConnected&&!this._backgroundSync.completed?[3,7]:[4,Xi((function(){return N(b,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._getLocalChannels()];case 1:return s=e.sent(),[2]}}))}))}))]:[3,11];case 6:return y.sent(),this._hasMore=s.length>=this._limit,[3,10];case 7:return y.trys.push([7,9,,10]),[4,this._getRemoteChannels()];case 8:return s=y.sent(),this._isGetRemoteChannelsSucceeded=!0,[3,10];case 9:return y.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,10];case 10:this._addChannelsToView(s,{source:bs.REQUEST_CHANNEL},!0),y.label=11;case 11:if(t){try{for(o=I(t.updatedChannels),l=o.next();!l.done;l=o.next())u=l.value,(_=U_(s,u))>=0?s[_]=u:(c=P_(s,u,this.order).place,s.splice(c,0,u))}catch(C){m={error:C}}finally{try{l&&!l.done&&(v=o.return)&&v.call(o)}finally{if(m)throw m.error}}d=s.map((function(e){return e.url}));try{for(h=I(t.deletedChannelUrls),f=h.next();!f.done;f=h.next())p=f.value,(_=d.indexOf(p))>=0&&(s.splice(_,1),d.splice(_,1))}catch(C){g={error:C}}finally{try{f&&!f.done&&(E=h.return)&&E.call(h)}finally{if(g)throw g.error}}}return[2,s]}}))}))},e.prototype.dispose=function(){var e,t,n;this._isDisposed||(this._isDisposed=!0,this.channels.length>0&&this.channels.splice(0,this.channels.length),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._changelogSyncSubscriberContext)||void 0===n||n.close(),xp.of(this._iid).unsubscribeChannelEvent(this._key))},e}(),H_=function(e){function t(t){var n=this,r=t.token,i=t.limit,a=t.order,s=t.includeEmpty,o=t.membershipFilter,l=t.channelNameContainsFilter,u=t.channelUrlsFilter,c=t.customTypesFilter,d=t.customTypeStartsWithFilter,h=t.superChannelFilter,f=t.metadataOrderKeyFilter,p=t.metadataKey,_=t.metadataValues,m=t.metadataValueStartsWith,v=t.includeFrozen,g=t.includeMetaData;return(n=e.call(this)||this).method=Ie.GET,n.path=Re,n.params=Ne(Se({token:r,limit:i,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:s,public_mode:pf.PUBLIC,public_membership_mode:o,name_contains:l,channel_urls:u,custom_types:c,custom_type_startswith:d,super_mode:h,metadata_order_key:f,metadata_key:p,metadata_values:_,metadata_value_startswith:m,show_frozen:v,show_metadata:g})),n}return C(t,e),t}(tt),G_=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.channels=[];var i=n.next,a=n.channels,s=n.ts;return r.token=i,a&&a.length>0&&(r.channels=a.map((function(e){return e.ts=s,new O_(t,e)}))),r.ts="number"==typeof s?s:0,r}return C(t,e),t}(nt);!function(e){e.ALL="all",e.JOINED="joined"}(M_||(M_={}));var j_=function(e){function t(t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v=this;return(v=e.call(this,t,n)||this).includeEmpty=!1,v.includeFrozen=!0,v.includeMetaData=!0,v.channelUrlsFilter=null,v.customTypesFilter=null,v.customTypeStartsWithFilter=null,v.channelNameContainsFilter=null,v.membershipFilter=M_.ALL,v.superChannelFilter=mf.ALL,v.metadataKey=null,v.metadataValues=null,v.metadataOrderKeyFilter=null,v.metadataValueStartsWith=null,v.order=Rh.CHRONOLOGICAL,v.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,v.includeFrozen=null===(i=n.includeFrozen)||void 0===i||i,v.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,v.channelUrlsFilter=null!==(s=n.channelUrlsFilter)&&void 0!==s?s:null,v.customTypesFilter=null!==(o=n.customTypesFilter)&&void 0!==o?o:null,v.customTypeStartsWithFilter=null!==(l=n.customTypeStartsWithFilter)&&void 0!==l?l:null,v.channelNameContainsFilter=null!==(u=n.channelNameContainsFilter)&&void 0!==u?u:null,v.membershipFilter=null!==(c=n.membershipFilter)&&void 0!==c?c:M_.ALL,v.superChannelFilter=null!==(d=n.superChannelFilter)&&void 0!==d?d:mf.ALL,v.metadataKey=null!==(h=n.metadataKey)&&void 0!==h?h:null,v.metadataValues=null!==(f=n.metadataValues)&&void 0!==f?f:null,v.metadataOrderKeyFilter=null!==(p=n.metadataOrderKeyFilter)&&void 0!==p?p:null,v.metadataValueStartsWith=null!==(_=n.metadataValueStartsWith)&&void 0!==_?_:null,v.order=null!==(m=n.order)&&void 0!==m?m:Rh.CHRONOLOGICAL,v}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("boolean",this.includeEmpty)&&q("boolean",this.includeFrozen)&&q("boolean",this.includeMetaData)&&q("string",this.channelNameContainsFilter,!0)&&Y("string",this.channelUrlsFilter,!0)&&Y("string",this.customTypesFilter,!0)&&q("string",this.customTypeStartsWithFilter,!0)&&z(M_,this.membershipFilter)&&z(mf,this.superChannelFilter)&&z(Rh,this.order)&&q("string",this.metadataOrderKeyFilter,!0)&&q("string",this.metadataKey,!0)&&Y("string",this.metadataValues,!0)&&q("string",this.metadataValueStartsWith,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=As.of(this._iid).requestQueue,n=new H_(Se(T(T({},this),{token:this._token}))),[4,t.send(n)]):[3,2]):[3,5];case 1:return r=o.sent(),i=r.as(G_),a=i.channels,s=i.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,a];case 2:return[2,e];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),V_=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return C(t,e),t}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserJoined=St,t.onUserLeft=St,t.onUserReceivedInvitation=St,t.onUserDeclinedInvitation=St,t.onChannelHidden=St,t.onUnreadMemberStatusUpdated=St,t.onUndeliveredMemberStatusUpdated=St,t.onTypingStatusUpdated=St,t.onPollUpdated=St,t.onPollVoted=St,t.onPollDeleted=St,t.onPinnedMessageUpdated=St,t}return C(t,e),t}(R_)),q_=function(e){function t(t){var n=this,r=t.token,i=t.limit,a=t.order,s=t.reverse,o=t.channelUrl,l=t.messageTypeFilter,u=t.scheduledStatus;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(He),n.params=Ne(Se({token:r,limit:i,reverse:s,channel_url:o,order:a,message_type:l,status:u})),n}return C(t,e),t}(tt),z_=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.scheduledMessages=[];var i=n.next,a=n.scheduled_messages;return r.token=i,r.scheduledMessages=a.map((function(e){return hl(t,e)})),r}return C(t,e),t}(nt),K_=function(e){function t(t,n){var r,i,a,s,o,l=this;return(l=e.call(this,t,n)||this).channelUrl=null,l.order=null,l.reverse=!1,l.scheduledStatus=null,l.messageTypeFilter=ue.ALL,l.channelUrl=null!==(r=n.channelUrl)&&void 0!==r?r:null,l.order=null!==(i=n.order)&&void 0!==i?i:null,l.reverse=null!==(a=n.reverse)&&void 0!==a&&a,l.scheduledStatus=null!==(s=n.scheduledStatus)&&void 0!==s?s:null,l.messageTypeFilter=null!==(o=n.messageTypeFilter)&&void 0!==o?o:ue.ALL,l}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("string",this.channelUrl,!0)&&(z(Dh,this.order)||null===this.order)&&q("boolean",this.reverse)&&(Y(Wo,this.scheduledStatus)||null===this.scheduledStatus)&&z(ue,this.messageTypeFilter)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new q_(Se(T(T({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(z_),i=r.scheduledMessages,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ks),Y_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="groupChannel",t}return C(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,a=n.sessionManager,s=n.requestQueue,o=n.logger,l=n.onlineDetector,u=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:a,requestQueue:s,logger:o,onlineDetector:l,cacheContext:u}),this._manager=new xp(t,{sdkState:r,cacheContext:u,dispatcher:i,sessionManager:a,requestQueue:s,logger:o})},t.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new B_(this._iid,e)},t.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new Mp(this._iid,e)},t.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new j_(this._iid,e)},t.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new K_(this._iid,e)},t.prototype.addGroupChannelHandler=function(e,t){Ia(q("string",e)&&t instanceof V_).throw(H.invalidParameters),this._manager.addHandler(e,t)},t.prototype.removeGroupChannelHandler=function(e){Ia(q("string",e)).throw(H.invalidParameters),this._manager.removeHandler(e)},t.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},t.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},t.prototype.getChannel=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(q("string",e)).throw(H.invalidParameters),[2,this._manager.getChannel(e)]}))}))},t.prototype.getChannelWithoutCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(q("string",e)).throw(H.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]}))}))},t.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Mf),t),Ia(q("string",e)&&Of(n)).throw(H.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return void 0===t&&(t={}),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:return n=T(T({},Mf),t),Ia(q("number",e)&&Of(n)).throw(H.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.getGroupChannelCount=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},Rf),e),Ia(Df(t)).throw(H.invalidParameters),[2,this._manager.getGroupChannelCount(t)]}))}))},t.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getTotalUnreadChannelCount=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}}))}))},t.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},t.prototype.createChannel=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},wf),e),Ia(Af(t)).throw(H.invalidParameters),[2,this._manager.createChannel(t)]}))}))},t.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},wf),e),Ia(Af(t)).throw(H.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]}))}))},t.prototype.createChannelWithUserIds=function(e,t,n,r,i,a){return void 0===t&&(t=!1),void 0===i&&(i=""),void 0===a&&(a=""),N(this,0,void 0,(function(){var s;return S(this,(function(o){return s=T(T({},wf),{invitedUserIds:e,isDistinct:t,name:n,data:i,customType:a}),"string"==typeof r?s.coverUrl=r:s.coverImage=r,[2,this.createChannel(s)]}))}))},t.prototype.markAsReadAll=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return this._manager.markAsReadAll(),[2]}))}))},t.prototype.markAsReadWithChannelUrls=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return Ia(Y("string",e)).throw(H.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]}))}))},t.prototype.markAsDelivered=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},t}(Ms);const W_="reactions",Q_="message_search_v3",X_="enable_og_tag",Z_="delivery_receipt",J_={collection:{groupChannel:{defaultLimit:20,defaultOrder:Oh.LATEST_LAST_MESSAGE,defaultIncludeEmpty:!1},message:{defaultLimit:{next:25,prev:25},searchLimit:{next:10,prev:10}}}};var $_=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const em=(e,n)=>{t.useEffect(nm(e),n)},tm=e=>"function"==typeof e&&e(),nm=e=>()=>{const t=tm(e);return()=>{t&&(t instanceof Promise?tm((()=>$_(void 0,void 0,void 0,(function*(){const e=yield t;"function"==typeof e&&e()})))):"function"==typeof t&&tm(t))}};let rm=0;const im=(e,n,r)=>{const i=t.useRef(n),a=t.useState((()=>""+rm++))[0];i.current=n,t.useEffect((()=>{var t;var n;return null===(t=null==e?void 0:e.groupChannel)||void 0===t||t.addGroupChannelHandler(a,(n=new V_,Object.keys(n).forEach((e=>{n[e]=(...t)=>{var n,r;return null===(r=null===(n=i.current)||void 0===n?void 0:n[e])||void 0===r?void 0:r.call(n,...t)}})),n)),()=>{var t;null===(t=null==e?void 0:e.groupChannel)||void 0===t||t.removeGroupChannelHandler(a)}}),[null==e?void 0:e.groupChannel,a])};function am(e){const n=t.useRef(e);return n.current=e,t.useCallback(((...e)=>n.current(...e)),[n])}const sm=(e,t)=>{var n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,[]);const r=om(n.order);switch(t.type){case"update_refreshing":n.refreshing=t.value.status;break;case"update_initialized":n.initialized=t.value.status;break;case"update_channels":lm(t.value.channels).forEach((e=>{const t=n.groupChannels.findIndex((t=>t.url===e.url));t>-1&&(n.groupChannels[t]=e)})),r&&(n.groupChannels=n.groupChannels.sort(r));break;case"delete_channels":t.value.channelUrls.forEach((e=>{const t=n.groupChannels.findIndex((t=>t.url===e));t>-1&&n.groupChannels.splice(t,1)})),r&&(n.groupChannels=n.groupChannels.sort(r));break;case"append_channels":{const e=lm(t.value.channels);t.value.clearBeforeAction?n.groupChannels=e:n.groupChannels=function(e,t,n){const r=new Set(e.map((e=>e[n]))),i=[...e];for(let a=0;a<t.length;a++)r.has(t[a][n])||(i.push(t[a]),r.add(t[a][n]));return i}(n.groupChannels,e,"url"),r&&(n.groupChannels=n.groupChannels.sort(r));break}case"update_order":{n.order=t.value.order;const e=om(n.order);e&&(n.groupChannels=n.groupChannels.sort(e));break}}return n},om=e=>{if(e)return(t,n)=>{switch(e){case"latest_last_message":return t.lastMessage&&n.lastMessage?n.lastMessage.createdAt-t.lastMessage.createdAt:t.lastMessage?-1:n.lastMessage?1:n.createdAt-t.createdAt;case"chronological":return n.createdAt-t.createdAt;case"channel_name_alphabetical":return t.name.localeCompare(n.name);default:return 0}}};function lm(e){return e.filter((e=>e.isGroupChannel()))}var um=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const cm=(e,n)=>{var r,i,a;const s=Boolean(null===(i=null===(r=e.appInfo)||void 0===r?void 0:r.premiumFeatureList)||void 0===i?void 0:i.includes(Z_)),o=t.useRef(),l=t.useRef(n);l.current=n;const{initialized:u,groupChannels:c,refreshing:d,appendChannels:h,deleteChannels:f,updateRefreshing:p,updateInitialized:_}=(e=>{const[{initialized:n,refreshing:r,groupChannels:i},a]=t.useReducer(sm,{initialized:!1,refreshing:!1,groupChannels:[],order:e});return{updateInitialized:e=>{a({type:"update_initialized",value:{status:e}})},updateRefreshing:e=>{a({type:"update_refreshing",value:{status:e}})},updateChannels:e=>{a({type:"update_channels",value:{channels:e}})},deleteChannels:e=>{a({type:"delete_channels",value:{channelUrls:e}})},appendChannels:(e,t)=>{a({type:"append_channels",value:{channels:e,clearBeforeAction:t}})},updateOrder:e=>{a({type:"update_order",value:{order:e}})},initialized:n,refreshing:r,groupChannels:i}})(),m=(e,t,n)=>{var r,i,a,u;const c=null!==(i=null===(r=o.current)||void 0===r?void 0:r.channels)&&void 0!==i?i:[];if(h(c,!0),e&&s)switch(t){case Pf.EVENT_MESSAGE_RECEIVED:case Pf.EVENT_MESSAGE_SENT:case Pf.SYNC_CHANNEL_BACKGROUND:case Pf.SYNC_CHANNEL_CHANGELOGS:case void 0:null===(u=null===(a=l.current)||void 0===a?void 0:a.markAsDelivered)||void 0===u||u.call(a,null!=n?n:c)}},v=am((t=>um(void 0,void 0,void 0,(function*(){var r,i,a,s;o.current&&(null===(r=o.current)||void 0===r||r.dispose()),t&&(o.current=((e,t)=>{const n={includeEmpty:J_.collection.groupChannel.defaultIncludeEmpty,limit:J_.collection.groupChannel.defaultLimit,order:J_.collection.groupChannel.defaultOrder};return(null==t?void 0:t(n))||e.groupChannel.createGroupChannelCollection(Object.assign(Object.assign({},n),{filter:new Sf(n)}))})(e,null==n?void 0:n.collectionCreator),null===(i=o.current)||void 0===i||i.setGroupChannelCollectionHandler({onChannelsAdded:(e,t)=>{var n,r;const i=t.filter((e=>e.isGroupChannel()));m(!0,e.source,i),null===(r=null===(n=l.current)||void 0===n?void 0:n.onChannelsAdded)||void 0===r||r.call(n,i)},onChannelsUpdated:(e,t)=>{var n,r;const i=t.filter((e=>e.isGroupChannel()));m(!0,e.source,i),null===(r=null===(n=l.current)||void 0===n?void 0:n.onChannelsUpdated)||void 0===r||r.call(n,i)},onChannelsDeleted:(e,t)=>{var n,r;m(!1),null===(r=null===(n=l.current)||void 0===n?void 0:n.onChannelsDeleted)||void 0===r||r.call(n,t)}}),(null===(a=o.current)||void 0===a?void 0:a.hasMore)&&(yield null===(s=o.current)||void 0===s?void 0:s.loadMore(),m(!0)))}))));t.useEffect((()=>()=>{var e;o.current&&(null===(e=o.current)||void 0===e||e.dispose())}),[]),em((()=>um(void 0,void 0,void 0,(function*(){_(!1),e.currentUser&&(yield v(e.currentUser.userId),_(!0))}))),[e,null===(a=e.currentUser)||void 0===a?void 0:a.userId]),im(e,{onUserBanned:(t,n)=>{var r,i,a;n.userId===(null===(r=e.currentUser)||void 0===r?void 0:r.userId)?(f([t.url]),null===(a=null===(i=l.current)||void 0===i?void 0:i.onChannelsDeleted)||void 0===a||a.call(i,[t.url])):m(!1)}});return{initialized:u,groupChannels:c,refresh:am((()=>um(void 0,void 0,void 0,(function*(){e.currentUser&&(p(!0),yield v(e.currentUser.userId),p(!1))})))),refreshing:d,loadMore:am((()=>um(void 0,void 0,void 0,(function*(){var e,t;(null===(e=o.current)||void 0===e?void 0:e.hasMore)&&(yield null===(t=o.current)||void 0===t?void 0:t.loadMore(),m(!0))}))))}};var dm=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="poll",t}return C(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,a=n.sessionManager,s=n.requestQueue,o=n.logger,l=n.onlineDetector,u=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:a,requestQueue:s,logger:o,onlineDetector:l,cacheContext:u}),this._manager=new co(t,{sdkState:r,dispatcher:i,sessionManager:a,requestQueue:s,logger:o,onlineDetector:l,cacheContext:u})},t.prototype.create=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},ro),e),Ia(io(t)).throw(H.invalidParameters),[2,this._manager.create(t)]}))}))},t.prototype.get=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},oo),e),Ia(lo(t)).throw(H.invalidParameters),[2,this._manager.get(t)]}))}))},t.prototype.getOption=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){return t=T(T({},ao),e),Ia(so(t)).throw(H.invalidParameters),[2,this._manager.getOption(t)]}))}))},t.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},t}(Ms),hm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t}(Te),fm=function(e){this.key=e.key,this.url=e.url},pm=function(e){this.id=e.id,this.name=e.name,this.url=e.url,this.emojis=e.emojis?e.emojis.map((function(e){return new fm(e)})):[]},_m=function(e){this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new pm(e)})):[]},mm={profileImage:void 0,profileUrl:void 0,nickname:void 0},vm=function(e){return{v2:function(){return N(void 0,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.commitSchema([{collectionName:Oc,keyName:"url",index:[Gh(Oh.LATEST_LAST_MESSAGE),Gh(Oh.CHRONOLOGICAL),Gh(Oh.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:Rc,keyName:"messageId",index:[sh(nh.CHANNEL_LATEST),sh(nh.NEWEST_CHILD_MESSAGE)]},{collectionName:uh,keyName:"reqId",index:[sh(nh.CHANNEL_LATEST),sh(nh.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}])];case 1:return[2,t.sent()]}}))}))},v3:function(){return N(void 0,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.commitSchema([{collectionName:"FeedChannel",keyName:"url",index:[["-lastMessageUpdatedAt","-createdAt","syncIndex"]]}])];case 1:return[2,t.sent()]}}))}))},v4:function(){return N(void 0,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.commitSchema([{collectionName:Dc,keyName:"notificationId",index:[["channelUrl","-createdAt","-notificationId"]]}])];case 1:return[2,t.sent()]}}))}))},v5:function(){return N(void 0,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,e.commitSchema([{collectionName:kc,keyName:"userId",index:[["-userId","-updatedAt"]]}])];case 1:return[2,t.sent()]}}))}))}}},gm=function(e){var t=new rh;return function(n,r){return N(void 0,0,void 0,(function(){var i,a,s,o;return S(this,(function(l){switch(l.label){case 0:switch(n){case 1:case 2:case 3:case 4:return[3,1];case 5:return[3,2];case 6:return[3,4];case 7:return[3,11]}return[3,15];case 1:return r(),[3,16];case 2:return[4,e.reset()];case 3:return l.sent(),r(),[3,16];case 4:return l.trys.push([4,9,,10]),i=vm(e),a=i.v2,s=i.v3,o=i.v4,[4,a()];case 5:return l.sent(),[4,s()];case 6:return l.sent(),[4,o()];case 7:return l.sent(),[4,e.collection(Rc).removeIf({where:{channelType:ae.OPEN}})];case 8:return l.sent(),[3,10];case 9:return l.sent(),t.warn("Failed to migrate to v2, v3, v4"),[3,10];case 10:return r(),[3,16];case 11:return l.trys.push([11,13,,14]),[4,(0,vm(e).v5)()];case 12:return l.sent(),[3,14];case 13:return l.sent(),t.warn("Failed to migrate to v5"),[3,14];case 14:return r(),[3,16];case 15:r(),l.label=16;case 16:return[2]}}))}))}},Em=function(){return"undefined"!=typeof document?document.visibilityState:"visible"},bm=function(e){function t(t){var n=t.getVisibilityState,r=void 0===n?Em:n,i=t.initialState,a=void 0===i?"visible":i,s=t.isEnabled,o=void 0===s||s,l=t.pauseCheckDelay,u=void 0===l?3e4:l,c=e.call(this)||this;return c._pauseCheckDelay=3e4,c._currentState="visible",c._getVisibilityState=r,c._pauseCheckDelay=u,c._currentState=a,c._isEnabled=o,c._boundToggleState=c._toggleState.bind(c),c}return C(t,e),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t.prototype._toggleState=function(){var e=this,t=this._getVisibilityState();"hidden"!==t?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=void 0,e.dispatch("pause")}),this._pauseCheckDelay)),this._currentState=t},t.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))},t.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})},t}(ye),ym=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n,i=this;this._onlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=t,r&&(this.connectionDelegate=r)}return Object.defineProperty(e.prototype,"isAvailableOnWeb",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype.setOnlineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)},e.prototype.setOfflineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)},e.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},e.prototype.stop=function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(n){e.logger.warn(n.message)}})),this.unsubscribes=[]},e.prototype.isOnline=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise((function(e){fetch("https://www.google.com",{method:Ie.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))}))]}))}))},e}(),Cm=function(e){function t(t){var n,r=this;return(r=e.call(this)||this).method=Ie.GET,r.path=We,r.params=Ne(Se({ts:"number"==typeof t.token?t.token:void 0,token:"string"==typeof t.token?t.token:void 0,limit:null!==(n=t.limit)&&void 0!==n?n:100})),r}return C(t,e),t}(tt),Tm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.configs=n.configs,r.hasMore=n.has_more,r.nextToken=n.next,r.ts=n.ts,r}return C(t,e),t}(nt),Nm=function(e){function t(t){var n=t.userId,r=t.nickname,i=t.profileUrl,a=t.profileImage,s=t.preferredLanguages,o=e.call(this)||this;return o.method=Ie.PUT,o.path="".concat(Ae,"/").concat(encodeURIComponent(n)),o.params=Ne(Se({nickname:r,profile_url:i,profile_file:a,preferred_languages:s})),o}return C(t,e),t}(tt),Sm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.user=new Aa(t,T({},n)),r}return C(t,e),t}(nt),Im=function(e){function t(t){var n=t.userId,r=t.token,i=t.deviceOS,a=t.deviceManufacturer,s=t.systemPushEnabled,o=e.call(this)||this;return o.method=Ie.POST,o.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/apns"),o.params=Ne({apns_device_token:r,always_push:!0,device_os:i,device_manufacturer:a,system_push_enabled:s}),o}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?x[n.type.toLowerCase()]:x.UNKNOWN,r.user=new Aa(t,n.user),r}),e)}(nt);var wm=function(e){function t(t){var n=t.userId,r=t.token,i=t.deviceOS,a=t.deviceManufacturer,s=t.systemPushEnabled,o=e.call(this)||this;return o.method=Ie.POST,o.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/gcm"),o.params=Ne({gcm_reg_token:r,always_push:!0,device_os:i,device_manufacturer:a,system_push_enabled:s}),o}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?x[n.type.toLowerCase()]:x.UNKNOWN,r.user=new Aa(t,n.user),r}),e)}(nt);var Am=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new Aa(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}),e)}(nt);var Mm=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new Aa(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}),e)}(nt);var Om=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.DELETE,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/apns"),r}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?x[n.type.toLowerCase()]:x.UNKNOWN,r.user=new Aa(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}),e)}(nt);var Rm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.DELETE,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?x[n.type.toLowerCase()]:x.UNKNOWN,r.user=new Aa(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}),e)}(nt);var Dm=function(e){function t(t){var n=t.userId,r=t.type,i=t.token,a=t.ts,s=e.call(this)||this;return s.method=Ie.GET,s.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),s.params={created_ts:a,token:i},s}return C(t,e),t}(tt),km=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTokens={type:n.type?x[n.type.toLowerCase()]:x.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return C(t,e),t}(nt),Lm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return C(t,e),t}(tt),xm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return C(t,e),t}(nt),Um=function(e){function t(t){var n=t.userId,r=t.willAutoAccept,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return C(t,e),t}(tt),Pm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return C(t,e),t}(nt),Fm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),r}return C(t,e),t}(tt),Bm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return C(t,e),t}(nt),Hm=function(e){function t(t){var n=t.userId,r=t.doNotDisturbOn,i=t.startHour,a=t.startMin,s=t.endHour,o=t.endMin,l=t.timezone,u=e.call(this)||this;return u.method=Ie.PUT,u.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),u.params={do_not_disturb:r,start_hour:i,start_min:a,end_hour:s,end_min:o,timezone:l},u}return C(t,e),t}(tt),Gm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return C(t,e),t}(nt),jm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),r}return C(t,e),t}(tt),Vm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return C(t,e),t}(nt),qm=function(e){function t(t){var n=t.userId,r=t.snoozeOn,i=t.startTs,a=t.endTs,s=e.call(this)||this;return s.method=Ie.PUT,s.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),s.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:a},s}return C(t,e),t}(tt),zm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return C(t,e),t}(nt),Km=function(e){function t(t){var n=t.userId,r=t.blockedUserId,i=e.call(this)||this;return i.method=Ie.POST,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return C(t,e),t}(tt);!function(e){C((function(t,n){var r=e.call(this,t,n)||this;return r.user=new Aa(t,n),r}),e)}(nt);var Ym=function(e){function t(t){var n=t.userId,r=t.unblockedUserId,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var Wm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),r}return C(t,e),t}(tt),Qm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return C(t,e),t}(nt),Xm=function(e){function t(t){var n=t.userId,r=t.pushTriggerOption,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push_preference"),i.params={push_trigger_option:r},i}return C(t,e),t}(tt),Zm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return C(t,e),t}(nt),Jm=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/template"),r}return C(t,e),t}(tt),$m=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return C(t,e),t}(nt),ev=function(e){function t(t){var n=t.userId,r=t.templateName,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return C(t,e),t}(tt),tv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return C(t,e),t}(nt),nv=function(e){function t(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=Ie.GET,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return C(t,e),t}(tt),rv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.changelogs={addedUsers:n.added.map((function(e){return new Aa(t,e)})),updatedUsers:n.updated.map((function(e){return new Aa(t,e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return C(t,e),t}(nt),iv=function(e){function t(t){var n=t.userId,r=t.discoveries,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return C(t,e),t}(tt),av=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return C(t,e),t}(nt),sv=function(e){function t(t){var n=t.userId,r=t.discoveryKeys,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var ov=function(e){function t(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=Ie.POST,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return C(t,e),t}(tt),lv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new Aa(t,e)})),r}return C(t,e),t}(nt),uv=function(e){function t(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=Ie.DELETE,i.path="".concat(Ae,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var cv=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Ae,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return C(t,e),t}(tt),dv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return C(t,e),t}(nt),hv=function(e){function t(t){var n=t.userId,r=t.allowFriendDiscovery,i=e.call(this)||this;return i.method=Ie.PUT,i.path="".concat(Ae,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return C(t,e),t}(tt);!function(e){C((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(nt);var fv,pv=function(e){function t(){var t=e.call(this)||this;return t.method=Ie.GET,t.path=Fe,t}return C(t,e),t}(tt),_v=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emojiContainer=new _m(n),r}return C(t,e),t}(nt),mv=function(e){function t(t){var n=t.categoryId,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Fe,"/").concat(n),r}return C(t,e),t}(tt),vv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emojiCategory=new pm(n),r}return C(t,e),t}(nt),gv=function(e){function t(t){var n=t.key,r=e.call(this)||this;return r.method=Ie.GET,r.path="".concat(Pe,"/").concat(n),r}return C(t,e),t}(tt),Ev=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.emoji=new fm(n),r}return C(t,e),t}(nt),bv=function(e){function t(){var t=e.call(this)||this;return t.method=Ie.GET,t.path="".concat(Ge),t}return C(t,e),t}(tt),yv=function(e){function t(t,n){var r,i=this,a=null!=n?n:{};return(i=e.call(this,t,n)||this).uikitConfiguration={string:JSON.stringify(a),json:a},i.updatedAt=null!==(r=null==n?void 0:n.updated_at)&&void 0!==r?r:0,i}return C(t,e),t}(nt);!function(e){e.DELIVERED="DELIVERED",e.CLICKED="CLICKED"}(fv||(fv={}));var Cv,Tv=function(e){function t(t){var n=t.deviceToken,r=t.pushTrackingId,i=t.messageId,a=t.allowedPushNotification,s=t.channelKey,o=t.templateKey,l=t.eventType,u=t.notificationEventDeadline,c=e.call(this)||this;return c.method=Ie.POST,c.path=ze,c.params=Ne({device_token:n,push_tracking_id:r,message_id:i,allowed_push_notification:a,channel_key:s,template_key:o,event_type:l,notification_event_deadline:u}),c}return C(t,e),t}(tt),Nv=function(){function e(e,t,n){var r=this;this._storeInitialized=!1,this._iid=e,this.options=t;var i=As.of(e),a=i.sdkState,s=i.cacheContext,o=i.dispatcher,l=i.sessionManager,u=i.requestQueue,c=i.logger,d=i.userEventHandlers,h=i.appStateToggleEnabled;this._onlineDetector=new ym({logger:c,connectionDelegate:{reconnect:function(){return N(r,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(l){switch(l.label){case 0:if(t=As.of(e),n=t.sdkState,r=t.connectionManager,(i=t.sessionManager).session.hasSession)return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.connect(i.session.authToken)];case 2:return l.sent(),[3,4];case 3:if(a=l.sent(),B(a))throw a;return c.debug("connect failed by reconnect event = ",a),[3,4];case 4:return[3,9];case 5:if("foreground"!==n.appState)return[3,9];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,r.resetAndReconnect()];case 7:return l.sent(),[3,9];case 8:if(s=l.sent(),B(s))throw s;return c.debug("resetAndReconnect failed by reconnect event = ",s),[3,9];case 9:return o.dispatch(new hm),[2]}}))}))},disconnect:function(){Xi((function(){return N(r,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,As.of(e).connectionManager.disconnect()];case 1:return t.sent(),[2]}}))}))}))}}});var f=new qh(e,{localCacheEnabled:s.localCacheEnabled,enableAutoResend:s.localCacheConfig.enableAutoResend,dispatcher:o,sdkState:a,logger:c});n.forEach((function(t){t.init(e,{sdkState:a,cacheContext:s,dispatcher:o,sessionManager:l,requestQueue:u,logger:c,onlineDetector:r._onlineDetector}),r[t.name]=t})),this._appStateChangeDetector=new bm({isEnabled:h}),this._appStateChangeDetector.on("resume",(function(){c.debug("the page resumes from freeze"),r.setForegroundState()})).on("pause",(function(){c.debug("the page freezes"),r.setBackgroundState()})),o.on((function(t){var n;if(t instanceof ra)t.stateType===Zi.CONNECTED&&f.processNonAutoResendRegisteredPendingMessages();else if(t instanceof at){if("USEV"===t.code){var i=t.as(Xh).event;if(i.category===Hh.FRIEND_DISCOVERED){var o=Kh.getDataAsFriendDiscoveredEvent(e,i).friendDiscoveries;Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,d.forEach((function(e){e.onFriendsDiscovered&&e.onFriendsDiscovered(o)}))]}))}))}))}}}else if(t instanceof $i){var l=As.of(r._iid).subscribedUnreadMessageCount,u=!1,h=t.ts;"number"==typeof h&&h>l.ts&&(l.all!==t.all&&(u=!0),l.all=t.all>=0?t.all:0,t.customTypes&&Object.keys(t.customTypes).forEach((function(e){l.customTypes[e]!==t.customTypes[e]&&(u=!0),l.customTypes[e]=t.customTypes[e]})),u=u&&l.ts>0,l.ts=h),u&&Qi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,d.forEach((function(e){e.onTotalUnreadMessageCountChanged&&e.onTotalUnreadMessageCountChanged({groupChannelCount:l.all,feedChannelCount:l.feed,customTypeUnreadCount:l.customTypes}),e.onTotalUnreadMessageCountUpdated&&e.onTotalUnreadMessageCountUpdated(l.all,l.customTypes)}))]}))}))}))}else t instanceof Ma?(s.preference.set(r._getUserProfileCacheKey(a.userId),Oa.payloadify(t.userProfile)),(null===(n=t.userProfile.appInfo.notificationInfo)||void 0===n?void 0:n.isEnabled)&&s.preference.set(la(r.appId),{value:!0})):t instanceof Da?t.configSyncNeeded&&Xi((function(){return N(r,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._getAppConfigsInfo()];case 1:return e.sent(),[2]}}))}))})):t instanceof Qh?s.preference.set(_a(r.appId),{configTs:t.configTs}):t instanceof it&&t.error&&t.error.isSessionInvalidatedError&&(c.debug("session revoked."),r._internalDisconnect(t.error))}))}return e.init=function(t){var n=t.appId,r=t.appVersion,i=t.modules,a=void 0===i?[]:i,s=t.options,o=void 0===s?new J:s,l=t.debugMode,u=void 0!==l&&l,c=t.customApiHost,d=t.customWebSocketHost,h=t.newInstance,f=void 0!==h&&h,p=t.logLevel,_=t.localCacheEnabled,m=void 0!==_&&_,v=t.localCacheConfig,g=void 0===v?new ie:v,E=t.localCacheEncryption,b=t.useAsyncStorageStore,y=void 0===b?null:b,C=t.useMMKVStorageStore,T=void 0===C?null:C,N=t.appStateToggleEnabled,S=void 0===N||N;if(!Cv||f){var I="su-".concat(Ee()),M=null!=E?E:{encrypt:function(e){return e},decrypt:function(e){return e}},O=new rh;O.level=null!=p?p:eh.WARN;var R=new Wd({encryption:M});u||(vt()?T?R=new $d({MMKV:T,encryption:M}):y&&(R=new Jd({AsyncStorage:y,encryption:M}),O.warn("AsyncStorage store is deprecated due to the small size limit. Please use MMKVStorage store instead.")):R=new Zd({encryption:M})),new As(I,{appId:n,appVersion:r,options:o,apiHost:null!=c?c:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(n,".sendbird.com"),store:R,encryption:M,logger:O,localCacheEnabled:m,localCacheConfig:g,debugMode:u,appStateToggleEnabled:S});var D=[new Bh,new dm],k=new e(I,o,A(A([],w(a),!1),w(D),!1));return Cv||(Cv=k),k}return Cv},Object.defineProperty(e,"instance",{get:function(){return Cv},enumerable:!1,configurable:!0}),Object.defineProperty(e,"version",{get:function(){return R},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appId",{get:function(){return As.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appInfo",{get:function(){var e=As.of(this._iid).appInfo;return null!=e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){var e;return null!==(e=As.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debugMode",{get:function(){return!!As.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"logLevel",{get:function(){return As.of(this._iid).logger.level},set:function(e){As.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCacheEnabled",{get:function(){return As.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localCacheConfig",{get:function(){var e=As.of(this._iid).cacheContext;return e.localCacheEnabled?e.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ekey",{get:function(){return As.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUser",{get:function(){var e;return null!==(e=As.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionState",{get:function(){var e=As.of(this._iid).connectionManager;return e.isConnected?Ki.OPEN:e.isConnecting?Ki.CONNECTING:Ki.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastConnectedAt",{get:function(){var e=As.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fcmPushToken",{get:function(){var e;return null!==(e=this._fcmPushToken)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"apnsPushToken",{get:function(){var e;return null!==(e=this._apnsPushToken)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),e.prototype._getNestDBVersion=function(){return 8},e.prototype._getPreferenceVersion=function(){return 9},e.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},e.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},e.prototype._internalDisconnect=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=As.of(this._iid),n=t.connectionManager,r=t.sdkState,i=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),i.cancelAll(),[4,n.logout(e)];case 1:return a.sent(),[4,this.clearCachedData()];case 2:return a.sent(),r.appState="foreground",[2]}}))}))},e.prototype._getAppConfigsInfo=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s,o,l=this;return S(this,(function(u){switch(u.label){case 0:return e=As.of(this._iid),t=e.requestQueue,n=e.dispatcher,r=e.cacheContext,i=e.sdkState,a={},[4,r.preference.get(_a(i.appId))];case 1:return(o=u.sent())&&(s=o.configTs),new $h("appConfigsInfo",(function(e){return N(l,0,void 0,(function(){var r,i,s,o,l,u,c,d;return S(this,(function(h){switch(h.label){case 0:return r={hasNext:!0,nextToken:e},i=new Cm({token:e}),[4,t.send(i)];case 1:return s=h.sent(),o=s.as(Tm),l=o.configs,u=o.hasMore,c=o.nextToken,d=o.ts,Object.keys(l).forEach((function(e){a[e]=l[e]})),r.hasNext=u,r.nextToken=c,u||n.dispatch(new Zh({appConfigsInfo:a,configTs:d})),[2,r]}}))}))})).start(s),[2]}}))}))},e.prototype.getMemoryStoreForDebugging=function(){var e=As.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Wd?n.store:null;throw H.debugModeRequired},e.prototype.addExtension=function(e,t){var n=As.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&n.extensions&&(n.extensions[e]=t)},e.prototype.addSendbirdExtensions=function(e,t,n){var r,i,a=As.of(this._iid),s=a.logger,o=a.sdkState,l=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$");if(0===e.length)return s.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(e.find((function(e){return!l.test(e.version)})))return s.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(n)try{for(var u=I(Object.entries(n)),c=u.next();!c.done;c=u.next()){var d=w(c.value,2),h=d[0],f=d[1];if(/&|=/.test(h)||/&|=/.test(f))return s.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(p){r={error:p}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return o.sendbirdRuntimeEnvironment={sendbirdExtensions:e,deviceOS:t,customData:n},!0},e.prototype.setOnlineListener=function(e){this._onlineDetector.setOnlineListener(e)},e.prototype.setOfflineListener=function(e){this._onlineDetector.setOfflineListener(e)},e.prototype._safeInitializeStore=function(e){return N(this,0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:t=As.of(this._iid).cacheContext,n.label=1;case 1:return n.trys.push([1,3,,5]),[4,t.store.init(e)];case 2:return n.sent(),this._storeInitialized=!0,[3,5];case 3:return n.sent(),t.replaceStore(new Wd),[4,this._safeInitializeStore(e)];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.setLocaleForChatbot=function(e){var t=As.of(this._iid).sdkState,n=e.trim().replace(/[^a-zA-Z-_.]/g,"");n&&(t.localeForChatbot=n)},e.prototype.initializeCache=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u;return S(this,(function(c){switch(c.label){case 0:if(t=As.of(this._iid),n=t.sdkState,r=t.cacheContext,i=t.dispatcher,a=t.logger,n.userId&&n.userId===e)return[3,13];s="sendbird@".concat(n.appId,"/").concat(e,".db"),c.label=1;case 1:return c.trys.push([1,9,11,13]),r.localCacheEnabled?r.nestdb&&r.nestdb.state!==Xd.CLOSED&&r.nestdb.name===s?[3,3]:(o="sendbird@".concat(n.appId,"/").concat(e,".db"),(l=r.nestdb=new th({name:o,version:this._getNestDBVersion(),store:r.store,config:new id({dbname:o,itemSizeLimit:61440})})).on("upgrade",gm(l)),l.on("storeReplaced",(function(e){r.replaceStore(e),r.localCacheEnabled=!1,l.on("upgrade",gm(l))})),[4,l.open()]):[3,6];case 2:return c.sent(),this._storeInitialized=!0,i.dispatch(new Yh(this._iid,{userId:e})),[3,5];case 3:return[4,this._safeInitializeStore(s)];case 4:c.sent(),c.label=5;case 5:return n.userId=e,[3,8];case 6:return[4,this._safeInitializeStore(s)];case 7:c.sent(),n.userId=e,c.label=8;case 8:return[3,13];case 9:return u=c.sent(),a.warn("Nest DB Open Failed. ",u),r.store instanceof Wd||(r.replaceStore(new Wd),r.localCacheEnabled=!1),[4,this._safeInitializeStore(s)];case 10:throw c.sent(),n.userId=e,H.databaseError;case 11:return[4,this._setupPreference(e)];case 12:return c.sent(),[7];case 13:return[2]}}))}))},e.prototype.getCacheDataSize=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return(e=As.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?[4,e.nestdb.estimateUsage()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,0]}}))}))},e.prototype.clearCachedData=function(){return N(this,0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return(e=As.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?[4,e.nestdb.clear()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this._storeInitialized?[4,e.preference.clear()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.clearCachedMessages=function(e){return N(this,0,void 0,(function(){var t,n,r=this;return S(this,(function(i){switch(i.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=fh.of(this._iid),n=dh.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return N(r,0,void 0,(function(){return S(this,(function(r){switch(r.label){case 0:return[4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype._setupPreference=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return t=As.of(this._iid),n=t.sdkState,r=t.cacheContext,i=t.statManager,[4,r.preference.init(this._getPreferenceCacheKey(e),this._getPreferenceVersion())];case 1:return s.sent(),[4,r.preference.get(this._getUserProfileCacheKey(e))];case 2:return(a=s.sent())&&new Oa(this._iid,a).apply(),[4,i.init("sendbird@".concat(n.appId,"/").concat(e,".statlog"))];case 3:return s.sent(),[2]}}))}))},e.prototype._ready=function(e,t,n){return void 0===n&&(n={}),N(this,0,void 0,(function(){var r,i,a,s,o,l;return S(this,(function(u){switch(u.label){case 0:return Ia(q("string",e)&&q("string",t,!0)).throw(H.invalidParameters),r=As.of(this._iid),i=r.sdkState,a=r.cacheContext,s=r.connectionManager,o=n.errorForOtherUser,i.userId&&i.userId!==e?o?[3,2]:[4,s.logout()]:[3,3];case 1:return u.sent(),[3,3];case 2:throw o;case 3:return u.trys.push([3,5,,6]),[4,this.initializeCache(e)];case 4:return u.sent(),As.of(this._iid).dispatcher.dispatch(new Wh),[3,6];case 5:return u.sent(),l=As.of(this._iid).logger,a.localCacheEnabled=!1,l.warn("Cache initialization failed - cache is not available."),[3,6];case 6:return[2]}}))}))},e.prototype.authenticateFeed=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this.authenticate(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.authenticate=function(e,t,n){var r;return void 0===n&&(n=U.SESSION_TOKEN),N(this,0,void 0,(function(){var i,a,s;return S(this,(function(o){switch(o.label){case 0:return i=As.of(this._iid),a=i.sessionManager,s=i.connectionManager,[4,this._ready(e,t,{errorForOtherUser:s.isConnected?H.alreadyConnectedAsAnotherUser:void 0})];case 1:return o.sent(),(null===(r=a.session.services)||void 0===r?void 0:r.includes(ne.CHAT))?[3,3]:(a.handler||t&&n!==U.ACCESS_TOKEN||this.setSessionHandler(new Kc),[4,a.authenticate(e,t)]);case 2:o.sent(),o.label=3;case 3:return[2,this.currentUser]}}))}))},e.prototype.connect=function(e,t){return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._ready(e,t)];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,,4,5]),[4,As.of(this._iid).connectionManager.connect(t)];case 3:return n.sent(),[3,5];case 4:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 5:return[2,this.currentUser]}}))}))},e.prototype.reconnect=function(){var e=As.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.session.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){}))),r},e.prototype.disconnect=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._internalDisconnect()];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnectWebSocket=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return e=As.of(this._iid),t=e.connectionManager,n=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),n.cancelAll(),[4,t.disconnectWebSocket(!0)];case 1:return r.sent(),[2]}}))}))},e.prototype.setBackgroundState=function(){var e=As.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background().catch((function(e){r.debug("setBackgroundState error = ",e)})))},e.prototype.setForegroundState=function(){var e=As.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.dispatcher,i=e.logger;"background"===n.appState&&(n.appState="foreground",i.debug("going foreground state"),t.resetAndReconnect().catch((function(e){i.debug("setForgroundState error = ",e)})),r.dispatch(new hm))},e.prototype.setSessionHandler=function(e){Ia(e instanceof Kc).throw(H.invalidParameters),As.of(this._iid).sessionManager.handler=e},e.prototype.addUserEventHandler=function(e,t){Ia(q("string",e)&&t instanceof Yc).throw(H.invalidParameters),As.of(this._iid).userEventHandlers.set(e,t)},e.prototype.removeUserEventHandler=function(e){As.of(this._iid).userEventHandlers.delete(e)},e.prototype.removeAllUserEventHandler=function(){As.of(this._iid).userEventHandlers.clear()},e.prototype.addConnectionHandler=function(e,t){Ia(q("string",e)&&t instanceof zc).throw(H.invalidParameters),As.of(this._iid).connectionHandlers.set(e,t)},e.prototype.removeConnectionHandler=function(e){As.of(this._iid).connectionHandlers.delete(e)},e.prototype.removeAllConnectionHandler=function(){As.of(this._iid).connectionHandlers.clear()},e.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new Xc(this._iid,e)},e.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new $c(this._iid,e)},e.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new nd(this._iid,e)},e.prototype.createMessageSearchQuery=function(e){return new kh(this._iid,e)},e.prototype.createPollListQuery=function(e){return new po(this._iid,T({},e))},e.prototype.createPollVoterListQuery=function(e){return new vo(this._iid,T({},e))},e.prototype.buildUserFromSerializedData=function(e){var t=Sa(e);return new Aa(this._iid,Aa.payloadify(t))},e.prototype.updateCurrentUserInfo=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){var t,n,r,i,a,s,o;return S(this,(function(l){switch(l.label){case 0:return t=T(T({},mm),e),Ia((u=t,X(u.profileImage,!0)&&q("string",u.profileUrl,!0)&&q("string",u.nickname,!0))).throw(H.invalidParameters),this.currentUser?(n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Nm(T({userId:r.userId},t)),[4,i.send(a)]):[3,2];case 1:return s=l.sent(),o=s.as(Sm).user,this.currentUser&&(t.nickname&&(this.currentUser.nickname=o.nickname),(t.profileUrl||t.profileImage)&&(this.currentUser.plainProfileUrl=o.profileUrl)),[2,o];case 2:throw H.connectionRequired}var u}))}))},e.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),this.currentUser?(t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Nm({userId:n.userId,preferredLanguages:e}),[4,r.send(i)]):[3,2];case 1:return a=o.sent(),s=a.as(Sm).user,this.currentUser&&(this.currentUser.preferredLanguages=s.preferredLanguages),[2,s];case 2:throw H.connectionRequired}}))}))},e.prototype.registerFCMPushTokenForCurrentUser=function(e,t){var n,r;return N(this,0,void 0,(function(){var i,a,s,o,l,u,c=this;return S(this,(function(d){switch(d.label){case 0:if(Ia(q("string",e)&&q("string",null==t?void 0:t.deviceManufacturer,!0)).throw(H.invalidParameters),(null==t?void 0:t.deviceOS)&&Ia(z(_t,t.deviceOS.platform,!0)&&q("string",t.deviceOS.version,!0)).throw(H.invalidParameters),!this.currentUser)return[3,6];i={deviceOS:"".concat((null===(n=null==t?void 0:t.deviceOS)||void 0===n?void 0:n.platform)||_t.ANDROID,"-").concat((null===(r=null==t?void 0:t.deviceOS)||void 0===r?void 0:r.version)||"unknown"),deviceManufacturer:null==t?void 0:t.deviceManufacturer,systemPushEnabled:null==t?void 0:t.systemPushEnabled},d.label=1;case 1:return d.trys.push([1,4,,5]),a=As.of(this._iid),s=a.sessionManager,o=a.sdkState,l=a.requestQueue,s.hasDeviceToken(x.FCM,e)?[2,k.SUCCESS]:(u=new wm({userId:o.userId,token:e,deviceOS:i.deviceOS,deviceManufacturer:i.deviceManufacturer,systemPushEnabled:i.systemPushEnabled}),[4,l.send(u)]);case 2:return d.sent(),[4,Xi((function(){return N(c,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return s.setDeviceToken(x.FCM,e,i),[4,s.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return d.sent(),this._fcmPushToken="",[2,k.SUCCESS];case 4:return d.sent(),[2,k.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=e,[2,k.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:if(Ia(q("string",e)).throw(H.invalidParameters),!this.currentUser)return[3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),t=As.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,a=new Mm({userId:r.userId,token:e}),[4,i.send(a)];case 2:return s=l.sent().lastDeletedAt,[4,Xi((function(){return N(o,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return n.unsetDeviceToken(x.FCM,e),n.setDeviceTokenDeletedAt(s),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return l.sent(),this._fcmPushToken="",[2,k.SUCCESS];case 4:return l.sent(),[2,k.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=e,[2,k.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return this.currentUser?(e=As.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i=new Rm({userId:n.userId}),[4,r.send(i)]):[3,3];case 1:return a=o.sent().lastDeletedAt,[4,Xi((function(){return N(s,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(x.FCM),t.setDeviceTokenDeletedAt(a),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},e.prototype.registerAPNSPushTokenForCurrentUser=function(e,t){var n,r;return N(this,0,void 0,(function(){var i,a,s,o,l,u,c=this;return S(this,(function(d){switch(d.label){case 0:if(Ia(q("string",e)&&q("string",null==t?void 0:t.deviceManufacturer,!0)).throw(H.invalidParameters),(null==t?void 0:t.deviceOS)&&Ia(z(_t,t.deviceOS.platform,!0)&&q("string",t.deviceOS.version,!0)).throw(H.invalidParameters),!this.currentUser)return[3,6];i={deviceOS:"".concat((null===(n=null==t?void 0:t.deviceOS)||void 0===n?void 0:n.platform)||_t.IOS,"-").concat((null===(r=null==t?void 0:t.deviceOS)||void 0===r?void 0:r.version)||"unknown"),deviceManufacturer:null==t?void 0:t.deviceManufacturer,systemPushEnabled:null==t?void 0:t.systemPushEnabled},d.label=1;case 1:return d.trys.push([1,4,,5]),a=As.of(this._iid),s=a.sessionManager,o=a.sdkState,l=a.requestQueue,s.hasDeviceToken(x.APNS,e)?[2,k.SUCCESS]:(u=new Im({userId:o.userId,token:e,deviceOS:i.deviceOS,deviceManufacturer:i.deviceManufacturer,systemPushEnabled:i.systemPushEnabled}),[4,l.send(u)]);case 2:return d.sent(),[4,Xi((function(){return N(c,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return s.setDeviceToken(x.APNS,e,i),[4,s.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return d.sent(),this._apnsPushToken="",[2,k.SUCCESS];case 4:return d.sent(),[2,k.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=e,[2,k.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o=this;return S(this,(function(l){switch(l.label){case 0:if(Ia(q("string",e)).throw(H.invalidParameters),!this.currentUser)return[3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),t=As.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,a=new Am({userId:r.userId,token:e}),[4,i.send(a)];case 2:return s=l.sent().lastDeletedAt,[4,Xi((function(){return N(o,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return n.unsetDeviceToken(x.APNS,e),n.setDeviceTokenDeletedAt(s),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return l.sent(),this._apnsPushToken="",[2,k.SUCCESS];case 4:return l.sent(),[2,k.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=e,[2,k.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return this.currentUser?(e=As.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i=new Om({userId:n.userId}),[4,r.send(i)]):[3,3];case 1:return a=o.sent().lastDeletedAt,[4,Xi((function(){return N(s,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(x.APNS),t.setDeviceTokenDeletedAt(a),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},e.prototype.markPushNotificationAsDelivered=function(e,t){var n;return void 0===t&&(t=!0),N(this,0,void 0,(function(){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y;return S(this,(function(C){switch(C.label){case 0:if(r=As.of(this._iid),i=r.logger,a=r.sessionManager,s=r.requestQueue,o=r.pushNotificationAckManager,i.debug("markPushNotificationAsDelivered:",e),l=fv.DELIVERED,u=o.parseData(e),c=u.pushTrackingId,d=u.sessionTopics,h=u.sessionKey,f=u.messageId,p=u.channelKey,_=u.templateKey,m=u.notificationEventDeadline,!h)throw i.info("Can't use markPushNotificationAsDelivered() feature."),H.malformedDataError;if(!d.includes(us.PUSH_ACKNOWLEDGEMENT))throw i.info("Can't use markPushNotificationAsDelivered() feature."),H.malformedDataError;if(o.isAcked(c,l))return i.info("already delivered push notification:",c),[2];v=Boolean(p),g=t&&v,E=null===(n=a.deviceTokens[0])||void 0===n?void 0:n.token,b=new Tv({deviceToken:null!=E?E:"",pushTrackingId:c,eventType:l,messageId:f,channelKey:p,templateKey:_,notificationEventDeadline:m,allowedPushNotification:g}),h&&(b.headers["Session-Key"]=h),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,s.send(b)];case 2:return C.sent(),o.markAsAcked(c,l),[3,4];case 3:throw y=C.sent(),i.debug("failed to mark push notification as delivered. push tracking id: ".concat(c,". error: ").concat(y)),y;case 4:return[2]}}))}))},e.prototype.markPushNotificationAsClicked=function(e){var t;return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g;return S(this,(function(E){switch(E.label){case 0:if(n=As.of(this._iid),r=n.logger,i=n.sessionManager,a=n.requestQueue,s=n.pushNotificationAckManager,r.debug("markPushNotificationAsClicked:",e),o=fv.CLICKED,l=s.parseData(e),u=l.pushTrackingId,c=l.sessionTopics,d=l.sessionKey,h=l.messageId,f=l.channelKey,p=l.templateKey,_=l.notificationEventDeadline,!d)throw r.info("Can't use markPushNotificationAsClicked() feature."),H.malformedDataError;if(!c.includes(us.PUSH_ACKNOWLEDGEMENT))throw r.info("Can't use markPushNotificationAsClicked() feature."),H.malformedDataError;if(s.isAcked(u,o))return r.info("already clicked push notification:",u),[2];m=null===(t=i.deviceTokens[0])||void 0===t?void 0:t.token,v=new Tv({deviceToken:null!=m?m:"",pushTrackingId:u,eventType:o,messageId:h,channelKey:f,templateKey:p,notificationEventDeadline:_}),d&&(v.headers["Session-Key"]=d),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,a.send(v)];case 2:return E.sent(),s.markAsAcked(u,o),[3,4];case 3:throw g=E.sent(),r.debug("failed to mark push notification as clicked. push tracking id: ".concat(u,". error: ").concat(g)),g;case 4:return[2]}}))}))},e.prototype.getChannelInvitationPreference=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Lm({userId:t.userId}),[4,n.send(r)];case 1:return[2,{autoAccept:i.sent().as(xm).autoAccept}]}}))}))},e.prototype.setChannelInvitationPreference=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("boolean",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Um({userId:n.userId,willAutoAccept:e}),[4,r.send(i)];case 1:return[2,{autoAccept:a.sent().as(Pm).autoAccept}]}}))}))},e.prototype.getDoNotDisturb=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Fm({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Bm).preference]}}))}))},e.prototype.setDoNotDisturb=function(e,t,n,r,i,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=""),N(this,0,void 0,(function(){var s,o,l,u;return S(this,(function(c){switch(c.label){case 0:return Ia(q("boolean",e)&&q("number",t)&&q("number",n)&&q("number",r)&&q("number",i)&&q("string",a)).throw(H.invalidParameters),s=As.of(this._iid),o=s.sdkState,l=s.requestQueue,u=new Hm({userId:o.userId,doNotDisturbOn:e,startHour:t,startMin:n,endHour:r,endMin:i,timezone:a}),[4,l.send(u)];case 1:return[2,c.sent().as(Gm).preference]}}))}))},e.prototype.getSnoozePeriod=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new jm({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Vm).snoozePeriod]}}))}))},e.prototype.setSnoozePeriod=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),N(this,0,void 0,(function(){var r,i,a,s;return S(this,(function(o){switch(o.label){case 0:return Ia(q("boolean",e)&&q("number",t)&&q("number",n)).throw(H.invalidParameters),r=As.of(this._iid),i=r.sdkState,a=r.requestQueue,s=new qm({userId:i.userId,snoozeOn:e,startTs:t,endTs:n}),[4,a.send(s)];case 1:return[2,o.sent().as(zm).snoozePeriod]}}))}))},e.prototype.getMyPushTokensByToken=function(e,t){return N(this,0,void 0,(function(){var n,r,i,a,s,o,l,u,c,d,h,f;return S(this,(function(p){switch(p.label){case 0:return Ia(q("string",e)&&z(x,t)).throw(H.invalidParameters),n=As.of(this._iid),r=n.sdkState,i=n.requestQueue,a=n.sessionManager,s=new Dm({userId:r.userId,type:t,token:e}),[4,i.send(s)];case 1:o=p.sent(),l=o.as(km).pushTokens;try{for(u=I(l.deviceTokens),c=u.next();!c.done;c=u.next())d=c.value,a.setDeviceToken(l.type,d)}catch(_){h={error:_}}finally{try{c&&!c.done&&(f=u.return)&&f.call(u)}finally{if(h)throw h.error}}return[4,a.saveDeviceToken()];case 2:return p.sent(),[2,l]}}))}))},e.prototype.getPushTriggerOption=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Wm({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Qm).pushTriggerOption]}}))}))},e.prototype.setPushTriggerOption=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(z(L,e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Xm({userId:n.userId,pushTriggerOption:e}),[4,r.send(i)];case 1:return[2,a.sent().as(Zm).pushTriggerOption]}}))}))},e.prototype.getPushTemplate=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Jm({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as($m).name]}}))}))},e.prototype.setPushTemplate=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(z(P,e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ev({userId:n.userId,templateName:e}),[4,r.send(i)];case 1:return[2,a.sent().as(tv).name]}}))}))},e.prototype.blockUser=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(e instanceof Aa||q("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Km({userId:n.userId,blockedUserId:e instanceof Aa?e.userId:e}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},e.prototype.blockUserWithUserId=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.blockUser(e)]}))}))},e.prototype.unblockUser=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(e instanceof Aa||q("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ym({userId:n.userId,unblockedUserId:e instanceof Aa?e.userId:e}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},e.prototype.unblockUserWithUserId=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.unblockUser(e)]}))}))},e.prototype.getFriendChangeLogsByToken=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new nv({userId:n.userId,token:e}),[4,r.send(i)];case 1:return[2,a.sent().as(rv).changelogs]}}))}))},e.prototype.getAllowFriendDiscovery=function(){return N(this,0,void 0,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:return e=As.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new cv({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(dv).allowFriendDiscovery]}}))}))},e.prototype.setAllowFriendDiscovery=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("boolean",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new hv({userId:n.userId,allowFriendDiscovery:e}),[4,r.send(i)];case 1:return a.sent(),[2,e]}}))}))},e.prototype.uploadFriendDiscoveries=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new iv({userId:n.userId,discoveries:e}),[4,r.send(i)];case 1:return[2,a.sent().as(av).friendDiscoveryRequestId]}}))}))},e.prototype.deleteFriendDiscovery=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.deleteFriendDiscoveries([e])]}))}))},e.prototype.deleteFriendDiscoveries=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new sv({userId:n.userId,discoveryKeys:e}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},e.prototype.addFriends=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ov({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return[2,a.sent().as(lv).users]}}))}))},e.prototype.deleteFriend=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this.deleteFriends([e])]}))}))},e.prototype.deleteFriends=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(Y("string",e)).throw(H.invalidParameters),t=As.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new uv({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return a.sent(),[2]}}))}))},e.prototype.getAllEmoji=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new pv,[4,e.send(t)];case 1:return[2,n.sent().as(_v).emojiContainer]}}))}))},e.prototype.getEmojiCategory=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new mv({categoryId:e}),[4,t.send(n)];case 1:return[2,r.sent().as(vv).emojiCategory]}}))}))},e.prototype.getEmoji=function(e){return N(this,0,void 0,(function(){var t,n;return S(this,(function(r){switch(r.label){case 0:return t=As.of(this._iid).requestQueue,n=new gv({key:e}),[4,t.send(n)];case 1:return[2,r.sent().as(Ev).emoji]}}))}))},e.prototype.getUIKitConfiguration=function(){return N(this,0,void 0,(function(){var e,t,n;return S(this,(function(r){switch(r.label){case 0:return e=As.of(this._iid),Ia(e.hasExtension("sb_uikit")).throw(H.notSupportedError),t=e.requestQueue,n=new bv,[4,t.send(n)];case 1:return[2,r.sent().as(yv).uikitConfiguration]}}))}))},e.prototype.getReportCategoryInfoList=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,As.of(this._iid).reportCategoryManager.categories()];case 1:return[2,e.sent()]}}))}))},e}();function Sv(e){return null!=e&&"sendingStatus"in e}function Iv(e,t="##__USER_ID_IS_NOT_PROVIDED__##"){var n;return!!Sv(e)&&(null===(n=e.sender)||void 0===n?void 0:n.userId)===t}function wv(e){return"sendingStatus"in e?"succeeded"===e.sendingStatus?String(e.messageId):e.reqId:String(e.messageId)}function Av(e){return"boolean"==typeof e}function Mv(e,t){return t.includes(e)}function Ov(e){return!(!e||!Array.isArray(e))&&0!==e.length}function Rv(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>Rv(e)));const t={};return Object.keys(e).forEach((n=>{const r=n.replace(/_\w/g,(e=>e[1].toUpperCase()));t[r]=Rv(e[n])})),t}function Dv(e,t){return e.reduce(((e,n)=>(e[t(n)]=n,e)),{})}const kv=(e,t)=>{var n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,[]);switch(t.type){case"update_initialized":return n.initialized=t.value.status,n;case"update_refreshing":return n.refreshing=t.value.status,n;case"update_loading":return n.loading=t.value.status,n;case"update_messages":if(t.value.clearBeforeAction)n.messageMap=Lv(t.value.messages);else{const e=Object.assign({},n.messageMap),r=[],i=[];t.value.messages.forEach((t=>{[Sv(t)?t.reqId:void 0,t.messageId||void 0].forEach((n=>{if(!n)return;const a=e[n];xv(a,t)&&(a&&r.push(a),i.push(t))}))})),r.forEach((t=>{Sv(t)&&delete e[t.reqId],delete e[t.messageId]})),i.forEach((t=>{Sv(t)&&(e[t.reqId]=t),e[t.messageId]=t})),n.messageMap=e}return n;case"update_new_messages":{const e=t.value.currentUserId,r=t.value.messages.filter((t=>{return!Iv(n=t,e)&&!n.isAdminMessage()&&0===n.updatedAt;var n}));if(t.value.clearBeforeAction)n.newMessageMap=Dv(r,wv);else{r.map((e=>e.messageId)).forEach((e=>delete n.newMessageMap[e])),n.newMessageMap=Object.assign(Object.assign({},n.newMessageMap),Dv(r,wv))}return n}case"delete_messages":case"delete_new_messages":{const e="delete_messages"===t.type?"messageMap":"newMessageMap";return n[e]=Object.assign({},n[e]),t.value.messageIds.forEach((t=>{const r=n[e][t];r&&(Sv(r)&&delete n[e][r.reqId],delete n[e][r.messageId])})),t.value.reqIds.forEach((t=>{const r=n[e][t];r&&(Sv(r)&&delete n[e][r.reqId],delete n[e][r.messageId])})),n}}},Lv=e=>e.reduce(((e,t)=>(Sv(t)?(e[t.reqId]=t,t.sendingStatus===pe.SUCCEEDED&&(e[t.messageId]=t)):e[t.messageId]=t,e)),{}),xv=(e,t)=>!Sv(e)||!Sv(t)||(e.sendingStatus===pe.SUCCEEDED?t.sendingStatus===pe.SUCCEEDED:e.sendingStatus!==t.sendingStatus),Uv=(e=Fv)=>{const[{initialized:n,loading:r,refreshing:i,messageMap:a,newMessageMap:s},o]=t.useReducer(kv,{initialized:!1,loading:!0,refreshing:!1,messageMap:{},newMessageMap:{}}),l=Object.values(s);return{updateInitialized:e=>{o({type:"update_initialized",value:{status:e}})},updateLoading:e=>{o({type:"update_loading",value:{status:e}})},updateRefreshing:e=>{o({type:"update_refreshing",value:{status:e}})},updateMessages:(e,t,n)=>{o({type:"update_messages",value:{messages:e,clearBeforeAction:t,currentUserId:n}})},deleteMessages:(e,t)=>{o({type:"delete_messages",value:{messageIds:e,reqIds:t}})},initialized:n,loading:r,refreshing:i,messages:t.useMemo((()=>Array.from(new Set(Object.values(a))).sort(e)),[a]),newMessages:l,updateNewMessages:(e,t,n)=>{o({type:"update_new_messages",value:{messages:e,clearBeforeAction:t,currentUserId:n}})},deleteNewMessages:(e,t)=>{o({type:"delete_new_messages",value:{messageIds:e,reqIds:t}})}}},Pv=Math.floor(Number.MAX_SAFE_INTEGER/10);function Fv(e,t){let n=0,r=0;return Sv(e)&&"succeeded"!==e.sendingStatus&&(n=Pv),Sv(t)&&"succeeded"!==t.sendingStatus&&(r=Pv),e.createdAt+n-(t.createdAt+r)}var Bv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Hv(e){return e<Date.now()?J_.collection.message.searchLimit:J_.collection.message.defaultLimit}const Gv=(e,n,r={})=>{var i,a,s;const o=t.useRef(r);o.current=r;const l=t.useRef(n);l.current=n;const u=o.current.logger,c=null!==(i=o.current.startingPoint)&&void 0!==i?i:Number.MAX_SAFE_INTEGER,d=Hv(c),h=t.useRef({prev:!1,next:!1}),f=(()=>{const[,e]=t.useState(0);return t.useCallback((()=>e((e=>e+1))),[])})(),p=t.useRef({initialized:!1,apiInitialized:!1,instance:null}),{initialized:_,loading:m,refreshing:v,messages:g,newMessages:E,updateMessages:b,updateNewMessages:y,deleteNewMessages:C,deleteMessages:T,updateInitialized:N,updateLoading:S,updateRefreshing:I}=Uv(null==r?void 0:r.sortComparator),w=am((e=>{var t,n,r,i;if(!l.current||!l.current.url)return null===(t=null==u?void 0:u.error)||void 0===t?void 0:t.call(u,"[useGroupChannelMessages] channel is required");try{switch(e){case bs.EVENT_MESSAGE_RECEIVED:case bs.EVENT_MESSAGE_SENT_SUCCESS:case bs.SYNC_MESSAGE_FILL:case void 0:null===(r=(n=o.current).markAsRead)||void 0===r||r.call(n,[l.current])}}catch(O){null===(i=null==u?void 0:u.warn)||void 0===i||i.call(u,"[useGroupChannelMessages/markAsReadBySource]",O)}})),A=am(((t,n)=>{var r,i,a,s,l;const u=n.filter((t=>{var n;return!Iv(t,null===(n=e.currentUser)||void 0===n?void 0:n.userId)}));if(u.length>0)switch(t){case bs.EVENT_MESSAGE_RECEIVED:case bs.SYNC_MESSAGE_FILL:(null===(i=(r=o.current).shouldCountNewMessages)||void 0===i?void 0:i.call(r))&&y(u,!1,null===(a=e.currentUser)||void 0===a?void 0:a.userId),null===(l=(s=o.current).onMessagesReceived)||void 0===l||l.call(s,u)}})),M=am(((t,n)=>Bv(void 0,void 0,void 0,(function*(){return new Promise((r=>{var i,a;if(!l.current||!l.current.url)return null===(i=null==u?void 0:u.error)||void 0===i?void 0:i.call(u,"[useGroupChannelMessages] channel is required");p.current.instance&&p.current.instance.dispose(),w(),y([],!0,null===(a=e.currentUser)||void 0===a?void 0:a.userId);const s=()=>{var t,n,r;const{pendingMessages:i,failedMessages:a}=null!==(t=p.current.instance)&&void 0!==t?t:{};Ov(i)&&b(i,!1,null===(n=e.currentUser)||void 0===n?void 0:n.userId),Ov(a)&&b(a,!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId)},c=((e,t,n)=>{var r;const i={prevResultLimit:t.prev,nextResultLimit:t.next,startingPoint:null==n?void 0:n.startingPoint,replyType:null==n?void 0:n.replyType},a=null===(r=null==n?void 0:n.collectionCreator)||void 0===r?void 0:r.call(n,i);return a||e.createMessageCollection(Object.assign(Object.assign({},i),{filter:new ih(i)}))})(l.current,n,Object.assign(Object.assign({},o.current),{startingPoint:t}));p.current={apiInitialized:!1,initialized:!1,instance:c},c.setMessageCollectionHandler({onMessagesAdded:(t,n,r)=>{var i;w(t.source),A(t.source,r),b(r,!1,null===(i=e.currentUser)||void 0===i?void 0:i.userId)},onMessagesUpdated:(t,n,r)=>{var i,a,s;w(t.source),A(t.source,r),b(r,!1,null===(i=e.currentUser)||void 0===i?void 0:i.userId),t.source===bs.EVENT_MESSAGE_UPDATED&&(null===(s=(a=o.current).onMessagesUpdated)||void 0===s||s.call(a,r))},onMessagesDeleted:(e,t,n,r)=>{const i=r.map((e=>e.messageId)),a=r.filter(Sv).map((e=>e.reqId));T(i,a),C(i,a)},onChannelDeleted:(e,t)=>{var n,r;null===(r=(n=o.current).onChannelDeleted)||void 0===r||r.call(n,t)},onChannelUpdated:(e,t)=>{var n,r;f(),null===(r=(n=o.current).onChannelUpdated)||void 0===r||r.call(n,t)},onHugeGapDetected:()=>{M(Number.MAX_SAFE_INTEGER,J_.collection.message.defaultLimit)}}),c.initialize(Rp.CACHE_AND_REPLACE_BY_API).onCacheResult(((t,n)=>{var i,a,o;t?e.isCacheEnabled&&(null===(i=null==u?void 0:u.error)||void 0===i||i.call(u,"[useGroupChannelMessages/onCacheResult]",t)):n&&(null===(a=null==u?void 0:u.debug)||void 0===a||a.call(u,"[useGroupChannelMessages/onCacheResult]","message length:",n.length),b(n,!0,null===(o=e.currentUser)||void 0===o?void 0:o.userId),s(),n.length>0&&(p.current.initialized=!0,r()))})).onApiResult(((t,n)=>{var i,a,l,c,d;t?null===(i=null==u?void 0:u.warn)||void 0===i||i.call(u,"[useGroupChannelMessages/onApiResult]",t):n&&(null===(a=null==u?void 0:u.debug)||void 0===a||a.call(u,"[useGroupChannelMessages/onApiResult]","message length:",n.length),b(n,!0,null===(l=e.currentUser)||void 0===l?void 0:l.userId),o.current.startingPoint||null===(d=(c=o.current).onMessagesReceived)||void 0===d||d.call(c,n),e.isCacheEnabled&&s()),p.current.initialized=!0,p.current.apiInitialized=!0,r()}))}))}))));im(e,{onUserBanned(t,n){var r,i,a,s,u;t.isGroupChannel()&&(s=t,u=l.current,s&&u&&s.url===u.url)&&(n.userId===(null===(r=e.currentUser)||void 0===r?void 0:r.userId)?null===(a=(i=o.current).onCurrentUserBanned)||void 0===a||a.call(i):f())}}),t.useLayoutEffect((()=>{const t=setTimeout((()=>Bv(void 0,void 0,void 0,(function*(){e.currentUser&&l.current&&(N(!1),S(!0),yield M(c,d),S(!1),N(!0))}))));return()=>clearTimeout(t)}),[e,null===(a=e.currentUser)||void 0===a?void 0:a.userId,null===(s=l.current)||void 0===s?void 0:s.url,o.current.replyType]),t.useEffect((()=>()=>{p.current.instance&&p.current.instance.dispose()}),[]);const R=am((()=>Bv(void 0,void 0,void 0,(function*(){e.currentUser&&l.current&&(I(!0),yield M(Number.MAX_SAFE_INTEGER,J_.collection.message.defaultLimit),I(!1))})))),D=am((()=>Bv(void 0,void 0,void 0,(function*(){var t;const n=p.current.instance;if((null==n?void 0:n.hasPrevious)&&!h.current.prev)try{h.current.prev=!0;const r=yield n.loadPrevious();b(r,!1,null===(t=e.currentUser)||void 0===t?void 0:t.userId)}catch(r){}finally{h.current.prev=!1}})))),k=am((()=>{const{initialized:e,instance:t}=p.current;return!(!e||!t)&&t.hasPrevious})),L=am((()=>Bv(void 0,void 0,void 0,(function*(){var t;const n=p.current.instance;if((null==n?void 0:n.hasNext)&&!h.current.next)try{h.current.next=!0;const r=yield n.loadNext();b(r,!1,null===(t=e.currentUser)||void 0===t?void 0:t.userId)}catch(r){}finally{h.current.next=!1}})))),x=am((()=>{const{initialized:e,apiInitialized:t,instance:n}=p.current;return!!(t&&e&&n)&&n.hasNext})),U=am(((t,n)=>{var r;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");return new Promise(((r,i)=>{l.current.sendUserMessage(t).onPending((t=>{var r;t.channelUrl===l.current.url&&b([t],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),null==n||n(t)})).onSucceeded((t=>{var n;t.channelUrl===l.current.url&&b([t],!1,null===(n=e.currentUser)||void 0===n?void 0:n.userId),r(t)})).onFailed(((t,n)=>{var r;n&&n.channelUrl===l.current.url&&b([n],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),i(t)}))}))})),P=am(((t,n)=>{var r;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");return new Promise(((r,i)=>{l.current.sendFileMessage(t).onPending((t=>{var r;t.channelUrl===l.current.url&&b([t],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),null==n||n(t)})).onSucceeded((t=>{var n;t.channelUrl===l.current.url&&b([t],!1,null===(n=e.currentUser)||void 0===n?void 0:n.userId),r(t)})).onFailed(((t,n)=>{var r;n&&n.channelUrl===l.current.url&&b([n],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),i(t)}))}))})),F=am(((t,n)=>Bv(void 0,void 0,void 0,(function*(){var r;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");return new Promise((r=>{const i=[];l.current.sendFileMessages(t).onPending((t=>{var r;t.channelUrl===l.current.url&&b([t],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),null==n||n(t)})).onSucceeded((n=>{var a;n.isFileMessage()&&n.channelUrl===l.current.url&&(b([n],!1,null===(a=e.currentUser)||void 0===a?void 0:a.userId),i.push(n)),i.length===t.length&&r(i)})).onFailed(((n,a)=>{var s;a&&a.channelUrl===l.current.url?(b([a],!1,null===(s=e.currentUser)||void 0===s?void 0:s.userId),i.push(a)):i.push(null),i.length===t.length&&r(i)}))}))})))),B=am(((t,n)=>{var r;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");return new Promise(((r,i)=>{l.current.sendMultipleFilesMessage(t).onPending((t=>{var r;t.channelUrl===l.current.url&&b([t],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),null==n||n(t)})).onFileUploaded((()=>{f()})).onSucceeded((t=>{var n;t.channelUrl===l.current.url&&b([t],!1,null===(n=e.currentUser)||void 0===n?void 0:n.userId),r(t)})).onFailed(((t,n)=>{var r;n&&n.channelUrl===l.current.url&&b([n],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),i(t)}))}))})),H=am(((t,n)=>Bv(void 0,void 0,void 0,(function*(){var r,i;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");const a=yield l.current.updateUserMessage(t,n);return a.channelUrl===l.current.url&&b([a],!1,null===(i=e.currentUser)||void 0===i?void 0:i.userId),a})))),G=am(((t,n)=>Bv(void 0,void 0,void 0,(function*(){var r,i;if(!l.current||!l.current.url)throw null===(r=null==u?void 0:u.error)||void 0===r||r.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");const a=yield l.current.updateFileMessage(t,n);return a.channelUrl===l.current.url&&b([a],!1,null===(i=e.currentUser)||void 0===i?void 0:i.userId),a})))),j=am((t=>Bv(void 0,void 0,void 0,(function*(){var n;if(!l.current||!l.current.url)throw null===(n=null==u?void 0:u.error)||void 0===n||n.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");return new Promise(((n,r)=>{let i;t.isUserMessage()&&(i=l.current.resendMessage(t)),t.isFileMessage()&&(i=l.current.resendMessage(t)),t.isMultipleFilesMessage()&&(i=l.current.resendMessage(t)),i&&("onPending"in i&&i.onPending((t=>{var n;t.channelUrl===l.current.url&&b([t],!1,null===(n=e.currentUser)||void 0===n?void 0:n.userId)})),"onFileUploaded"in i&&i.onFileUploaded((()=>{f()})),"onSucceeded"in i&&i.onSucceeded((t=>{var r;t.channelUrl===l.current.url&&b([t],!1,null===(r=e.currentUser)||void 0===r?void 0:r.userId),n(t)})),"onFailed"in i&&i.onFailed(((t,n)=>{var i;n&&n.channelUrl===l.current.url&&b([n],!1,null===(i=e.currentUser)||void 0===i?void 0:i.userId),r(t)})))}))})))),V=am((e=>Bv(void 0,void 0,void 0,(function*(){var t,n;if(!l.current||!l.current.url)throw null===(t=null==u?void 0:u.error)||void 0===t||t.call(u,"[useGroupChannelMessages] channel is required"),new Error("Channel is required");if("succeeded"===e.sendingStatus)e.isUserMessage()&&(yield l.current.deleteMessage(e)),e.isFileMessage()&&(yield l.current.deleteMessage(e)),e.isMultipleFilesMessage()&&(yield l.current.deleteMessage(e));else try{yield null===(n=p.current.instance)||void 0===n?void 0:n.removeFailedMessage(e.reqId)}finally{T([e.messageId],[e.reqId])}}))));return{initialized:_,loading:m,refreshing:v,messages:g,newMessages:E,resetNewMessages:am((()=>{var t;y([],!0,null===(t=e.currentUser)||void 0===t?void 0:t.userId)})),refresh:R,loadPrevious:D,hasPrevious:k,loadNext:L,hasNext:x,sendUserMessage:U,sendFileMessage:P,sendFileMessages:F,sendMultipleFilesMessage:B,updateUserMessage:H,updateFileMessage:G,resendMessage:j,deleteMessage:V,resetWithStartingPoint:am((t=>Bv(void 0,void 0,void 0,(function*(){var n;if(e.currentUser&&l.current){const r=Hv(t);S(!0),b([],!0,null===(n=e.currentUser)||void 0===n?void 0:n.userId),yield M(t,r),S(!1)}})))),_dangerous_reducer_updateMessages:b,_dangerous_reducer_deleteMessages:T}},jv=e=>Vv(e),Vv=e=>"function"==typeof e&&e();function qv(e,t){const n=Object.assign({},e);return Object.keys(t).forEach((e=>{var r,i;Object.prototype.hasOwnProperty.call(n,e)&&(r=n[e],i=t[e],Object.prototype.toString.call(r)===Object.prototype.toString.call(i))&&("object"!=typeof t[e]||Array.isArray(t[e])?n[e]=t[e]:n[e]=qv(n[e],t[e]))})),n}const zv=()=>({common:{enableUsingDefaultUserProfile:!1},groupChannel:{channel:{enableMention:!1,enableOgtag:!0,enableReactions:!0,enableReactionsSupergroup:!1,enableTypingIndicator:!0,enableVoiceMessage:!1,input:{camera:{enablePhoto:!0,enableVideo:!0},enableDocument:!0,gallery:{enablePhoto:!0,enableVideo:!0}},replyType:"quote_reply",threadReplySelectType:"thread",typingIndicatorTypes:new Set(["text"]),enableFeedback:!1,enableSuggestedReplies:!1,showSuggestedRepliesFor:"last_message_only",suggestedRepliesDirection:"vertical",enableMarkdownForUserMessage:!1,enableFormTypeMessage:!1},channelList:{enableMessageReceiptStatus:!1,enableTypingIndicator:!1},setting:{enableMessageSearch:!1}},openChannel:{channel:{enableOgtag:!0,input:{camera:{enablePhoto:!0,enableVideo:!0},enableDocument:!0,gallery:{enablePhoto:!0,enableVideo:!0}}}}});const Kv=()=>function(e){return delete e.groupChannel.channel.typingIndicatorTypes,delete e.groupChannel.channel.enableFeedback,delete e.groupChannel.channel.enableSuggestedReplies,delete e.groupChannel.channel.showSuggestedRepliesFor,delete e.groupChannel.channel.suggestedRepliesDirection,delete e.groupChannel.channel.enableMarkdownForUserMessage,delete e.groupChannel.channel.enableFormTypeMessage,e}(zv()),Yv=zv(),Wv=Kv();var Qv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Xv={items:{},getItem(e){var t;return Qv(this,void 0,void 0,(function*(){return null!==(t=Xv.items[e])&&void 0!==t?t:null}))},setItem(e,t){return Qv(this,void 0,void 0,(function*(){Xv.items[e]=t}))}};class Zv{constructor(e){this.storage=null!=e?e:Xv}init(e){return this.key=`sbu@${e}.uikitConfiguration`,this.get()}get safeKey(){if(!this.key)throw new Error("Please UIKitConfigManager.init() first");return this.key}update(e){return Qv(this,void 0,void 0,(function*(){const t=yield this.get(),n={updatedAt:e.updatedAt,configuration:qv(t.configuration,e.configuration)};return yield this.storage.setItem(this.safeKey,JSON.stringify(n)),n}))}get(){return Qv(this,void 0,void 0,(function*(){const e={updatedAt:0,configuration:Wv};try{const t=yield this.storage.getItem(this.safeKey);return t?JSON.parse(t):e}catch(t){return e}}))}}function Jv(e,t,n){!function(e,t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N,S,I,w,A,M,O,R,D,k,L,x,U,P,F,B,H,G,j,V,q,z,K,Y,W,Q,X,Z,J,$,ee,te,ne,re,ie,ae,se,oe,le,ue,ce,de,he,fe,pe,_e,me,ve,ge,Ee,be,ye,Ce,Te,Ne,Se,Ie,we,Ae,Me,Oe,Re,De,ke,Le,xe,Ue,Pe,Fe,Be,He,Ge,je,Ve,qe,ze,Ke,Ye,We,Qe,Xe,Ze,Je,$e,et,tt,nt,rt,it,at;(null===(r=n.groupChannel)||void 0===r?void 0:r.channel)&&Av(null===(a=null===(i=n.groupChannel)||void 0===i?void 0:i.channel)||void 0===a?void 0:a.enableOgtag)&&(e.channel.enableOgtag=n.groupChannel.channel.enableOgtag);(null===(s=t.groupChannel)||void 0===s?void 0:s.channel)&&Av(null===(l=null===(o=t.groupChannel)||void 0===o?void 0:o.channel)||void 0===l?void 0:l.enableOgtag)&&(e.channel.enableOgtag=null===(c=null===(u=t.groupChannel)||void 0===u?void 0:u.channel)||void 0===c?void 0:c.enableOgtag);(null===(d=n.groupChannel)||void 0===d?void 0:d.channel)&&Av(null===(f=null===(h=n.groupChannel)||void 0===h?void 0:h.channel)||void 0===f?void 0:f.enableTypingIndicator)&&(e.channel.enableTypingIndicator=null===(_=null===(p=n.groupChannel)||void 0===p?void 0:p.channel)||void 0===_?void 0:_.enableTypingIndicator);(null===(m=t.groupChannel)||void 0===m?void 0:m.channel)&&Av(null===(g=null===(v=t.groupChannel)||void 0===v?void 0:v.channel)||void 0===g?void 0:g.enableTypingIndicator)&&(e.channel.enableTypingIndicator=null===(b=null===(E=t.groupChannel)||void 0===E?void 0:E.channel)||void 0===b?void 0:b.enableTypingIndicator);(null===(y=n.groupChannel)||void 0===y?void 0:y.channel)&&Av(null===(T=null===(C=n.groupChannel)||void 0===C?void 0:C.channel)||void 0===T?void 0:T.enableReactions)&&(e.channel.enableReactions=null===(S=null===(N=n.groupChannel)||void 0===N?void 0:N.channel)||void 0===S?void 0:S.enableReactions);(null===(I=t.groupChannel)||void 0===I?void 0:I.channel)&&Av(null===(A=null===(w=t.groupChannel)||void 0===w?void 0:w.channel)||void 0===A?void 0:A.enableReactions)&&(e.channel.enableReactions=null===(O=null===(M=t.groupChannel)||void 0===M?void 0:M.channel)||void 0===O?void 0:O.enableReactions);(null===(R=n.groupChannel)||void 0===R?void 0:R.channel)&&Av(null===(k=null===(D=n.groupChannel)||void 0===D?void 0:D.channel)||void 0===k?void 0:k.enableReactionsSupergroup)&&(e.channel.enableReactionsSupergroup=null===(x=null===(L=n.groupChannel)||void 0===L?void 0:L.channel)||void 0===x?void 0:x.enableReactionsSupergroup);(null===(U=t.groupChannel)||void 0===U?void 0:U.channel)&&Av(null===(F=null===(P=t.groupChannel)||void 0===P?void 0:P.channel)||void 0===F?void 0:F.enableReactionsSupergroup);(null===(B=n.groupChannel)||void 0===B?void 0:B.channel)&&Av(null===(G=null===(H=n.groupChannel)||void 0===H?void 0:H.channel)||void 0===G?void 0:G.enableMention)&&(e.channel.enableMention=null===(V=null===(j=n.groupChannel)||void 0===j?void 0:j.channel)||void 0===V?void 0:V.enableMention);(null===(q=t.groupChannel)||void 0===q?void 0:q.channel)&&Av(null===(K=null===(z=t.groupChannel)||void 0===z?void 0:z.channel)||void 0===K?void 0:K.enableMention)&&(e.channel.enableMention=null===(W=null===(Y=t.groupChannel)||void 0===Y?void 0:Y.channel)||void 0===W?void 0:W.enableMention);(null===(Q=n.groupChannel)||void 0===Q?void 0:Q.channel)&&Mv(null===(Z=null===(X=n.groupChannel)||void 0===X?void 0:X.channel)||void 0===Z?void 0:Z.replyType,["none","quote_reply","thread"])&&(e.channel.replyType=null===($=null===(J=n.groupChannel)||void 0===J?void 0:J.channel)||void 0===$?void 0:$.replyType);(null===(ee=t.groupChannel)||void 0===ee?void 0:ee.channel)&&Mv(null===(ne=null===(te=t.groupChannel)||void 0===te?void 0:te.channel)||void 0===ne?void 0:ne.replyType,["none","quote_reply","thread"])&&(e.channel.replyType=null===(ie=null===(re=t.groupChannel)||void 0===re?void 0:re.channel)||void 0===ie?void 0:ie.replyType);(null===(ae=n.groupChannel)||void 0===ae?void 0:ae.channel)&&Mv(null===(oe=null===(se=n.groupChannel)||void 0===se?void 0:se.channel)||void 0===oe?void 0:oe.threadReplySelectType,["thread","parent"])&&(e.channel.threadReplySelectType=null===(ue=null===(le=n.groupChannel)||void 0===le?void 0:le.channel)||void 0===ue?void 0:ue.threadReplySelectType);(null===(ce=t.groupChannel)||void 0===ce?void 0:ce.channel)&&Mv(null===(he=null===(de=t.groupChannel)||void 0===de?void 0:de.channel)||void 0===he?void 0:he.threadReplySelectType,["thread","parent"])&&(e.channel.threadReplySelectType=null===(pe=null===(fe=t.groupChannel)||void 0===fe?void 0:fe.channel)||void 0===pe?void 0:pe.threadReplySelectType);(null===(_e=n.groupChannel)||void 0===_e?void 0:_e.channel)&&Av(null===(ve=null===(me=n.groupChannel)||void 0===me?void 0:me.channel)||void 0===ve?void 0:ve.enableVoiceMessage)&&(e.channel.enableVoiceMessage=null===(Ee=null===(ge=n.groupChannel)||void 0===ge?void 0:ge.channel)||void 0===Ee?void 0:Ee.enableVoiceMessage);(null===(be=t.groupChannel)||void 0===be?void 0:be.channel)&&Av(null===(Ce=null===(ye=t.groupChannel)||void 0===ye?void 0:ye.channel)||void 0===Ce?void 0:Ce.enableVoiceMessage)&&(e.channel.enableVoiceMessage=null===(Ne=null===(Te=t.groupChannel)||void 0===Te?void 0:Te.channel)||void 0===Ne?void 0:Ne.enableVoiceMessage);(null===(Se=t.groupChannel)||void 0===Se?void 0:Se.channel)&&(st=null===(we=null===(Ie=t.groupChannel)||void 0===Ie?void 0:Ie.channel)||void 0===we?void 0:we.typingIndicatorTypes,st instanceof Set)&&(e.channel.typingIndicatorTypes=null===(Me=null===(Ae=t.groupChannel)||void 0===Ae?void 0:Ae.channel)||void 0===Me?void 0:Me.typingIndicatorTypes);var st;(null===(Oe=t.groupChannel)||void 0===Oe?void 0:Oe.channel)&&Av(null===(De=null===(Re=t.groupChannel)||void 0===Re?void 0:Re.channel)||void 0===De?void 0:De.enableFeedback)&&(e.channel.enableFeedback=null===(Le=null===(ke=t.groupChannel)||void 0===ke?void 0:ke.channel)||void 0===Le?void 0:Le.enableFeedback);(null===(xe=t.groupChannel)||void 0===xe?void 0:xe.channel)&&Av(null===(Pe=null===(Ue=t.groupChannel)||void 0===Ue?void 0:Ue.channel)||void 0===Pe?void 0:Pe.enableSuggestedReplies)&&(e.channel.enableSuggestedReplies=null===(Be=null===(Fe=t.groupChannel)||void 0===Fe?void 0:Fe.channel)||void 0===Be?void 0:Be.enableSuggestedReplies);(null===(He=t.groupChannel)||void 0===He?void 0:He.channel)&&Mv(null===(je=null===(Ge=t.groupChannel)||void 0===Ge?void 0:Ge.channel)||void 0===je?void 0:je.showSuggestedRepliesFor,["all_messages","last_message_only"])&&(e.channel.showSuggestedRepliesFor=null===(qe=null===(Ve=t.groupChannel)||void 0===Ve?void 0:Ve.channel)||void 0===qe?void 0:qe.showSuggestedRepliesFor);(null===(ze=t.groupChannel)||void 0===ze?void 0:ze.channel)&&Mv(null===(Ye=null===(Ke=t.groupChannel)||void 0===Ke?void 0:Ke.channel)||void 0===Ye?void 0:Ye.suggestedRepliesDirection,["vertical","horizontal"])&&(e.channel.suggestedRepliesDirection=null===(Qe=null===(We=t.groupChannel)||void 0===We?void 0:We.channel)||void 0===Qe?void 0:Qe.suggestedRepliesDirection);(null===(Xe=t.groupChannel)||void 0===Xe?void 0:Xe.channel)&&Av(null===(Je=null===(Ze=t.groupChannel)||void 0===Ze?void 0:Ze.channel)||void 0===Je?void 0:Je.enableMarkdownForUserMessage)&&(e.channel.enableMarkdownForUserMessage=null===(et=null===($e=t.groupChannel)||void 0===$e?void 0:$e.channel)||void 0===et?void 0:et.enableMarkdownForUserMessage);(null===(tt=t.groupChannel)||void 0===tt?void 0:tt.channel)&&Av(null===(rt=null===(nt=t.groupChannel)||void 0===nt?void 0:nt.channel)||void 0===rt?void 0:rt.enableFormTypeMessage)&&(e.channel.enableFormTypeMessage=null===(at=null===(it=t.groupChannel)||void 0===it?void 0:it.channel)||void 0===at?void 0:at.enableFormTypeMessage)}(e,t,n),function(e,t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N,S,I,w,A,M,O,R,D,k,L,x,U,P,F,B,H,G,j,V,q,z,K,Y,W,Q,X,Z,J,$,ee,te,ne,re,ie,ae,se,oe,le,ue,ce,de,he,fe,pe,_e,me,ve,ge,Ee,be,ye,Ce,Te,Ne,Se,Ie,we,Ae,Me,Oe,Re,De,ke,Le,xe,Ue,Pe,Fe,Be,He,Ge,je,Ve,qe,ze,Ke,Ye,We,Qe,Xe,Ze,Je;(null===(i=null===(r=n.groupChannel)||void 0===r?void 0:r.channel)||void 0===i?void 0:i.input)&&Av(null===(o=null===(s=null===(a=n.groupChannel)||void 0===a?void 0:a.channel)||void 0===s?void 0:s.input)||void 0===o?void 0:o.enableDocument)&&(e.channel.input.enableDocument=null===(c=null===(u=null===(l=n.groupChannel)||void 0===l?void 0:l.channel)||void 0===u?void 0:u.input)||void 0===c?void 0:c.enableDocument);(null===(h=null===(d=t.groupChannel)||void 0===d?void 0:d.channel)||void 0===h?void 0:h.input)&&Av(null===(_=null===(p=null===(f=t.groupChannel)||void 0===f?void 0:f.channel)||void 0===p?void 0:p.input)||void 0===_?void 0:_.enableDocument)&&(e.channel.input.enableDocument=null===(g=null===(v=null===(m=t.groupChannel)||void 0===m?void 0:m.channel)||void 0===v?void 0:v.input)||void 0===g?void 0:g.enableDocument);(null===(y=null===(b=null===(E=n.groupChannel)||void 0===E?void 0:E.channel)||void 0===b?void 0:b.input)||void 0===y?void 0:y.camera)&&Av(null===(S=null===(N=null===(T=null===(C=n.groupChannel)||void 0===C?void 0:C.channel)||void 0===T?void 0:T.input)||void 0===N?void 0:N.camera)||void 0===S?void 0:S.enablePhoto)&&(e.channel.input.camera.enablePhoto=null===(M=null===(A=null===(w=null===(I=n.groupChannel)||void 0===I?void 0:I.channel)||void 0===w?void 0:w.input)||void 0===A?void 0:A.camera)||void 0===M?void 0:M.enablePhoto);(null===(D=null===(R=null===(O=t.groupChannel)||void 0===O?void 0:O.channel)||void 0===R?void 0:R.input)||void 0===D?void 0:D.camera)&&Av(null===(U=null===(x=null===(L=null===(k=t.groupChannel)||void 0===k?void 0:k.channel)||void 0===L?void 0:L.input)||void 0===x?void 0:x.camera)||void 0===U?void 0:U.enablePhoto)&&(e.channel.input.camera.enablePhoto=null===(H=null===(B=null===(F=null===(P=t.groupChannel)||void 0===P?void 0:P.channel)||void 0===F?void 0:F.input)||void 0===B?void 0:B.camera)||void 0===H?void 0:H.enablePhoto);(null===(V=null===(j=null===(G=n.groupChannel)||void 0===G?void 0:G.channel)||void 0===j?void 0:j.input)||void 0===V?void 0:V.camera)&&Av(null===(Y=null===(K=null===(z=null===(q=n.groupChannel)||void 0===q?void 0:q.channel)||void 0===z?void 0:z.input)||void 0===K?void 0:K.camera)||void 0===Y?void 0:Y.enableVideo)&&(e.channel.input.camera.enableVideo=null===(Z=null===(X=null===(Q=null===(W=n.groupChannel)||void 0===W?void 0:W.channel)||void 0===Q?void 0:Q.input)||void 0===X?void 0:X.camera)||void 0===Z?void 0:Z.enableVideo);(null===(ee=null===($=null===(J=t.groupChannel)||void 0===J?void 0:J.channel)||void 0===$?void 0:$.input)||void 0===ee?void 0:ee.camera)&&Av(null===(ie=null===(re=null===(ne=null===(te=t.groupChannel)||void 0===te?void 0:te.channel)||void 0===ne?void 0:ne.input)||void 0===re?void 0:re.camera)||void 0===ie?void 0:ie.enableVideo)&&(e.channel.input.camera.enableVideo=null===(le=null===(oe=null===(se=null===(ae=t.groupChannel)||void 0===ae?void 0:ae.channel)||void 0===se?void 0:se.input)||void 0===oe?void 0:oe.camera)||void 0===le?void 0:le.enableVideo);(null===(de=null===(ce=null===(ue=n.groupChannel)||void 0===ue?void 0:ue.channel)||void 0===ce?void 0:ce.input)||void 0===de?void 0:de.gallery)&&Av(null===(_e=null===(pe=null===(fe=null===(he=n.groupChannel)||void 0===he?void 0:he.channel)||void 0===fe?void 0:fe.input)||void 0===pe?void 0:pe.gallery)||void 0===_e?void 0:_e.enablePhoto)&&(e.channel.input.gallery.enablePhoto=null===(Ee=null===(ge=null===(ve=null===(me=n.groupChannel)||void 0===me?void 0:me.channel)||void 0===ve?void 0:ve.input)||void 0===ge?void 0:ge.gallery)||void 0===Ee?void 0:Ee.enablePhoto);(null===(Ce=null===(ye=null===(be=t.groupChannel)||void 0===be?void 0:be.channel)||void 0===ye?void 0:ye.input)||void 0===Ce?void 0:Ce.gallery)&&Av(null===(Ie=null===(Se=null===(Ne=null===(Te=t.groupChannel)||void 0===Te?void 0:Te.channel)||void 0===Ne?void 0:Ne.input)||void 0===Se?void 0:Se.gallery)||void 0===Ie?void 0:Ie.enablePhoto)&&(e.channel.input.gallery.enablePhoto=null===(Oe=null===(Me=null===(Ae=null===(we=t.groupChannel)||void 0===we?void 0:we.channel)||void 0===Ae?void 0:Ae.input)||void 0===Me?void 0:Me.gallery)||void 0===Oe?void 0:Oe.enablePhoto);(null===(ke=null===(De=null===(Re=n.groupChannel)||void 0===Re?void 0:Re.channel)||void 0===De?void 0:De.input)||void 0===ke?void 0:ke.gallery)&&Av(null===(Pe=null===(Ue=null===(xe=null===(Le=n.groupChannel)||void 0===Le?void 0:Le.channel)||void 0===xe?void 0:xe.input)||void 0===Ue?void 0:Ue.gallery)||void 0===Pe?void 0:Pe.enableVideo)&&(e.channel.input.gallery.enableVideo=null===(Ge=null===(He=null===(Be=null===(Fe=n.groupChannel)||void 0===Fe?void 0:Fe.channel)||void 0===Be?void 0:Be.input)||void 0===He?void 0:He.gallery)||void 0===Ge?void 0:Ge.enableVideo);(null===(qe=null===(Ve=null===(je=t.groupChannel)||void 0===je?void 0:je.channel)||void 0===Ve?void 0:Ve.input)||void 0===qe?void 0:qe.gallery)&&Av(null===(We=null===(Ye=null===(Ke=null===(ze=t.groupChannel)||void 0===ze?void 0:ze.channel)||void 0===Ke?void 0:Ke.input)||void 0===Ye?void 0:Ye.gallery)||void 0===We?void 0:We.enableVideo)&&(e.channel.input.gallery.enableVideo=null===(Je=null===(Ze=null===(Xe=null===(Qe=t.groupChannel)||void 0===Qe?void 0:Qe.channel)||void 0===Xe?void 0:Xe.input)||void 0===Ze?void 0:Ze.gallery)||void 0===Je?void 0:Je.enableVideo)}(e,t,n),function(e,t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b;(null===(r=n.groupChannel)||void 0===r?void 0:r.channelList)&&Av(null===(a=null===(i=n.groupChannel)||void 0===i?void 0:i.channelList)||void 0===a?void 0:a.enableTypingIndicator)&&(e.channelList.enableTypingIndicator=n.groupChannel.channelList.enableTypingIndicator);(null===(s=t.groupChannel)||void 0===s?void 0:s.channelList)&&Av(null===(l=null===(o=t.groupChannel)||void 0===o?void 0:o.channelList)||void 0===l?void 0:l.enableTypingIndicator)&&(e.channelList.enableTypingIndicator=null===(c=null===(u=t.groupChannel)||void 0===u?void 0:u.channelList)||void 0===c?void 0:c.enableTypingIndicator);(null===(d=n.groupChannel)||void 0===d?void 0:d.channelList)&&Av(null===(f=null===(h=n.groupChannel)||void 0===h?void 0:h.channelList)||void 0===f?void 0:f.enableMessageReceiptStatus)&&(e.channelList.enableMessageReceiptStatus=null===(_=null===(p=n.groupChannel)||void 0===p?void 0:p.channelList)||void 0===_?void 0:_.enableMessageReceiptStatus);(null===(m=t.groupChannel)||void 0===m?void 0:m.channelList)&&Av(null===(g=null===(v=t.groupChannel)||void 0===v?void 0:v.channelList)||void 0===g?void 0:g.enableMessageReceiptStatus)&&(e.channelList.enableMessageReceiptStatus=null===(b=null===(E=t.groupChannel)||void 0===E?void 0:E.channelList)||void 0===b?void 0:b.enableMessageReceiptStatus)}(e,t,n),function(e,t,n){var r,i,a,s,o,l,u,c;(null===(r=n.groupChannel)||void 0===r?void 0:r.setting)&&Av(null===(a=null===(i=n.groupChannel)||void 0===i?void 0:i.setting)||void 0===a?void 0:a.enableMessageSearch)&&(e.setting.enableMessageSearch=n.groupChannel.setting.enableMessageSearch);(null===(s=t.groupChannel)||void 0===s?void 0:s.setting)&&Av(null===(l=null===(o=t.groupChannel)||void 0===o?void 0:o.setting)||void 0===l?void 0:l.enableMessageSearch)&&(e.setting.enableMessageSearch=null===(c=null===(u=t.groupChannel)||void 0===u?void 0:u.setting)||void 0===c?void 0:c.enableMessageSearch)}(e,t,n)}function $v(e,t,n){!function(e,t,n){var r,i,a,s,o,l,u,c;(null===(r=n.openChannel)||void 0===r?void 0:r.channel)&&Av(null===(a=null===(i=n.openChannel)||void 0===i?void 0:i.channel)||void 0===a?void 0:a.enableOgtag)&&(e.channel.enableOgtag=n.openChannel.channel.enableOgtag);(null===(s=t.openChannel)||void 0===s?void 0:s.channel)&&Av(null===(l=null===(o=t.openChannel)||void 0===o?void 0:o.channel)||void 0===l?void 0:l.enableOgtag)&&(e.channel.enableOgtag=null===(c=null===(u=t.openChannel)||void 0===u?void 0:u.channel)||void 0===c?void 0:c.enableOgtag)}(e,t,n),function(e,t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,N,S,I,w,A,M,O,R,D,k,L,x,U,P,F,B,H,G,j,V,q,z,K,Y,W,Q,X,Z,J,$,ee,te,ne,re,ie,ae,se,oe,le,ue,ce,de,he,fe,pe,_e,me,ve,ge,Ee,be,ye,Ce,Te,Ne,Se,Ie,we,Ae,Me,Oe,Re,De,ke,Le,xe,Ue,Pe,Fe,Be,He,Ge,je,Ve,qe,ze,Ke,Ye,We,Qe,Xe,Ze,Je;(null===(i=null===(r=n.openChannel)||void 0===r?void 0:r.channel)||void 0===i?void 0:i.input)&&Av(null===(o=null===(s=null===(a=n.openChannel)||void 0===a?void 0:a.channel)||void 0===s?void 0:s.input)||void 0===o?void 0:o.enableDocument)&&(e.channel.input.enableDocument=null===(c=null===(u=null===(l=n.openChannel)||void 0===l?void 0:l.channel)||void 0===u?void 0:u.input)||void 0===c?void 0:c.enableDocument);(null===(h=null===(d=t.openChannel)||void 0===d?void 0:d.channel)||void 0===h?void 0:h.input)&&Av(null===(_=null===(p=null===(f=t.openChannel)||void 0===f?void 0:f.channel)||void 0===p?void 0:p.input)||void 0===_?void 0:_.enableDocument)&&(e.channel.input.enableDocument=null===(g=null===(v=null===(m=t.openChannel)||void 0===m?void 0:m.channel)||void 0===v?void 0:v.input)||void 0===g?void 0:g.enableDocument);(null===(y=null===(b=null===(E=n.openChannel)||void 0===E?void 0:E.channel)||void 0===b?void 0:b.input)||void 0===y?void 0:y.camera)&&Av(null===(S=null===(N=null===(T=null===(C=n.openChannel)||void 0===C?void 0:C.channel)||void 0===T?void 0:T.input)||void 0===N?void 0:N.camera)||void 0===S?void 0:S.enablePhoto)&&(e.channel.input.camera.enablePhoto=null===(M=null===(A=null===(w=null===(I=n.openChannel)||void 0===I?void 0:I.channel)||void 0===w?void 0:w.input)||void 0===A?void 0:A.camera)||void 0===M?void 0:M.enablePhoto);(null===(D=null===(R=null===(O=t.openChannel)||void 0===O?void 0:O.channel)||void 0===R?void 0:R.input)||void 0===D?void 0:D.camera)&&Av(null===(U=null===(x=null===(L=null===(k=t.openChannel)||void 0===k?void 0:k.channel)||void 0===L?void 0:L.input)||void 0===x?void 0:x.camera)||void 0===U?void 0:U.enablePhoto)&&(e.channel.input.camera.enablePhoto=null===(H=null===(B=null===(F=null===(P=t.openChannel)||void 0===P?void 0:P.channel)||void 0===F?void 0:F.input)||void 0===B?void 0:B.camera)||void 0===H?void 0:H.enablePhoto);(null===(V=null===(j=null===(G=n.openChannel)||void 0===G?void 0:G.channel)||void 0===j?void 0:j.input)||void 0===V?void 0:V.camera)&&Av(null===(Y=null===(K=null===(z=null===(q=n.openChannel)||void 0===q?void 0:q.channel)||void 0===z?void 0:z.input)||void 0===K?void 0:K.camera)||void 0===Y?void 0:Y.enableVideo)&&(e.channel.input.camera.enableVideo=null===(Z=null===(X=null===(Q=null===(W=n.openChannel)||void 0===W?void 0:W.channel)||void 0===Q?void 0:Q.input)||void 0===X?void 0:X.camera)||void 0===Z?void 0:Z.enableVideo);(null===(ee=null===($=null===(J=t.openChannel)||void 0===J?void 0:J.channel)||void 0===$?void 0:$.input)||void 0===ee?void 0:ee.camera)&&Av(null===(ie=null===(re=null===(ne=null===(te=t.openChannel)||void 0===te?void 0:te.channel)||void 0===ne?void 0:ne.input)||void 0===re?void 0:re.camera)||void 0===ie?void 0:ie.enableVideo)&&(e.channel.input.camera.enableVideo=null===(le=null===(oe=null===(se=null===(ae=t.openChannel)||void 0===ae?void 0:ae.channel)||void 0===se?void 0:se.input)||void 0===oe?void 0:oe.camera)||void 0===le?void 0:le.enableVideo);(null===(de=null===(ce=null===(ue=n.openChannel)||void 0===ue?void 0:ue.channel)||void 0===ce?void 0:ce.input)||void 0===de?void 0:de.gallery)&&Av(null===(_e=null===(pe=null===(fe=null===(he=n.openChannel)||void 0===he?void 0:he.channel)||void 0===fe?void 0:fe.input)||void 0===pe?void 0:pe.gallery)||void 0===_e?void 0:_e.enablePhoto)&&(e.channel.input.gallery.enablePhoto=null===(Ee=null===(ge=null===(ve=null===(me=n.openChannel)||void 0===me?void 0:me.channel)||void 0===ve?void 0:ve.input)||void 0===ge?void 0:ge.gallery)||void 0===Ee?void 0:Ee.enablePhoto);(null===(Ce=null===(ye=null===(be=t.openChannel)||void 0===be?void 0:be.channel)||void 0===ye?void 0:ye.input)||void 0===Ce?void 0:Ce.gallery)&&Av(null===(Ie=null===(Se=null===(Ne=null===(Te=t.openChannel)||void 0===Te?void 0:Te.channel)||void 0===Ne?void 0:Ne.input)||void 0===Se?void 0:Se.gallery)||void 0===Ie?void 0:Ie.enablePhoto)&&(e.channel.input.gallery.enablePhoto=null===(Oe=null===(Me=null===(Ae=null===(we=t.openChannel)||void 0===we?void 0:we.channel)||void 0===Ae?void 0:Ae.input)||void 0===Me?void 0:Me.gallery)||void 0===Oe?void 0:Oe.enablePhoto);(null===(ke=null===(De=null===(Re=n.openChannel)||void 0===Re?void 0:Re.channel)||void 0===De?void 0:De.input)||void 0===ke?void 0:ke.gallery)&&Av(null===(Pe=null===(Ue=null===(xe=null===(Le=n.openChannel)||void 0===Le?void 0:Le.channel)||void 0===xe?void 0:xe.input)||void 0===Ue?void 0:Ue.gallery)||void 0===Pe?void 0:Pe.enableVideo)&&(e.channel.input.gallery.enableVideo=null===(Ge=null===(He=null===(Be=null===(Fe=n.openChannel)||void 0===Fe?void 0:Fe.channel)||void 0===Be?void 0:Be.input)||void 0===He?void 0:He.gallery)||void 0===Ge?void 0:Ge.enableVideo);(null===(qe=null===(Ve=null===(je=t.openChannel)||void 0===je?void 0:je.channel)||void 0===Ve?void 0:Ve.input)||void 0===qe?void 0:qe.gallery)&&Av(null===(We=null===(Ye=null===(Ke=null===(ze=t.openChannel)||void 0===ze?void 0:ze.channel)||void 0===Ke?void 0:Ke.input)||void 0===Ye?void 0:Ye.gallery)||void 0===We?void 0:We.enableVideo)&&(e.channel.input.gallery.enableVideo=null===(Je=null===(Ze=null===(Xe=null===(Qe=t.openChannel)||void 0===Qe?void 0:Qe.channel)||void 0===Xe?void 0:Xe.input)||void 0===Ze?void 0:Ze.gallery)||void 0===Je?void 0:Je.enableVideo)}(e,t,n)}function eg(e,t){const n=zv();var r,i,a,s,o;return r=n.common,i=e,(a=t).common&&Av(null===(s=a.common)||void 0===s?void 0:s.enableUsingDefaultUserProfile)&&(r.enableUsingDefaultUserProfile=a.common.enableUsingDefaultUserProfile),i.common&&Av(null===(o=i.common)||void 0===o?void 0:o.enableUsingDefaultUserProfile)&&(r.enableUsingDefaultUserProfile=i.common.enableUsingDefaultUserProfile),Jv(n.groupChannel,e,t),$v(n.openChannel,e,t),n}var tg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(O){a(O)}}function o(e){try{l(r.throw(e))}catch(O){a(O)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ng(e){var t,n;return null!==(n=null===(t=e.appInfo)||void 0===t?void 0:t.applicationAttributes)&&void 0!==n?n:[]}const rg=t.createContext({initDashboardConfigs:()=>Promise.resolve(),configs:Yv,configsWithAppAttr:()=>Yv}),ig=({storage:e,children:n,localConfigs:r={}})=>{const[i,a]=t.useState(Kv),[s]=t.useState((()=>new Zv(e))),o=t.useCallback((e=>tg(void 0,void 0,void 0,(function*(){const t=yield s.init(e.appId);if(e.appInfo&&e.appInfo.uikitConfigInfo.lastUpdatedAt===t.updatedAt)a(t.configuration);else try{const t=yield e.getUIKitConfiguration();if("object"==typeof(n=t.json)&&"configuration"in n&&"updated_at"in n){const e=Rv(t.json),n=yield s.update(e);a(n.configuration)}}catch(r){a(t.configuration)}var n}))),[s]),l=eg(r,i),u=am((e=>({groupChannel:{channel:{get enableReactions(){return l.groupChannel.channel.enableReactions&&ng(e).includes(W_)},get enableReactionsSupergroup(){return l.groupChannel.channel.enableReactionsSupergroup&&ng(e).includes(W_)},get enableOgtag(){return l.groupChannel.channel.enableOgtag&&ng(e).includes(X_)}},setting:{get enableMessageSearch(){return l.groupChannel.setting.enableMessageSearch&&ng(e).includes(Q_)}}},openChannel:{channel:{get enableOgtag(){return l.openChannel.channel.enableOgtag&&ng(e).includes(X_)}}}})));return t.createElement(rg.Provider,{value:{initDashboardConfigs:o,configs:l,configsWithAppAttr:u}},n)};var ag=10,sg=1e3,og=6e5,lg=["audio/webm","audio/mp4","audio/mpeg","audio/ogg"],ug="sendbird-voice-player-provider-root",cg="sendbird-global-audio-player-id",dg="Voice_message.mp3",hg="audio/mp3;sbu_type=voice",fg="KEY_VOICE_MESSAGE_DURATION",pg="KEY_INTERNAL_MESSAGE_TYPE",_g="voice/mp3",mg="32px",vg=26214400,gg="sendbird_message_templates_token_key",Eg="sendbird_message_templates_key",bg="message_template",yg="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Cg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Tg,Ng={exports:{}},Sg={};var Ig,wg={};
/**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */"production"===process.env.NODE_ENV?Ng.exports=function(){if(Tg)return Sg;Tg=1;var e=t,n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=e.useState,i=e.useEffect,a=e.useLayoutEffect,s=e.useDebugValue;function o(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(i){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),l=r({inst:{value:n,getSnapshot:t}}),u=l[0].inst,c=l[1];return a((function(){u.value=n,u.getSnapshot=t,o(u)&&c({inst:u})}),[e,n,t]),i((function(){return o(u)&&c({inst:u}),e((function(){o(u)&&c({inst:u})}))}),[e]),s(n),n};return Sg.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Sg}():Ng.exports=(Ig||(Ig=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=t,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function r(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];!function(e,t,r){var i=n.ReactDebugCurrentFrame.getStackAddendum();""!==i&&(t+="%s",r=r.concat([i]));var a=r.map((function(e){return String(e)}));a.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,a)}("error",e,r)}var i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=e.useState,s=e.useEffect,o=e.useLayoutEffect,l=e.useDebugValue,u=!1,c=!1;function d(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!i(n,r)}catch(a){return!0}}var h="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t,n){return t()}:function(t,n,h){u||void 0!==e.startTransition&&(u=!0,r("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var f=n();if(!c){var p=n();i(f,p)||(r("The result of getSnapshot should be cached to avoid an infinite loop"),c=!0)}var _=a({inst:{value:f,getSnapshot:n}}),m=_[0].inst,v=_[1];return o((function(){m.value=f,m.getSnapshot=n,d(m)&&v({inst:m})}),[t,f,n]),s((function(){return d(m)&&v({inst:m}),t((function(){d(m)&&v({inst:m})}))}),[t]),l(f),f},f=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:h;wg.useSyncExternalStore=f,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),wg);var Ag=Ng.exports;var Mg=function(){this.__data__=[],this.size=0};var Og=function(e,t){return e===t||e!=e&&t!=t},Rg=Og;var Dg=function(e,t){for(var n=e.length;n--;)if(Rg(e[n][0],t))return n;return-1},kg=Dg,Lg=Array.prototype.splice;var xg=Dg;var Ug=Dg;var Pg=Dg;var Fg=Mg,Bg=function(e){var t=this.__data__,n=kg(t,e);return!(n<0)&&(n==t.length-1?t.pop():Lg.call(t,n,1),--this.size,!0)},Hg=function(e){var t=this.__data__,n=xg(t,e);return n<0?void 0:t[n][1]},Gg=function(e){return Ug(this.__data__,e)>-1},jg=function(e,t){var n=this.__data__,r=Pg(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Vg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Vg.prototype.clear=Fg,Vg.prototype.delete=Bg,Vg.prototype.get=Hg,Vg.prototype.has=Gg,Vg.prototype.set=jg;var qg=Vg,zg=qg;var Kg=function(){this.__data__=new zg,this.size=0};var Yg=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Wg=function(e){return this.__data__.get(e)};var Qg=function(e){return this.__data__.has(e)},Xg="object"==typeof yg&&yg&&yg.Object===Object&&yg,Zg=Xg,Jg="object"==typeof self&&self&&self.Object===Object&&self,$g=Zg||Jg||Function("return this")(),eE=$g.Symbol,tE=eE,nE=Object.prototype,rE=nE.hasOwnProperty,iE=nE.toString,aE=tE?tE.toStringTag:void 0;var sE=function(e){var t=rE.call(e,aE),n=e[aE];try{e[aE]=void 0;var r=!0}catch(O){}var i=iE.call(e);return r&&(t?e[aE]=n:delete e[aE]),i},oE=Object.prototype.toString;var lE=sE,uE=function(e){return oE.call(e)},cE=eE?eE.toStringTag:void 0;var dE=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":cE&&cE in Object(e)?lE(e):uE(e)};var hE=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},fE=dE,pE=hE;var _E,mE=function(e){if(!pE(e))return!1;var t=fE(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},vE=$g["__core-js_shared__"],gE=(_E=/[^.]+$/.exec(vE&&vE.keys&&vE.keys.IE_PROTO||""))?"Symbol(src)_1."+_E:"";var EE=function(e){return!!gE&&gE in e},bE=Function.prototype.toString;var yE=function(e){if(null!=e){try{return bE.call(e)}catch(O){}try{return e+""}catch(O){}}return""},CE=mE,TE=EE,NE=hE,SE=yE,IE=/^\[object .+?Constructor\]$/,wE=Function.prototype,AE=Object.prototype,ME=wE.toString,OE=AE.hasOwnProperty,RE=RegExp("^"+ME.call(OE).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var DE=function(e){return!(!NE(e)||TE(e))&&(CE(e)?RE:IE).test(SE(e))},kE=function(e,t){return null==e?void 0:e[t]};var LE=function(e,t){var n=kE(e,t);return DE(n)?n:void 0},xE=LE($g,"Map"),UE=LE(Object,"create"),PE=UE;var FE=function(){this.__data__=PE?PE(null):{},this.size=0};var BE=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},HE=UE,GE=Object.prototype.hasOwnProperty;var jE=function(e){var t=this.__data__;if(HE){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return GE.call(t,e)?t[e]:void 0},VE=UE,qE=Object.prototype.hasOwnProperty;var zE=UE;var KE=FE,YE=BE,WE=jE,QE=function(e){var t=this.__data__;return VE?void 0!==t[e]:qE.call(t,e)},XE=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=zE&&void 0===t?"__lodash_hash_undefined__":t,this};function ZE(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ZE.prototype.clear=KE,ZE.prototype.delete=YE,ZE.prototype.get=WE,ZE.prototype.has=QE,ZE.prototype.set=XE;var JE=ZE,$E=qg,eb=xE;var tb=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var nb=function(e,t){var n=e.__data__;return tb(t)?n["string"==typeof t?"string":"hash"]:n.map},rb=nb;var ib=nb;var ab=nb;var sb=nb;var ob=function(){this.size=0,this.__data__={hash:new JE,map:new(eb||$E),string:new JE}},lb=function(e){var t=rb(this,e).delete(e);return this.size-=t?1:0,t},ub=function(e){return ib(this,e).get(e)},cb=function(e){return ab(this,e).has(e)},db=function(e,t){var n=sb(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function hb(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}hb.prototype.clear=ob,hb.prototype.delete=lb,hb.prototype.get=ub,hb.prototype.has=cb,hb.prototype.set=db;var fb=hb,pb=qg,_b=xE,mb=fb;var vb=qg,gb=Kg,Eb=Yg,bb=Wg,yb=Qg,Cb=function(e,t){var n=this.__data__;if(n instanceof pb){var r=n.__data__;if(!_b||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new mb(r)}return n.set(e,t),this.size=n.size,this};function Tb(e){var t=this.__data__=new vb(e);this.size=t.size}Tb.prototype.clear=gb,Tb.prototype.delete=Eb,Tb.prototype.get=bb,Tb.prototype.has=yb,Tb.prototype.set=Cb;var Nb=Tb;var Sb=fb,Ib=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},wb=function(e){return this.__data__.has(e)};function Ab(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Sb;++t<n;)this.add(e[t])}Ab.prototype.add=Ab.prototype.push=Ib,Ab.prototype.has=wb;var Mb=Ab,Ob=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Rb=function(e,t){return e.has(t)};var Db=function(e,t,n,r,i,a){var s=1&n,o=e.length,l=t.length;if(o!=l&&!(s&&l>o))return!1;var u=a.get(e),c=a.get(t);if(u&&c)return u==t&&c==e;var d=-1,h=!0,f=2&n?new Mb:void 0;for(a.set(e,t),a.set(t,e);++d<o;){var p=e[d],_=t[d];if(r)var m=s?r(_,p,d,t,e,a):r(p,_,d,e,t,a);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!Ob(t,(function(e,t){if(!Rb(f,t)&&(p===e||i(p,e,n,r,a)))return f.push(t)}))){h=!1;break}}else if(p!==_&&!i(p,_,n,r,a)){h=!1;break}}return a.delete(e),a.delete(t),h};var kb=$g.Uint8Array,Lb=Og,xb=Db,Ub=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},Pb=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Fb=eE?eE.prototype:void 0,Bb=Fb?Fb.valueOf:void 0;var Hb=function(e,t,n,r,i,a,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new kb(e),new kb(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Lb(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=Ub;case"[object Set]":var l=1&r;if(o||(o=Pb),e.size!=t.size&&!l)return!1;var u=s.get(e);if(u)return u==t;r|=2,s.set(e,t);var c=xb(o(e),o(t),r,i,a,s);return s.delete(e),c;case"[object Symbol]":if(Bb)return Bb.call(e)==Bb.call(t)}return!1};var Gb=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},jb=Array.isArray,Vb=Gb,qb=jb;var zb=function(e,t,n){var r=t(e);return qb(e)?r:Vb(r,n(e))};var Kb=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var s=e[n];t(s,n,e)&&(a[i++]=s)}return a},Yb=function(){return[]},Wb=Object.prototype.propertyIsEnumerable,Qb=Object.getOwnPropertySymbols,Xb=Qb?function(e){return null==e?[]:(e=Object(e),Kb(Qb(e),(function(t){return Wb.call(e,t)})))}:Yb;var Zb=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var Jb=function(e){return null!=e&&"object"==typeof e},$b=dE,ey=Jb;var ty,ny,ry,iy,ay,sy,oy,ly,uy=function(e){return ey(e)&&"[object Arguments]"==$b(e)},cy=Jb,dy=Object.prototype,hy=dy.hasOwnProperty,fy=dy.propertyIsEnumerable,py=uy(function(){return arguments}())?uy:function(e){return cy(e)&&hy.call(e,"callee")&&!fy.call(e,"callee")},_y=py,my={exports:{}};ty=my,ry=$g,iy=function(){return!1},ay=(ny=my.exports)&&!ny.nodeType&&ny,sy=ay&&ty&&!ty.nodeType&&ty,oy=sy&&sy.exports===ay?ry.Buffer:void 0,ly=(oy?oy.isBuffer:void 0)||iy,ty.exports=ly;var vy=my.exports,gy=/^(?:0|[1-9]\d*)$/;var Ey=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&gy.test(e))&&e>-1&&e%1==0&&e<t};var by=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},yy=dE,Cy=by,Ty=Jb,Ny={};Ny["[object Float32Array]"]=Ny["[object Float64Array]"]=Ny["[object Int8Array]"]=Ny["[object Int16Array]"]=Ny["[object Int32Array]"]=Ny["[object Uint8Array]"]=Ny["[object Uint8ClampedArray]"]=Ny["[object Uint16Array]"]=Ny["[object Uint32Array]"]=!0,Ny["[object Arguments]"]=Ny["[object Array]"]=Ny["[object ArrayBuffer]"]=Ny["[object Boolean]"]=Ny["[object DataView]"]=Ny["[object Date]"]=Ny["[object Error]"]=Ny["[object Function]"]=Ny["[object Map]"]=Ny["[object Number]"]=Ny["[object Object]"]=Ny["[object RegExp]"]=Ny["[object Set]"]=Ny["[object String]"]=Ny["[object WeakMap]"]=!1;var Sy=function(e){return Ty(e)&&Cy(e.length)&&!!Ny[yy(e)]};var Iy=function(e){return function(t){return e(t)}},wy={exports:{}};!function(e,t){var n=Xg,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,a=i&&i.exports===r&&n.process,s=function(){try{var e=i&&i.require&&i.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(O){}}();e.exports=s}(wy,wy.exports);var Ay=wy.exports,My=Sy,Oy=Iy,Ry=Ay&&Ay.isTypedArray,Dy=Ry?Oy(Ry):My,ky=Zb,Ly=_y,xy=jb,Uy=vy,Py=Ey,Fy=Dy,By=Object.prototype.hasOwnProperty;var Hy=function(e,t){var n=xy(e),r=!n&&Ly(e),i=!n&&!r&&Uy(e),a=!n&&!r&&!i&&Fy(e),s=n||r||i||a,o=s?ky(e.length,String):[],l=o.length;for(var u in e)!t&&!By.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Py(u,l))||o.push(u);return o},Gy=Object.prototype;var jy=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Gy)};var Vy=function(e,t){return function(n){return e(t(n))}},qy=Vy(Object.keys,Object),zy=jy,Ky=qy,Yy=Object.prototype.hasOwnProperty;var Wy=mE,Qy=by;var Xy=Hy,Zy=function(e){if(!zy(e))return Ky(e);var t=[];for(var n in Object(e))Yy.call(e,n)&&"constructor"!=n&&t.push(n);return t},Jy=function(e){return null!=e&&Qy(e.length)&&!Wy(e)};var $y=zb,eC=Xb,tC=function(e){return Jy(e)?Xy(e):Zy(e)};var nC=function(e){return $y(e,tC,eC)},rC=Object.prototype.hasOwnProperty;var iC=function(e,t,n,r,i,a){var s=1&n,o=nC(e),l=o.length;if(l!=nC(t).length&&!s)return!1;for(var u=l;u--;){var c=o[u];if(!(s?c in t:rC.call(t,c)))return!1}var d=a.get(e),h=a.get(t);if(d&&h)return d==t&&h==e;var f=!0;a.set(e,t),a.set(t,e);for(var p=s;++u<l;){var _=e[c=o[u]],m=t[c];if(r)var v=s?r(m,_,c,t,e,a):r(_,m,c,e,t,a);if(!(void 0===v?_===m||i(_,m,n,r,a):v)){f=!1;break}p||(p="constructor"==c)}if(f&&!p){var g=e.constructor,E=t.constructor;g==E||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof E&&E instanceof E||(f=!1)}return a.delete(e),a.delete(t),f},aC=LE($g,"DataView"),sC=xE,oC=LE($g,"Promise"),lC=LE($g,"Set"),uC=LE($g,"WeakMap"),cC=dE,dC=yE,hC="[object Map]",fC="[object Promise]",pC="[object Set]",_C="[object WeakMap]",mC="[object DataView]",vC=dC(aC),gC=dC(sC),EC=dC(oC),bC=dC(lC),yC=dC(uC),CC=cC;(aC&&CC(new aC(new ArrayBuffer(1)))!=mC||sC&&CC(new sC)!=hC||oC&&CC(oC.resolve())!=fC||lC&&CC(new lC)!=pC||uC&&CC(new uC)!=_C)&&(CC=function(e){var t=cC(e),n="[object Object]"==t?e.constructor:void 0,r=n?dC(n):"";if(r)switch(r){case vC:return mC;case gC:return hC;case EC:return fC;case bC:return pC;case yC:return _C}return t});var TC=Nb,NC=Db,SC=Hb,IC=iC,wC=CC,AC=jb,MC=vy,OC=Dy,RC="[object Arguments]",DC="[object Array]",kC="[object Object]",LC=Object.prototype.hasOwnProperty;var xC=function(e,t,n,r,i,a){var s=AC(e),o=AC(t),l=s?DC:wC(e),u=o?DC:wC(t),c=(l=l==RC?kC:l)==kC,d=(u=u==RC?kC:u)==kC,h=l==u;if(h&&MC(e)){if(!MC(t))return!1;s=!0,c=!1}if(h&&!c)return a||(a=new TC),s||OC(e)?NC(e,t,n,r,i,a):SC(e,t,l,n,r,i,a);if(!(1&n)){var f=c&&LC.call(e,"__wrapped__"),p=d&&LC.call(t,"__wrapped__");if(f||p){var _=f?e.value():e,m=p?t.value():t;return a||(a=new TC),i(_,m,n,r,a)}}return!!h&&(a||(a=new TC),IC(e,t,n,r,i,a))},UC=Jb;var PC=function e(t,n,r,i,a){return t===n||(null==t||null==n||!UC(t)&&!UC(n)?t!=t&&n!=n:xC(t,n,r,i,e,a))},FC=PC;var BC=Cg((function(e,t){return FC(e,t)}));function HC(e,t){return Object.entries(t).some((function(t){var n=t[0],r=t[1];return("function"!=typeof e[n]||"function"!=typeof r)&&!BC(e[n],r)}))}function GC(e){var t=m({},e),n=new Set,r=!1;return{getState:function(){return t},setState:function(e,i){if(!r)try{r=!0;var a="function"==typeof e?e(t):e,s=HC(t,a);(i||s)&&(t=m(m({},t),a),n.forEach((function(e){return e()})))}finally{r=!1}},subscribe:function(e){return n.add(e),function(){return n.delete(e)}}}}var jC={config:m(m({},{onUserProfileMessage:void 0,disableUserProfile:!1,isReactionEnabled:!0,isMentionEnabled:!1,isVoiceMessageEnabled:!0,replyType:"NONE",showSearchIcon:!0,isTypingIndicatorEnabledOnChannelList:!1,isMessageReceiptStatusEnabledOnChannelList:!1,setCurrenttheme:function(){}}),{appId:"",userId:"",accessToken:void 0,theme:"light",isOnline:!1,allowProfileEdit:!0,forceLeftToRightMessageLayout:!1,disableMarkAsDelivered:!1,isMultipleFilesMessageEnabled:!1,htmlTextDirection:"ltr",uikitUploadSizeLimit:vg,uikitMultipleFilesMessageLimit:10,imageCompression:void 0,voiceRecord:void 0,userMention:void 0,renderUserProfile:void 0,onStartDirectMessage:void 0,setCurrentTheme:void 0,userListQuery:void 0,pubSub:void 0,logger:void 0,markAsReadScheduler:void 0,markAsDeliveredScheduler:void 0,common:{enableUsingDefaultUserProfile:!1},groupChannel:{enableOgtag:!0,enableTypingIndicator:!0,enableReactions:!0,enableMention:!1,replyType:"none",threadReplySelectType:"thread",enableVoiceMessage:!0,typingIndicatorTypes:void 0,enableDocument:!1,enableFeedback:!1,enableSuggestedReplies:!1,showSuggestedRepliesFor:"all_messages",suggestedRepliesDirection:"vertical",enableMarkdownForUserMessage:!1,enableFormTypeMessage:!1,enableReactionsSupergroup:void 0},groupChannelList:{enableTypingIndicator:!1,enableMessageReceiptStatus:!1},groupChannelSettings:{enableMessageSearch:!1},openChannel:{enableOgtag:!0,enableDocument:!1}}),stores:{sdkStore:{sdk:{},initialized:!1,loading:!1,error:void 0},userStore:{user:{},initialized:!1,loading:!1},appInfoStore:{messageTemplatesInfo:void 0,waitingTemplateKeysMap:{}}},emojiManager:void 0,eventHandlers:{reaction:{onPressUserProfile:function(){}},connection:{onConnected:function(){},onFailed:function(){}},modal:{onMounted:function(){}},message:{onSendMessageFailed:function(){},onUpdateMessageFailed:function(){},onFileUploadFailed:function(){}}},utils:{updateMessageTemplatesInfo:function(){return new Promise((function(){}))},getCachedTemplate:function(){return null}}};function VC(e,n,r){var i=t.useContext(e);if(!i)throw new Error("useStore must be used within a StoreProvider");var a=t.useRef(n);a.current=n;var s=Ag.useSyncExternalStore(i.subscribe,(function(){return a.current(i.getState())}),(function(){return a.current(r)})),o=t.useCallback((function(e){HC(i.getState(),e)&&i.setState((function(t){return m(m({},t),e)}))}),[i]);return t.useMemo((function(){return{state:s,updateState:o}}),[s,o])}var qC,zC=t.createContext(null),KC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._channels=new Map,t._enteredChannelUrls=[],t}return C(t,e),Object.defineProperty(t.prototype,"enteredChannels",{get:function(){var e=this;return this._enteredChannelUrls.map((function(t){return e._channels.get(t)})).filter((function(e){return!!e}))},enumerable:!1,configurable:!0}),t.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},t.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},t.prototype.exit=function(e){var t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)},t.prototype.exitAll=function(){this._enteredChannelUrls=[]},t.prototype.get=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this._channels.get(e)]}))}))},t.prototype.upsert=function(e){return N(this,0,void 0,(function(){var t,n=this;return S(this,(function(r){return t=[],e.forEach((function(e){if(n._channels.has(e.url)){var r=n._channels.get(e.url);Object.assign(r,e),t.push(r)}else n._channels.set(e.url,e),t.push(e)})),[2,t]}))}))},t.prototype.remove=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return this._channels.delete(e),this.exit(e),[2]}))}))},t.prototype.clear=function(){return N(this,0,void 0,(function(){return S(this,(function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]}))}))},t}(ma),YC={channelUrl:void 0,name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,isEphemeral:void 0},WC=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,i=e.call(this)||this;return i.method=Ie.GET,i.path="".concat(r?Le:ke,"/").concat(encodeURIComponent(n)),i.params={show_pinned_messages:!0},i}return C(t,e),t}(tt),QC=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new cT(t,n),r}return C(t,e),t}(nt),XC=function(e){function t(t){var n=this,r=t.channelUrl,i=t.coverUrlOrImage,a=t.name,s=t.data,o=t.customType,l=t.operatorUserIds,u=t.isEphemeral;return(n=e.call(this)||this).method=Ie.POST,n.path=ke,n.params=Ne(Se({channel_url:r,cover_url:q("string",i)?i:null,cover_file:X(i)?i:null,name:a,data:s,custom_type:o,operators:l,is_ephemeral:u})),n}return C(t,e),t}(tt);C((function(e,t){var n=qC.call(this,e,t)||this;return n.channel=new cT(e,t),n}),qC=nt);var ZC=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"ENTR",payload:{channel_url:n},ackRequired:!0})||this}return C(t,e),t}(st),JC=function(e){function t(t,n,r){var i,a,s=this;return s=e.call(this,t,"SYEV",r)||this,r.data&&(s.participantCount=null!==(i=r.data.participant_count)&&void 0!==i?i:0,s.user=new Aa(t,r.data),s.ts=null!==(a=r.data.edge_ts)&&void 0!==a?a:0),s}return C(t,e),t}(rf),$C=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"EXIT",payload:{channel_url:n},ackRequired:!0})||this}return C(t,e),t}(st),eT=function(e){function t(t,n,r){var i,a,s=this;return s=e.call(this,t,"EXIT",r)||this,r.data&&(s.participantCount=null!==(i=r.data.participant_count)&&void 0!==i?i:0,s.user=new Aa(t,r.data),s.ts=null!==(a=r.data.edge_ts)&&void 0!==a?a:0),s}return C(t,e),t}(rf),tT={},nT=function(e){function t(t,n){var r=e.call(this,t,T(T({},n),{channelType:ae.OPEN}))||this;return r.subscribeChannelEvent=St,r.unsubscribeChannelEvent=St,r.refreshChannel=function(){return N(r,0,void 0,(function(){return S(this,(function(e){return[2,void 0]}))}))},r._openChannelCache=new KC(t),r._openChannelHandlers=new Map,r._dispatcher.on((function(e){var t,n;if(e instanceof at)r._handleEvent(e).catch((function(e){if(B(e)&&"foreground"===r._sdkState.appState)throw e}));else if(e instanceof ra&&e.stateType===Zi.CONNECTED){var i=r._openChannelCache.enteredChannels;try{for(var a=I(i),s=a.next();!s.done;s=a.next())s.value.enter()}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}})),tT[t]||(tT[t]=r),r}return C(t,e),t.of=function(e){return tT[e]},t.prototype.buildOpenChannelFromSerializedData=function(e){var t=Sa(e);return new cT(this._iid,cT.payloadify(t))},t.prototype.getChannelFromCache=function(e){var t;return N(this,0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,this._openChannelCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},t.prototype.upsertChannelsToCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this._openChannelCache.upsert(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.removeChannelsFromCache=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s;return S(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=I(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i=o.sent(),a={error:i},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}return[7];case 7:return[2]}}))}))},t.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},t.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},Object.defineProperty(t.prototype,"handlers",{get:function(){return A([],w(this._openChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),t.prototype._handleEvent=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b,y,C,T,w,A,M,O,R,D,k,L,x,U,P,F,H,G,j,V,q,z,K,Y,W,Q,X,Z,J,$,ee,te,ne,re,ie,se,oe,le,ue,ce,de,he,fe,pe,_e,me,ve,ge,Ee,be,ye,Ce,Te,Ne,Se,Ie=this;return S(this,(function(we){switch(we.label){case 0:switch(we.trys.push([0,59,,60]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"PEDI":return[3,27];case"VOTE":return[3,30];case"SYEV":return[3,33]}return[3,58];case 1:return i=null,"MESG"===e.code?i=e.as(rc):"FILE"===e.code?i=e.as(vl):"ADMM"!==e.code&&"BRDM"!=e.code||(i=e.as(lf)),i?(t=i.message,n=i.isMentioned,t.channelType!==ae.OPEN?[3,3]:[4,this.getChannel(t.channelUrl,!0)]):[3,3];case 2:r=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){var e,i,a,s,o;return S(this,(function(l){try{for(e=I(this._openChannelHandlers.values()),i=e.next();!i.done;i=e.next())a=i.value,this._openChannelCache.isEnteredChannel(r.url)&&(a.onMessageReceived&&a.onMessageReceived(r,t),n&&a.onMentionReceived&&a.onMentionReceived(r,t))}catch(u){s={error:u}}finally{try{i&&!i.done&&(o=e.return)&&o.call(e)}finally{if(s)throw s.error}}return[2]}))}))})),we.label=3;case 3:return[3,58];case 4:return i=null,"MEDI"===e.code?i=e.as(ac):"FEDI"===e.code?i=e.as(oc):"AEDI"===e.code&&(i=e.as(uf)),i?(a=i.message,s=i.mentionCountChange,a.channelType!==ae.OPEN?[3,6]:[4,this.getChannel(a.channelUrl,!0)]):[3,6];case 5:o=we.sent(),l=!1,o.lastPinnedMessage&&o.lastPinnedMessage.messageId===a.messageId&&o.lastPinnedMessage.updatedAt<a.updatedAt&&(o.lastPinnedMessage=a,l=!0),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i,u,c;return S(this,(function(d){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(o.url)&&(l&&(null===(u=n.onPinnedMessageUpdated)||void 0===u||u.call(n,o),null===(c=n.onChannelChanged)||void 0===c||c.call(n,o)),n.onMessageUpdated&&n.onMessageUpdated(o,a),s>0&&n.onMentionReceived&&n.onMentionReceived(o,a))}catch(h){r={error:h}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=6;case 6:return[3,58];case 7:return u=e.as(Tt),x=u.channelUrl,U=u.channelType,c=u.messageId,U!==ae.OPEN?[3,9]:[4,this.getChannel(x,!0)];case 8:d=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(d.url)&&n.onMessageDeleted&&n.onMessageDeleted(d,c)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=9;case 9:return[3,58];case 10:return h=e.as(cf),x=h.channelUrl,U=h.channelType,f=h.event,U!==ae.OPEN?[3,12]:[4,this.getChannel(x,!0)];case 11:p=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(p.url)&&n.onReactionUpdated&&n.onReactionUpdated(p,f)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=12;case 12:return[3,58];case 13:return(_=e.as(df).event).channelType!==ae.OPEN?[3,15]:[4,this.getChannel(_.channelUrl,!0)];case 14:m=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())n=t.value,this._openChannelCache.isEnteredChannel(m.url)&&n.onThreadInfoUpdated&&n.onThreadInfoUpdated(m,_)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=15;case 15:return[3,58];case 16:v=e.as(hf).openChannelMemberCounts,g=[],we.label=17;case 17:we.trys.push([17,22,23,24]),E=I(v),b=E.next(),we.label=18;case 18:return b.done?[3,21]:(y=b.value,x=y.channelUrl,K=y.participantCount,C=y.updatedAt,[4,this.getChannelFromCache(x)]);case 19:(T=we.sent())&&T._updateParticipantCount(K,C)&&g.push(T),we.label=20;case 20:return b=E.next(),[3,18];case 21:return[3,24];case 22:return w=we.sent(),Ne={error:w},[3,24];case 23:try{b&&!b.done&&(Se=E.return)&&Se.call(E)}finally{if(Ne)throw Ne.error}return[7];case 24:return g.length>0?[4,this.upsertChannelsToCache(g)]:[3,26];case 25:A=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelMemberCountChanged&&n.onChannelMemberCountChanged(A)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=26;case 26:return[3,58];case 27:return M=e.as(ff),O=M.event,R=M.status,x=M.channelUrl,U=M.channelType,x&&U===ae.OPEN?[4,this.getChannel(x,!0)]:[3,29];case 28:D=we.sent(),this._dispatcher.dispatch(new Fs({event:O,source:bs.EVENT_POLL_UPDATED})),Qi(R===Gs?function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollDeleted&&n.onPollDeleted(D,O.pollId)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}:function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollUpdated&&n.onPollUpdated(D,O)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))}),we.label=29;case 29:return[3,58];case 30:return k=e.as(Mc),L=k.event,x=k.channelUrl,U=k.channelType,x&&U===ae.OPEN?[4,this.getChannel(x,!0)]:[3,32];case 31:P=we.sent(),this._dispatcher.dispatch(new Bs({event:L,source:bs.EVENT_POLL_VOTED})),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollVoted&&n.onPollVoted(P,L)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),we.label=32;case 32:return[3,58];case 33:if(!(F=e.as(rf).event).isOpenChannelEvent)return[3,57];switch(F.category){case Jh.CHANNEL_ENTER:return[3,34];case Jh.CHANNEL_EXIT:return[3,36];case Jh.CHANNEL_OPERATOR_UPDATE:return[3,38];case Jh.USER_CHANNEL_MUTE:case Jh.USER_CHANNEL_UNMUTE:return[3,40];case Jh.USER_CHANNEL_BAN:case Jh.USER_CHANNEL_UNBAN:return[3,42];case Jh.CHANNEL_FREEZE:case Jh.CHANNEL_UNFREEZE:return[3,44];case Jh.CHANNEL_DELETED:return[3,46];case Jh.CHANNEL_PROP_CHANGED:return[3,49];case Jh.CHANNEL_META_DATA_CHANGED:return[3,51];case Jh.CHANNEL_META_COUNTERS_CHANGED:return[3,53];case Jh.PINNED_MESSAGE_CHANGED:return[3,55]}return[3,57];case 34:return[4,this.getChannel(F.channelUrl,!0)];case 35:return H=we.sent(),G=e.as(JC),K=G.participantCount,j=G.user,V=H._updateParticipantCount(K,F.ts),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserEntered&&e.onUserEntered(H,j),V&&e.onChannelParticipantCountChanged&&e.onChannelParticipantCountChanged(H)})),[2]}))}))})),[3,57];case 36:return[4,this.getChannel(F.channelUrl,!0)];case 37:return q=we.sent(),z=e.as(eT),K=z.participantCount,Y=z.user,W=q._updateParticipantCount(K,F.ts),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onUserExited&&e.onUserExited(q,Y),W&&e.onChannelParticipantCountChanged&&e.onChannelParticipantCountChanged(q)})),[2]}))}))})),[3,57];case 38:return[4,this.getChannel(F.channelUrl,!0)];case 39:return Q=we.sent(),X=e.as(af).operators,Q.operators=X,this.upsertChannelsToCache([Q]),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(Q,X)})),[2]}))}))})),[3,57];case 40:return[4,this.getChannel(F.channelUrl,!0)];case 41:return Z=we.sent(),J=F.category===Jh.USER_CHANNEL_MUTE,$=e.as(J?ju:qu).user,Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){J?e.onUserMuted&&e.onUserMuted(Z,$):e.onUserUnmuted&&e.onUserUnmuted(Z,$)})),[2]}))}))})),[3,57];case 42:return[4,this.getChannel(F.channelUrl,!0)];case 43:return ee=we.sent(),te=F.category===Jh.USER_CHANNEL_BAN,ne=e.as(te?Ku:Wu).user,Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){te?e.onUserBanned&&e.onUserBanned(ee,ne):e.onUserUnbanned&&e.onUserUnbanned(ee,ne)})),[2]}))}))})),[3,57];case 44:return[4,this.getChannel(F.channelUrl,!0)];case 45:return re=we.sent(),ie=e.as(Xu).freeze,re.isFrozen=ie,this.upsertChannelsToCache([re]),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){ie?e.onChannelFrozen&&e.onChannelFrozen(re):e.onChannelUnfrozen&&e.onChannelUnfrozen(re)})),[2]}))}))})),[3,57];case 46:return[4,this.getChannel(F.channelUrl,!0)];case 47:return se=we.sent(),[4,this.removeChannelsFromCache([se.url])];case 48:return we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(se.url,se.channelType)})),[2]}))}))})),[3,57];case 49:return[4,this.getChannelWithoutCache(F.channelUrl,!0)];case 50:return oe=we.sent(),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(oe)})),[2]}))}))})),[3,57];case 51:return[4,this.getChannel(F.channelUrl,!0)];case 52:return le=we.sent(),ue=e.as(wu),ce=ue.created,de=ue.updated,he=ue.deleted,ce&&le._upsertCachedMetaData(ce,F.ts),de&&le._upsertCachedMetaData(de,F.ts),he&&le._removeFromCachedMetaData(he,F.ts),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){ce&&e.onMetaDataCreated&&e.onMetaDataCreated(le,ce),de&&e.onMetaDataUpdated&&e.onMetaDataUpdated(le,de),he&&e.onMetaDataDeleted&&e.onMetaDataDeleted(le,he)})),[2]}))}))})),[3,57];case 53:return[4,this.getChannel(F.channelUrl,!0)];case 54:return fe=we.sent(),pe=e.as(Fu),_e=pe.created,me=pe.updated,ve=pe.deleted,Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){_e&&e.onMetaCounterCreated&&e.onMetaCounterCreated(fe,_e),me&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(fe,me),ve&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(fe,ve)})),[2]}))}))})),[3,57];case 55:return[4,this.getChannel(F.channelUrl,!0)];case 56:return ge=we.sent(),Ee=e.as(sf),be=Ee.pinnedMessageIds,ye=Ee.latestPinnedMessage,(Ce=Ee.ts)>ge._pinnedMessagesUpdatedAt&&(ge.pinnedMessageIds=be,ge.lastPinnedMessage=ye,ge._pinnedMessagesUpdatedAt=Ce,this.upsertChannelsToCache([ge]),Qi((function(){return N(Ie,0,void 0,(function(){var e,t,n,r,i;return S(this,(function(a){try{for(e=I(this._openChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(ge)}catch(s){r={error:s}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Qi((function(){return N(Ie,0,void 0,(function(){return S(this,(function(e){return this._openChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(ge)})),[2]}))}))}))),[3,57];case 57:return[3,58];case 58:return[3,60];case 59:if(Te=we.sent(),B(Te))throw Te;return[3,60];case 60:return[2]}}))}))},t.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},t.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._openChannelHandlers.clear()},t.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n;return S(this,(function(r){switch(r.label){case 0:Ia(q("string",e)).throw(H.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},t.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),N(this,0,void 0,(function(){var n,r,i;return S(this,(function(a){switch(a.label){case 0:return Ia(q("string",e)).throw(H.invalidParameters),n=new WC({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:return r=a.sent(),i=r.as(QC).channel,[4,this.upsertChannelsToCache([i])];case 2:return[2,a.sent()[0]]}}))}))},t.prototype.createChannel=function(e){return N(this,0,void 0,(function(){var t,n,r,i;return S(this,(function(a){switch(a.label){case 0:return t=T(T({},YC),e),Ia((s=t,Y("string",s.operatorUserIds,!0)&&(q("string",s.coverUrlOrImage,!0)||X(s.coverUrlOrImage,!0))&&q("string",s.name,!0)&&q("string",s.data,!0)&&q("string",s.customType,!0)&&(q("string",s.channelUrl)&&/^\w+$/.test(s.channelUrl)||null===s.channelUrl||void 0===s.channelUrl)&&q("boolean",s.isEphemeral,!0))).throw(H.invalidParameters),n=new XC(t),[4,this._requestQueue.send(n)];case 1:return r=a.sent(),i=r.as(QC).channel,this.upsertChannelsToCache([i]),[2,i]}var s}))}))},t}(of),rT={name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0},iT=function(e){function t(t){var n=this,r=t.channelUrl,i=t.token,a=t.limit;return(n=e.call(this)||this).method=Ie.GET,n.path="".concat(ke,"/").concat(encodeURIComponent(r),"/participants"),n.params={token:i,limit:a},n}return C(t,e),t}(tt),aT=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.participants=[];var i=n.next,a=n.participants;return r.token=i,r.participants=a.map((function(e){return new Fl(t,e)})),r}return C(t,e),t}(nt),sT=function(e){function t(t,n,r){return e.call(this,t,n,ae.OPEN,r)||this}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new iT(T(T({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(aT),i=r.participants,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}}))}))},t}(Ys),oT=function(e){function t(t){var n=this,r=t.channelUrl,i=t.coverUrlOrImage,a=t.name,s=t.data,o=t.customType,l=t.operatorUserIds;return(n=e.call(this)||this).method=Ie.PUT,n.path="".concat(ke,"/").concat(encodeURIComponent(r)),n.params=Ne(Se({cover_url:q("string",i)?i:null,cover_file:X(i)?i:null,name:a,data:s,custom_type:o,operators:l})),n}return C(t,e),t}(tt),lT=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new cT(t,n),r}return C(t,e),t}(nt),uT=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=Ie.DELETE,n.path="".concat(ke,"/").concat(encodeURIComponent(r)),n}return C(t,e),t}(tt);!function(e){C((function(t,n){return e.call(this,t,n)||this}),e)}(nt);var cT=function(e){function t(t,n){var r,i=this;return(i=e.call(this,t,n)||this)._lastParticipantCountUpdated=0,i.participantCount=0,i.operators=[],i.lastPinnedMessage=null,i._pinnedMessagesUpdatedAt=0,i.channelType=ae.OPEN,i.participantCount=null!==(r=n.participant_count)&&void 0!==r?r:0,i.operators=Array.isArray(n.operators)?n.operators.map((function(e){return new Aa(t,e)})):[],i.lastPinnedMessage=n.latest_pinned_message?hl(i._iid,T({channel_type:i.channelType},n.latest_pinned_message)):null,i}return C(t,e),t.payloadify=function(e){return Ne(Se(T(T({},qc.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return Aa.payloadify(e)})),latest_pinned_message:e.lastPinnedMessage?dl(e.lastPinnedMessage):null})))},t.prototype.serialize=function(){return Na(this)},t.prototype.isOperator=function(e){return e instanceof Aa?this.isOperator(e.userId):this.operators.some((function(t){return t.userId===e}))},t.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},t.prototype.createParticipantListQuery=function(e){return new sT(this._iid,this.url,e)},t.prototype.refresh=function(){return N(this,0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,nT.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}}))}))},t.prototype.enter=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return e=As.of(this._iid).requestQueue,t=new ZC({channelUrl:this.url}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(JC),i=r.participantCount,a=r.ts,this._updateParticipantCount(i,a),nT.of(this._iid).setEnteredToCache(this),[2]}}))}))},t.prototype.exit=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return e=As.of(this._iid).requestQueue,t=new $C({channelUrl:this.url}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(eT),i=r.participantCount,a=r.ts,this._updateParticipantCount(i,a),nT.of(this._iid).setExitedToCache(this),Sh.of(this._iid).fileMessageQueue.cancel(this),[2]}}))}))},t.prototype.updateChannel=function(e){return N(this,0,void 0,(function(){var t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return t=T(T({},rT),e),Ia((o=t,Y("string",o.operatorUserIds,!0)&&(q("string",o.coverUrlOrImage,!0)||X(o.coverUrlOrImage,!0))&&q("string",o.name,!0)&&q("string",o.data,!0)&&q("string",o.customType,!0))).throw(H.invalidParameters),n=As.of(this._iid).requestQueue,r=new oT(T({channelUrl:this.url},t)),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(lT).channel,this._update(a),[4,nT.of(this._iid).upsertChannelsToCache([a])];case 2:return s.sent(),[2,this]}var o}))}))},t.prototype.updateChannelWithOperatorUserIds=function(e,t,n,r,i){return N(this,0,void 0,(function(){var a;return S(this,(function(s){return a=T(T({},rT),{name:e,coverUrlOrImage:t,data:n,operatorUserIds:r,customType:i}),[2,this.updateChannel(a)]}))}))},t.prototype.delete=function(){return N(this,0,void 0,(function(){var e,t;return S(this,(function(n){switch(n.label){case 0:return e=As.of(this._iid).requestQueue,t=new uT({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[4,nT.of(this._iid).removeChannelsFromCache([this.url])];case 2:return n.sent(),[2]}}))}))},t.prototype.updateUserMessage=function(t,n){return N(this,0,void 0,(function(){var r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return[4,e.prototype.updateUserMessage.call(this,t,n)];case 1:return r=o.sent(),i=!1,a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===r.messageId&&(this.lastPinnedMessage=r,i=!0,a=!0),i&&nT.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(s)})),a&&nT.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(s)})),[2,r]}}))}))},t.prototype.updateFileMessage=function(t,n){return N(this,0,void 0,(function(){var r,i,a,s=this;return S(this,(function(o){switch(o.label){case 0:return[4,e.prototype.updateFileMessage.call(this,t,n)];case 1:return r=o.sent(),i=!1,a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===r.messageId&&(this.lastPinnedMessage=r,i=!0,a=!0),i&&nT.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(s)})),a&&nT.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(s)})),[2,r]}}))}))},t}(qc);!function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}C(t,e)}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserEntered=St,t.onUserExited=St,t.onChannelParticipantCountChanged=St,t.onPollUpdated=St,t.onPollVoted=St,t.onPollDeleted=St,t.onPinnedMessageUpdated=St,t}return C(t,e),t}(R_));var dT=function(e){function t(t){var n=this,r=t.token,i=t.limit,a=t.nameKeyword,s=t.urlKeyword,o=t.customTypes,l=t.includeFrozen,u=t.includeMetaData;return(n=e.call(this)||this).method=Ie.GET,n.path=ke,n.params=Ne({token:r,limit:i,name_contains:a,url_contains:s,custom_types:o,show_frozen:l,show_metadata:u,show_pinned_messages:!0}),n}return C(t,e),t}(tt),hT=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.channels=[];var i=n.next,a=n.channels,s=n.ts;return r.token=i,a&&a.length>0&&(r.channels=a.map((function(e){return new cT(t,e)}))),r.ts="number"==typeof s?s:null,r}return C(t,e),t}(nt),fT=function(e){function t(t,n){var r,i,a,s,o,l=this;return(l=e.call(this,t,n)||this).includeFrozen=!0,l.includeMetaData=!0,l.nameKeyword=null,l.urlKeyword=null,l.customTypes=null,l.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,l.includeMetaData=null===(i=n.includeMetaData)||void 0===i||i,l.nameKeyword=null!==(a=n.nameKeyword)&&void 0!==a?a:null,l.urlKeyword=null!==(s=n.urlKeyword)&&void 0!==s?s:null,l.customTypes=null!==(o=n.customTypes)&&void 0!==o?o:null,l}return C(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&q("boolean",this.includeFrozen)&&q("boolean",this.includeMetaData)&&q("string",this.nameKeyword,!0)&&q("string",this.urlKeyword,!0)&&Y("string",this.customTypes,!0)},t.prototype.next=function(){return N(this,0,void 0,(function(){var e,t,n,r,i,a;return S(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,e=As.of(this._iid).requestQueue,t=new dT(Se(T(T({},this),{token:this._token}))),[4,e.send(t)]):[3,3]:[3,6];case 1:return n=s.sent(),r=n.as(hT),i=r.channels,a=r.token,this._token=a,this._hasNext=!!a,[4,nT.of(this._iid).upsertChannelsToCache(i)];case 2:return s.sent(),this._isLoading=!1,[2,i];case 3:return[2,[]];case 4:throw H.queryInProgress;case 5:return[3,7];case 6:throw H.invalidParameters;case 7:return[2]}}))}))},t}(Ks),pT=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="openChannel",t}return C(t,e),t.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,a=n.sessionManager,s=n.requestQueue,o=n.logger,l=n.onlineDetector,u=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:a,requestQueue:s,logger:o,onlineDetector:l,cacheContext:u}),this._manager=new nT(t,{sdkState:r,dispatcher:i,requestQueue:s,logger:o,cacheContext:u,sessionManager:a})},t.prototype.createOpenChannelListQuery=function(e){return void 0===e&&(e={}),new fT(this._iid,e)},t.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},t.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},t.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},t.prototype.getChannel=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this._manager.getChannel(e)]}))}))},t.prototype.getChannelWithoutCache=function(e){return N(this,0,void 0,(function(){return S(this,(function(t){return[2,this._manager.getChannelWithoutCache(e)]}))}))},t.prototype.createChannel=function(e){return void 0===e&&(e={}),N(this,0,void 0,(function(){return S(this,(function(t){return[2,this._manager.createChannel(e)]}))}))},t.prototype.createChannelWithOperatorUserIds=function(e,t,n,r,i){return N(this,0,void 0,(function(){var a;return S(this,(function(s){return(a=T({},YC)).name=e,a.coverUrlOrImage=t,a.data=n,a.operatorUserIds=r,a.customType=i,[2,this._manager.createChannel(a)]}))}))},t}(Ms),_T=function(e,t){return m(m({},e),{stores:m(m({},e.stores),{appInfoStore:m(m({},e.stores.appInfoStore),t)})})},mT=function(e,t){return m(m({},e),{stores:m(m({},e.stores),{sdkStore:m(m({},e.stores.sdkStore),t)})})},vT=function(e,t){return m(m({},e),{stores:m(m({},e.stores),{userStore:m(m({},e.stores.userStore),t)})})};var gT="3.16.2";var ET,bT,yT=function(){var e=t.useContext(zC);if(!e)throw new Error("No sendbird state value available. Make sure you are rendering `<SendbirdProvider>` at the top of your app.");var n=Ag.useSyncExternalStore(e.subscribe,e.getState),r=t.useMemo((function(){return{initMessageTemplateInfo:function(t){var n=t.payload;e.setState((function(e){return _T(e,{messageTemplatesInfo:n,waitingTemplateKeysMap:{}})}))},upsertMessageTemplates:function(t){var r=t.payload,i=n.stores.appInfoStore,a=i.messageTemplatesInfo;if(!a)return n;var s=m({},i.waitingTemplateKeysMap);r.forEach((function(e){var t=e.key,n=e.template;a.templatesMap[t]=n,delete s[t]})),e.setState((function(e){return _T(e,{waitingTemplateKeysMap:s,messageTemplatesInfo:a})}))},upsertWaitingTemplateKeys:function(t){var r=t.payload,i=n.stores.appInfoStore,a=r.keys,s=r.requestedAt,o=m({},i.waitingTemplateKeysMap);a.forEach((function(e){var t,n;o[e]={erroredMessageIds:null!==(n=null===(t=o[e])||void 0===t?void 0:t.erroredMessageIds)&&void 0!==n?n:[],requestedAt:s}})),e.setState((function(e){return _T(e,{waitingTemplateKeysMap:o})}))},markErrorWaitingTemplateKeys:function(t){var r=t.payload,i=n.stores.appInfoStore,a=r.keys,s=r.messageId,o=m({},i.waitingTemplateKeysMap);a.forEach((function(e){var t=o[e];t&&-1===t.erroredMessageIds.indexOf(s)&&t.erroredMessageIds.push(s)})),e.setState((function(e){return _T(e,{waitingTemplateKeysMap:o})}))},setSdkLoading:function(t){e.setState((function(e){return mT(e,{initialized:!1,loading:t})}))},sdkError:function(){e.setState((function(e){return mT(e,{initialized:!1,loading:!1,error:!0})}))},initSdk:function(t){e.setState((function(e){return mT(e,{sdk:t,initialized:!0,loading:!1,error:!1})}))},resetSdk:function(){e.setState((function(e){return mT(e,{sdk:{},initialized:!1,loading:!1,error:!1})}))},initUser:function(t){e.setState((function(e){return vT(e,{initialized:!0,loading:!1,user:t})}))},resetUser:function(){e.setState((function(e){return vT(e,{initialized:!1,loading:!1,user:{}})}))},updateUserInfo:function(t){e.setState((function(e){return vT(e,{user:t})}))},connect:function(e){return g(void 0,void 0,void 0,(function(){var t,n,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,b,y,C,T,N,S,I;return E(this,(function(E){switch(E.label){case 0:return t=e.logger,n=e.userId,i=e.appId,a=e.accessToken,s=e.nickname,o=e.profileUrl,l=e.isMobile,u=e.sdkInitParams,c=e.customApiHost,d=e.customWebSocketHost,h=e.customExtensionParams,f=e.eventHandlers,p=e.initializeMessageTemplatesInfo,_=e.configureSession,m=e.initDashboardConfigs,[4,r.disconnect({logger:t})];case 1:E.sent(),v=function(e){var t=e.appId,n=e.customApiHost,r=e.customWebSocketHost,i=e.sdkInitParams,a=void 0===i?{}:i,s=Object.assign(a,{appId:t,modules:[new Y_,new pT],localCacheEnabled:!0});return n&&(s.customApiHost=n),r&&(s.customWebSocketHost=r),Nv.init(s)}({appId:i,customApiHost:c,customWebSocketHost:d,sdkInitParams:u}),function(e,t){var n,r,i=t.logger,a=t.sessionHandler,s=t.isMobile,o=t.customExtensionParams;null===(n=i.info)||void 0===n||n.call(i,"SendbirdProvider | useConnect/setupConnection/setVersion",{version:gT}),e.addExtension("sb_uikit",gT),e.addSendbirdExtensions([{product:ft.UIKIT_CHAT,version:gT,platform:null==pt?void 0:pt.JS}],{platform:s?_t.MOBILE_WEB:_t.WEB},o),a&&(null===(r=i.info)||void 0===r||r.call(i,"SendbirdProvider | useConnect/setupConnection/configureSession",a),e.setSessionHandler(a))}(v,{logger:t,isMobile:l,customExtensionParams:h,sessionHandler:_?_(v):void 0}),r.setSdkLoading(!0),E.label=2;case 2:return E.trys.push([2,8,,9]),[4,v.connect(n,a)];case 3:return g=E.sent(),r.initUser(g),s||o?[4,v.updateCurrentUserInfo({nickname:s||g.nickname||"",profileUrl:o||g.profileUrl})]:[3,5];case 4:E.sent(),E.label=5;case 5:return[4,null==p?void 0:p(v)];case 6:return E.sent(),[4,null==m?void 0:m(v)];case 7:return E.sent(),r.initSdk(v),null===(T=null===(C=null==f?void 0:f.connection)||void 0===C?void 0:C.onConnected)||void 0===T||T.call(C,g),[3,9];case 8:return b=E.sent(),y=b,r.resetSdk(),r.resetUser(),null===(N=t.error)||void 0===N||N.call(t,"SendbirdProvider | useSendbird/connect failed",y),null===(I=null===(S=null==f?void 0:f.connection)||void 0===S?void 0:S.onFailed)||void 0===I||I.call(S,y),[3,9];case 9:return[2]}}))}))},disconnect:function(e){return g(void 0,[e],void 0,(function(e){var t,i,a=e.logger;return E(this,(function(e){switch(e.label){case 0:return r.setSdkLoading(!0),(null==(t=n.stores.sdkStore.sdk)?void 0:t.disconnectWebSocket)?[4,t.disconnectWebSocket()]:[3,2];case 1:e.sent(),e.label=2;case 2:return r.resetSdk(),r.resetUser(),null===(i=a.info)||void 0===i||i.call(a,"SendbirdProvider | useSendbird/disconnect completed"),[2]}}))}))}}}),[e,n.stores.appInfoStore]);return{state:n,actions:r}},CT=t.createContext({disableUserProfile:!0,isOpenChannel:!1}),TT=function(){return t.useContext(CT)},NT=function(e){var n,r=e.isOpenChannel,i=void 0!==r&&r,a=e.disableUserProfile,s=void 0!==a&&a,o=e.renderUserProfile,l=e.onUserProfileMessage,u=e.onStartDirectMessage,c=e.children,d=yT().state.config,h=null!==(n=null!=u?u:l)&&void 0!==n?n:d.onStartDirectMessage;return t.createElement(CT.Provider,{value:{isOpenChannel:i,disableUserProfile:null!=s?s:!d.common.enableUsingDefaultUserProfile,renderUserProfile:null!=o?o:d.renderUserProfile,onStartDirectMessage:h,onUserProfileMessage:h}},c)},ST=function(e){var t={};return{__getTopics:function(){return t},subscribe:function(e,n){var r;return null!==(r=t[e])&&void 0!==r||(t[e]=new Set),t[e].add(n),{remove:function(){t[e].delete(n)}}},publish:function(n,r){t[n]&&t[n].forEach((function(t){(null==e?void 0:e.publishSynchronous)?t(void 0!==r?r:{}):setTimeout((function(){return t(void 0!==r?r:{})}),0)}))}}},IT="@";function wT(e){return"sendingStatus"in e?"succeeded"===e.sendingStatus?String(e.messageId):e.reqId:String(e.messageId)}function AT(){var e,t;return 0===(null===(e=document.getElementById("sendbird-dropdown-portal"))||void 0===e?void 0:e.childElementCount)&&0===(null===(t=document.getElementById("sendbird-emoji-list-portal"))||void 0===t?void 0:t.childElementCount)}function MT(e){var t,n=null===(t=document.querySelectorAll('[data-sb-created-at="'.concat(e,'"]')))||void 0===t?void 0:t[0];return n instanceof HTMLElement?n.offsetTop:null}(bT=ET||(ET={})).PARENT="PARENT",bT.THREAD="THREAD";var OT,RT,DT=function(e){return!!e&&(e.isFrozen&&"operator"!==e.myRole)},kT=function(e){return!!e&&"muted"===e.myMutedState},LT=function(e,t){var n,r,i,a;return t&&Array.isArray(null===(r=null===(n=null==e?void 0:e.lastMessage)||void 0===n?void 0:n.extendedMessagePayload)||void 0===r?void 0:r.suggested_replies)&&!!(null===(a=null===(i=null==e?void 0:e.lastMessage)||void 0===i?void 0:i.extendedMessagePayload)||void 0===a?void 0:a.disable_chat_input)},xT=function(e){return e<=1},UT=function(e,t){return t&&e.some((function(e){var t;return!!e.messageForm&&!e.messageForm.isSubmitted&&!!(null===(t=e.extendedMessagePayload)||void 0===t?void 0:t.disable_chat_input)&&xT(e.messageForm.version)}))};function PT(e){var t=e.channel,n=e.config,r=e.moduleLevel;return!(!t||t.isBroadcast||t.isEphemeral)&&(t.isSuper?null!=r?r:n.groupChannel.enableReactionsSupergroup:null!=r?r:n.groupChannel.enableReactions)}function FT(e){return{lowerCase:e.toLowerCase(),upperCase:e.toUpperCase()}}(RT=OT||(OT={})).CHANNEL="CHANNEL",RT.THREAD="THREAD";var BT,HT,GT=function(e,t){return!t||0===t.length||t.includes(e)};(HT=BT||(BT={})).USER_UPDATED="USER_UPDATED",HT.SEND_MESSAGE_START="SEND_MESSAGE_START",HT.SEND_MESSAGE_FAILED="SEND_MESSAGE_FAILED",HT.SEND_USER_MESSAGE="SEND_USER_MESSAGE",HT.SEND_FILE_MESSAGE="SEND_FILE_MESSAGE",HT.ON_FILE_INFO_UPLOADED="ON_FILE_INFO_UPLOADED",HT.UPDATE_USER_MESSAGE="UPDATE_USER_MESSAGE",HT.DELETE_MESSAGE="DELETE_MESSAGE",HT.LEAVE_CHANNEL="LEAVE_CHANNEL",HT.CREATE_CHANNEL="CREATE_CHANNEL",HT.UPDATE_OPEN_CHANNEL="UPDATE_OPEN_CHANNEL";var jT=BT;function VT(e){var n=t.useRef(e);return BC(e,n.current)||(n.current=e),n.current}function qT(e,n){t.useEffect(e,n.map(VT))}var zT=function(){},KT=function(e){var t={};return Object.entries(e).forEach((function(e){var n=e[0],r=e[1];null!=r&&(t[n]=r)})),t};function YT(e){var t=e;t&&(t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t),window.open(t,"_blank","noopener,noreferrer"))}function WT(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(Boolean).join(" ")}var QT=Symbol("@ts-pattern/matcher"),XT="@ts-pattern/anonymous-select-key",ZT=function(e){return Boolean(e&&"object"==typeof e)},JT=function(e){return e&&!!e[QT]},$T=function e(t,n,r){if(ZT(t)){if(JT(t)){var i=t[QT]().match(n),a=i.matched,s=i.selections;return a&&s&&Object.keys(s).forEach((function(e){return r(e,s[e])})),a}if(!ZT(n))return!1;if(Array.isArray(t))return!!Array.isArray(n)&&t.length===n.length&&t.every((function(t,i){return e(t,n[i],r)}));if(t instanceof Map)return n instanceof Map&&Array.from(t.keys()).every((function(i){return e(t.get(i),n.get(i),r)}));if(t instanceof Set){if(!(n instanceof Set))return!1;if(0===t.size)return 0===n.size;if(1===t.size){var o=Array.from(t.values())[0];return JT(o)?Array.from(n.values()).every((function(t){return e(o,t,r)})):n.has(o)}return Array.from(t.values()).every((function(e){return n.has(e)}))}return Object.keys(t).every((function(i){var a,s=t[i];return(i in n||JT(a=s)&&"optional"===a[QT]().matcherType)&&e(s,n[i],r)}))}return Object.is(n,t)};function eN(e){var t;return(t={})[QT]=function(){return{match:function(t){return{matched:Boolean(e(t))}}}},t}function tN(e){return new nN(e,[])}eN((function(e){return!0})),eN((function(e){return"string"==typeof e})),eN((function(e){return"number"==typeof e})),eN((function(e){return"boolean"==typeof e})),eN((function(e){return"bigint"==typeof e})),eN((function(e){return"symbol"==typeof e})),eN((function(e){return null==e}));var nN=function(){function e(e,t){this.value=void 0,this.cases=void 0,this.value=e,this.cases=t}var t=e.prototype;return t.with=function(){var t=[].slice.call(arguments),n=t[t.length-1],r=[t[0]],i=[];return 3===t.length&&"function"==typeof t[1]?(r.push(t[0]),i.push(t[1])):t.length>2&&r.push.apply(r,t.slice(1,t.length-1)),new e(this.value,this.cases.concat([{match:function(e){var t={},n=Boolean(r.some((function(n){return $T(n,e,(function(e,n){t[e]=n}))}))&&i.every((function(t){return t(e)})));return{matched:n,value:n&&Object.keys(t).length?XT in t?t[XT]:t:e}},handler:n}]))},t.when=function(t,n){return new e(this.value,this.cases.concat([{match:function(e){return{matched:Boolean(t(e)),value:e}},handler:n}]))},t.otherwise=function(t){return new e(this.value,this.cases.concat([{match:function(e){return{matched:!0,value:e}},handler:t}])).run()},t.exhaustive=function(){return this.run()},t.run=function(){for(var e=this.value,t=void 0,n=0;n<this.cases.length;n++){var r=this.cases[n],i=r.match(this.value);if(i.matched){e=i.value,t=r.handler;break}}if(!t){var a;try{a=JSON.stringify(this.value)}catch(s){a=this.value}throw new Error("Pattern matching error: no pattern matches value "+a)}return t(e,this.value)},e}(),rN=function(e){return e};var iN=function(){var e,n,r,i=t.useContext(lN);if(!i)throw new Error("useGroupChannel must be used within a GroupChannelProvider");var a=yT().state.config,s=a.markAsReadScheduler,o=Ag.useSyncExternalStore(i.subscribe,i.getState),l=t.useCallback((function(e){i.setState((function(t){return m(m({},t),{animatedMessageId:e})}))}),[]),u=t.useCallback((function(e){i.setState((function(t){return m(m({},t),{isScrollBottomReached:e})}))}),[]),c=t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return o.scrollRef.current?(l(null),u(!0),[4,new Promise((function(e){setTimeout(e,n)}))]):[2];case 1:return t.sent(),a.isOnline&&o.hasNext()?[4,o.resetWithStartingPoint(Number.MAX_SAFE_INTEGER)]:[3,3];case 2:t.sent(),t.label=3;case 3:return o.scrollPubSub.publish("scrollToBottom",{animated:e}),o.currentChannel&&!o.hasNext()&&(o.resetNewMessages(),o.disableMarkAsRead||s.push(o.currentChannel)),[2]}var n}))}))}),[o.scrollRef.current,a.isOnline,s]),d=t.useCallback((function(e,t,n,r){return g(void 0,void 0,void 0,(function(){var i,a,s,u,c;return E(this,(function(d){switch(d.label){case 0:return i=o.scrollRef.current,a=null==i?void 0:i.parentNode,(s={activate:function(){i&&a&&(i.style.pointerEvents="auto",a.style.cursor="auto")},deactivate:function(){i&&a&&(i.style.pointerEvents="none",a.style.cursor="wait")}}).deactivate(),l(null),(u=o.messages.find((function(n){return n.messageId===t||n.createdAt===e})))?((c=MT(u.createdAt))&&o.scrollPubSub.publish("scroll",{top:c,animated:r}),(null==n||n)&&l(t),[3,3]):[3,1];case 1:return[4,o.resetWithStartingPoint(e)];case 2:d.sent(),setTimeout((function(){var i=MT(e);i&&o.scrollPubSub.publish("scroll",{top:i,lazy:!1,animated:r}),(null==n||n)&&l(t)})),d.label=3;case 3:return s.activate(),[2]}}))}))}),[l,o.scrollRef.current,null===(e=o.messages)||void 0===e?void 0:e.map((function(e){return null==e?void 0:e.messageId}))]),h=t.useCallback((function(e,t,n){o.currentChannel&&(n?o.currentChannel.deleteReaction(e,t).catch((function(e){var t;null===(t=a.logger)||void 0===t||t.warning("Failed to delete reaction:",e)})):o.currentChannel.addReaction(e,t).catch((function(e){var t;null===(t=a.logger)||void 0===t||t.warning("Failed to add reaction:",e)})))}),[null===(n=o.currentChannel)||void 0===n?void 0:n.deleteReaction,null===(r=o.currentChannel)||void 0===r?void 0:r.addReaction]),f=function(e){var n=this,r=e.onBeforeSendUserMessage,i=void 0===r?rN:r,a=e.onBeforeSendFileMessage,s=void 0===a?rN:a,o=e.onBeforeUpdateUserMessage,l=void 0===o?rN:o,u=e.onBeforeSendVoiceMessage,c=void 0===u?rN:u,d=e.onBeforeSendMultipleFilesMessage,h=void 0===d?rN:d,f=e.sendFileMessage,p=e.sendMultipleFilesMessage,_=e.sendUserMessage,v=e.updateUserMessage,b=e.updateFileMessage,y=e.resendMessage,C=e.deleteMessage,T=e.resetNewMessages,N=e.scrollToBottom,S=e.quoteMessage,I=e.replyType,w=e.currentChannel,A=yT().state,M=A.eventHandlers,O=A.config.pubSub,R=t.useCallback((function(t){var n=m({},t);return e.quoteMessage&&"NONE"!==I&&(n.isReplyToChannel=!0,n.parentMessageId=null==S?void 0:S.messageId),n}),[I,S]),D=t.useCallback((function(){setTimeout(N,0)}),[]),k=t.useCallback((function(e,t,r){return g(n,void 0,void 0,(function(){var n,i;return E(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,e(t)];case 1:return[2,void 0===(n=a.sent())?t:n];case 2:throw i=a.sent(),"object"==typeof(null==M?void 0:M.message)&&tN(r).with("file","voice",(function(){var e,n,r,a;t.file&&(null===(n=(e=M.message).onFileUploadFailed)||void 0===n||n.call(e,i)),null===(a=(r=M.message).onSendMessageFailed)||void 0===a||a.call(r,t,i)})).with("multipleFiles",(function(){var e,n,r,a;t.fileInfoList&&(null===(n=(e=M.message).onFileUploadFailed)||void 0===n||n.call(e,i)),null===(a=(r=M.message).onSendMessageFailed)||void 0===a||a.call(r,t,i)})).with("user",(function(){var e,n;null===(n=(e=M.message).onSendMessageFailed)||void 0===n||n.call(e,t,i)})).with("update",(function(){var e,n;null===(n=(e=M.message).onUpdateMessageFailed)||void 0===n||n.call(e,t,i)})).exhaustive(),i;case 3:return[2]}}))}))}),[M]);return{sendUserMessage:t.useCallback((function(e){return g(n,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:return t=R(e),[4,k(i,t,"user")];case 1:return n=r.sent(),[2,_(n,D)]}}))}))}),[R,_,N,k]),sendFileMessage:t.useCallback((function(e){return g(n,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:return t=R(e),[4,k(s,t,"file")];case 1:return n=r.sent(),[2,f(n,D)]}}))}))}),[R,f,N,k]),sendMultipleFilesMessage:t.useCallback((function(e){return g(n,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:return t=R(e),[4,k(h,t,"multipleFiles")];case 1:return n=r.sent(),[2,p(n,D)]}}))}))}),[R,p,N,k]),sendVoiceMessage:t.useCallback((function(e,t){return g(n,void 0,void 0,(function(){var n,r;return E(this,(function(i){switch(i.label){case 0:return n=R(m(m({},e),{fileName:dg,mimeType:hg,metaArrays:[new Ro({key:fg,value:["".concat(t)]}),new Ro({key:pg,value:[_g]})]})),[4,k(c,n,"voice")];case 1:return r=i.sent(),[2,f(r,D)]}}))}))}),[R,f,N,k]),updateUserMessage:t.useCallback((function(e,t){return g(n,void 0,void 0,(function(){var n,r;return E(this,(function(i){switch(i.label){case 0:return n=R(t),[4,k(l,n,"update")];case 1:return r=i.sent(),[2,v(e,r).then((function(e){return O.publish(BT.UPDATE_USER_MESSAGE,{channel:w,message:e,publishingModules:[OT.CHANNEL]}),e}))]}}))}))}),[R,v,k,null==w?void 0:w.url]),updateFileMessage:b,resendMessage:y,deleteMessage:C,resetNewMessages:T}}(m(m({},o),{scrollToBottom:c})),p=t.useCallback((function(e){i.setState((function(t){return m(m({},t),{currentChannel:e,fetchChannelError:null,quoteMessage:null,animatedMessageId:null,nicknamesMap:new Map(e.members.map((function(e){return[e.userId,e.nickname]})))})}),!0)}),[]),_=t.useCallback((function(e){i.setState((function(t){return m(m({},t),{currentChannel:null,fetchChannelError:e,quoteMessage:null,animatedMessageId:null})}))}),[]),v=t.useCallback((function(e){i.setState((function(t){return m(m({},t),{quoteMessage:e})}))}),[]),b=t.useMemo((function(){return m({setCurrentChannel:p,handleChannelError:_,setQuoteMessage:v,scrollToBottom:c,scrollToMessage:d,toggleReaction:h,setAnimatedMessageId:l,setIsScrollBottomReached:u},f)}),[p,_,v,c,d,h,l,u,f]);return{state:o,actions:b}};function aN(e,t){void 0===t&&(t=!0),t?setTimeout((function(){e()})):e()}function sN(e,t){return"boolean"==typeof t?t?"smooth":"auto":e}var oN={currentChannel:null,channelUrl:"",fetchChannelError:null,nicknamesMap:new Map,messages:[],quoteMessage:null,animatedMessageId:null,isScrollBottomReached:!0,scrollRef:{current:null},scrollDistanceFromBottomRef:{current:0},scrollPositionRef:{current:0},messageInputRef:{current:null},isReactionEnabled:!1,isMessageGroupingEnabled:!0,isMultipleFilesMessageEnabled:!1,showSearchIcon:!0,replyType:"NONE",threadReplySelectType:ET.PARENT,disableMarkAsRead:!1,scrollBehavior:"auto",scrollPubSub:null},lN=t.createContext(null),uN=function(e){var n=e.children,r=KT({channelUrl:null==e?void 0:e.channelUrl,renderUserProfile:null==e?void 0:e.renderUserProfile,disableUserProfile:null==e?void 0:e.disableUserProfile,onUserProfileMessage:null==e?void 0:e.onUserProfileMessage,onStartDirectMessage:null==e?void 0:e.onStartDirectMessage,isReactionEnabled:null==e?void 0:e.isReactionEnabled,isMessageGroupingEnabled:null==e?void 0:e.isMessageGroupingEnabled,isMultipleFilesMessageEnabled:null==e?void 0:e.isMultipleFilesMessageEnabled,showSearchIcon:null==e?void 0:e.showSearchIcon,threadReplySelectType:null==e?void 0:e.threadReplySelectType,disableMarkAsRead:null==e?void 0:e.disableMarkAsRead,scrollBehavior:null==e?void 0:e.scrollBehavior,forceLeftToRightMessageLayout:null==e?void 0:e.forceLeftToRightMessageLayout,startingPoint:null==e?void 0:e.startingPoint,animatedMessageId:null==e?void 0:e.animatedMessageId,onMessageAnimated:null==e?void 0:e.onMessageAnimated,messageListQueryParams:null==e?void 0:e.messageListQueryParams,filterEmojiCategoryIds:null==e?void 0:e.filterEmojiCategoryIds,onBeforeSendUserMessage:null==e?void 0:e.onBeforeSendUserMessage,onBeforeSendFileMessage:null==e?void 0:e.onBeforeSendFileMessage,onBeforeSendVoiceMessage:null==e?void 0:e.onBeforeSendVoiceMessage,onBeforeSendMultipleFilesMessage:null==e?void 0:e.onBeforeSendMultipleFilesMessage,onBeforeUpdateUserMessage:null==e?void 0:e.onBeforeUpdateUserMessage,onBeforeDownloadFileMessage:null==e?void 0:e.onBeforeDownloadFileMessage,onBackClick:null==e?void 0:e.onBackClick,onChatHeaderActionClick:null==e?void 0:e.onChatHeaderActionClick,onReplyInThreadClick:null==e?void 0:e.onReplyInThreadClick,onSearchClick:null==e?void 0:e.onSearchClick,onQuoteMessageClick:null==e?void 0:e.onQuoteMessageClick,renderUserMentionItem:null==e?void 0:e.renderUserMentionItem}),i=t.useRef(function(e){return GC(m(m({},oN),e))}(r));return t.createElement(lN.Provider,{value:i.current},n)},cN=function(e){var n,r,i,a,s,o,l=e.channelUrl,u=e.children,c=e.isReactionEnabled,d=e.replyType,h=e.threadReplySelectType,f=e.isMessageGroupingEnabled,p=void 0===f||f,_=e.isMultipleFilesMessageEnabled,v=e.showSearchIcon,b=e.disableMarkAsRead,y=void 0!==b&&b,C=e.scrollBehavior,T=void 0===C?"auto":C,N=e.startingPoint,S=e.animatedMessageId,I=e.messageListQueryParams,w=e.onBeforeSendUserMessage,A=e.onBeforeSendFileMessage,M=e.onBeforeSendVoiceMessage,O=e.onBeforeSendMultipleFilesMessage,R=e.onBeforeUpdateUserMessage,D=e.onBeforeDownloadFileMessage,k=e.onMessageAnimated,L=e.onBackClick,x=e.onChatHeaderActionClick,U=e.onReplyInThreadClick,P=e.onSearchClick,F=e.onQuoteMessageClick,B=e.renderUserMentionItem,H=e.filterEmojiCategoryIds,G=iN(),j=G.state,V=G.actions,q=hN().updateState,z=yT().state,K=z.config,Y=z.stores.sdkStore,W=K.markAsReadScheduler,Q=K.logger,X=K.pubSub,Z=function(e,n){void 0===n&&(n=[]);var r=t.useRef(null),i=t.useRef(0),a=t.useRef(0),s=t.useState((function(){return ST({publishSynchronous:!0})}))[0],o=iN().actions.setIsScrollBottomReached;return t.useLayoutEffect((function(){i.current=0,a.current=0,o(!0),r.current&&(r.current.scrollTop=r.current.scrollHeight)}),n),t.useLayoutEffect((function(){var t=[];return t.push(s.subscribe("scrollToBottom",(function(t){var n=t.resolve,i=t.animated;aN((function(){r.current?(r.current.scroll?r.current.scroll({top:r.current.scrollHeight,behavior:sN(e,i)}):r.current.scrollTop=r.current.scrollHeight,a.current=0,o(!0),n&&n()):n&&n()}))}))),t.push(s.subscribe("scroll",(function(t){var n=t.top,i=t.animated,s=t.lazy,l=t.resolve;aN((function(){if(r.current){var t=r.current,s=t.scrollTop,u=t.scrollHeight,c=t.clientHeight;r.current.scroll?r.current.scroll({top:n,behavior:sN(e,i)}):"number"==typeof n&&(r.current.scrollTop=n),a.current=Math.max(0,u-s-c),o(0===a.current),l&&l()}}),s)}))),function(){t.forEach((function(e){return(0,e.remove)()}))}}),[e]),{scrollRef:r,scrollPubSub:s,scrollDistanceFromBottomRef:a,scrollPositionRef:i}}(T,[null===(n=j.currentChannel)||void 0===n?void 0:n.url]),J=Z.scrollRef,$=Z.scrollPubSub,ee=Z.scrollDistanceFromBottomRef,te=Z.scrollPositionRef,ne=j.isScrollBottomReached,re=FT(null!=d?d:K.groupChannel.replyType).upperCase,ie=(a=null!=h?h:K.groupChannel.threadReplySelectType,{lowerCase:a.toLowerCase(),upperCase:a.toUpperCase()}).upperCase,ae=FT(null!=d?d:K.groupChannel.replyType).upperCase,se=PT({channel:j.currentChannel,config:K,moduleLevel:c}),oe=jv((function(){return"NONE"===ae?he.NONE:he.ONLY_REPLY_TO_CHANNEL})),le=Gv(Y.sdk,j.currentChannel,{startingPoint:N,replyType:oe,collectionCreator:pN(j.currentChannel,I),shouldCountNewMessages:function(){return!ne},markAsRead:function(e){ne&&!y&&e.forEach((function(e){return W.push(e)}))},onMessagesReceived:function(e){ne&&AT()&&e.length!==j.messages.length&&setTimeout((function(){return V.scrollToBottom(!0)}),10)},onChannelDeleted:function(){V.setCurrentChannel(null),null==L||L()},onCurrentUserBanned:function(){V.setCurrentChannel(null),null==L||L()},onChannelUpdated:function(e){V.setCurrentChannel(e)},logger:Q});em((function(){return g(void 0,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:if(!Y.initialized||!l)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Y.sdk.groupChannel.getChannel(l)];case 2:return e=r.sent(),V.setCurrentChannel(e),[3,4];case 3:return t=r.sent(),V.handleChannelError(t),null===(n=null==Q?void 0:Q.error)||void 0===n||n.call(Q,"GroupChannelProvider: error when fetching channel",t),[3,4];case 4:return[2]}}))}))}),[Y.initialized,Y.sdk,l]),s=function(){return g(void 0,void 0,void 0,(function(){var e,t;return E(this,(function(n){return le.initialized&&V.scrollToBottom(),e=function(e){var t;e.channel.url===(null===(t=j.currentChannel)||void 0===t?void 0:t.url)&&V.scrollToBottom(!0)},void 0===(null==X?void 0:X.subscribe)?[2]:(t=[K.pubSub.subscribe(jT.SEND_USER_MESSAGE,e),K.pubSub.subscribe(jT.SEND_FILE_MESSAGE,e)],[2,function(){t.forEach((function(e){return e.remove()}))}])}))}))},o=[le.initialized,null===(r=j.currentChannel)||void 0===r?void 0:r.url],t.useLayoutEffect(nm(s),o),t.useEffect((function(){"number"==typeof N&&V.scrollToMessage(N,0,!1,!1)}),[N]),t.useEffect((function(){S&&V.setAnimatedMessageId(S)}),[S]);var ue=t.useMemo((function(){return{onBeforeSendUserMessage:w,onBeforeSendFileMessage:A,onBeforeSendVoiceMessage:M,onBeforeSendMultipleFilesMessage:O,onBeforeUpdateUserMessage:R,onBeforeDownloadFileMessage:D,onBackClick:L,onChatHeaderActionClick:x,onReplyInThreadClick:U,onSearchClick:P,onQuoteMessageClick:F,onMessageAnimated:k}}),[w,A,M,O,R,D,L,x,U,P,F,k]),ce=t.useMemo((function(){return{renderUserMentionItem:B,filterEmojiCategoryIds:H}}),[B,H]),de=t.useMemo((function(){return{isReactionEnabled:se,isMessageGroupingEnabled:p,isMultipleFilesMessageEnabled:_,replyType:re,threadReplySelectType:ie,showSearchIcon:null!=v?v:K.groupChannelSettings.enableMessageSearch,disableMarkAsRead:y,scrollBehavior:T}}),[se,p,_,re,ie,v,y,T,K.groupChannelSettings.enableMessageSearch]),fe=t.useMemo((function(){return{scrollRef:J,scrollPubSub:$,scrollDistanceFromBottomRef:ee,scrollPositionRef:te,isScrollBottomReached:ne}}),[J,$,ee,te,ne]);return qT((function(){q(m(m(m(m(m({channelUrl:l,currentChannel:j.currentChannel},de),fe),ue),ce),le))}),[l,null===(i=j.currentChannel)||void 0===i?void 0:i.serialize(),de,fe,ue,ce,le.initialized,le.loading,le.messages.map((function(e){return e.serialize()}))]),u},dN=function(e){return t.createElement(uN,m({},e),t.createElement(cN,m({},e),t.createElement(NT,m({},e),e.children)))},hN=function(){return VC(lN,(function(e){return e}),oN)},fN=function(){var e=iN(),t=e.state,n=e.actions;return m(m({},t),n)};function pN(e,t){return function(n){var r=m(m(m({},n),{prevResultLimit:30,nextResultLimit:30}),t);return e.createMessageCollection(m(m({},r),{filter:new ih(r)}))}}var _N={en:{MESSAGE_STATUS__YESTERDAY:"Yesterday",CHANNEL__MESSAGE_LIST__NOTIFICATION__NEW_MESSAGE:"new message(s) since",CHANNEL__MESSAGE_LIST__NOTIFICATION__ON:"on",CHANNEL_PREVIEW_MOBILE_LEAVE:"Leave channel",CHANNEL_SETTING__HEADER__TITLE:"Channel information",CHANNEL_SETTING__PROFILE__EDIT:"Edit",CHANNEL_SETTING__MEMBERS__TITLE:"Members",CHANNEL_SETTING__MEMBERS__SEE_ALL_MEMBERS:"All members",CHANNEL_SETTING__MEMBERS__INVITE_MEMBER:"Invite users",CHANNEL_SETTING__MEMBERS__YOU:" (You)",CHANNEL_SETTING__MEMBERS__SELECT_TITLE:"Select members",CHANNEL_SETTING__MEMBERS__OPERATOR:"Operator",CHANNEL_SETTING__LEAVE_CHANNEL__TITLE:"Leave channel",CHANNEL_SETTING__OPERATORS__TITLE:"Operators",CHANNEL_SETTING__OPERATORS__TITLE_ALL:"All operators",CHANNEL_SETTING__OPERATORS__TITLE_ADD:"Add operator",CHANNEL_SETTING__OPERATORS__ADD_BUTTON:"Add",CHANNEL_SETTING__MUTED_MEMBERS__TITLE:"Muted members",CHANNEL_SETTING__MUTED_MEMBERS__TITLE_ALL:"All muted members",CHANNEL_SETTING__NO_UNMUTED:"No muted members yet",CHANNEL_SETTING__BANNED_MEMBERS__TITLE:"Banned users",CHANNEL_SETTING__FREEZE_CHANNEL:"Freeze Channel",CHANNEL_SETTING__MODERATION__REGISTER_AS_OPERATOR:"Register as operator",CHANNEL_SETTING__MODERATION__UNREGISTER_OPERATOR:"Unregister operator",CHANNEL_SETTING__MODERATION__MUTE:"Mute",CHANNEL_SETTING__MODERATION__UNMUTE:"Unmute",CHANNEL_SETTING__MODERATION__BAN:"Ban",CHANNEL_SETTING__MODERATION__UNBAN:"Unban",CHANNEL_SETTING__MODERATION__EMPTY_BAN:"No banned members yet",CHANNEL_SETTING__MODERATION__ALL_BAN:"All banned members",OPEN_CHANNEL_CONVERSATION__TITLE_PARTICIPANTS:"participants",OPEN_CHANNEL_CONVERSATION__SELECT_PARTICIPANTS:"Select participants",OPEN_CHANNEL_LIST__TITLE:"Channels",CREATE_OPEN_CHANNEL_LIST__TITLE:"New channel profile",CREATE_OPEN_CHANNEL_LIST__SUBTITLE__IMG_SECTION:"Channel image",CREATE_OPEN_CHANNEL_LIST__SUBTITLE__IMG_UPLOAD:"Upload",CREATE_OPEN_CHANNEL_LIST__SUBTITLE__TEXT_SECTION:"Channel name",CREATE_OPEN_CHANNEL_LIST__SUBTITLE__TEXT_PLACE_HOLDER:"Enter channel name",CREATE_OPEN_CHANNEL_LIST__SUBMIT:"Create",OPEN_CHANNEL_SETTINGS__OPERATOR_TITLE:"Channel Information",OPEN_CHANNEL_SETTINGS__OPERATOR_URL:"URL",OPEN_CHANNEL_SETTINGS__PARTICIPANTS_ACCORDION_TITLE:"Participants",OPEN_CHANNEL_SETTINGS__DELETE_CHANNEL_PANEL:"Delete channel",OPEN_CHANNEL_SETTINGS__DELETE_CHANNEL_TITLE:"Delete channel?",OPEN_CHANNEL_SETTINGS__DELETE_CHANNEL_CONTEXT:"Once deleted, this channel can't be restored.",OPEN_CHANNEL_SETTINGS__DELETE_CHANNEL_SUBMIT:"Delete",OPEN_CHANNEL_SETTINGS__OPERATORS_TITLE:"Operators",OPEN_CHANNEL_SETTINGS__OPERATORS__TITLE_ADD:"Add operator",OPEN_CHANNEL_SETTINGS__OPERATORS__TITLE_ALL:"All operators",OPEN_CHANNEL_SETTINGS__MUTED_MEMBERS__TITLE:"Muted participants",OPEN_CHANNEL_SETTINGS__MUTED_MEMBERS__TITLE_ALL:"All muted participants",OPEN_CHANNEL_SETTINGS__MUTED_MEMBERS__NO_ONE:"No muted participants yet",OPEN_CHANNEL_SETTINGS__BANNED_MEMBERS__TITLE:"Banned users",OPEN_CHANNEL_SETTINGS__BANNED_MEMBERS__TITLE_ALL:"All banned users",OPEN_CHANNEL_SETTINGS__BANNED_MEMBERS__NO_ONE:"No banned users yet",OPEN_CHANNEL_SETTINGS__MEMBERS__YOU:" (You)",OPEN_CHANNEL_SETTINGS__MEMBERS__OPERATOR:"Operator",OPEN_CHANNEL_SETTINGS__PARTICIPANTS_TITLE:"Participants",OPEN_CHANNEL_SETTINGS__EMPTY_LIST:"No participants yet",OPEN_CHANNEL_SETTINGS__SEE_ALL:"See all participants",OPEN_CHANNEL_SETTINGS__ALL_PARTICIPANTS_TITLE:"All participants",OPEN_CHANNEL_SETTINGS__NO_TITLE:"(No title)",OPEN_CHANNEL_SETTING__MODERATION__REGISTER_AS_OPERATOR:"Register as operator",OPEN_CHANNEL_SETTING__MODERATION__UNREGISTER_OPERATOR:"Unregister operator",OPEN_CHANNEL_SETTING__MODERATION__MUTE:"Mute",OPEN_CHANNEL_SETTING__MODERATION__UNMUTE:"Unmute",OPEN_CHANNEL_SETTING__MODERATION__BAN:"Ban",OPEN_CHANNEL_SETTING__MODERATION__UNBAN:"Unban",TRYING_TO_CONNECT:"Trying to connect",TYPING_INDICATOR__IS_TYPING:"is typing...",TYPING_INDICATOR__AND:"and",TYPING_INDICATOR__ARE_TYPING:"are typing...",TYPING_INDICATOR__MULTIPLE_TYPING:"Several people are typing...",CHANNEL_FROZEN:"Channel frozen",PLACE_HOLDER__NO_CHANNEL:"No channels",PLACE_HOLDER__WRONG:"Something went wrong",PLACE_HOLDER__RETRY_TO_CONNECT:"Retry",PLACE_HOLDER__NO_MESSAGES:"No messages",TOOLTIP__AND_YOU:", and you",TOOLTIP__YOU:"you",TOOLTIP__UNKNOWN_USER:"(no name)",UNKNOWN__UNKNOWN_MESSAGE_TYPE:"(Unknown message type)",UNKNOWN__CANNOT_READ_MESSAGE:"Cannot read this message.",UNKNOWN__TEMPLATE_ERROR:"(Template error)",FORM_VERSION_ERROR:"Form type messages are not available in this version.",UNKNOWN__CANNOT_READ_TEMPLATE:"Cannot read this template.",MESSAGE_EDITED:"(edited)",MODAL__DELETE_MESSAGE__TITLE:"Delete this message?",MODAL__CHANNEL_INFORMATION__TITLE:"Edit channel information",MODAL__CHANNEL_INFORMATION__CHANNEL_IMAGE:"Channel image",MODAL__CHANNEL_INFORMATION__UPLOAD:"Upload",MODAL__CHANNEL_INFORMATION__CHANNEL_NAME:"Channel name",MODAL__CHANNEL_INFORMATION__INPUT__PLACE_HOLDER:"Enter name",MODAL__INVITE_MEMBER__TITLE:"Invite member",MODAL__INVITE_MEMBER__SELECTED:"selected",MODAL__CHOOSE_CHANNEL_TYPE__TITLE:"New channel",MODAL__CHOOSE_CHANNEL_TYPE__GROUP:"Group",MODAL__CHOOSE_CHANNEL_TYPE__SUPER_GROUP:"Super group",MODAL__CHOOSE_CHANNEL_TYPE__BROADCAST:"Broadcast",MODAL__CREATE_CHANNEL__TITLE:"New channel",MODAL__CREATE_CHANNEL__GROUP:"Group",MODAL__CREATE_CHANNEL__SUPER:"Super group",MODAL__CREATE_CHANNEL__BROADCAST:"Broadcast",MODAL__CREATE_CHANNEL__SELECTED:"selected",MODAL__LEAVE_CHANNEL__TITLE:"Leave this channel?",MODAL__LEAVE_CHANNEL__FOOTER:"Leave",MODAL__VOICE_MESSAGE_INPUT_DISABLED__TITLE_MUTED:"You're muted by the operator.",MODAL__VOICE_MESSAGE_INPUT_DISABLED__TITLE_FROZEN:"Channel is frozen.",USER_PROFILE__MESSAGE:"Message",USER_PROFILE__USER_ID:"User ID",EDIT_PROFILE__TITLE:"My profile",EDIT_PROFILE__IMAGE_LABEL:"Profile image",EDIT_PROFILE__IMAGE_UPLOAD:"Upload",EDIT_PROFILE__NICKNAME_LABEL:"Nickname",EDIT_PROFILE__NICKNAME_PLACEHOLDER:"Enter your nickname",EDIT_PROFILE__USERID_LABEL:"User ID",EDIT_PROFILE__THEME_LABEL:"Dark theme",MESSAGE_INPUT__PLACE_HOLDER:"Enter message",MESSAGE_INPUT__PLACE_HOLDER__DISABLED:"Chat is unavailable in this channel",MESSAGE_INPUT__PLACE_HOLDER__SUGGESTED_REPLIES:"Please choose one from above",MESSAGE_INPUT__PLACE_HOLDER__MESSAGE_FORM:"Please fill out the message form.",MESSAGE_INPUT__PLACE_HOLDER__FROZEN:"Chat is unavailable in this channel",MESSAGE_INPUT__PLACE_HOLDER__MUTED:"Chat is unavailable because you're muted",MESSAGE_INPUT__PLACE_HOLDER__MUTED_SHORT:"You're muted",MESSAGE_INPUT__QUOTE_REPLY__PLACE_HOLDER:"Reply to message",BUTTON__SUBMIT:"Submit",BUTTON__CANCEL:"Cancel",BUTTON__DELETE:"Delete",BUTTON__SAVE:"Save",BUTTON__CREATE:"Create",BUTTON__INVITE:"Invite",BUTTON__OK:"OK",BADGE__OVER:"+",NO_TITLE:"No title",NO_NAME:"(No name)",NO_MEMBERS:"(No members)",LABEL__OPERATOR:"Operator",MESSAGE_MENU__COPY:"Copy",MESSAGE_MENU__REPLY:"Reply",MESSAGE_MENU__THREAD:"Reply in thread",MESSAGE_MENU__OPEN_IN_CHANNEL:"Open in channel",MESSAGE_MENU__EDIT:"Edit",MESSAGE_MENU__RESEND:"Resend",MESSAGE_MENU__DELETE:"Delete",MESSAGE_MENU__SAVE:"Save",CONTEXT_MENU_DROPDOWN__COPY:"Copy",CONTEXT_MENU_DROPDOWN__EDIT:"Edit",CONTEXT_MENU_DROPDOWN__RESEND:"Resend",CONTEXT_MENU_DROPDOWN__DELETE:"Delete",CONTEXT_MENU_DROPDOWN__SAVE:"Save",SEARCH:"Search",SEARCH_IN_CHANNEL:"Search in channel",SEARCH_IN:"Search in",SEARCHING:"Searching for messages...",NO_SEARCHED_MESSAGE:"No results found.",QUOTE_MESSAGE_INPUT__REPLY_TO:"Reply to",QUOTE_MESSAGE_INPUT__FILE_TYPE_IMAGE:"Photo",QUOTE_MESSAGE_INPUT__FILE_TYPE_GIF:"GIF",QUOTE_MESSAGE_INPUT__FILE_TYPE__VIDEO:"Video",QUOTED_MESSAGE__REPLIED_TO:"replied to",QUOTED_MESSAGE__CURRENT_USER:"You",QUOTED_MESSAGE__UNAVAILABLE:"Message unavailable",THREAD__HEADER_TITLE:"Thread",CHANNEL__THREAD_REPLY:"reply",CHANNEL__THREAD_REPLIES:"replies",CHANNEL__THREAD_OVER_MAX:"99+",THREAD__THREAD_REPLY:"reply",THREAD__THREAD_REPLIES:"replies",THREAD__INPUT__REPLY_TO_THREAD:"Reply to thread",THREAD__INPUT__REPLY_IN_THREAD:"Reply in thread",MENTION_NAME__NO_NAME:"(No name)",MENTION_COUNT__OVER_LIMIT:"You can mention up to %d times at a time.",UI__FILE_VIEWER__UNSUPPORT:"Unsupported message",VOICE_RECORDING_PERMISSION_DENIED:"You cannot record the voice since\n        voice recording is not permitted in your device system setting",VOICE_MESSAGE:"Voice Message",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_GIF:"GIF",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_PHOTO:"Photo",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_VIDEO:"Video",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_AUDIO:"Audio",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_VOICE_MESSAGE:"Voice message",CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_GENERAL:"File",CHANNEL_PREVIEW_LAST_MESSAGE_TEMPLATE_MESSAGE:"Message",DATE_FORMAT__MESSAGE_LIST__NOTIFICATION__UNREAD_SINCE:"p 'on' MMM dd",DATE_FORMAT__MESSAGE_LIST__DATE_SEPARATOR:"MMMM dd, yyyy",DATE_FORMAT__THREAD_LIST__DATE_SEPARATOR:"MMM dd, yyyy",DATE_FORMAT__MESSAGE_CREATED_AT:"p",DATE_FORMAT__UNREAD_SINCE:"p MMM dd",DATE_FORMAT__LAST_MESSAGE_CREATED_AT__TODAY:"p",DATE_FORMAT__LAST_MESSAGE_CREATED_AT__THIS_YEAR:"MMM d",DATE_FORMAT__LAST_MESSAGE_CREATED_AT__PREVIOUS_YEAR:"yyyy/M/d",FILE_UPLOAD_NOTIFICATION__COUNT_LIMIT:"Up to %d files can be attached.",FILE_UPLOAD_NOTIFICATION__SIZE_LIMIT:"The maximum size per file is %d MB.",FEEDBACK_LIKE:"Like",FEEDBACK_DISLIKE:"Dislike",EDIT_COMMENT:"Edit comment",REMOVE_FEEDBACK:"Remove Feedback",FEEDBACK_MODAL_TITLE:"Provide additional feedback (optional)",FEEDBACK_CONTENT_PLACEHOLDER:"Leave a comment",BUTTON__REMOVE_FEEDBACK:"Remove feedback",FEEDBACK_FAILED_SUBMIT:"Couldnt submit. Try again.",FEEDBACK_FAILED_SAVE:"Couldnt save. Try again.",FEEDBACK_FAILED_DELETE:"Couldnt delete. Try again.",FORM_ITEM_REQUIRED:"This field is required",FORM_ITEM_INVALID:"Please check the value",FORM_ITEM_OPTIONAL_EMPTY:"No Response"}},mN=function(e){return _N[e]},vN={H_1:"H_1",H_2:"H_2",SUBTITLE_1:"SUBTITLE_1",SUBTITLE_2:"SUBTITLE_2",BODY_1:"BODY_1",BODY_2:"BODY_2",BUTTON_1:"BUTTON_1",BUTTON_2:"BUTTON_2",BUTTON_3:"BUTTON_3",CAPTION_1:"CAPTION_1",CAPTION_2:"CAPTION_2",CAPTION_3:"CAPTION_3"},gN={ONBACKGROUND_1:"ONBACKGROUND_1",ONBACKGROUND_2:"ONBACKGROUND_2",ONBACKGROUND_3:"ONBACKGROUND_3",ONBACKGROUND_4:"ONBACKGROUND_4",ONCONTENT_1:"ONCONTENT_1",ONCONTENT_2:"ONCONTENT_2",ONCONTENT_3:"ONCONTENT_3",ONCONTENT_INVERSE_1:"ONCONTENT_INVERSE_1",ONCONTENT_INVERSE_3:"ONCONTENT_INVERSE_3",PRIMARY:"PRIMARY",ERROR:"ERROR",SECONDARY_3:"SECONDARY_3"};function EN(e){switch(e){case vN.H_1:return"sendbird-label--h-1";case vN.H_2:return"sendbird-label--h-2";case vN.SUBTITLE_1:return"sendbird-label--subtitle-1";case vN.SUBTITLE_2:return"sendbird-label--subtitle-2";case vN.BODY_1:return"sendbird-label--body-1";case vN.BODY_2:return"sendbird-label--body-2";case vN.BUTTON_1:return"sendbird-label--button-1";case vN.BUTTON_2:return"sendbird-label--button-2";case vN.BUTTON_3:return"sendbird-label--button-3";case vN.CAPTION_1:return"sendbird-label--caption-1";case vN.CAPTION_2:return"sendbird-label--caption-2";case vN.CAPTION_3:return"sendbird-label--caption-3";default:return""}}function bN(e){switch(e){case gN.ONBACKGROUND_1:return"sendbird-label--color-onbackground-1";case gN.ONBACKGROUND_2:return"sendbird-label--color-onbackground-2";case gN.ONBACKGROUND_3:return"sendbird-label--color-onbackground-3";case gN.ONBACKGROUND_4:return"sendbird-label--color-onbackground-4";case gN.ONCONTENT_1:return"sendbird-label--color-oncontent-1";case gN.ONCONTENT_2:return"sendbird-label--color-oncontent-2";case gN.ONCONTENT_3:return"sendbird-label--color-oncontent-3";case gN.ONCONTENT_INVERSE_1:return"sendbird-label--color-oncontent-inverse-1";case gN.ONCONTENT_INVERSE_3:return"sendbird-label--color-oncontent-inverse-3";case gN.PRIMARY:return"sendbird-label--color-primary";case gN.ERROR:return"sendbird-label--color-error";case gN.SECONDARY_3:return"sendbird-label--color-secondary-3";default:return""}}var yN=t.forwardRef((function(e,n){var r=e.className,i=void 0===r?[]:r,a=e.type,s=e.color,o=e.children,l=void 0===o?null:o,u=e.testID;return t.createElement("span",{className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-label",EN(a),bN(s)],!1).join(" "),ref:n,"data-testid":u},l)})),CN=vN,TN=gN,NN=mN("en"),SN={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function IN(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var wN={date:IN({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:IN({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:IN({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},AN={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function MN(e){return function(t,n){var r;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,a=null!=n&&n.width?String(n.width):i;r=e.formattingValues[a]||e.formattingValues[i]}else{var s=e.defaultWidth,o=null!=n&&n.width?String(n.width):e.defaultWidth;r=e.values[o]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}var ON={ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:MN({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:MN({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:MN({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:MN({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:MN({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function RN(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;var s,o=a[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],u=Array.isArray(l)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(l,(function(e){return e.test(o)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(l,(function(e){return e.test(o)}));return s=e.valueCallback?e.valueCallback(u):u,{value:s=n.valueCallback?n.valueCallback(s):s,rest:t.slice(o.length)}}}var DN,kN,LN,xN={ordinalNumber:(DN={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(DN.matchPattern);if(!n)return null;var r=n[0],i=e.match(DN.parsePattern);if(!i)return null;var a=DN.valueCallback?DN.valueCallback(i[0]):i[0];return{value:a=t.valueCallback?t.valueCallback(a):a,rest:e.slice(r.length)}}),era:RN({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:RN({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:RN({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:RN({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:RN({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},UN={code:"en-US",formatDistance:function(e,t,n){var r,i=SN[e];return r="string"==typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!=n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:wN,formatRelative:function(e,t,n,r){return AN[e]},localize:ON,match:xN,options:{weekStartsOn:0,firstWeekContainsDate:1}},PN={stringSet:mN("en"),dateLocale:UN},FN=t.createContext(PN),BN=function(e){var n=e.children;return t.createElement(FN.Provider,{value:m(m({},PN),e)},n)},HN=function(){var e=t.useContext(FN);if(!e)throw new Error("`useLocalization` hook must be used within `SendbirdProvider` that includes `LocalizationProvider`.");return e},GN=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},jN=function(e){var n,r=e.members;return t.createElement(t.Fragment,null,(n=t.useContext(FN).stringSet,r&&0!==r.length?r&&1===r.length?"".concat(r[0].nickname," ").concat(n.TYPING_INDICATOR__IS_TYPING):r&&2===r.length?"".concat(r[0].nickname," ").concat(n.TYPING_INDICATOR__AND," ").concat(r[1].nickname," ").concat(n.TYPING_INDICATOR__ARE_TYPING):n.TYPING_INDICATOR__MULTIPLE_TYPING:""))},VN=function(e){var n,r,i,a=e.channelUrl,s=yT().state,o=null===(r=null===(n=null==s?void 0:s.stores)||void 0===n?void 0:n.sdkStore)||void 0===r?void 0:r.sdk,l=null===(i=null==s?void 0:s.config)||void 0===i?void 0:i.logger,u=t.useState(GN()),c=u[0],d=u[1],h=t.useState([]),f=h[0],p=h[1];return t.useEffect((function(){var e;if(null===(e=null==o?void 0:o.groupChannel)||void 0===e?void 0:e.addGroupChannelHandler){o.groupChannel.removeGroupChannelHandler(c);var t=GN(),n=new V_({onTypingStatusUpdated:function(e){if(l.info("Channel > Typing Indicator: onTypingStatusUpdated",e),e.url===a){var t=e.getTypingUsers();p(t)}}});o.groupChannel.addGroupChannelHandler(t,n),d(t)}return function(){var e;p([]),(null===(e=null==o?void 0:o.groupChannel)||void 0===e?void 0:e.removeGroupChannelHandler)&&o.groupChannel.removeGroupChannelHandler(c)}}),[a]),t.createElement(yN,{className:"sendbird-conversation__footer__typing-indicator__text",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},t.createElement(jN,{members:f}))};(LN=kN||(kN={})).Text="text",LN.Bubble="bubble";var qN,zN={ADD:"ADD",ARROW_LEFT:"ARROW_LEFT",ATTACH:"ATTACH",AUDIO_ON_LINED:"AUDIO_ON_LINED",BAN:"BAN",BROADCAST:"BROADCAST",CAMERA:"CAMERA",CHANNELS:"CHANNELS",CHAT:"CHAT",CHAT_FILLED:"CHAT_FILLED",CHEVRON_DOWN:"CHEVRON_DOWN",CHEVRON_RIGHT:"CHEVRON_RIGHT",CLOSE:"CLOSE",COLLAPSE:"COLLAPSE",COPY:"COPY",CREATE:"CREATE",DELETE:"DELETE",DISCONNECTED:"DISCONNECTED",DOCUMENT:"DOCUMENT",DONE:"DONE",DONE_ALL:"DONE_ALL",DOWNLOAD:"DOWNLOAD",EDIT:"EDIT",EMOJI_MORE:"EMOJI_MORE",ERROR:"ERROR",EXPAND:"EXPAND",FILE_AUDIO:"FILE_AUDIO",FILE_DOCUMENT:"FILE_DOCUMENT",FREEZE:"FREEZE",GIF:"GIF",INFO:"INFO",LEAVE:"LEAVE",MEMBERS:"MEMBERS",MESSAGE:"MESSAGE",MODERATIONS:"MODERATIONS",MORE:"MORE",MUTE:"MUTE",NOTIFICATIONS:"NOTIFICATIONS",NOTIFICATIONS_OFF_FILLED:"NOTIFICATIONS_OFF_FILLED",OPERATOR:"OPERATOR",PHOTO:"PHOTO",PLAY:"PLAY",PLUS:"PLUS",QUESTION:"QUESTION",REFRESH:"REFRESH",REPLY:"REPLY",REMOVE:"REMOVE",SEARCH:"SEARCH",SEND:"SEND",SETTINGS_FILLED:"SETTINGS_FILLED",SLIDE_LEFT:"SLIDE_LEFT",SPINNER:"SPINNER",SUPERGROUP:"SUPERGROUP",THREAD:"THREAD",THUMBNAIL_NONE:"THUMBNAIL_NONE",TOGGLE_OFF:"TOGGLE_OFF",TOGGLE_ON:"TOGGLE_ON",USER:"USER",FEEDBACK_LIKE:"FEEDBACK_LIKE",FEEDBACK_DISLIKE:"FEEDBACK_DISLIKE"},KN={DEFAULT:"DEFAULT",PRIMARY:"PRIMARY",PRIMARY_2:"PRIMARY_2",SECONDARY:"SECONDARY",SECONDARY_2:"SECONDARY_2",CONTENT:"CONTENT",CONTENT_INVERSE:"CONTENT_INVERSE",CONTENT_INVERSE_3:"CONTENT_INVERSE_3",WHITE:"WHITE",GRAY:"GRAY",THUMBNAIL_ICON:"THUMBNAIL_ICON",SENT:"SENT",READ:"READ",ON_BACKGROUND_1:"ON_BACKGROUND_1",ON_BACKGROUND_2:"ON_BACKGROUND_2",ON_BACKGROUND_3:"ON_BACKGROUND_3",ON_BACKGROUND_4:"ON_BACKGROUND_4",BACKGROUND_3:"BACKGROUND_3",ERROR:"ERROR"};function YN(e){switch(e){case KN.PRIMARY:return"sendbird-icon-color--primary";case KN.PRIMARY_2:return"sendbird-icon-color--primary-2";case KN.SECONDARY:return"sendbird-icon-color--secondary";case KN.SECONDARY_2:return"sendbird-icon-color--secondary-2";case KN.CONTENT:return"sendbird-icon-color--content";case KN.CONTENT_INVERSE:return"sendbird-icon-color--content-inverse";case KN.CONTENT_INVERSE_3:return"sendbird-icon-color--content-inverse-3";case KN.WHITE:return"sendbird-icon-color--white";case KN.GRAY:return"sendbird-icon-color--gray";case KN.THUMBNAIL_ICON:return"sendbird-icon-color--thumbnail-icon";case KN.SENT:return"sendbird-icon-color--sent";case KN.READ:return"sendbird-icon-color--read";case KN.ON_BACKGROUND_1:return"sendbird-icon-color--on-background-1";case KN.ON_BACKGROUND_2:return"sendbird-icon-color--on-background-2";case KN.ON_BACKGROUND_3:return"sendbird-icon-color--on-background-3";case KN.ON_BACKGROUND_4:return"sendbird-icon-color--on-background-4";case KN.BACKGROUND_3:return"sendbird-icon-color--background-3";case KN.ERROR:return"sendbird-icon-color--error";default:return""}}function WN(e){switch(e){case zN.ADD:return"sendbird-icon-add";case zN.ARROW_LEFT:return"sendbird-icon-arrow-left";case zN.ATTACH:return"sendbird-icon-attach";case zN.AUDIO_ON_LINED:return"sendbird-icon-audio-on-lined";case zN.BAN:return"sendbird-icon-ban";case zN.BROADCAST:return"sendbird-icon-broadcast";case zN.CAMERA:return"sendbird-icon-camera";case zN.CHANNELS:return"sendbird-icon-channels";case zN.CHAT:return"sendbird-icon-chat";case zN.CHAT_FILLED:return"sendbird-icon-chat-filled";case zN.CHEVRON_DOWN:return"sendbird-icon-chevron-down";case zN.CHEVRON_RIGHT:return"sendbird-icon-chevron-right";case zN.CLOSE:return"sendbird-icon-close";case zN.COLLAPSE:return"sendbird-icon-collapse";case zN.COPY:return"sendbird-icon-copy";case zN.CREATE:return"sendbird-icon-create";case zN.DELETE:return"sendbird-icon-delete";case zN.DISCONNECTED:return"sendbird-icon-disconnected";case zN.DOCUMENT:return"sendbird-icon-document";case zN.DONE:return"sendbird-icon-done";case zN.DONE_ALL:return"sendbird-icon-done-all";case zN.DOWNLOAD:return"sendbird-icon-down-load";case zN.EDIT:return"sendbird-icon-edit";case zN.EMOJI_MORE:return"sendbird-icon-emoji-more";case zN.ERROR:return"sendbird-icon-error";case zN.EXPAND:return"sendbird-icon-expand";case zN.FILE_AUDIO:return"sendbird-icon-file-audio";case zN.FILE_DOCUMENT:return"sendbird-icon-file-document";case zN.FREEZE:return"sendbird-icon-freeze";case zN.GIF:return"sendbird-icon-gif";case zN.INFO:return"sendbird-icon-info";case zN.LEAVE:return"sendbird-icon-leave";case zN.MEMBERS:return"sendbird-icon-members";case zN.MESSAGE:return"sendbird-icon-message";case zN.MODERATIONS:return"sendbird-icon-moderations";case zN.MORE:return"sendbird-icon-more";case zN.MUTE:return"sendbird-icon-mute";case zN.NOTIFICATIONS:return"sendbird-icon-notifications";case zN.NOTIFICATIONS_OFF_FILLED:return"sendbird-icon-notifications-off-filled";case zN.OPERATOR:return"sendbird-icon-operator";case zN.PHOTO:return"sendbird-icon-photo";case zN.PLAY:return"sendbird-icon-play";case zN.PLUS:return"sendbird-iconn-plus";case zN.QUESTION:return"sendbird-icon-question";case zN.REFRESH:return"sendbird-icon-refresh";case zN.REMOVE:return"sendbird-icon-remove";case zN.REPLY:return"sendbird-icon-reply";case zN.SEARCH:return"sendbird-icon-search";case zN.SEND:return"sendbird-icon-send";case zN.SETTINGS_FILLED:return"sendbird-icon-settings-filled";case zN.SPINNER:return"sendbird-icon-spinner";case zN.SUPERGROUP:return"sendbird-icon-supergroup";case zN.THREAD:return"sendbird-icon-thread";case zN.THUMBNAIL_NONE:return"sendbird-icon-thumbnail-none";case zN.TOGGLE_OFF:return"sendbird-icon-toggle-off";case zN.TOGGLE_ON:return"sendbird-icon-toggle-on";case zN.USER:return"sendbird-icon-user";case zN.FEEDBACK_LIKE:return"sendbird-icon-feedback-like";case zN.FEEDBACK_DISLIKE:return"sendbird-icon-feedback-dislike";default:return"sendbird-icon-unknown"}}function QN(){return QN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},QN.apply(null,arguments)}const XN=e=>a.createElement("svg",QN({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),qN||(qN=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M50.667 5.333a8 8 0 0 1 8 8v37.334a8 8 0 0 1-8 8H13.333a8 8 0 0 1-8-8V13.333a8 8 0 0 1 8-8zm0 5.334H13.333a2.667 2.667 0 0 0-2.666 2.666v37.334a2.667 2.667 0 0 0 2.666 2.666h37.334a2.667 2.667 0 0 0 2.666-2.666V13.333a2.667 2.667 0 0 0-2.666-2.666m-18.667 8a2.667 2.667 0 0 1 2.649 2.355l.018.311v8h8a2.667 2.667 0 0 1 .311 5.316l-.311.018h-8v8a2.667 2.667 0 0 1-5.316.311l-.018-.311v-8h-8a2.667 2.667 0 0 1-.311-5.316l.311-.018h8v-8A2.667 2.667 0 0 1 32 18.667",className:"icon-add_svg__fill"})));var ZN;function JN(){return JN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},JN.apply(null,arguments)}const $N=e=>a.createElement("svg",JN({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),ZN||(ZN=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M33.886 8.781a2.67 2.67 0 0 1 .221 3.52l-.221.251-16.78 16.781H56a2.667 2.667 0 0 1 .311 5.316l-.311.018-38.895-.001 16.78 16.782a2.666 2.666 0 0 1 .222 3.52l-.221.251a2.67 2.67 0 0 1-3.52.222l-.252-.222L8.781 33.886a2.67 2.67 0 0 1-.222-3.52l.222-.252L30.114 8.781a2.67 2.67 0 0 1 3.772 0",className:"icon-arrow-left_svg__fill"})));var eS;function tS(){return tS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tS.apply(null,arguments)}const nS=e=>a.createElement("svg",tS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),eS||(eS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m55.334 28.926-24.506 23.34c-5.222 4.973-13.74 4.973-18.962 0-5.149-4.903-5.149-12.797 0-17.7l24.506-23.34c3.138-2.988 8.278-2.988 11.416 0 3.064 2.919 3.064 7.594 0 10.513L23.255 45.077c-1.055 1.005-2.815 1.005-3.87.001-.98-.933-.98-2.39 0-3.325l22.64-21.535a2.667 2.667 0 0 0-3.676-3.864L15.709 37.89a7.58 7.58 0 0 0-.001 11.05c3.113 2.966 8.11 2.966 11.224 0l24.533-23.338c5.272-5.021 5.272-13.217 0-18.238-5.197-4.95-13.573-4.95-18.77 0L8.187 30.704c-7.356 7.005-7.356 18.419 0 25.424 7.281 6.935 19.036 6.935 26.318 0l24.506-23.34a2.666 2.666 0 1 0-3.678-3.862z",className:"icon-attach_svg__fill"})));var rS,iS;function aS(){return aS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aS.apply(null,arguments)}const sS=e=>a.createElement("svg",aS({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 64 64"},e),rS||(rS=a.createElement("g",{clipPath:"url(#icon-audio-on-lined_svg__a)"},a.createElement("path",{d:"M32 0C26.11 0 21.333 4.776 21.333 10.667V32c0 5.891 4.776 10.667 10.667 10.667S42.667 37.89 42.667 32V10.667C42.667 4.776 37.89 0 32 0m-5.333 10.667a5.333 5.333 0 0 1 10.666 0V32a5.333 5.333 0 0 1-10.666 0z",className:"icon-audio-on-lined_svg__fill",clipRule:"evenodd"}),a.createElement("path",{d:"M16 26.667a2.667 2.667 0 1 0-5.333 0V32c0 10.879 8.143 19.856 18.666 21.168v5.499h-8a2.667 2.667 0 0 0 0 5.333h21.334a2.667 2.667 0 1 0 0-5.333h-8v-5.499C45.19 51.856 53.333 42.88 53.333 32v-5.333a2.667 2.667 0 1 0-5.333 0V32c0 8.837-7.163 16-16 16s-16-7.163-16-16z",className:"icon-audio-on-lined_svg__fill"}))),iS||(iS=a.createElement("defs",null,a.createElement("clipPath",{id:"icon-audio-on-lined_svg__a"},a.createElement("path",{fill:"#fff",d:"M0 0h64v64H0z"})))));var oS;function lS(){return lS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lS.apply(null,arguments)}const uS=e=>a.createElement("svg",lS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),oS||(oS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333 2.667 48.2 2.667 32 15.8 2.667 32 2.667M32 8C18.745 8 8 18.745 8 32s10.745 24 24 24 24-10.745 24-24S45.255 8 32 8m12.333 21.333a1 1 0 0 1 1 1v3.334a1 1 0 0 1-1 1H19.667a1 1 0 0 1-1-1v-3.334a1 1 0 0 1 1-1z",className:"icon-ban_svg__fill"})));var cS;function dS(){return dS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dS.apply(null,arguments)}const hS=e=>a.createElement("svg",dS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),cS||(cS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M58.545 5.498q.121.389.122.796v46.079a2.666 2.666 0 0 1-3.462 2.546l-17.951-5.61c-.645 5.273-5.14 9.358-10.587 9.358C20.776 58.667 16 53.89 16 48v-5.334h-5.333a8 8 0 0 1-7.997-7.75l-.003-.25V24a8 8 0 0 1 8-8H16L55.205 3.749a2.665 2.665 0 0 1 3.34 1.75zM21.333 44.587V48a5.333 5.333 0 0 0 10.652.398L32 47.92zm32-34.667-32 9.997v18.83l32 9.997zM16 21.333h-5.333a2.67 2.67 0 0 0-2.65 2.356L8 24v10.667a2.667 2.667 0 0 0 2.667 2.666H16z",className:"icon-broadcast_svg__fill"})));var fS;function pS(){return pS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pS.apply(null,arguments)}const _S=e=>a.createElement("svg",pS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),fS||(fS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M40 5.333c.892 0 1.724.446 2.219 1.188l4.541 6.812H56a8 8 0 0 1 7.986 7.53l.014.47v29.334a8 8 0 0 1-8 8H8a8 8 0 0 1-8-8V21.333a8 8 0 0 1 8-8h9.237l4.544-6.812a2.67 2.67 0 0 1 1.888-1.167l.331-.02zm-1.43 5.334H25.428l-4.542 6.812a2.66 2.66 0 0 1-1.887 1.167l-.331.02H8a2.67 2.67 0 0 0-2.667 2.667v29.334A2.667 2.667 0 0 0 8 53.333h48a2.667 2.667 0 0 0 2.667-2.666V21.333A2.667 2.667 0 0 0 56 18.667H45.333a2.67 2.67 0 0 1-2.218-1.188zM32 21.333c7.364 0 13.333 5.97 13.333 13.334S39.363 48 32 48s-13.333-5.97-13.333-13.333S24.637 21.333 32 21.333m0 5.334a8 8 0 1 0 0 16 8 8 0 0 0 0-16",className:"icon-camera_svg__fill"})));var mS;function vS(){return vS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vS.apply(null,arguments)}const gS=e=>a.createElement("svg",vS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),mS||(mS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m42.65 5.333.311.017a2.666 2.666 0 0 1 2.373 2.633l-.017.311-1.45 13.04h9.466a2.667 2.667 0 0 1 .311 5.315l-.31.018H43.271l-1.184 10.666h11.245a2.667 2.667 0 0 1 .312 5.316l-.31.018H41.495l-1.512 13.627a2.667 2.667 0 0 1-5.318-.277l.017-.311 1.448-13.04H25.496l-1.512 13.628a2.667 2.667 0 0 1-5.318-.277l.017-.311 1.448-13.04h-9.464a2.667 2.667 0 0 1-.311-5.315l.31-.018h10.057l1.186-10.667H10.667a2.667 2.667 0 0 1-.311-5.315l.31-.018h11.835l1.515-13.627a2.67 2.67 0 0 1 2.634-2.373l.311.017a2.666 2.666 0 0 1 2.373 2.633l-.017.311-1.45 13.04H38.5l1.515-13.628a2.67 2.67 0 0 1 2.634-2.373zm-5.927 32 1.186-10.667H27.272l-1.184 10.667z",className:"icon-channels_svg__fill"})));var ES;function bS(){return bS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bS.apply(null,arguments)}const yS=e=>a.createElement("svg",bS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),ES||(ES=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333c-4.455 0-8.679-.993-12.461-2.77l-1.753.58q-8.947 2.868-12.504 1.981-4.198-1.047-1.657-3.663 1.757-2.094 2.928-5.234.934-2.502-.737-7A29.15 29.15 0 0 1 2.666 32C2.667 15.8 15.8 2.667 32 2.667M32 8C18.745 8 8 18.745 8 32c0 3.5.747 6.88 2.168 9.978l.405.837.137.271.106.285c1.517 4.085 1.89 7.622.734 10.72l-.382.972-.192.433.235-.05a62 62 0 0 0 4.886-1.363l1.721-.568 2.04-.696 1.95.917A23.9 23.9 0 0 0 32 56c13.255 0 24-10.745 24-24S45.255 8 32 8",className:"icon-chat_svg__fill"})));var CS;function TS(){return TS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TS.apply(null,arguments)}const NS=e=>a.createElement("svg",TS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),CS||(CS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333c-4.455 0-8.679-.993-12.461-2.77l-1.753.58q-8.947 2.868-12.504 1.981-4.198-1.047-1.657-3.663 1.757-2.094 2.928-5.234.934-2.502-.737-7A29.15 29.15 0 0 1 2.666 32C2.667 15.8 15.8 2.667 32 2.667",className:"icon-chat-filled_svg__fill"})));var SS;function IS(){return IS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},IS.apply(null,arguments)}const wS=e=>a.createElement("svg",IS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),SS||(SS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M16.121 21.879a3 3 0 0 0-4.242 0 3 3 0 0 0 0 4.242l18 18a3 3 0 0 0 4.242 0l18-18a3 3 0 0 0 0-4.242 3 3 0 0 0-4.242 0L32 37.757z",className:"icon-chevron-down_svg__fill"})));var AS;function MS(){return MS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},MS.apply(null,arguments)}const OS=e=>a.createElement("svg",MS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),AS||(AS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M22.114 46.114a2.668 2.668 0 0 0 3.772 3.772l16-16a2.67 2.67 0 0 0 0-3.772l-16-16a2.668 2.668 0 0 0-3.772 3.772L36.23 32z",className:"icon-chevron-right_svg__fill"})));var RS;function DS(){return DS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DS.apply(null,arguments)}const kS=e=>a.createElement("svg",DS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),RS||(RS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M52.552 11.448a2.666 2.666 0 0 1 .222 3.52l-.222.251-16.781 16.78 16.781 16.782a2.665 2.665 0 0 1 0 3.771 2.666 2.666 0 0 1-3.52.222l-.251-.222L32 35.771 15.219 52.552a2.665 2.665 0 0 1-3.771 0 2.666 2.666 0 0 1-.222-3.52l.222-.251L28.228 32l-16.78-16.781a2.665 2.665 0 0 1 0-3.771 2.666 2.666 0 0 1 3.52-.222l.251.222 16.78 16.78 16.782-16.78a2.665 2.665 0 0 1 3.771 0",className:"icon-close_svg__fill"})));var LS;function xS(){return xS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xS.apply(null,arguments)}const US=e=>a.createElement("svg",xS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),LS||(LS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M16 8a2.667 2.667 0 0 0-2.649 2.356l-.018.31v42.667a2.667 2.667 0 0 0 5.316.311l.018-.31V34.666h25.56l-6.113 6.114a2.67 2.67 0 0 0-.221 3.52l.221.251a2.666 2.666 0 0 0 3.52.222l.252-.222 10.666-10.666a2.666 2.666 0 0 0 .222-3.52l-.222-.252-10.666-10.666a2.666 2.666 0 0 0-3.993 3.52l.221.251 6.113 6.114h-25.56V10.667A2.667 2.667 0 0 0 16 8",className:"icon-collapse_svg__fill"})));var PS;function FS(){return FS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},FS.apply(null,arguments)}const BS=e=>a.createElement("svg",FS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),PS||(PS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M53.333 21.333a8 8 0 0 1 8 8v24a8 8 0 0 1-8 8h-24a8 8 0 0 1-8-8v-24a8 8 0 0 1 8-8zm0 5.334h-24a2.667 2.667 0 0 0-2.666 2.666v24A2.667 2.667 0 0 0 29.333 56h24A2.667 2.667 0 0 0 56 53.333v-24a2.667 2.667 0 0 0-2.667-2.666m-18.666-24a8 8 0 0 1 7.986 7.53l.014.47v2.666a2.667 2.667 0 0 1-5.316.311l-.018-.31v-2.667a2.67 2.67 0 0 0-2.355-2.65L34.667 8h-24a2.67 2.67 0 0 0-2.65 2.356l-.017.31v24a2.67 2.67 0 0 0 2.356 2.65l.31.017h2.667a2.667 2.667 0 0 1 .311 5.316l-.31.018h-2.667a8 8 0 0 1-7.987-7.53l-.013-.47v-24c0-4.26 3.33-7.743 7.53-7.987l.47-.013z",className:"icon-copy_svg__fill"})));var HS;function GS(){return GS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},GS.apply(null,arguments)}const jS=e=>a.createElement("svg",GS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),HS||(HS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333c-4.455 0-8.679-.993-12.461-2.77l-1.753.58q-8.947 2.868-12.504 1.981-4.198-1.047-1.657-3.663 1.757-2.094 2.928-5.234.934-2.502-.737-7A29.15 29.15 0 0 1 2.666 32C2.667 15.8 15.8 2.667 32 2.667M32 8C18.745 8 8 18.745 8 32c0 3.5.747 6.88 2.168 9.978l.405.837.137.271.106.285c1.517 4.085 1.89 7.622.734 10.72l-.382.972-.192.433.235-.05a62 62 0 0 0 4.886-1.363l1.721-.568 2.04-.696 1.95.917A23.9 23.9 0 0 0 32 56c13.255 0 24-10.745 24-24S45.255 8 32 8m2.667 16v5.333H40c3.556 0 3.556 5.334 0 5.334h-5.333V40c0 3.556-5.334 3.556-5.334 0v-5.333H24c-3.556 0-3.556-5.334 0-5.334h5.333V24c0-3.556 5.334-3.556 5.334 0",className:"icon-create_svg__fill"})));var VS;function qS(){return qS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qS.apply(null,arguments)}const zS=e=>a.createElement("svg",qS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),VS||(VS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M37.333 2.667c4.26 0 7.743 3.33 7.987 7.53l.013.47v2.666H56a2.667 2.667 0 0 1 .311 5.316l-.311.018h-2.668l.001 34.666c0 4.26-3.33 7.743-7.53 7.987l-.47.013H18.667a8 8 0 0 1-7.987-7.53l-.013-.47V18.667H8a2.667 2.667 0 0 1-.311-5.316L8 13.333h10.666v-2.666a8 8 0 0 1 7.53-7.987l.47-.013zm10.666 16H16v34.666a2.67 2.67 0 0 0 2.356 2.65l.31.017h26.667a2.67 2.67 0 0 0 2.65-2.356l.017-.31zm-21.332 8a2.667 2.667 0 0 1 2.648 2.355l.018.311v16a2.667 2.667 0 0 1-5.316.311l-.017-.31v-16a2.667 2.667 0 0 1 2.667-2.667m10.666 0a2.67 2.67 0 0 1 2.65 2.355l.017.311v16a2.667 2.667 0 0 1-5.315.311l-.018-.31v-16a2.667 2.667 0 0 1 2.666-2.667m0-18.667H26.667a2.67 2.67 0 0 0-2.65 2.356l-.017.31v2.667h16v-2.666a2.67 2.67 0 0 0-2.356-2.65L37.334 8z",className:"icon-delete_svg__fill"})));var KS;function YS(){return YS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},YS.apply(null,arguments)}const WS=e=>a.createElement("svg",YS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),KS||(KS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m54.534 6.069-.248.217-9.736 9.735-.04.04-9.573 9.573q-.226.178-.405.404L6.286 54.286a2.423 2.423 0 0 0 3.18 3.645l.248-.217 13.374-13.373a2.42 2.42 0 0 0 1.88-.401 12.12 12.12 0 0 1 14.04 0 2.424 2.424 0 1 0 2.808-3.952 16.95 16.95 0 0 0-11.303-3.072l6.743-6.744a24.1 24.1 0 0 1 10.159 5.021 2.424 2.424 0 0 0 3.11-3.719 29 29 0 0 0-9.34-5.23l5.633-5.634a36.2 36.2 0 0 1 9.225 5.934 2.425 2.425 0 0 0 3.211-3.633 41 41 0 0 0-8.796-5.941l7.256-7.256a2.423 2.423 0 0 0-3.18-3.645m-35.04 21.474a29 29 0 0 0-6.032 3.942 2.424 2.424 0 0 0 3.137 3.697 24 24 0 0 1 5.022-3.282 2.425 2.425 0 0 0-2.127-4.357M4.748 22.909a2.424 2.424 0 0 0 3.207 3.636 36.36 36.36 0 0 1 26.978-8.977 2.424 2.424 0 0 0 .389-4.832A41.2 41.2 0 0 0 4.748 22.909",className:"icon-disconnected_svg__fill"})));var QS;function XS(){return XS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},XS.apply(null,arguments)}const ZS=e=>a.createElement("svg",XS({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),QS||(QS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M37.333 2.667a3 3 0 0 1 .274.014l.085.01.058.008q.07.01.141.026l.029.007q.075.016.146.037l.034.01q.357.107.663.303l.034.022q.053.034.104.072l.057.043q.045.033.085.068.091.075.176.16l-.126-.117q.075.065.143.135L55.21 19.438q.07.07.134.143l.035.04q.04.047.076.096l.04.054.07.1.024.038c.16.253.279.535.347.836l.01.048q.014.064.024.13l.006.048.007.051.004.041q.014.135.014.27v32a8 8 0 0 1-8 8H16a8 8 0 0 1-8-8V10.667a8 8 0 0 1 8-8zM34.666 8H16a2.667 2.667 0 0 0-2.667 2.667v42.666A2.667 2.667 0 0 0 16 56h32a2.667 2.667 0 0 0 2.667-2.667L50.666 24H37.333a2.667 2.667 0 0 1-2.648-2.356l-.018-.31zm12.227 10.667-6.894-6.894.001 6.894z",className:"icon-document_svg__fill"})));var JS;function $S(){return $S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$S.apply(null,arguments)}const eI=e=>a.createElement("svg",$S({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),JS||(JS=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M12.552 31.448a2.665 2.665 0 1 0-3.771 3.771l13.333 13.333a2.666 2.666 0 0 0 3.772 0L55.219 19.22a2.667 2.667 0 0 0-3.771-3.771L24 42.895z",className:"icon-done_svg__fill"})));var tI;function nI(){return nI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nI.apply(null,arguments)}const rI=e=>a.createElement("svg",nI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),tI||(tI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M5.886 31.448 19.219 44.78a2.667 2.667 0 0 1-3.771 3.771L2.114 35.22a2.667 2.667 0 0 1 3.772-3.771zm52.228-16a2.666 2.666 0 1 1 3.772 3.771L32.552 48.552a2.665 2.665 0 0 1-3.771 0L15.448 35.22a2.665 2.665 0 0 1 0-3.771 2.665 2.665 0 0 1 3.771 0l11.448 11.447zm-9.562 0a2.665 2.665 0 0 1 0 3.771L32.556 35.215a2.665 2.665 0 0 1-3.771 0 2.664 2.664 0 0 1 0-3.77L44.78 15.447a2.665 2.665 0 0 1 3.771 0z",className:"icon-done-all_svg__fill"})));var iI;function aI(){return aI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aI.apply(null,arguments)}const sI=e=>a.createElement("svg",aI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),iI||(iI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M56 42.667a2.667 2.667 0 0 1 2.649 2.355l.018.311v8c0 4.26-3.33 7.743-7.53 7.987l-.47.013H13.333a8 8 0 0 1-7.986-7.53l-.014-.47v-8a2.667 2.667 0 0 1 5.316-.311l.018.311v8a2.67 2.67 0 0 0 2.355 2.65l.311.017h37.334a2.667 2.667 0 0 0 2.648-2.356l.018-.31v-8A2.667 2.667 0 0 1 56 42.667m-36.552-8.781a2.666 2.666 0 0 1 3.52-3.993l.251.221 6.114 6.114V5.333a2.667 2.667 0 0 1 5.316-.311l.018.311v30.894l6.114-6.113a2.67 2.67 0 0 1 3.52-.221l.251.221a2.666 2.666 0 0 1 .222 3.52l-.222.252-10.658 10.657a2 2 0 0 1-.135.128l.127-.119a3 3 0 0 1-.195.176l-.056.045-.086.064-.056.04-.086.056-.06.036-.081.046-.079.04a3 3 0 0 1-.14.065l-.09.036q-.034.014-.067.025l-.09.03-.063.019q-.064.018-.13.034l-.013.003-.144.028-.064.01q-.045.008-.092.012l-.084.008-.103.006-.069.002h-.095q-.042 0-.082-.003l.139.003q-.126 0-.249-.011l-.061-.007-.092-.012-.09-.015-.118-.025-.04-.01a3 3 0 0 1-.34-.11l-.015-.006q-.074-.03-.145-.063l-.042-.02L30.71 45l-.067-.039q-.045-.026-.087-.054l-.062-.041q-.045-.03-.088-.063l-.04-.03-.008-.007a3 3 0 0 1-.251-.223z",className:"icon-download_svg__fill"})));var oI;function lI(){return lI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lI.apply(null,arguments)}const uI=e=>a.createElement("svg",lI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 65 65"},e),oI||(oI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M56 56a2.667 2.667 0 0 1 .311 5.315l-.311.018H8a2.667 2.667 0 0 1-.311-5.316L8 56zM35.448 3.448a2.665 2.665 0 0 1 3.771 0l10.667 10.666a2.67 2.67 0 0 1 0 3.772L20.552 47.219c-.5.5-1.178.781-1.885.781H8a2.667 2.667 0 0 1-2.667-2.667V34.667c0-.708.281-1.386.781-1.886zm1.885 5.659L10.667 35.77v6.896h6.89L44.227 16z",className:"icon-edit_svg__fill"})));var cI;function dI(){return dI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dI.apply(null,arguments)}const hI=e=>a.createElement("svg",dI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),cI||(cI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32.097 3.22c2.65 0 5.255.357 7.763 1.054a2.134 2.134 0 0 1-1.144 4.111 24.7 24.7 0 0 0-6.619-.899c-13.603 0-24.63 11.027-24.63 24.63s11.027 24.63 24.63 24.63 24.63-11.027 24.63-24.63c0-2.227-.295-4.413-.87-6.518a2.13 2.13 0 0 1 1.494-2.62 2.13 2.13 0 0 1 2.62 1.494 29 29 0 0 1 1.023 7.644c0 15.96-12.938 28.897-28.897 28.897-15.96 0-28.897-12.937-28.897-28.897S16.138 3.22 32.097 3.22m10.705 34.792a2.133 2.133 0 0 1 2.024 2.808c-1.873 5.623-6.937 9.488-12.729 9.488s-10.856-3.865-12.73-9.488a2.134 2.134 0 0 1 1.875-2.803l.15-.005zm-3.477 4.266H24.867l.294.382c1.539 1.887 3.718 3.113 6.115 3.342l.314.024.507.015c2.617 0 5.037-1.188 6.743-3.151l.193-.23zM21.392 21.954c1.087 0 1.985.814 2.116 1.866l.017.267v5.353a2.133 2.133 0 0 1-4.25.268l-.017-.268v-5.353c0-1.178.955-2.133 2.134-2.133m21.41 0c1.088 0 1.985.814 2.117 1.866l.017.267v5.353a2.133 2.133 0 0 1-4.25.268l-.017-.268v-5.353c0-1.178.955-2.133 2.133-2.133M54.853 0a.8.8 0 0 1 .8.8v7.786h7.76a.8.8 0 0 1 .8.8v2.667a.8.8 0 0 1-.8.8h-7.76v7.758a.8.8 0 0 1-.8.8h-2.666a.8.8 0 0 1-.8-.8v-7.758h-7.785a.8.8 0 0 1-.8-.8V9.387a.8.8 0 0 1 .8-.8l7.784-.001V.8a.8.8 0 0 1 .8-.8z",className:"icon-emoji-more_svg__fill"})));var fI;function pI(){return pI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pI.apply(null,arguments)}const _I=e=>a.createElement("svg",pI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),fI||(fI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 5.06a8 8 0 0 1 6.561 3.424l.287.439 22.608 37.744a8 8 0 0 1 .022 7.962 8 8 0 0 1-6.356 4.014l-.535.024H9.384a8 8 0 0 1-6.862-4.038 8.01 8.01 0 0 1-.226-7.493l.27-.506L25.16 8.91A8 8 0 0 1 32 5.06m0 5.333c-.816 0-1.58.372-2.076.99l-.196.28-22.565 37.67a2.67 2.67 0 0 0 1.909 3.973l.341.027h45.144a2.67 2.67 0 0 0 2.45-3.659l-.148-.304L34.28 11.676A2.67 2.67 0 0 0 32 10.393m0 32.274A2.667 2.667 0 1 1 32 48a2.667 2.667 0 0 1 0-5.333m0-21.334a2.667 2.667 0 0 1 2.649 2.356l.018.311v10.667a2.667 2.667 0 0 1-5.316.311l-.018-.311V24A2.667 2.667 0 0 1 32 21.333",className:"icon-error_svg__fill"})));var mI;function vI(){return vI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vI.apply(null,arguments)}const gI=e=>a.createElement("svg",vI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),mI||(mI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M48 8a2.667 2.667 0 0 1 2.649 2.356l.018.31V32l-.001.027v21.306a2.667 2.667 0 0 1-5.315.311l-.018-.31V34.665H19.772l6.114 6.115a2.67 2.67 0 0 1 .221 3.52l-.221.251a2.666 2.666 0 0 1-3.52.222l-.252-.222-10.666-10.666a2.666 2.666 0 0 1-.222-3.52l.222-.252 10.666-10.666a2.666 2.666 0 0 1 3.993 3.52l-.221.251-6.113 6.114h25.56V10.667A2.667 2.667 0 0 1 48 8",className:"icon-expand_svg__fill"})));var EI;function bI(){return bI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bI.apply(null,arguments)}const yI=e=>a.createElement("svg",bI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),EI||(EI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M30.52 12.51c1.685-1.226 4.139-.103 4.139 1.893v35.194c0 1.996-2.454 3.119-4.138 1.893l-12.45-9.909H7.898c-1.416 0-2.564-1.074-2.564-2.399V24.818c0-1.325 1.148-2.4 2.564-2.4h10.175zm20.427.163c10.293 10.667 10.293 27.987 0 38.654a2.137 2.137 0 0 1-3.156-.047c-.86-.942-.84-2.448.044-3.364 8.49-8.799 8.49-23.033 0-31.832-.884-.916-.904-2.422-.044-3.364a2.137 2.137 0 0 1 3.156-.047m-8.492 8.799c5.597 5.8 5.597 15.231 0 21.031a2.136 2.136 0 0 1-3.156-.046c-.86-.942-.84-2.448.044-3.364 3.794-3.932 3.794-10.279 0-14.211-.884-.916-.904-2.422-.044-3.363a2.136 2.136 0 0 1 3.156-.047",className:"icon-file-audio_svg__fill"})));var CI;function TI(){return TI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TI.apply(null,arguments)}const NI=e=>a.createElement("svg",TI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),CI||(CI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M39.414 6.4a2.4 2.4 0 0 1 1.71.701l12.642 12.75c.407.41.634.953.634 1.516v29.765c0 3.542-4.342 6.468-8 6.468H16.16c-3.658 0-6.4-2.926-6.4-6.468L9.6 12.868c0-3.542 2.902-6.468 6.56-6.468zm3.331 35.173-21.49.027-.147.005c-1.066.08-1.908 1.014-1.908 2.155 0 1.193.92 2.16 2.055 2.16l21.49-.027.147-.005c1.066-.08 1.908-1.014 1.908-2.155 0-1.193-.92-2.16-2.055-2.16m0-8.533-21.49.027-.147.005c-1.066.08-1.908 1.014-1.908 2.155 0 1.193.92 2.16 2.055 2.16l21.49-.027.147-.005c1.066-.08 1.908-1.014 1.908-2.155 0-1.193-.92-2.16-2.055-2.16m-11.807-8.507h-9.6l-.153.006a2.15 2.15 0 0 0-1.985 2.154c0 1.193.957 2.16 2.138 2.16h9.6l.152-.005a2.15 2.15 0 0 0 1.985-2.155c0-1.193-.957-2.16-2.137-2.16",className:"icon-file-document_svg__fill"})));var SI;function II(){return II=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},II.apply(null,arguments)}const wI=e=>a.createElement("svg",II({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),SI||(SI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m41.636 3.226.251.222a2.67 2.67 0 0 1 .222 3.52l-.222.251-7.219 7.218V27.38l11.209-6.472 2.643-9.86a2.667 2.667 0 0 1 5.218 1.051l-.067.329-2.237 8.35 8.352 2.24a2.67 2.67 0 0 1 1.952 2.938l-.067.328a2.67 2.67 0 0 1-2.937 1.952l-.329-.066-9.861-2.643L37.334 32l11.209 6.47 9.862-2.64.329-.067a2.67 2.67 0 0 1 2.937 1.952l.067.328a2.67 2.67 0 0 1-1.952 2.938l-8.353 2.237 2.238 8.353.067.329a2.666 2.666 0 0 1-5.218 1.052l-2.643-9.861-11.209-6.472v12.944l7.219 7.218a2.667 2.667 0 0 1-3.52 3.993l-.251-.222L32 54.437l-6.114 6.115a2.666 2.666 0 0 1-3.52.222l-.251-.222a2.666 2.666 0 0 1-.222-3.52l.222-.251 7.218-7.22V36.62l-11.209 6.47-2.642 9.863a2.666 2.666 0 0 1-5.218-1.052l.067-.329 2.236-8.351-8.35-2.24a2.665 2.665 0 0 1-1.953-2.937l.067-.328a2.665 2.665 0 0 1 2.937-1.952l.329.066 9.861 2.642L26.667 32l-11.209-6.472-9.86 2.643-.329.066a2.665 2.665 0 0 1-2.937-1.952l-.067-.328a2.67 2.67 0 0 1 1.952-2.938l8.35-2.239-2.235-8.351-.067-.329a2.667 2.667 0 0 1 5.218-1.052l2.642 9.862 11.209 6.47V14.439L22.116 7.22a2.665 2.665 0 0 1 0-3.771 2.666 2.666 0 0 1 3.52-.222l.251.222 6.114 6.112 6.115-6.112a2.666 2.666 0 0 1 3.52-.222z",className:"icon-freeze_svg__fill"})));var AI;function MI(){return MI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},MI.apply(null,arguments)}const OI=e=>a.createElement("svg",MI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),AI||(AI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M16.664 45.333q3.233 0 5.89-.953 2.658-.954 4.113-2.683V31.34h-10.29v3.94h4.902v4.474q-1.292 1.284-4.327 1.283-3.017 0-4.58-2.085-1.561-2.085-1.562-6.168v-1.657q.018-4.047 1.455-6.097t4.184-2.05q2.155 0 3.385 1.034t1.59 3.262h5.243q-.486-4.206-3.107-6.408t-7.273-2.201q-3.34 0-5.827 1.506t-3.807 4.35q-1.32 2.843-1.32 6.728v1.765q.036 3.78 1.428 6.578 1.392 2.797 3.95 4.269 2.56 1.47 5.953 1.47m20.67 0V18.667H32v26.666h5.333zm10.396 0V34.436h9.721v-4.432H47.73v-6.887h10.937v-4.45h-16v26.666z",className:"icon-gif_svg__fill"})));var RI;function DI(){return DI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DI.apply(null,arguments)}const kI=e=>a.createElement("svg",DI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),RI||(RI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333 2.667 48.2 2.667 32 15.8 2.667 32 2.667M32 8C18.745 8 8 18.745 8 32s10.745 24 24 24 24-10.745 24-24S45.255 8 32 8m1.667 21.333a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3.334a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1zm-1.667-8a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334",className:"icon-info_svg__fill"})));var LI;function xI(){return xI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xI.apply(null,arguments)}const UI=e=>a.createElement("svg",xI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),LI||(LI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 5.333a2.667 2.667 0 0 1 .311 5.316l-.311.018H10.667a2.67 2.67 0 0 0-2.65 2.355L8 13.333v37.334a2.667 2.667 0 0 0 2.356 2.648l.31.018H32a2.667 2.667 0 0 1 .311 5.316l-.311.018H10.667a8 8 0 0 1-7.987-7.53l-.013-.47V13.333a8 8 0 0 1 7.53-7.986l.47-.014zm17.634 13.893.252.222 10.666 10.666a2.666 2.666 0 0 1 .222 3.52l-.222.252-10.666 10.666a2.666 2.666 0 0 1-3.993-3.52l.221-.251 4.78-4.782L20 36a2.667 2.667 0 0 1-.311-5.315l.311-.018h33.56l-7.446-7.448a2.67 2.67 0 0 1-.221-3.52l.221-.251a2.666 2.666 0 0 1 3.52-.222",className:"icon-leave_svg__fill"})));var PI;function FI(){return FI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},FI.apply(null,arguments)}const BI=e=>a.createElement("svg",FI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),PI||(PI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M34.667 37.333c7.17 0 13.018 5.66 13.32 12.755l.013.579V56a2.667 2.667 0 0 1-5.315.311L42.667 56v-5.333c0-4.26-3.33-7.743-7.53-7.987l-.47-.013H13.333a8 8 0 0 0-7.986 7.53l-.014.47V56a2.667 2.667 0 0 1-5.316.311L0 56v-5.333c0-7.17 5.66-13.019 12.755-13.321l.578-.013zM54 37.765a13.33 13.33 0 0 1 9.986 12.297l.014.605V56a2.667 2.667 0 0 1-5.315.311L58.667 56v-5.331a8 8 0 0 0-6-7.74A2.667 2.667 0 1 1 54 37.765M24 5.333c7.364 0 13.333 5.97 13.333 13.334S31.363 32 24 32s-13.333-5.97-13.333-13.333S16.637 5.333 24 5.333m19.328.43a13.333 13.333 0 0 1 0 25.834 2.667 2.667 0 1 1-1.323-5.167 8 8 0 0 0 0-15.5 2.667 2.667 0 1 1 1.323-5.167M24 10.667a8 8 0 1 0 0 16 8 8 0 0 0 0-16",className:"icon-members_svg__fill"})));var HI;function GI(){return GI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},GI.apply(null,arguments)}const jI=e=>a.createElement("svg",GI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),HI||(HI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333c-4.455 0-8.679-.993-12.461-2.77l-1.753.58q-8.947 2.868-12.504 1.981-4.198-1.047-1.657-3.663 1.757-2.094 2.928-5.234.934-2.502-.737-7A29.15 29.15 0 0 1 2.666 32C2.667 15.8 15.8 2.667 32 2.667M32 8C18.745 8 8 18.745 8 32c0 3.5.747 6.88 2.168 9.978l.405.837.137.271.106.285c1.517 4.085 1.89 7.622.734 10.72l-.382.972-.192.433.235-.05a62 62 0 0 0 4.886-1.363l1.721-.568 2.04-.696 1.95.917A23.9 23.9 0 0 0 32 56c13.255 0 24-10.745 24-24S45.255 8 32 8M18.667 29.333a2.667 2.667 0 1 1-.001 5.333 2.667 2.667 0 0 1 .001-5.333m13.333 0a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334m13.333 0a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334",className:"icon-message_svg__fill"})));var VI;function qI(){return qI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qI.apply(null,arguments)}const zI=e=>a.createElement("svg",qI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),VI||(VI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M18.667 34.667a2.667 2.667 0 0 1 .311 5.316l-.311.017h-5.334v16a2.667 2.667 0 0 1-5.316.311L8 56V40H2.667a2.667 2.667 0 0 1-.311-5.315l.31-.018h16zM32 29.333a2.667 2.667 0 0 1 2.649 2.356l.018.311v24a2.667 2.667 0 0 1-5.316.311L29.333 56V32A2.667 2.667 0 0 1 32 29.333M61.333 40a2.667 2.667 0 0 1 .311 5.315l-.31.018h-5.335L56 56a2.667 2.667 0 0 1-5.315.311L50.667 56l-.001-10.668-5.333.001a2.667 2.667 0 0 1-.311-5.316l.311-.017zm-8-34.667a2.67 2.67 0 0 1 2.65 2.356L56 8v24a2.667 2.667 0 0 1-5.315.311L50.667 32V8a2.667 2.667 0 0 1 2.666-2.667m-42.666 0a2.667 2.667 0 0 1 2.648 2.356l.018.311v18.667a2.667 2.667 0 0 1-5.316.311L8 26.667V8a2.667 2.667 0 0 1 2.667-2.667m21.333 0a2.667 2.667 0 0 1 2.649 2.356l.018.311-.001 10.666H40a2.668 2.668 0 0 1 .311 5.317L40 24H24a2.667 2.667 0 0 1-.311-5.315l.311-.018h5.333V8A2.667 2.667 0 0 1 32 5.333",className:"icon-moderations_svg__fill"})));var KI;function YI(){return YI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},YI.apply(null,arguments)}const WI=e=>a.createElement("svg",YI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),KI||(KI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 45.333a5.333 5.333 0 1 1 0 10.666 5.333 5.333 0 0 1 0-10.666M32 28a5.333 5.333 0 1 1 0 10.668A5.333 5.333 0 0 1 32 28m0-17.333c2.946 0 5.333 2.387 5.333 5.333S34.946 21.333 32 21.333 26.667 18.946 26.667 16s2.387-5.333 5.333-5.333",className:"icon-more_svg__fill"})));var QI;function XI(){return XI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},XI.apply(null,arguments)}const ZI=e=>a.createElement("svg",XI({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),QI||(QI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m55.62 19.616.067.123A26.55 26.55 0 0 1 58.667 32c0 4.326-1.03 8.41-2.864 12.025q-1.518 4.089-.67 6.363 1.066 2.855 2.662 4.758 2.31 2.379-1.506 3.33-3.135.782-10.879-1.646l-.488-.155-1.594-.527A26.6 26.6 0 0 1 32 58.667a26.55 26.55 0 0 1-12.326-3.014l-.059-.03 4-4A21.2 21.2 0 0 0 32 53.333c2.993 0 5.89-.614 8.562-1.786l.498-.226 1.925-.905 3.613 1.196.695.219q1.093.337 2.054.595l.472.125.485.121-.167-.42-.2-.594c-.814-2.685-.484-5.681.713-9.065l.154-.425.106-.284.528-1.084a21.2 21.2 0 0 0 1.895-8.8 21.2 21.2 0 0 0-1.71-8.385zm2.266-13.502a2.67 2.67 0 0 1 .221 3.52l-.221.252-48 48a2.668 2.668 0 0 1-3.993-3.52l.221-.252 5.238-5.237a26.56 26.56 0 0 1-6.015-16.412L5.333 32C5.333 17.272 17.273 5.333 32 5.333a26.55 26.55 0 0 1 16.877 6.02l5.237-5.239a2.67 2.67 0 0 1 3.772 0M32 10.667c-11.782 0-21.333 9.55-21.333 21.333 0 4.836 1.614 9.401 4.48 13.084l29.936-29.938A21.25 21.25 0 0 0 32 10.666z",className:"icon-mute_svg__fill"})));var JI;function $I(){return $I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$I.apply(null,arguments)}const ew=e=>a.createElement("svg",$I({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),JI||(JI=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M36.613 53.333c2.056 0 3.338 2.227 2.307 4.005a8 8 0 0 1-13.84 0c-.98-1.689.129-3.783 2.004-3.988l.303-.017zM32 2.667c11.56 0 20.972 9.194 21.323 20.669l.01.664v13.333a5.334 5.334 0 0 0 4.936 5.319l.753.033c2.963.318 3.077 4.616.342 5.24l-.342.056-.355.019H5.333l-.355-.019c-3.082-.33-3.082-4.965 0-5.296l.753-.033a5.335 5.335 0 0 0 4.92-4.9l.016-.419V24c0-11.782 9.55-21.333 21.333-21.333M32 8c-8.636 0-15.674 6.842-15.989 15.4L16 24v13.333c0 1.562-.336 3.046-.939 4.383l-.275.564-.218.387h34.861l-.215-.387a10.6 10.6 0 0 1-1.146-3.74l-.055-.674-.013-.533V24c0-8.837-7.163-16-16-16",className:"icon-notifications_svg__fill"})));var tw;function nw(){return nw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nw.apply(null,arguments)}const rw=e=>a.createElement("svg",nw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),tw||(tw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M36.613 53.333c2.056 0 3.338 2.227 2.307 4.005a8 8 0 0 1-13.84 0c-.98-1.689.129-3.783 2.004-3.988l.303-.017zM32 2.667c7.173 0 13.52 3.54 17.387 8.97l5.686-5.687a2.105 2.105 0 0 1 2.85-.117l.127.117a2.105 2.105 0 0 1 0 2.977L8.927 58.05c-.78.781-2.023.82-2.85.117l-.127-.117a2.105 2.105 0 0 1 0-2.977L13.023 48h-7.69l-.355-.019c-3.082-.33-3.082-4.965 0-5.296l.753-.033a5.335 5.335 0 0 0 4.92-4.9l.016-.419V24c0-11.782 9.55-21.333 21.333-21.333m20.85 16.795c.271 1.253.433 2.548.473 3.874l.01.664v13.333a5.334 5.334 0 0 0 4.936 5.319l.753.033c2.963.318 3.077 4.616.342 5.24l-.342.056-.355.019H24.31z",className:"icon-notifications-off-filled_svg__fill"})));var iw;function aw(){return aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aw.apply(null,arguments)}const sw=e=>a.createElement("svg",aw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),iw||(iw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M29.83 6.45a2.667 2.667 0 0 1 4.34 0l11.697 16.374L57 13.918c1.88-1.504 4.573.054 4.32 2.35l-.047.29-8 37.334A2.666 2.666 0 0 1 50.666 56H13.333a2.666 2.666 0 0 1-2.607-2.108l-8-37.333c-.525-2.452 2.315-4.207 4.273-2.641l11.132 8.906zM32 12.587l-11.163 15.63a2.667 2.667 0 0 1-3.836.532l-7.497-5.997 5.984 27.915h33.021l5.984-27.915L47 28.749a2.667 2.667 0 0 1-3.632-.281l-.204-.251zM32 32a5.333 5.333 0 1 1 0 10.668A5.333 5.333 0 0 1 32 32",className:"icon-operator_svg__fill"})));var ow;function lw(){return lw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lw.apply(null,arguments)}const uw=e=>a.createElement("svg",lw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),ow||(ow=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M50.667 5.333a8 8 0 0 1 8 8v37.334a8 8 0 0 1-8 8H13.333a8 8 0 0 1-8-8V13.333a8 8 0 0 1 8-8zm-8 25.107L19.77 53.332l30.896.001a2.667 2.667 0 0 0 2.661-2.498l.005-.168v-9.564L42.666 30.44zm8-19.773H13.333a2.667 2.667 0 0 0-2.666 2.666v37.334c0 1.143.72 2.119 1.731 2.498L40.781 24.78a2.67 2.67 0 0 1 3.52-.222l.251.222 8.78 8.78.001-20.228a2.667 2.667 0 0 0-2.498-2.661zm-28 5.333a6.666 6.666 0 1 1 0 13.333 6.666 6.666 0 0 1 0-13.333m0 5.333a1.334 1.334 0 1 0 0 2.667 1.334 1.334 0 0 0 0-2.667",className:"icon-photo_svg__fill"})));var cw;function dw(){return dw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dw.apply(null,arguments)}const hw=e=>a.createElement("svg",dw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),cw||(cw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M51.908 34.75c1.9-1.233 1.896-3.26.013-4.514L19.376 8.577c-1.893-1.26-3.404-.391-3.376 1.968l.522 42.888c.028 2.347 1.596 3.247 3.493 2.016z",className:"icon-play_svg__fill"})));var fw;function pw(){return pw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pw.apply(null,arguments)}const _w=e=>a.createElement("svg",pw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),fw||(fw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M34.667 29.333h18.666c3.556 0 3.556 5.334 0 5.334H34.667v18.666c0 3.556-5.334 3.556-5.334 0V34.667H10.667c-3.556 0-3.556-5.334 0-5.334h18.666V10.667c0-3.556 5.334-3.556 5.334 0z",className:"icon-plus_svg__fill"})));var mw;function vw(){return vw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vw.apply(null,arguments)}const gw=e=>a.createElement("svg",vw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),mw||(mw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 61.333C15.8 61.333 2.667 48.2 2.667 32S15.8 2.667 32 2.667 61.333 15.8 61.333 32 48.2 61.333 32 61.333M32 56c13.255 0 24-10.745 24-24S45.255 8 32 8 8 18.745 8 32s10.745 24 24 24m2.213-18.63a2.667 2.667 0 1 1-5.333 0v-2.69c0-1.148.734-2.168 1.823-2.53.173-.058.532-.195 1.01-.407.809-.36 1.616-.79 2.354-1.282 1.835-1.223 2.813-2.528 2.813-3.786a5.333 5.333 0 0 0-10.364-1.777 2.667 2.667 0 0 1-5.032-1.77 10.668 10.668 0 0 1 20.729 3.551c0 3.413-2.022 6.109-5.187 8.22a21 21 0 0 1-2.813 1.578zm-5.333 7.523a2.667 2.667 0 1 1 5.333 0v.44a2.667 2.667 0 1 1-5.333 0v-.44",className:"icon-question_svg__fill"})));var Ew;function bw(){return bw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bw.apply(null,arguments)}const yw=e=>a.createElement("svg",bw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Ew||(Ew=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"m46.14 14.43.562.537 6.631 6.167v-7.8a2.67 2.67 0 0 1 2.356-2.65l.311-.017a2.667 2.667 0 0 1 2.649 2.355l.018.311v16a2.67 2.67 0 0 1-2.356 2.65L56 32H40a2.667 2.667 0 0 1-.311-5.315l.311-.018h11.452l-8.44-7.85c-5.964-5.893-15.168-7.182-22.563-3.156-7.38 4.018-11.172 12.357-9.314 20.455 1.859 8.107 8.935 14.032 17.362 14.518 8.43.487 16.162-4.585 18.967-12.426a2.667 2.667 0 0 1 5.022 1.797C48.88 50.082 38.973 56.582 28.19 55.959c-10.785-.623-19.862-8.222-22.254-18.65C3.542 26.872 8.426 16.135 17.9 10.977c9.227-5.024 20.65-3.579 28.241 3.453z",className:"icon-refresh_svg__fill"})));var Cw;function Tw(){return Tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Tw.apply(null,arguments)}const Nw=e=>a.createElement("svg",Tw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Cw||(Cw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667C48.2 2.667 61.333 15.8 61.333 32S48.2 61.333 32 61.333 2.667 48.2 2.667 32 15.8 2.667 32 2.667m9.886 19.447a2.67 2.67 0 0 0-3.772 0L32 28.23l-6.114-6.115-.134-.124a2.667 2.667 0 0 0-3.638.124l-.124.134a2.667 2.667 0 0 0 .124 3.638L28.23 32l-6.115 6.114-.124.134a2.667 2.667 0 0 0 .124 3.638l.134.124a2.667 2.667 0 0 0 3.638-.124L32 35.77l6.114 6.115.134.124a2.667 2.667 0 0 0 3.638-.124l.124-.134a2.667 2.667 0 0 0-.124-3.638L35.77 32l6.115-6.114.124-.134a2.667 2.667 0 0 0-.124-3.638z",className:"icon-remove_svg__fill"})));var Sw;function Iw(){return Iw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Iw.apply(null,arguments)}const ww=e=>a.createElement("svg",Iw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12"},e),Sw||(Sw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M11.774 10.5c.062 0 .12-.025.164-.07a.22.22 0 0 0 .062-.164c-.069-1.447-.495-2.678-1.268-3.66-.618-.785-1.455-1.409-2.49-1.855a9.3 9.3 0 0 0-2.406-.655 10 10 0 0 0-.862-.078V2.225a.23.23 0 0 0-.128-.203.23.23 0 0 0-.24.028L.084 5.692A.22.22 0 0 0 0 5.865c0 .068.03.132.082.175l4.523 3.737c.067.056.16.068.24.03a.22.22 0 0 0 .13-.202v-1.95c1.134-.08 2.178.003 3.107.25a6.4 6.4 0 0 1 2.087.96c1.018.724 1.398 1.5 1.401 1.507a.23.23 0 0 0 .204.128",className:"icon-reply-filled_svg__fill"})));var Aw;function Mw(){return Mw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mw.apply(null,arguments)}const Ow=e=>a.createElement("svg",Mw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Aw||(Aw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M26.667 48C14.885 48 5.333 38.449 5.333 26.667S14.885 5.333 26.667 5.333 48 14.885 48 26.667c0 4.93-1.672 9.469-4.48 13.081l13.67 13.67a2.668 2.668 0 0 1-3.772 3.772l-13.67-13.67A21.24 21.24 0 0 1 26.667 48m0-5.333c8.836 0 16-7.164 16-16s-7.164-16-16-16-16 7.163-16 16 7.163 16 16 16",className:"icon-search_svg__fill"})));var Rw;function Dw(){return Dw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Dw.apply(null,arguments)}const kw=e=>a.createElement("svg",Dw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Rw||(Rw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M59.795 29.43 7.329 2.979C4.691 1.802 1.76 4.153 2.932 6.798l6.925 18.609a2 2 0 0 0 1.544 1.275l32.273 5.394L11.4 37.47a2 2 0 0 0-1.544 1.275L2.932 57.353c-.879 2.645 1.76 4.997 4.397 3.527l52.466-26.453c2.051-.882 2.051-3.82 0-4.996z",className:"icon-send_svg__fill"})));var Lw;function xw(){return xw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xw.apply(null,arguments)}const Uw=e=>a.createElement("svg",xw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Lw||(Lw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 2.667A5.33 5.33 0 0 1 37.333 8v.24A4.4 4.4 0 0 0 40 12.267a4.4 4.4 0 0 0 4.853-.88l.16-.16a5.33 5.33 0 0 1 7.547 0 5.333 5.333 0 0 1 0 7.546l-.16.16a4.4 4.4 0 0 0-.88 4.854V24a4.4 4.4 0 0 0 4.027 2.667H56c2.946 0 5.333 2.387 5.333 5.333S58.946 37.333 56 37.333h-.24A4.4 4.4 0 0 0 51.733 40a4.4 4.4 0 0 0 .88 4.853l.16.16a5.33 5.33 0 0 1 0 7.547 5.333 5.333 0 0 1-7.546 0l-.16-.16a4.4 4.4 0 0 0-4.854-.88 4.4 4.4 0 0 0-2.666 4.027V56a5.333 5.333 0 0 1-10.667 0v-.24A4.4 4.4 0 0 0 24 51.733a4.4 4.4 0 0 0-4.853.88l-.16.16a5.33 5.33 0 0 1-7.547 0 5.333 5.333 0 0 1 0-7.546l.16-.16a4.4 4.4 0 0 0 .88-4.854 4.4 4.4 0 0 0-4.027-2.666H8A5.333 5.333 0 0 1 8 26.88h.24A4.4 4.4 0 0 0 12.267 24a4.4 4.4 0 0 0-.88-4.853l-.16-.16a5.33 5.33 0 0 1 0-7.547 5.333 5.333 0 0 1 7.546 0l.16.16a4.4 4.4 0 0 0 4.854.88H24a4.4 4.4 0 0 0 2.667-4.027V8A5.33 5.33 0 0 1 32 2.667M32 24a8 8 0 1 0 0 16 8 8 0 0 0 0-16",className:"icon-settings-filled_svg__fill"})));var Pw;function Fw(){return Fw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fw.apply(null,arguments)}const Bw=e=>a.createElement("svg",Fw({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32"},e),Pw||(Pw=a.createElement("path",{d:"M21.943 24.39a1.333 1.333 0 0 1-1.886 1.886l-9.333-9.333a1.333 1.333 0 0 1 0-1.886l9.333-9.333a1.333 1.333 0 1 1 1.886 1.885L13.553 16z",className:"icon-slide-left_svg__fill",clipRule:"evenodd"})));var Hw;function Gw(){return Gw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Gw.apply(null,arguments)}const jw=e=>a.createElement("svg",Gw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Hw||(Hw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M32 61.333C48.2 61.333 61.333 48.2 61.333 32S48.2 2.667 32 2.667 2.667 15.8 2.667 32a2.838 2.838 0 1 0 5.678 0C8.344 18.935 18.934 8.344 32 8.344c13.065 0 23.656 10.591 23.656 23.656S45.065 55.656 32 55.656a2.838 2.838 0 1 0 0 5.677",className:"icon-spinner_svg__fill"})));var Vw;function qw(){return qw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qw.apply(null,arguments)}const zw=e=>a.createElement("svg",qw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Vw||(Vw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M36.889 43.013c6.608 0 12.121 4.685 12.43 10.734l.014.537V58a2.667 2.667 0 0 1-5.316.311L44 58v-3.716c0-3.07-2.87-5.718-6.636-5.925l-.475-.013H27.11c-3.838 0-6.86 2.525-7.096 5.557l-.015.381V58a2.667 2.667 0 0 1-5.315.311L14.667 58v-3.716c0-6.126 5.324-10.986 11.864-11.26l.58-.011zm18.578-17.291q.401 0 .784.118c4.632 1.426 7.518 4.801 7.736 9.688l.013.594v12.8a2.667 2.667 0 0 1-5.315.311l-.018-.311V36.124c-.002-2.595-1.163-4.171-3.528-5.034l-.104-.037-2.502.002a2.667 2.667 0 0 1-2.648-2.356l-.018-.31a2.67 2.67 0 0 1 2.355-2.65l.311-.017zm-44 0 .31.018a2.666 2.666 0 0 1 2.356 2.648l-.018.311a2.666 2.666 0 0 1-2.648 2.356l-2.51-.002-.119.042c-2.246.85-3.503 2.574-3.505 5.147v12.68l-.018.31A2.666 2.666 0 0 1 0 48.922V36.24l.014-.591c.225-4.874 3.203-8.415 7.712-9.809q.384-.117.788-.118zM32 19.958c5.512 0 10 4.409 10 9.871s-4.488 9.872-10 9.872-10-4.41-10-9.872 4.488-9.871 10-9.871m0 5.333c-2.588 0-4.667 2.043-4.667 4.538s2.08 4.538 4.667 4.538c2.588 0 4.667-2.042 4.667-4.538 0-2.495-2.08-4.538-4.667-4.538M17.333 2.667c5.513 0 10 4.409 10 9.871s-4.487 9.871-10 9.871c-5.512 0-10-4.409-10-9.871s4.488-9.871 10-9.871m29.334 0c5.512 0 10 4.409 10 9.871s-4.488 9.871-10 9.871c-5.513 0-10-4.409-10-9.871s4.487-9.871 10-9.871M17.333 8c-2.587 0-4.666 2.042-4.666 4.538s2.079 4.538 4.666 4.538S22 15.034 22 12.538 19.921 8 17.333 8m29.334 0C44.079 8 42 10.042 42 12.538s2.079 4.538 4.667 4.538 4.666-2.042 4.666-4.538S49.254 8 46.667 8",className:"icon-supergroup_svg__fill"})));var Kw,Yw;function Ww(){return Ww=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ww.apply(null,arguments)}const Qw=e=>a.createElement("svg",Ww({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 64 64"},e),Kw||(Kw=a.createElement("path",{d:"M38.824 25.895a2.95 2.95 0 0 1 4.16-.074L57.1 39.378a2.92 2.92 0 0 1 .002 4.213L42.985 57.177a2.95 2.95 0 0 1-4.158-.07 2.92 2.92 0 0 1 .07-4.14l11.928-11.48-11.926-11.451a2.92 2.92 0 0 1-.075-4.14",className:"icon-thread_svg__fill",clipRule:"evenodd"})),Yw||(Yw=a.createElement("path",{d:"M8.866 6c1.583 0 2.866 1.216 2.866 2.716V25.5c0 7.672 6.846 14.068 15.475 14.068h22.927c1.583 0 2.866 1.216 2.866 2.716S51.717 45 50.134 45H27.207C15.604 45 6 36.35 6 25.5V8.716C6 7.216 7.283 6 8.866 6",className:"icon-thread_svg__fill",clipRule:"evenodd"})));var Xw;function Zw(){return Zw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Zw.apply(null,arguments)}const Jw=e=>a.createElement("svg",Zw({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),Xw||(Xw=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M34.667 5.333a2.667 2.667 0 0 1 0 5.334H13.333a2.667 2.667 0 0 0-2.666 2.666v37.334c0 1.143.72 2.118 1.73 2.497l28.384-28.383a2.667 2.667 0 0 1 3.771 0l8.781 8.78v-4.228a2.667 2.667 0 0 1 2.498-2.661l.169-.005a2.667 2.667 0 0 1 2.667 2.666v21.334a8 8 0 0 1-8 8H13.33a8 8 0 0 1-7.998-8V13.333a8 8 0 0 1 8-8zm8 25.105L19.77 53.333h30.897a2.667 2.667 0 0 0 2.661-2.498l.005-.168v-9.563zM22.667 16a6.666 6.666 0 1 1 0 13.333 6.666 6.666 0 0 1 0-13.333m0 5.333a1.334 1.334 0 1 0 0 2.667 1.334 1.334 0 0 0 0-2.667M56.78 3.448a2.665 2.665 0 0 1 3.771 0 2.665 2.665 0 0 1 0 3.771l-4.782 4.78 4.782 4.782c.998.998 1.04 2.59.125 3.638l-.125.133a2.665 2.665 0 0 1-3.771 0l-4.782-4.781-4.78 4.781a2.667 2.667 0 0 1-3.638.125l-.133-.125a2.665 2.665 0 0 1 0-3.771L48.228 12l-4.78-4.781a2.667 2.667 0 0 1-.125-3.638l.125-.133a2.665 2.665 0 0 1 3.771 0l4.78 4.78z",className:"icon-thumbnail-none_svg__fill"})));var $w;function eA(){return eA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},eA.apply(null,arguments)}const tA=e=>a.createElement("svg",eA({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 88 48"},e),$w||($w=a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("rect",{width:80,height:40,x:4,y:4,fill:"#000",className:"icon-toggleoff_svg__fill",rx:20}),a.createElement("circle",{cx:24,cy:24,r:12,fill:"#FFF"}),a.createElement("path",{fill:"#FFF",d:"M64 4c11.046 0 20 8.954 20 20s-8.954 20-20 20H24C12.954 44 4 35.046 4 24S12.954 4 24 4zm0 2H24C14.059 6 6 14.059 6 24c0 9.764 7.774 17.712 17.47 17.992L24 42h40c9.941 0 18-8.059 18-18 0-9.764-7.774-17.712-17.47-17.992z"}),a.createElement("path",{fill:"#000",d:"M64 0H24C10.745 0 0 10.745 0 24s10.745 24 24 24h40c13.255 0 24-10.745 24-24S77.255 0 64 0m0 4c11.046 0 20 8.954 20 20s-8.954 20-20 20H24C12.954 44 4 35.046 4 24S12.954 4 24 4z",className:"icon-toggleoff_svg__fill"}))));var nA;function rA(){return rA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rA.apply(null,arguments)}const iA=e=>a.createElement("svg",rA({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 88 48"},e),nA||(nA=a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("rect",{width:80,height:40,x:4,y:4,fill:"#000",className:"icon-toggleon_svg__fill",rx:20}),a.createElement("circle",{cx:64,cy:24,r:12,fill:"#FFF"}),a.createElement("path",{fill:"#FFF",d:"M64 4c11.046 0 20 8.954 20 20s-8.954 20-20 20H24C12.954 44 4 35.046 4 24S12.954 4 24 4zm0 2H24C14.059 6 6 14.059 6 24c0 9.764 7.774 17.712 17.47 17.992L24 42h40c9.941 0 18-8.059 18-18 0-9.764-7.774-17.712-17.47-17.992z"}),a.createElement("path",{fill:"#000",d:"M64 0H24C10.745 0 0 10.745 0 24s10.745 24 24 24h40c13.255 0 24-10.745 24-24S77.255 0 64 0m0 4c11.046 0 20 8.954 20 20s-8.954 20-20 20H24C12.954 44 4 35.046 4 24S12.954 4 24 4z",className:"icon-toggleon_svg__fill"}))));var aA;function sA(){return sA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sA.apply(null,arguments)}const oA=e=>a.createElement("svg",sA({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"},e),aA||(aA=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M42.667 37.333c7.17 0 13.018 5.66 13.32 12.755l.013.579V56a2.667 2.667 0 0 1-5.315.311L50.667 56v-5.333c0-4.26-3.33-7.743-7.53-7.987l-.47-.013H21.333a8 8 0 0 0-7.986 7.53l-.014.47V56a2.667 2.667 0 0 1-5.316.311L8 56v-5.333c0-7.17 5.66-13.019 12.755-13.321l.578-.013zM32 5.333c7.364 0 13.333 5.97 13.333 13.334S39.363 32 32 32s-13.333-5.97-13.333-13.333S24.637 5.333 32 5.333m0 5.334a8 8 0 1 0 0 16 8 8 0 0 0 0-16",className:"icon-user_svg__fill"})));var lA;function uA(){return uA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uA.apply(null,arguments)}const cA=e=>a.createElement("svg",uA({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},e),lA||(lA=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M12.346 5.336v-.001c.405-.523 1.182-.524 1.58-.037.162.2.25.443.25.69v3.678c0 .518.42.938.938.938H18.6c.359 0 .7.179.911.488l.001.001.369.548.003.004c.174.256.226.583.134.895l-1.532 5.316c-.131.459-.559.782-1.044.782h-7.075c-.3 0-.593-.127-.8-.345l-1.13-1.222v-6.647zm-4.73 3.078 3.245-4.223.002-.002c1.125-1.456 3.339-1.521 4.517-.075.421.52.671 1.177.671 1.874v2.74h2.55c.99 0 1.908.496 2.462 1.31l.002.004.368.547.002.002a2.93 2.93 0 0 1 .382 2.475v.003l-1.528 5.302a2.96 2.96 0 0 1-2.847 2.142h-7.075a2.99 2.99 0 0 1-2.166-.935l-.007-.007-.066-.072a2.13 2.13 0 0 1-1.821 1.025H4.192a2.13 2.13 0 0 1-2.13-2.13v-8.3a2.13 2.13 0 0 1 2.13-2.13h2.115c.493 0 .948.168 1.31.45m-3.678 1.68c0-.141.114-.255.254-.255h2.115c.14 0 .254.114.254.255v8.3c0 .14-.114.255-.254.255H4.192a.255.255 0 0 1-.255-.255z",clipRule:"evenodd"})));var dA;function hA(){return hA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hA.apply(null,arguments)}const fA=e=>a.createElement("svg",hA({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},e),dA||(dA=a.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M11.654 18.664v.001c-.405.523-1.182.524-1.58.037-.162-.2-.25-.444-.25-.69v-3.678a.94.94 0 0 0-.938-.938H5.4c-.359 0-.7-.179-.911-.488l-.001-.001-.369-.548-.003-.004a1.05 1.05 0 0 1-.134-.895l1.532-5.316c.131-.459.559-.782 1.044-.782h7.075c.3 0 .593.127.8.345l1.13 1.222v6.647zm4.73-3.078-3.245 4.223-.002.002c-1.125 1.456-3.339 1.521-4.517.075a2.98 2.98 0 0 1-.671-1.874v-2.74h-2.55c-.99 0-1.908-.496-2.462-1.31l-.002-.004-.368-.547-.002-.002a2.93 2.93 0 0 1-.382-2.475v-.003L3.711 5.63a2.96 2.96 0 0 1 2.847-2.142h7.075c.823 0 1.608.345 2.166.935l.007.007.066.072a2.13 2.13 0 0 1 1.821-1.025h2.115a2.13 2.13 0 0 1 2.13 2.13v8.3a2.13 2.13 0 0 1-2.13 2.13h-2.115a2.12 2.12 0 0 1-1.31-.45m3.678-1.68c0 .141-.114.255-.254.255h-2.115a.255.255 0 0 1-.255-.255v-8.3c0-.14.115-.255.255-.255h2.115c.14 0 .255.114.255.255z",clipRule:"evenodd"})));function pA(e){var n=e.className,r=void 0===n?"":n,i=e.type,a=e.fillColor,s=void 0===a?KN.DEFAULT:a,o=e.width,l=void 0===o?26:o,u=e.height,c=void 0===u?26:u,d=e.onClick,h=void 0===d?zT:d,f=e.children,p=void 0===f?null:f,_=e.testID,m={width:"string"==typeof l?l:"".concat(l,"px"),minWidth:"string"==typeof l?l:"".concat(l,"px"),height:"string"==typeof c?c:"".concat(c,"px"),minHeight:"string"==typeof c?c:"".concat(c,"px")};return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-icon",WN(i),YN(s)],!1).join(" "),"data-testid":_,role:"button",onClick:h,onKeyDown:h,tabIndex:0,style:m},p||function(e){switch(e){case zN.ADD:return t.createElement(XN,null);case zN.ARROW_LEFT:return t.createElement($N,null);case zN.ATTACH:return t.createElement(nS,null);case zN.AUDIO_ON_LINED:return t.createElement(sS,null);case zN.BAN:return t.createElement(uS,null);case zN.BROADCAST:return t.createElement(hS,null);case zN.CAMERA:return t.createElement(_S,null);case zN.CHANNELS:return t.createElement(gS,null);case zN.CHAT:return t.createElement(yS,null);case zN.CHAT_FILLED:return t.createElement(NS,null);case zN.CHEVRON_DOWN:return t.createElement(wS,null);case zN.CHEVRON_RIGHT:return t.createElement(OS,null);case zN.CLOSE:return t.createElement(kS,null);case zN.COLLAPSE:return t.createElement(US,null);case zN.COPY:return t.createElement(BS,null);case zN.CREATE:return t.createElement(jS,null);case zN.DELETE:return t.createElement(zS,null);case zN.DISCONNECTED:return t.createElement(WS,null);case zN.DOCUMENT:return t.createElement(ZS,null);case zN.DONE:return t.createElement(eI,null);case zN.DONE_ALL:return t.createElement(rI,null);case zN.DOWNLOAD:return t.createElement(sI,null);case zN.EDIT:return t.createElement(uI,null);case zN.EMOJI_MORE:return t.createElement(hI,null);case zN.ERROR:return t.createElement(_I,null);case zN.EXPAND:return t.createElement(gI,null);case zN.FILE_AUDIO:return t.createElement(yI,null);case zN.FILE_DOCUMENT:return t.createElement(NI,null);case zN.FREEZE:return t.createElement(wI,null);case zN.GIF:return t.createElement(OI,null);case zN.INFO:return t.createElement(kI,null);case zN.LEAVE:return t.createElement(UI,null);case zN.MEMBERS:return t.createElement(BI,null);case zN.MESSAGE:return t.createElement(jI,null);case zN.MODERATIONS:return t.createElement(zI,null);case zN.MORE:return t.createElement(WI,null);case zN.MUTE:return t.createElement(ZI,null);case zN.NOTIFICATIONS:return t.createElement(ew,null);case zN.NOTIFICATIONS_OFF_FILLED:return t.createElement(rw,null);case zN.OPERATOR:return t.createElement(sw,null);case zN.PHOTO:return t.createElement(uw,null);case zN.PLAY:return t.createElement(hw,null);case zN.PLUS:return t.createElement(_w,null);case zN.QUESTION:return t.createElement(gw,null);case zN.REFRESH:return t.createElement(yw,null);case zN.REMOVE:return t.createElement(Nw,null);case zN.REPLY:return t.createElement(ww,null);case zN.SEARCH:return t.createElement(Ow,null);case zN.SEND:return t.createElement(kw,null);case zN.SETTINGS_FILLED:return t.createElement(Uw,null);case zN.SLIDE_LEFT:return t.createElement(Bw,null);case zN.SPINNER:return t.createElement(jw,null);case zN.SUPERGROUP:return t.createElement(zw,null);case zN.THREAD:return t.createElement(Qw,null);case zN.THUMBNAIL_NONE:return t.createElement(Jw,null);case zN.TOGGLE_OFF:return t.createElement(tA,null);case zN.TOGGLE_ON:return t.createElement(iA,null);case zN.USER:return t.createElement(oA,null);case zN.FEEDBACK_LIKE:return t.createElement(cA,null);case zN.FEEDBACK_DISLIKE:return t.createElement(fA,null);default:return"icon"}}(i))}var _A=zN,mA=KN;function vA(){var e=t.useContext(FN).stringSet;return t.createElement("div",{className:"sendbird-connection-status"},t.createElement(yN,{type:CN.BODY_2,color:TN.ONBACKGROUND_2},e.TRYING_TO_CONNECT),t.createElement(pA,{type:_A.DISCONNECTED,fillColor:mA.SENT,width:"14px",height:"14px"}))}function gA(e){var n=e.className,r=void 0===n?"":n,i=e.width,a=void 0===i?"26px":i,s=e.height,o=void 0===s?"26px":s,l=e.children,u=e.testID;return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-loader"],!1).join(" "),"data-testid":u,style:{width:"string"==typeof a?a:"".concat(a,"px"),height:"string"==typeof o?o:"".concat(o,"px")}},l||t.createElement(pA,{type:_A.SPINNER,width:"26px",height:"26px"}))}var EA="LOADING",bA="NO_CHANNELS",yA="NO_MESSAGES",CA="WRONG",TA="SEARCH_IN",NA="SEARCHING",SA="NO_RESULTS";function IA(e){var n=e.className,r=void 0===n?"":n,i=e.type,a=e.iconSize,s=e.searchInString,o=void 0===s?"":s,l=e.retryToConnect,u=t.useContext(FN).stringSet;return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-place-holder"],!1).join(" ")},i===EA&&t.createElement(gA,{width:a||"48px",height:a||"48px"},t.createElement(pA,{type:_A.SPINNER,fillColor:mA.PRIMARY,width:a||"48px",height:a||"48px"})),(i===bA||i===yA||i===CA)&&t.createElement("div",{className:"sendbird-place-holder__body"},i===bA&&t.createElement(pA,{className:"sendbird-place-holder__body__icon",type:_A.CHAT,fillColor:mA.ON_BACKGROUND_3,width:a||"64px",height:a||"64px"}),i===CA&&t.createElement(pA,{className:"sendbird-place-holder__body__icon",type:_A.ERROR,fillColor:mA.ON_BACKGROUND_3,width:a||"64px",height:a||"64px"}),i===yA&&t.createElement(pA,{className:"sendbird-place-holder__body__icon",type:_A.MESSAGE,fillColor:mA.ON_BACKGROUND_3,width:a||"64px",height:a||"64px"}),t.createElement(yN,{className:"sendbird-place-holder__body__text",type:CN.BODY_1,color:TN.ONBACKGROUND_2},i===bA&&u.PLACE_HOLDER__NO_CHANNEL,i===CA&&u.PLACE_HOLDER__WRONG,i===yA&&u.PLACE_HOLDER__NO_MESSAGES),l&&t.createElement("div",{className:"sendbird-place-holder__body__reconnect",role:"button",onClick:l,onKeyPress:l,tabIndex:0},t.createElement(pA,{className:"sendbird-place-holder__body__reconnect__icon",type:_A.REFRESH,fillColor:mA.PRIMARY,width:"20px",height:"20px"}),t.createElement(yN,{className:"sendbird-place-holder__body__reconnect__text",type:CN.BUTTON_1,color:TN.PRIMARY},u.PLACE_HOLDER__RETRY_TO_CONNECT))),(i===SA||i===TA||i===NA)&&t.createElement("div",{className:"sendbird-place-holder__body--align-top"},i===TA&&t.createElement("div",{className:"sendbird-place-holder__body--align-top__text"},t.createElement(yN,{className:"sendbird-place-holder__body--align-top__text__search-in",type:CN.BUTTON_2,color:TN.ONBACKGROUND_2},u.SEARCH_IN),t.createElement(yN,{className:"sendbird-place-holder__body--align-top__text__channel-name",type:CN.BUTTON_2,color:TN.PRIMARY},"'".concat(o)),t.createElement(yN,{className:"sendbird-place-holder__body--align-top__text__quote",type:CN.BUTTON_2,color:TN.PRIMARY},"'")),i===NA&&t.createElement(yN,{className:"sendbird-place-hlder__body--align-top__searching",type:CN.BODY_1,color:TN.ONBACKGROUND_2},u.SEARCHING),i===SA&&t.createElement(yN,{className:"sendbird-place-hlder__body--align-top__no-result",type:CN.BODY_1,color:TN.ONBACKGROUND_2},u.NO_SEARCHED_MESSAGE)))}var wA=function(e){var n,r,i,a,s=e.isLoading,o=e.isInvalid,l=e.channelUrl,u=KT(e),c=u.renderChannelHeader,d=u.renderMessageList,h=u.renderMessageInput,f=u.renderTypingIndicator,p=u.renderPlaceholderLoader,_=u.renderPlaceholderInvalid,m=yT().state,v=m.stores,g=m.config,E=null===(n=null==v?void 0:v.sdkStore)||void 0===n?void 0:n.error,b=g.logger,y=g.isOnline;return s?t.createElement("div",{className:"sendbird-conversation"},(null==p?void 0:p())||t.createElement(IA,{type:EA})):l?o?t.createElement("div",{className:"sendbird-conversation"},(null==_?void 0:_())||t.createElement(IA,{type:CA})):E?t.createElement("div",{className:"sendbird-conversation"},(null==_?void 0:_())||t.createElement(IA,{type:CA,retryToConnect:function(){b.info("Channel: reconnecting")}})):t.createElement("div",{className:"sendbird-conversation"},null==c?void 0:c({className:"sendbird-conversation__channel-header"}),null==d?void 0:d(e),t.createElement("div",{className:"sendbird-conversation__footer"},null==h?void 0:h(),t.createElement("div",{className:"sendbird-conversation__footer__typing-indicator"},(null==f?void 0:f())||(null===(r=null==g?void 0:g.groupChannel)||void 0===r?void 0:r.enableTypingIndicator)&&(null===(a=null===(i=null==g?void 0:g.groupChannel)||void 0===i?void 0:i.typingIndicatorTypes)||void 0===a?void 0:a.has(kN.Text))&&t.createElement(VN,{channelUrl:l}),!y&&t.createElement(vA,null)))):t.createElement("div",{className:"sendbird-conversation"},(null==_?void 0:_())||t.createElement(IA,{type:bA}))},AA=function(e){if(null!==e)return"number"==typeof e?"".concat(e,"px"):e};function MA(e,t,n){var r;return"min(".concat(null!=t?t:n,", ").concat(null!==(r=AA(e))&&void 0!==r?r:n,")")}var OA=function(){var e=t.useRef(!1),n=function(){var e=t.useState(!1),n=e[0],r=e[1],i=t.useState(null),a=i[0],s=i[1],o=t.useCallback((function(e){null!==e&&s(e)}),[]);return t.useEffect((function(){if(a){var e=new IntersectionObserver((function(e){var t=e[0];r(t.isIntersecting)}));return e.observe(a),function(){e.disconnect()}}}),[a]),[o,n]}(),r=n[0];return n[1]&&(e.current=!0),[r,e.current]};function RA(e,t){return void 0===e&&(e=!1),void 0===t&&(t=null),e?"50%":AA(t)}function DA(e,t,n){var r="string"==typeof e?parseInt(e,10):e,i=n-1,a=1===t?2*r:r,s=t===i?2*r:r,o=t===i-1?2*r:r;return"".concat(0===t?2*r:r,"px ").concat(a,"px ").concat(s,"px ").concat(o,"px")}var kA=function(e){var n,r=e.className,i=void 0===r?"":r,a=e.url,s=e.alt,o=void 0===s?"":s,l=e.width,u=void 0===l?null:l,c=e.maxSideLength,d=void 0===c?null:c,h=e.height,f=void 0===h?null:h,p=e.circle,_=void 0!==p&&p,v=e.fixedSize,g=void 0!==v&&v,E=e.placeHolder,y=void 0===E?null:E,C=e.defaultComponent,T=void 0===C?null:C,N=e.borderRadius,S=void 0===N?null:N,I=e.onLoad,w=void 0===I?zT:I,A=e.onError,M=void 0===A?zT:A,O=e.shadeOnHover,R=e.isUploaded,D=void 0===R||R,k=OA(),L=k[0],x=k[1]?a:null,U=t.useState(!1),P=U[0],F=U[1],B=t.useState(!0),H=B[0],G=B[1],j=function(e){var n=e.width,r=e.height,i=e.maxSideLength,a=e.defaultMinLength;return[t.useMemo((function(){return MA(n,i,a)}),[n]),t.useMemo((function(){return MA(r,i,a)}),[r])]}({width:u,height:f,maxSideLength:d,defaultMinLength:"400px"}),V=j[0],q=j[1];return V&&q&&t.createElement("div",{ref:L,className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-image-renderer"],!1).join(" "),style:{width:"100%",minWidth:V,maxWidth:g?V:"400px",height:q}},H&&("function"==typeof y?y({style:{width:"100%",minWidth:V,maxWidth:g?V:"400px",height:q,position:"absolute",display:"flex",justifyContent:"center",alignItems:"center"}}):y),!x||P?"function"==typeof T?T():T:(n=x?{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundImage:"url(".concat(x,")")}:{},t.createElement("div",{className:"sendbird-image-renderer__image",style:m({width:"100%",minWidth:V,maxWidth:g?V:"400px",height:q,position:"absolute",borderRadius:RA(_,S)},n)})),O&&t.createElement("div",{className:"sendbird-multiple-files-image-renderer__image-cover",style:m({borderRadius:RA(_,S)},D?{}:{display:"inline-flex"})}),x&&t.createElement(LA,{src:x,alt:o,onLoadStart:function(){G(!0),F(!1)},onLoad:function(){G(!1),F(!1),w()},onError:function(){G(!1),F(!0),M()}}))},LA=function(e){var n=e.src,r=e.alt,i=e.onLoadStart,a=void 0===i?zT:i,s=e.onLoad,o=void 0===s?zT:s,l=e.onError,u=void 0===l?zT:l,c=t.useRef({currSrc:n,prevSrc:n,loadFailure:!1});return c.current.currSrc!==n&&(c.current.prevSrc=c.current.currSrc,c.current.currSrc=n),t.useLayoutEffect((function(){if(n){var e=c.current.prevSrc!==c.current.currSrc,t=c.current.loadFailure;(e||t)&&a()}}),[n,navigator.onLine]),t.createElement("img",{className:"sendbird-image-renderer__hidden-image-loader",src:n,alt:r,onLoad:function(){c.current.loadFailure=!1,o()},onError:function(){c.current.loadFailure=!0,u()}})},xA=function(e){if("number"==typeof e)return e;if("string"==typeof e){var t=Number.parseFloat(e);if(!Number.isNaN(t))return t}return NaN},UA=function(e){var n=e.width,r=e.height,i=e.text,a=xA(n),s=xA(r);return"number"!=typeof a||Number.isNaN(a)||(a*=.575),"number"!=typeof s||Number.isNaN(s)||(s*=.575),t.createElement("div",{className:WT("sendbird-avatar-img--default",i&&"text"),style:{width:n,height:r}},i?t.createElement("div",{className:"sendbird-avatar-text"},i):t.createElement(pA,{type:_A.USER,fillColor:mA.CONTENT,width:a,height:s}))},PA="sendbird-avatar-img",FA=function(e){var n=e.src,r=void 0===n?"":n,i=e.alt,a=void 0===i?"":i,s=e.height,o=e.width,l=e.customDefaultComponent,u=function(){return l?l({width:o,height:s}):t.createElement(UA,{width:o,height:s})};return"string"==typeof r?t.createElement(kA,{className:PA,url:r,height:s,width:o,alt:a,defaultComponent:u}):r&&r.length?1===r.length?t.createElement(kA,{className:PA,url:r[0],height:s,width:o,alt:a,defaultComponent:u}):2===r.length?t.createElement("div",{className:"sendbird-avatar--inner__two-child"},t.createElement(kA,{className:PA,url:r[0],height:s,width:o,alt:a,defaultComponent:u}),t.createElement(kA,{className:PA,url:r[1],height:s,width:o,alt:a,defaultComponent:u})):3===r.length?t.createElement(t.Fragment,null,t.createElement("div",{className:"sendbird-avatar--inner__three-child--upper"},t.createElement(kA,{className:PA,url:r[0],height:s,width:o,alt:a,defaultComponent:u})),t.createElement("div",{className:"sendbird-avatar--inner__three-child--lower"},t.createElement(kA,{className:PA,url:r[1],height:s,width:o,alt:a,defaultComponent:u}),t.createElement(kA,{className:PA,url:r[2],height:s,width:o,alt:a,defaultComponent:u}))):t.createElement("div",{className:"sendbird-avatar--inner__four-child"},r.slice(0,4).map((function(e,n){return t.createElement(kA,{className:PA,url:e,height:s,width:o,alt:a,key:"".concat(e,"-").concat(n),defaultComponent:u})}))):t.createElement(kA,{className:PA,url:"",height:s,width:o,alt:a,defaultComponent:u})};var BA,HA,GA=t.forwardRef((function(e,n){var r=e.className,i=void 0===r?"":r,a=e.src,s=void 0===a?"":a,o=e.alt,l=void 0===o?"":o,u=e.width,c=void 0===u?"56px":u,d=e.height,h=void 0===d?"56px":d,f=e.zIndex,p=void 0===f?0:f,_=e.left,m=void 0===_?"":_,v=e.bottom,g=void 0===v?"":v,E=e.onClick,y=e.customDefaultComponent;return t.createElement("div",{className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-avatar"],!1).join(" "),role:"button",ref:n,style:{height:h,width:c,zIndex:p,left:m,bottom:g},onClick:E,onKeyDown:E,tabIndex:0},t.createElement(FA,{src:s,width:c,height:h,alt:l,customDefaultComponent:y}))})),jA="https://static.sendbird.com/sample/cover/cover_",VA=function(e,t){return(null==e?void 0:e.coverUrl)&&!new RegExp("^".concat(jA)).test(e.coverUrl)?e.coverUrl:((null==e?void 0:e.members)||[]).filter((function(e){return e.userId!==t})).map((function(e){return e.profileUrl}))};function qA(e){var n=e.channel,r=e.userId,i=e.theme,a=e.width,s=void 0===a?56:a,o=e.height,l=void 0===o?56:o,u=null==n?void 0:n.isBroadcast,c=t.useMemo((function(){return u?function(e){return!(null==e?void 0:e.coverUrl)||!!new RegExp("^".concat(jA)).test(e.coverUrl)}(n)?t.createElement("div",{className:"sendbird-chat-header--default-avatar",style:{width:s,height:l,display:"flex",justifyContent:"center",alignItems:"center"}},t.createElement(pA,{type:_A.BROADCAST,fillColor:mA.CONTENT,width:.575*s,height:.575*l})):t.createElement(GA,{className:"sendbird-chat-header--avatar--broadcast-channel",src:VA(n,r),width:s,height:l,alt:null==n?void 0:n.name}):t.createElement(GA,{className:"sendbird-chat-header--avatar--group-channel",src:VA(n,r),width:"".concat(s,"px"),height:"".concat(l,"px"),alt:null==n?void 0:n.name})}),[VA(n,r),i]);return t.createElement(t.Fragment,null,c)}(HA=BA||(BA={})).NONE="NONE",HA.PENDING="PENDING",HA.SENT="SENT",HA.FAILED="FAILED",HA.DELIVERED="DELIVERED",HA.READ="READ";var zA,KA=function(e,t){var n,r,i,a,s;if(!t||!("sendingStatus"in t))return BA.NONE;if("pending"===t.sendingStatus)return BA.PENDING;if("failed"===t.sendingStatus)return BA.FAILED;if(null===(n=null==e?void 0:e.isGroupChannel)||void 0===n?void 0:n.call(e)){if(0===(null===(i=(r=e).getUnreadMemberCount)||void 0===i?void 0:i.call(r,t)))return BA.READ;if(0===(null===(s=(a=e).getUndeliveredMemberCount)||void 0===s?void 0:s.call(a,t)))return BA.DELIVERED}return"succeeded"===t.sendingStatus?BA.SENT:BA.NONE},YA=function(e){return!function(e){return/Chrome/i.test(e)}(e)&&/Safari/i.test(e)},WA=function(e){return function(e){return/iPhone|iPad|iPod/i.test(e)}(e)&&(function(e){return/WebKit/i.test(e)}(e)||YA(e))};function QA(e){return(QA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function XA(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function ZA(e){XA(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===QA(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}var JA={IMAGE:["image/jpeg","image/jpg","image/png","image/gif","image/svg+xml","image/webp","image/bmp"],VIDEO:["video/mpeg","video/ogg","video/webm","video/mp4"],AUDIO:["audio/aac","audio/midi","audio/x-midi","audio/mpeg","audio/ogg","audio/opus","audio/wav","audio/webm","audio/3gpp","audio/3gpp2","audio/mp3"],DOCUMENT:["text/plain","text/css","text/csv","text/html","text/calendar","text/javascript","text/xml","text/x-log","video/quicktime"],APPLICATION:["application/x-abiword","application/x-freearc","application/vnd.amazon.ebook","application/octet-stream","application/x-bzip","application/x-bzip2","application/x-cdf","application/x-csh","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-fontobject","application/epub+zip","application/gzip","application/java-archive","application/json","application/ld+json","application/vnd.apple.installer+xml","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.text","application/ogg","application/pdf","application/x-httpd-php","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.rar","application/rtf","application/x-sh","application/x-tar","application/vnd.visio","application/xhtml+xml","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/xml","application/vnd.mozilla.xul+xml","application/zip","application/x-7z-compressed"],ARCHIVE:["application/zip","application/x-rar-compressed","application/x-7z-compressed","application/x-tar","application/gzip","application/x-bzip","application/x-bzip2","application/x-xz","application/x-iso9660-image"]},$A={IMAGE:[".apng",".avif",".gif",".jpg",".jpeg",".jfif",".pjpeg",".pjp",".png",".svg",".webp",".bmp",".ico",".cur",".tif",".tiff",".heic",".heif"],VIDEO:[".mp4",".webm",".ogv",".3gp",".3g2",".avi",".mov",".wmv",".mpg",".mpeg",".m4v",".mkv"],AUDIO:[".aac",".midi",".mp3",".oga",".opus",".wav",".weba",".3gp",".3g2"],DOCUMENT:[".txt",".log",".csv",".rtf",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx"],ARCHIVE:[".zip",".rar",".7z",".tar",".gz",".bz2",".xz",".iso"]},eM=function(e){if(Array.isArray(e)&&e.length>0){var t=e.reduce((function(e,t){switch(t.toLowerCase()){case"image":e.push.apply(e,b(b([],JA.IMAGE,!1),$A.IMAGE,!1));break;case"video":e.push.apply(e,b(b([],JA.VIDEO,!1),$A.VIDEO,!1));break;case"audio":e.push.apply(e,b(b([],JA.AUDIO,!1),$A.AUDIO,!1));break;case"archive":e.push.apply(e,b(b([],JA.ARCHIVE,!1),$A.ARCHIVE,!1));break;default:e.push(t)}return e}),[]);return Array.from(new Set(t)).join(",")}return b(b([],Object.values(JA).flat(),!0),Object.values($A).flat(),!0).join(",")},tM={ADMIN:"ADMIN",TEXT:"TEXT",FILE:"FILE",MULTIPLE_FILES:"MULTIPLE_FILES",THUMBNAIL:"THUMBNAIL",OG:"OG",UNKNOWN:"UNKNOWN"},nM={IMAGE:"IMAGE",AUDIO:"AUDIO",VIDEO:"VIDEO",GIF:"GIF",VOICE:"VOICE",OTHERS:"OTHERS"},rM=function(e){return JA.IMAGE.indexOf(e)>=0},iM=function(e){return JA.VIDEO.indexOf(e)>=0||function(e){return YA(navigator.userAgent)&&function(e){return"video/quicktime"===e}(e)}(e)},aM=function(e){return"image/gif"===e},sM=function(e){return rM(e)||iM(e)},oM=function(e){return JA.AUDIO.indexOf(e)>=0},lM=function(e){return aM(e)?nM.GIF:rM(e)?nM.IMAGE:iM(e)?nM.VIDEO:oM(e)?nM.AUDIO:nM.OTHERS},uM=function(e){return"succeeded"===e.sendingStatus},cM=function(e,t){return KA(e,t)===BA.READ},dM=function(e){return"failed"===(null==e?void 0:e.sendingStatus)},hM=function(e){return"pending"===(null==e?void 0:e.sendingStatus)},fM=function(e){return e&&(e.isAdminMessage&&"function"==typeof e.isAdminMessage?e.isAdminMessage():"admin"===(null==e?void 0:e.messageType))},pM=function(e){return e&&(e.isUserMessage&&"function"==typeof e.isUserMessage?e.isUserMessage():"user"===(null==e?void 0:e.messageType))},_M=function(e){return!!e&&(e.isFileMessage&&"function"==typeof e.isFileMessage?e.isFileMessage():"file"===(null==e?void 0:e.messageType))},mM=function(e){return e&&(e.isMultipleFilesMessage&&"function"==typeof e.isMultipleFilesMessage?e.isMultipleFilesMessage():"file"===e.messageType&&Object.prototype.hasOwnProperty.call(e,"fileInfoList"))},vM=function(e){return!!e.parentMessageId&&!!e.parentMessage},gM=function(e){return!!e.messageForm},EM=function(e){var t;return!(!e||!(null===(t=e.extendedMessagePayload)||void 0===t?void 0:t[bg]))},bM=function(e){var t=e.type;return!(t&&!yM[t])},yM={default:"default"},CM=((zA={})[yM.default]="ui_container_type__default",zA),TM=function(e){return!(!e||!pM(e))&&(!!e.ogMetaData&&!!(e.ogMetaData.url||e.ogMetaData.title||e.ogMetaData.description||e.ogMetaData.defaultImage))},NM=function(e){return pM(e)},SM=function(e){return!(!e||!_M(e))&&sM(e.type)},IM=function(e){return!(!e||!_M(e))&&(SM(e)&&rM(e.type))},wM=function(e){return!(!e||!_M(e))&&(SM(e)&&iM(e.type))},AM=function(e){return!(!e||!_M(e))&&(SM(e)&&aM(e.type))},MM=function(e){return/^voice\//.test(e)},OM=function(e){var t,n,r,i;if(!e||!_M(e)||!e.type)return!1;var a=e.type.split(";"),s=a[0],o=a[1];if(!/^audio\//.test(s))return!1;if(o){var l=o.split("="),u=l[0],c=l[1];return"sbu_type"===u&&"voice"===c}return MM(null!==(i=null===(r=null===(n=null===(t=null==e?void 0:e.metaArrays)||void 0===t?void 0:t.find((function(e){return"KEY_INTERNAL_MESSAGE_TYPE"===e.key})))||void 0===n?void 0:n.value)||void 0===r?void 0:r[0])&&void 0!==i?i:"")},RM=function(e){return pM(e)&&(null==e?void 0:e.updatedAt)>0},DM=function(e){return fM(e)?tM.ADMIN:pM(e)?TM(e)?tM.OG:tM.TEXT:mM(e)?tM.MULTIPLE_FILES:_M(e)?SM(e)?tM.THUMBNAIL:OM(e)?nM.VOICE:tM.FILE:tM.UNKNOWN},kM=function(e,t){return Array.isArray(t)?b(b([],e,!0),t,!0):(e.push(t),e)},LM=function(e){return Array.isArray(e)?e.reduce(kM,[]).join(" "):e},xM=function(e,t){return t.userIds.some((function(t){return t===e}))},UM=function(e,t,n,r){var i="";return xM(t,e)&&(i=1===e.userIds.length?r.TOOLTIP__YOU:r.TOOLTIP__AND_YOU),"".concat(e.userIds.filter((function(e){return e!==t})).map((function(e){return n.get(e)||r.TOOLTIP__UNKNOWN_USER})).join(", ")).concat(i)};function PM(e){var t;return(null==e?void 0:e.extendedMessagePayload)&&Array.isArray(null===(t=null==e?void 0:e.extendedMessagePayload)||void 0===t?void 0:t.suggested_replies)?e.extendedMessagePayload.suggested_replies:[]}var FM,BM,HM=function(e,t){if(t||(t=40),null==e)return"";if(e.length<=t)return e;var n=t-3,r=Math.ceil(n/2),i=Math.floor(n/2);return e.substr(0,r)+"..."+e.substr(e.length-i)},GM=function(e){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(n){return!1}finally{document.body.removeChild(t)}}return!1},jM=function(e){var t;return null===(t=null==e?void 0:e.emojiCategories)||void 0===t?void 0:t.map((function(e){return e.emojis})).reduce((function(e,t){return e.concat(t)}),[])},VM=function(e,t){var n;return t?(null===(n=null==e?void 0:e.emojiCategories)||void 0===n?void 0:n.filter((function(e){return t.includes(e.id)})).flatMap((function(e){return e.emojis})))||[]:jM(e)};(BM=FM||(FM={})).normal="normal",BM.mention="mention",BM.url="url";var qM,zM,KM=function(e){return Boolean(e)&&"sender"in e},YM=function(e){return!(null==e?void 0:e.name)||"Group Channel"===e.name||"AI Chatbot Widget Channel"===e.name},WM="sendbird--mobile-mode",QM=t.createContext({breakpoint:!1,isMobile:!1}),XM=function(){try{var e=document.querySelector("body");null==e||e.classList.add(WM)}catch(t){}},ZM=function(){try{var e=document.querySelector("body");null==e||e.classList.remove(WM)}catch(t){}},JM=function(e){var n=e.children,r=e.logger,i=(null==e?void 0:e.breakpoint)||!1,a=t.useState(!1),s=a[0],o=a[1];return t.useEffect((function(){var e,t=function(){var e;if("boolean"==typeof i)o(i),i?XM():ZM();else{var t=window.matchMedia("(max-width: ".concat(i,")"));null===(e=null==r?void 0:r.info)||void 0===e||e.call(r,"MediaQueryProvider: Screensize updated to ".concat(i)),t.matches?(o(!0),XM()):(o(!1),ZM())}};return t(),window.addEventListener("resize",t),null===(e=null==r?void 0:r.info)||void 0===e||e.call(r,"MediaQueryProvider: addEventListener",{updateSize:t}),function(){var e;window.removeEventListener("resize",t),null===(e=null==r?void 0:r.info)||void 0===e||e.call(r,"MediaQueryProvider: removeEventListener",{updateSize:t})}}),[i]),t.createElement(QM.Provider,{value:{breakpoint:i,isMobile:s}},n)},$M=function(){return t.useContext(QM)};(zM=qM||(qM={})).ONBACKGROUND_1="ONBACKGROUND_1",zM.ONBACKGROUND_2="ONBACKGROUND_2",zM.ONBACKGROUND_3="ONBACKGROUND_3",zM.ONBACKGROUND_4="ONBACKGROUND_4",zM.ONCONTENT_1="ONCONTENT_1",zM.PRIMARY="PRIMARY",zM.ERROR="ERROR";var eO=function(e){switch(e){case qM.ONBACKGROUND_1:return"sendbird-color--onbackground-1";case qM.ONBACKGROUND_2:return"sendbird-color--onbackground-2";case qM.ONBACKGROUND_3:return"sendbird-color--onbackground-3";case qM.ONBACKGROUND_4:return"sendbird-color--onbackground-4";case qM.ONCONTENT_1:return"sendbird-color--oncontent-1";case qM.PRIMARY:return"sendbird-color--primary";case qM.ERROR:return"sendbird-color--error";default:return""}},tO=function(e){var n=e.className,r=void 0===n?"":n,i=e.color,a=void 0===i?qM.ONBACKGROUND_1:i,s=e.disabled,o=void 0!==s&&s,l=e.disableUnderline,u=void 0!==l&&l,c=e.onClick,d=void 0===c?function(){}:c,h=e.children;return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),[eO(a),u?"sendbird-textbutton--not-underline":"sendbird-textbutton",o?"sendbird-textbutton--disabled":""],!1).join(" "),role:"button",tabIndex:0,onClick:function(e){return d(e)},onKeyPress:function(e){return d(e)}},h)},nO=t.forwardRef((function(e,n){var r=e.className,i=void 0===r?"":r,a=e.children,s=e.disabled,o=void 0!==s&&s,l=e.width,u=void 0===l?"56px":l,c=e.height,d=void 0===c?"56px":c,h=e.type,f=void 0===h?"button":h,p=e.style,_=void 0===p?{}:p,v=e.onBlur,g=void 0===v?function(){}:v,E=e.onClick,y=void 0===E?function(){}:E,C=e.testID,T=t.useState(!1),N=T[0],S=T[1];return t.createElement("button",{"data-testid":C,className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-iconbutton",N?"sendbird-iconbutton--pressed":""],!1).join(" "),disabled:o,ref:n,type:f,style:m(m({},_),{height:d,width:u}),onClick:function(e){o||(S(!0),null==y||y(e))},onBlur:function(e){S(!1),null==g||g(e)}},t.createElement("span",{className:"sendbird-iconbutton__inner"},a))})),rO=function(e){var n=e.className,r=e.type,i=e.color,a=e.width,s=void 0===a?"22px":a,o=e.height,l=void 0===o?"22px":o,u=e.onClick,c=void 0===u?zT:u;return t.createElement(pA,{className:n,type:r,fillColor:i,width:s,height:l,onClick:function(e){return null==c?void 0:c(e)}})},iO=Object.assign((function(e){var n,r=e.className,i=e.renderLeft,a=e.renderRight,s=e.renderMiddle,o=!1;try{o=null===(n=null==$M?void 0:$M())||void 0===n?void 0:n.isMobile}catch(l){}return t.createElement("div",{className:WT("sendbird-ui-header",r),"data-testid":"sendbird-ui-header"},i?t.createElement("div",{className:WT("sendbird-ui-header__left",o?"sendbird-ui-header--is-mobile":"sendbird-ui-header--is-desktop")},null==i?void 0:i()):null,t.createElement("div",{className:"sendbird-ui-header__middle"},null==s?void 0:s()),a?t.createElement("div",{className:WT("sendbird-ui-header__right",o?"sendbird-ui-header--is-mobile":"sendbird-ui-header--is-desktop")},null==a?void 0:a()):null)}),{Title:function(e){var n=e.title,r=e.subtitle,i=e.onClickSubtitle;return t.createElement("div",{className:"sendbird-ui-header__middle"},n&&t.createElement(yN,{className:"sendbird-ui-header__middle__title",type:CN.H_2,color:TN.ONBACKGROUND_1},n),r&&(i?t.createElement(tO,{className:"sendbird-ui-header__middle__subtitle__container",onClick:i,disableUnderline:!0},t.createElement(yN,{className:"sendbird-ui-header__middle__subtitle",type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},r)):t.createElement(yN,{className:"sendbird-ui-header__middle__subtitle",type:CN.BODY_1,color:TN.ONBACKGROUND_2},r)))},IconButton:function(e){var n=e.className,r=e.onClick,i=e.type,a=e.color,s=e.width,o=void 0===s?"32px":s,l=e.height,u=void 0===l?"32px":l,c=e.renderIcon,d=void 0===c?function(e){return t.createElement(rO,m({},e))}:c;return t.createElement(nO,{className:n,width:o,height:u,onClick:r},d({type:i,color:a}))},Icon:rO}),aO=function(e){var n=e.className,r=e.currentChannel,i=e.showSearchIcon,a=e.onBackClick,s=e.onSearchClick,o=e.onChatHeaderActionClick,l=e.renderLeft,u=e.renderMiddle,c=e.renderRight,d=yT().state.config,h=d.userId,f=d.theme,p=$M().isMobile,_=HN().stringSet,v="muted"===(null==r?void 0:r.myMutedState),g=function(e,t,n){var r,i=n||NN;return(null==e?void 0:e.name)||(null==e?void 0:e.members)?YM(e)?1===(null===(r=null==e?void 0:e.members)||void 0===r?void 0:r.length)?i.NO_MEMBERS:null==e?void 0:e.members.filter((function(e){return e.userId!==t})).map((function(e){return e.nickname||i.NO_NAME})).join(", "):e.name:i.NO_TITLE}(r,h,_);return t.createElement(iO,{className:WT("sendbird-chat-header",n),renderLeft:null!=l?l:function(){return t.createElement(t.Fragment,null,p&&t.createElement(iO.Icon,{className:"sendbird-chat-header__icon_back",onClick:a,type:_A.ARROW_LEFT,color:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(qA,{theme:f,channel:r,userId:h,height:32,width:32}))},renderMiddle:null!=u?u:function(){return t.createElement(iO.Title,{title:g})},renderRight:null!=c?c:function(){return t.createElement(t.Fragment,null,v&&t.createElement(iO.Icon,{className:"sendbird-chat-header__right__mute",type:_A.NOTIFICATIONS_OFF_FILLED,color:mA.ON_BACKGROUND_2,width:"24px",height:"24px"}),i&&!(null==r?void 0:r.isEphemeral)&&t.createElement(iO.IconButton,{className:"sendbird-chat-header__right__search",onClick:s,type:_A.SEARCH,color:mA.PRIMARY,renderIcon:function(e){return t.createElement(iO.Icon,m({},e,{width:"24px",height:"24px"}))}}),t.createElement(iO.IconButton,{className:"sendbird-chat-header__right__info",onClick:o,type:_A.INFO,color:mA.PRIMARY,renderIcon:function(e){return t.createElement(iO.Icon,m({},e,{width:"24px",height:"24px"}))}}))}})},sO=function(e){var n=fN();return t.createElement(aO,m({},e,n,{currentChannel:n.currentChannel}))};function oO(e){if(XA(1,arguments),!function(e){return XA(1,arguments),e instanceof Date||"object"===QA(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!=typeof e)return!1;var t=ZA(e);return!isNaN(Number(t))}function lO(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function uO(e,t){return XA(2,arguments),function(e,t){XA(2,arguments);var n=ZA(e).getTime(),r=lO(t);return new Date(n+r)}(e,-lO(t))}function cO(e){XA(1,arguments);var t=ZA(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function dO(e){XA(1,arguments);var t=ZA(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=cO(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var s=cO(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=s.getTime()?n:n-1}function hO(e){XA(1,arguments);var t=ZA(e),n=cO(t).getTime()-function(e){XA(1,arguments);var t=dO(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),cO(n)}(t).getTime();return Math.round(n/6048e5)+1}var fO={};function pO(){return fO}function _O(e,t){var n,r,i,a,s,o,l,u;XA(1,arguments);var c=pO(),d=lO(null!==(n=null!==(r=null!==(i=null!==(a=null==t?void 0:t.weekStartsOn)&&void 0!==a?a:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==i?i:c.weekStartsOn)&&void 0!==r?r:null===(l=c.locale)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=ZA(e),f=h.getUTCDay(),p=(f<d?7:0)+f-d;return h.setUTCDate(h.getUTCDate()-p),h.setUTCHours(0,0,0,0),h}function mO(e,t){var n,r,i,a,s,o,l,u;XA(1,arguments);var c=ZA(e),d=c.getUTCFullYear(),h=pO(),f=lO(null!==(n=null!==(r=null!==(i=null!==(a=null==t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:h.firstWeekContainsDate)&&void 0!==r?r:null===(l=h.locale)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==n?n:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var p=new Date(0);p.setUTCFullYear(d+1,0,f),p.setUTCHours(0,0,0,0);var _=_O(p,t),m=new Date(0);m.setUTCFullYear(d,0,f),m.setUTCHours(0,0,0,0);var v=_O(m,t);return c.getTime()>=_.getTime()?d+1:c.getTime()>=v.getTime()?d:d-1}function vO(e,t){XA(1,arguments);var n=ZA(e),r=_O(n,t).getTime()-function(e,t){var n,r,i,a,s,o,l,u;XA(1,arguments);var c=pO(),d=lO(null!==(n=null!==(r=null!==(i=null!==(a=null==t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:c.firstWeekContainsDate)&&void 0!==r?r:null===(l=c.locale)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==n?n:1),h=mO(e,t),f=new Date(0);return f.setUTCFullYear(h,0,d),f.setUTCHours(0,0,0,0),_O(f,t)}(n,t).getTime();return Math.round(r/6048e5)+1}function gO(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var EO=function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return gO("yy"===t?r%100:r,t.length)},bO=function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):gO(n+1,2)},yO=function(e,t){return gO(e.getUTCDate(),t.length)},CO=function(e,t){return gO(e.getUTCHours()%12||12,t.length)},TO=function(e,t){return gO(e.getUTCHours(),t.length)},NO=function(e,t){return gO(e.getUTCMinutes(),t.length)},SO=function(e,t){return gO(e.getUTCSeconds(),t.length)},IO=function(e,t){var n=t.length,r=e.getUTCMilliseconds();return gO(Math.floor(r*Math.pow(10,n-3)),t.length)},wO="midnight",AO="noon",MO="morning",OO="afternoon",RO="evening",DO="night",kO={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return EO(e,t)},Y:function(e,t,n,r){var i=mO(e,r),a=i>0?i:1-i;return"YY"===t?gO(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):gO(a,t.length)},R:function(e,t){return gO(dO(e),t.length)},u:function(e,t){return gO(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return gO(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return gO(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return bO(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return gO(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=vO(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):gO(i,t.length)},I:function(e,t,n){var r=hO(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):gO(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):yO(e,t)},D:function(e,t,n){var r=function(e){XA(1,arguments);var t=ZA(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):gO(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return gO(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return gO(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return gO(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?AO:0===i?wO:i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?RO:i>=12?OO:i>=4?MO:DO,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return CO(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):TO(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):gO(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):gO(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):NO(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):SO(e,t)},S:function(e,t){return IO(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return xO(i);case"XXXX":case"XX":return UO(i);default:return UO(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return xO(i);case"xxxx":case"xx":return UO(i);default:return UO(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+LO(i,":");default:return"GMT"+UO(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+LO(i,":");default:return"GMT"+UO(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return gO(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return gO((r._originalDate||e).getTime(),t.length)}};function LO(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var s=t;return n+String(i)+s+gO(a,2)}function xO(e,t){return e%60==0?(e>0?"-":"+")+gO(Math.abs(e)/60,2):UO(e,t)}function UO(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+gO(Math.floor(i/60),2)+n+gO(i%60,2)}var PO=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},FO=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},BO={p:FO,P:function(e,t){var n,r=e.match(/(P+)(p+)?/)||[],i=r[1],a=r[2];if(!a)return PO(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",PO(i,t)).replace("{{time}}",FO(a,t))}};var HO=["D","DD"],GO=["YY","YYYY"];function jO(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var VO=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,qO=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zO=/^'([^]*?)'?$/,KO=/''/g,YO=/[a-zA-Z]/;function WO(e,t,n){var r,i,a,s,o,l,u,c,d,h,f,p,_,m,v,g,E,b;XA(2,arguments);var y=String(t),C=pO(),T=null!==(r=null!==(i=null==n?void 0:n.locale)&&void 0!==i?i:C.locale)&&void 0!==r?r:UN,N=lO(null!==(a=null!==(s=null!==(o=null!==(l=null==n?void 0:n.firstWeekContainsDate)&&void 0!==l?l:null==n||null===(u=n.locale)||void 0===u||null===(c=u.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==o?o:C.firstWeekContainsDate)&&void 0!==s?s:null===(d=C.locale)||void 0===d||null===(h=d.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==a?a:1);if(!(N>=1&&N<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var S=lO(null!==(f=null!==(p=null!==(_=null!==(m=null==n?void 0:n.weekStartsOn)&&void 0!==m?m:null==n||null===(v=n.locale)||void 0===v||null===(g=v.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==_?_:C.weekStartsOn)&&void 0!==p?p:null===(E=C.locale)||void 0===E||null===(b=E.options)||void 0===b?void 0:b.weekStartsOn)&&void 0!==f?f:0);if(!(S>=0&&S<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!T.localize)throw new RangeError("locale must contain localize property");if(!T.formatLong)throw new RangeError("locale must contain formatLong property");var I=ZA(e);if(!oO(I))throw new RangeError("Invalid time value");var w=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(I),A=uO(I,w),M={firstWeekContainsDate:N,weekStartsOn:S,locale:T,_originalDate:I};return y.match(qO).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,BO[t])(e,T.formatLong):e})).join("").match(VO).map((function(r){if("''"===r)return"'";var i=r[0];if("'"===i)return function(e){var t=e.match(zO);if(!t)return e;return t[1].replace(KO,"'")}(r);var a,s=kO[i];if(s)return null!=n&&n.useAdditionalWeekYearTokens||(a=r,-1===GO.indexOf(a))||jO(r,t,String(e)),null!=n&&n.useAdditionalDayOfYearTokens||!function(e){return-1!==HO.indexOf(e)}(r)||jO(r,t,String(e)),s(A,r,T.localize,M);if(i.match(YO))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return r})).join("")}function QO(e){if(e){var t=e.querySelectorAll("[data-sb-mention='true']");return Array.from(t)}return[]}function XO(e,n){var r=e.ref,i=n.logger,a=r.current,s=t.useState([]),o=s[0],l=s[1];return t.useLayoutEffect((function(){if(a){var e=QO(a);l(e)}}),[a]),t.useEffect((function(){var e=new MutationObserver((function(e){e.length>0&&l(QO(a))}));return a&&e.observe(a,{childList:!0,subtree:!0}),function(){try{e.disconnect()}catch(t){i.error("useDirtyGetMentions: observer disconnect failed",{observer:e})}}}),[a]),o}var ZO,JO,$O,eR,tR=function(e){var n=e.children,r=void 0===n?void 0:n,i=e.className,a=void 0===i?"":i,s=e.separatorColor,o=void 0===s?qM.ONBACKGROUND_4:s;return t.createElement("div",{className:b(b([],Array.isArray(a)?a:[a],!0),["sendbird-separator"],!1).join(" ")},t.createElement("div",{className:["sendbird-separator__left","".concat(eO(o),"--background-color")].join(" ")}),t.createElement("div",{className:"sendbird-separator__text"},r||t.createElement(yN,{type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},"Date Separator")),t.createElement("div",{className:["sendbird-separator__right","".concat(eO(o),"--background-color")].join(" ")}))},nR="Enter",rR="ArrowUp",iR="ArrowDown",aR="Backspace",sR=1,oR=3,lR="SPAN",uR="BR",cR="DIV";function dR(e){switch(e){case ZO.PRIMARY:return"sendbird-button--primary";case ZO.SECONDARY:return"sendbird-button--secondary";case ZO.DANGER:return"sendbird-button--danger";case ZO.DISABLED:return"sendbird-button--disabled";case ZO.WARNING:return"sendbird-button--warning";default:return""}}function hR(e){switch(e){case $O.BIG:return"sendbird-button--big";case $O.SMALL:return"sendbird-button--small";default:return""}}function fR(e){var n=e.className,r=e.type,i=void 0===r?ZO.PRIMARY:r,a=e.size,s=void 0===a?$O.BIG:a,o=e.children,l=void 0===o?"Button":o,u=e.disabled,c=void 0!==u&&u,d=e.onClick,h=void 0===d?function(){}:d,f=e.labelType,p=void 0===f?CN.BUTTON_1:f,_=e.labelColor,m=void 0===_?TN.ONCONTENT_1:_,v=b(b([],Array.isArray(n)?n:[n],!0),["sendbird-button",c?"sendbird-button__disabled":"",dR(i),hR(s)],!1).join(" ");return t.createElement("button",{className:v,type:"button",onClick:h,disabled:c},t.createElement(yN,{className:"sendbird-button__text",type:p,color:m},l))}
/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */(JO=ZO||(ZO={})).PRIMARY="PRIMARY",JO.SECONDARY="SECONDARY",JO.DANGER="DANGER",JO.DISABLED="DISABLED",JO.WARNING="WARNING",(eR=$O||($O={})).BIG="BIG",eR.SMALL="SMALL";const{entries:pR,setPrototypeOf:_R,isFrozen:mR,getPrototypeOf:vR,getOwnPropertyDescriptor:gR}=Object;let{freeze:ER,seal:bR,create:yR}=Object,{apply:CR,construct:TR}="undefined"!=typeof Reflect&&Reflect;ER||(ER=function(e){return e}),bR||(bR=function(e){return e}),CR||(CR=function(e,t,n){return e.apply(t,n)}),TR||(TR=function(e,t){return new e(...t)});const NR=BR(Array.prototype.forEach),SR=BR(Array.prototype.lastIndexOf),IR=BR(Array.prototype.pop),wR=BR(Array.prototype.push),AR=BR(Array.prototype.splice),MR=BR(String.prototype.toLowerCase),OR=BR(String.prototype.toString),RR=BR(String.prototype.match),DR=BR(String.prototype.replace),kR=BR(String.prototype.indexOf),LR=BR(String.prototype.trim),xR=BR(Object.prototype.hasOwnProperty),UR=BR(RegExp.prototype.test),PR=(FR=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return TR(FR,t)});var FR;function BR(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return CR(e,t,r)}}function HR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MR;_R&&_R(e,null);let r=t.length;for(;r--;){let i=t[r];if("string"==typeof i){const e=n(i);e!==i&&(mR(t)||(t[r]=e),i=e)}e[i]=!0}return e}function GR(e){for(let t=0;t<e.length;t++){xR(e,t)||(e[t]=null)}return e}function jR(e){const t=yR(null);for(const[n,r]of pR(e)){xR(e,n)&&(Array.isArray(r)?t[n]=GR(r):r&&"object"==typeof r&&r.constructor===Object?t[n]=jR(r):t[n]=r)}return t}function VR(e,t){for(;null!==e;){const n=gR(e,t);if(n){if(n.get)return BR(n.get);if("function"==typeof n.value)return BR(n.value)}e=vR(e)}return function(){return null}}const qR=ER(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),zR=ER(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),KR=ER(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),YR=ER(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),WR=ER(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),QR=ER(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),XR=ER(["#text"]),ZR=ER(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),JR=ER(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$R=ER(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),eD=ER(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),tD=bR(/\{\{[\w\W]*|[\w\W]*\}\}/gm),nD=bR(/<%[\w\W]*|[\w\W]*%>/gm),rD=bR(/\$\{[\w\W]*/gm),iD=bR(/^data-[\-\w.\u00B7-\uFFFF]+$/),aD=bR(/^aria-[\-\w]+$/),sD=bR(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),oD=bR(/^(?:\w+script|data):/i),lD=bR(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),uD=bR(/^html$/i),cD=bR(/^[a-z][.\w]*(-[.\w]+)+$/i);var dD=Object.freeze({__proto__:null,ARIA_ATTR:aD,ATTR_WHITESPACE:lD,CUSTOM_ELEMENT:cD,DATA_ATTR:iD,DOCTYPE_NAME:uD,ERB_EXPR:nD,IS_ALLOWED_URI:sD,IS_SCRIPT_OR_DATA:oD,MUSTACHE_EXPR:tD,TMPLIT_EXPR:rD});const hD=1,fD=3,pD=7,_D=8,mD=9;var vD=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const n=t=>e(t);if(n.version="3.2.4",n.removed=[],!t||!t.document||t.document.nodeType!==mD||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const i=r,a=i.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:l,Element:u,NodeFilter:c,NamedNodeMap:d=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:p}=t,_=u.prototype,m=VR(_,"cloneNode"),v=VR(_,"remove"),g=VR(_,"nextSibling"),E=VR(_,"childNodes"),b=VR(_,"parentNode");if("function"==typeof o){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let y,C="";const{implementation:T,createNodeIterator:N,createDocumentFragment:S,getElementsByTagName:I}=r,{importNode:w}=i;let A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof pR&&"function"==typeof b&&T&&void 0!==T.createHTMLDocument;const{MUSTACHE_EXPR:M,ERB_EXPR:O,TMPLIT_EXPR:R,DATA_ATTR:D,ARIA_ATTR:k,IS_SCRIPT_OR_DATA:L,ATTR_WHITESPACE:x,CUSTOM_ELEMENT:U}=dD;let{IS_ALLOWED_URI:P}=dD,F=null;const B=HR({},[...qR,...zR,...KR,...WR,...XR]);let H=null;const G=HR({},[...ZR,...JR,...$R,...eD]);let j=Object.seal(yR(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),V=null,q=null,z=!0,K=!0,Y=!1,W=!0,Q=!1,X=!0,Z=!1,J=!1,$=!1,ee=!1,te=!1,ne=!1,re=!0,ie=!1,ae=!0,se=!1,oe={},le=null;const ue=HR({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ce=null;const de=HR({},["audio","video","img","source","image","track"]);let he=null;const fe=HR({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pe="http://www.w3.org/1998/Math/MathML",_e="http://www.w3.org/2000/svg",me="http://www.w3.org/1999/xhtml";let ve=me,ge=!1,Ee=null;const be=HR({},[pe,_e,me],OR);let ye=HR({},["mi","mo","mn","ms","mtext"]),Ce=HR({},["annotation-xml"]);const Te=HR({},["title","style","font","a","script"]);let Ne=null;const Se=["application/xhtml+xml","text/html"];let Ie=null,we=null;const Ae=r.createElement("form"),Me=function(e){return e instanceof RegExp||e instanceof Function},Oe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!we||we!==e){if(e&&"object"==typeof e||(e={}),e=jR(e),Ne=-1===Se.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ie="application/xhtml+xml"===Ne?OR:MR,F=xR(e,"ALLOWED_TAGS")?HR({},e.ALLOWED_TAGS,Ie):B,H=xR(e,"ALLOWED_ATTR")?HR({},e.ALLOWED_ATTR,Ie):G,Ee=xR(e,"ALLOWED_NAMESPACES")?HR({},e.ALLOWED_NAMESPACES,OR):be,he=xR(e,"ADD_URI_SAFE_ATTR")?HR(jR(fe),e.ADD_URI_SAFE_ATTR,Ie):fe,ce=xR(e,"ADD_DATA_URI_TAGS")?HR(jR(de),e.ADD_DATA_URI_TAGS,Ie):de,le=xR(e,"FORBID_CONTENTS")?HR({},e.FORBID_CONTENTS,Ie):ue,V=xR(e,"FORBID_TAGS")?HR({},e.FORBID_TAGS,Ie):{},q=xR(e,"FORBID_ATTR")?HR({},e.FORBID_ATTR,Ie):{},oe=!!xR(e,"USE_PROFILES")&&e.USE_PROFILES,z=!1!==e.ALLOW_ARIA_ATTR,K=!1!==e.ALLOW_DATA_ATTR,Y=e.ALLOW_UNKNOWN_PROTOCOLS||!1,W=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Q=e.SAFE_FOR_TEMPLATES||!1,X=!1!==e.SAFE_FOR_XML,Z=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_TRUSTED_TYPE||!1,$=e.FORCE_BODY||!1,re=!1!==e.SANITIZE_DOM,ie=e.SANITIZE_NAMED_PROPS||!1,ae=!1!==e.KEEP_CONTENT,se=e.IN_PLACE||!1,P=e.ALLOWED_URI_REGEXP||sD,ve=e.NAMESPACE||me,ye=e.MATHML_TEXT_INTEGRATION_POINTS||ye,Ce=e.HTML_INTEGRATION_POINTS||Ce,j=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Me(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(j.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Me(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(j.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(j.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Q&&(K=!1),te&&(ee=!0),oe&&(F=HR({},XR),H=[],!0===oe.html&&(HR(F,qR),HR(H,ZR)),!0===oe.svg&&(HR(F,zR),HR(H,JR),HR(H,eD)),!0===oe.svgFilters&&(HR(F,KR),HR(H,JR),HR(H,eD)),!0===oe.mathMl&&(HR(F,WR),HR(H,$R),HR(H,eD))),e.ADD_TAGS&&(F===B&&(F=jR(F)),HR(F,e.ADD_TAGS,Ie)),e.ADD_ATTR&&(H===G&&(H=jR(H)),HR(H,e.ADD_ATTR,Ie)),e.ADD_URI_SAFE_ATTR&&HR(he,e.ADD_URI_SAFE_ATTR,Ie),e.FORBID_CONTENTS&&(le===ue&&(le=jR(le)),HR(le,e.FORBID_CONTENTS,Ie)),ae&&(F["#text"]=!0),Z&&HR(F,["html","head","body"]),F.table&&(HR(F,["tbody"]),delete V.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw PR('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw PR('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=e.TRUSTED_TYPES_POLICY,C=y.createHTML("")}else void 0===y&&(y=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(a){return null}}(p,a)),null!==y&&"string"==typeof C&&(C=y.createHTML(""));ER&&ER(e),we=e}},Re=HR({},[...zR,...KR,...YR]),De=HR({},[...WR,...QR]),ke=function(e){wR(n.removed,{element:e});try{b(e).removeChild(e)}catch(t){v(e)}},Le=function(e,t){try{wR(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(r){wR(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{ke(t)}catch(r){}else try{t.setAttribute(e,"")}catch(r){}},xe=function(e){let t=null,n=null;if($)e="<remove></remove>"+e;else{const t=RR(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===Ne&&ve===me&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=y?y.createHTML(e):e;if(ve===me)try{t=(new f).parseFromString(i,Ne)}catch(s){}if(!t||!t.documentElement){t=T.createDocument(ve,"template",null);try{t.documentElement.innerHTML=ge?C:i}catch(s){}}const a=t.body||t.documentElement;return e&&n&&a.insertBefore(r.createTextNode(n),a.childNodes[0]||null),ve===me?I.call(t,Z?"html":"body")[0]:Z?t.documentElement:a},Ue=function(e){return N.call(e.ownerDocument||e,e,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Pe=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof d)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Fe=function(e){return"function"==typeof l&&e instanceof l};function Be(e,t,r){NR(e,(e=>{e.call(n,t,r,we)}))}const He=function(e){let t=null;if(Be(A.beforeSanitizeElements,e,null),Pe(e))return ke(e),!0;const r=Ie(e.nodeName);if(Be(A.uponSanitizeElement,e,{tagName:r,allowedTags:F}),e.hasChildNodes()&&!Fe(e.firstElementChild)&&UR(/<[/\w]/g,e.innerHTML)&&UR(/<[/\w]/g,e.textContent))return ke(e),!0;if(e.nodeType===pD)return ke(e),!0;if(X&&e.nodeType===_D&&UR(/<[/\w]/g,e.data))return ke(e),!0;if(!F[r]||V[r]){if(!V[r]&&je(r)){if(j.tagNameCheck instanceof RegExp&&UR(j.tagNameCheck,r))return!1;if(j.tagNameCheck instanceof Function&&j.tagNameCheck(r))return!1}if(ae&&!le[r]){const t=b(e)||e.parentNode,n=E(e)||e.childNodes;if(n&&t){for(let r=n.length-1;r>=0;--r){const i=m(n[r],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,g(e))}}}return ke(e),!0}return e instanceof u&&!function(e){let t=b(e);t&&t.tagName||(t={namespaceURI:ve,tagName:"template"});const n=MR(e.tagName),r=MR(t.tagName);return!!Ee[e.namespaceURI]&&(e.namespaceURI===_e?t.namespaceURI===me?"svg"===n:t.namespaceURI===pe?"svg"===n&&("annotation-xml"===r||ye[r]):Boolean(Re[n]):e.namespaceURI===pe?t.namespaceURI===me?"math"===n:t.namespaceURI===_e?"math"===n&&Ce[r]:Boolean(De[n]):e.namespaceURI===me?!(t.namespaceURI===_e&&!Ce[r])&&!(t.namespaceURI===pe&&!ye[r])&&!De[n]&&(Te[n]||!Re[n]):!("application/xhtml+xml"!==Ne||!Ee[e.namespaceURI]))}(e)?(ke(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!UR(/<\/no(script|embed|frames)/i,e.innerHTML)?(Q&&e.nodeType===fD&&(t=e.textContent,NR([M,O,R],(e=>{t=DR(t,e," ")})),e.textContent!==t&&(wR(n.removed,{element:e.cloneNode()}),e.textContent=t)),Be(A.afterSanitizeElements,e,null),!1):(ke(e),!0)},Ge=function(e,t,n){if(re&&("id"===t||"name"===t)&&(n in r||n in Ae))return!1;if(K&&!q[t]&&UR(D,t));else if(z&&UR(k,t));else if(!H[t]||q[t]){if(!(je(e)&&(j.tagNameCheck instanceof RegExp&&UR(j.tagNameCheck,e)||j.tagNameCheck instanceof Function&&j.tagNameCheck(e))&&(j.attributeNameCheck instanceof RegExp&&UR(j.attributeNameCheck,t)||j.attributeNameCheck instanceof Function&&j.attributeNameCheck(t))||"is"===t&&j.allowCustomizedBuiltInElements&&(j.tagNameCheck instanceof RegExp&&UR(j.tagNameCheck,n)||j.tagNameCheck instanceof Function&&j.tagNameCheck(n))))return!1}else if(he[t]);else if(UR(P,DR(n,x,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==kR(n,"data:")||!ce[e]){if(Y&&!UR(L,DR(n,x,"")));else if(n)return!1}else;return!0},je=function(e){return"annotation-xml"!==e&&RR(e,U)},Ve=function(e){Be(A.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Pe(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let i=t.length;for(;i--;){const s=t[i],{name:o,namespaceURI:l,value:u}=s,c=Ie(o);let d="value"===o?u:LR(u);if(r.attrName=c,r.attrValue=d,r.keepAttr=!0,r.forceKeepAttr=void 0,Be(A.uponSanitizeAttribute,e,r),d=r.attrValue,!ie||"id"!==c&&"name"!==c||(Le(o,e),d="user-content-"+d),X&&UR(/((--!?|])>)|<\/(style|title)/i,d)){Le(o,e);continue}if(r.forceKeepAttr)continue;if(Le(o,e),!r.keepAttr)continue;if(!W&&UR(/\/>/i,d)){Le(o,e);continue}Q&&NR([M,O,R],(e=>{d=DR(d,e," ")}));const h=Ie(e.nodeName);if(Ge(h,c,d)){if(y&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(l);else switch(p.getAttributeType(h,c)){case"TrustedHTML":d=y.createHTML(d);break;case"TrustedScriptURL":d=y.createScriptURL(d)}try{l?e.setAttributeNS(l,o,d):e.setAttribute(o,d),Pe(e)?ke(e):IR(n.removed)}catch(a){}}}Be(A.afterSanitizeAttributes,e,null)},qe=function e(t){let n=null;const r=Ue(t);for(Be(A.beforeSanitizeShadowDOM,t,null);n=r.nextNode();)Be(A.uponSanitizeShadowNode,n,null),He(n),Ve(n),n.content instanceof s&&e(n.content);Be(A.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,a=null,o=null,u=null;if(ge=!e,ge&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Fe(e)){if("function"!=typeof e.toString)throw PR("toString is not a function");if("string"!=typeof(e=e.toString()))throw PR("dirty is not a string, aborting")}if(!n.isSupported)return e;if(J||Oe(t),n.removed=[],"string"==typeof e&&(se=!1),se){if(e.nodeName){const t=Ie(e.nodeName);if(!F[t]||V[t])throw PR("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)r=xe("\x3c!----\x3e"),a=r.ownerDocument.importNode(e,!0),a.nodeType===hD&&"BODY"===a.nodeName||"HTML"===a.nodeName?r=a:r.appendChild(a);else{if(!ee&&!Q&&!Z&&-1===e.indexOf("<"))return y&&ne?y.createHTML(e):e;if(r=xe(e),!r)return ee?null:ne?C:""}r&&$&&ke(r.firstChild);const c=Ue(se?e:r);for(;o=c.nextNode();)He(o),Ve(o),o.content instanceof s&&qe(o.content);if(se)return e;if(ee){if(te)for(u=S.call(r.ownerDocument);r.firstChild;)u.appendChild(r.firstChild);else u=r;return(H.shadowroot||H.shadowrootmode)&&(u=w.call(i,u,!0)),u}let d=Z?r.outerHTML:r.innerHTML;return Z&&F["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&UR(uD,r.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+d),Q&&NR([M,O,R],(e=>{d=DR(d,e," ")})),y&&ne?y.createHTML(d):d},n.setConfig=function(){Oe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),J=!0},n.clearConfig=function(){we=null,J=!1},n.isValidAttribute=function(e,t,n){we||Oe({});const r=Ie(e),i=Ie(t);return Ge(r,i,n)},n.addHook=function(e,t){"function"==typeof t&&wR(A[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=SR(A[e],t);return-1===n?void 0:AR(A[e],n,1)[0]}return IR(A[e])},n.removeHooks=function(e){A[e]=[]},n.removeAllHooks=function(){A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}(),gD="sendbird-mention-user-label",ED="sendbird-text-message-item-body",bD="sendbird-og-message-item-body__text-bubble";function yD(e){var t=e.userId,n=e.nickname,r='<span data-userid="'.concat(t,'" data-sb-mention="true" class="').concat(gD,'">').concat(n,"</span>"),i=vD(window).sanitize(r).split(" ");return b([i[0],'contenteditable="false"'],i.slice(1),!0).join(" ")}var CD=function(e){return void 0===e&&(e=""),e?e.replace(/[<>]/g,(function(e){return"<"===e?"&#60;":"&#62;"})):""},TD=function(e){return e?Array.from(e):[]};function ND(e){var t;return e&&(null===(t=e.isGroupChannel)||void 0===t?void 0:t.call(e))&&!e.isBroadcast&&!e.isSuper}function SD(e){return e.nodeType===sR}function ID(e){var t="",n="";return e.forEach((function(e){if(SD(e)&&e.nodeName===lR){var r=e.innerText,i=e.dataset,a=(void 0===i?{}:i).userid,s=void 0===a?"":a;t+=r,n+="".concat(IT,"{").concat(s,"}")}else if(SD(e)&&e.nodeName===uR)t+="\n",n+="\n";else if(SD(e)&&e.nodeName===cR){var o=e.textContent;t+="\n".concat(l=void 0===o?"":o),n+="\n".concat(l)}else{var l,u=e.textContent;t+=l=void 0===u?"":u,n+=l}})),{messageText:t,mentionTemplate:n}}var wD="sendbird-word__mention",AD="sendbird-mention-user-label",MD=".".concat(wD,", .").concat(AD);function OD(e,t){return b([e],Array.from(e.querySelectorAll(t)),!0).find((function(e){return e.matches(t)}))}function RD(e){var t=window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(t.rangeCount-1);n.deleteContents();var r=document.createTextNode(e+"");n.insertNode(r),n.setStart(r,r.length),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}}function DD(e){var n=e.ref,r=e.setIsInput,i=e.channel,a=e.setMentionedUsers;return t.useCallback((function(e){e.preventDefault();var t=e.clipboardData.getData("text/html"),n=e.clipboardData.getData("text")||function(e){var t=e.clipboardData.getData("text/uri-list");return 0===t.length?"":t.split("\n").reduce((function(e,t){var n=t.trim();return""===n||n.startsWith("#")||(e+=n+"\n"),e}),"")}(e);if(!t)return RD(CD(n)),void r(!0);var s,o=function(e){var t=document.createElement("div");return t.innerHTML=e,t}(vD(window).sanitize(t));if(!(null==(s=o)?void 0:s.querySelector(MD)))return RD(CD(n)),o.remove(),void r(!0);var l,u,c=function(e){var t=OD(e,".".concat(bD));if(t)return TD(t.childNodes);var n=OD(e,".".concat(ED));return TD(n?n.childNodes:e.childNodes)}(o),d=null==(l=c)?void 0:l.reduce((function(e,t){var n,r,i,a=null==t?void 0:t.innerText;if(t instanceof Text&&(i=!1,a=null!==(n=t.textContent)&&void 0!==n?n:""),t instanceof HTMLElement&&(i=t.classList.contains(wD)||t.classList.contains(AD)?t:t.querySelector(MD)),i){var s=null==t?void 0:t.innerText,o=null===(r=i.dataset)||void 0===r?void 0:r.userid;return b(b([],e,!0),[{text:s,userId:o}],!1)}return b(b([],e,!0),[{text:a}],!1)}),[]),h=i.isGroupChannel()?function(e,t){var n={},r=t.members;return e.forEach((function(e){if(e.userId){var t=r.find((function(t){return t.userId===e.userId}));t&&(n[e.userId]=t)}})),Object.values(n)}(d,i):[];a(h),u=d.map((function(e){var t=e.text,n=e.userId;return n?yD({userId:n,nickname:t}):CD(t)})).join(" ").concat(" "),document.execCommand("insertHTML",!1,u),o.remove(),r(!0)}),[n,r,i,a])}var kD,LD,xD="@",UD="string",PD="mention",FD="url",BD="undetermined",HD="markdown",GD=/\[(.*?)\]\((.*?)\)|\*\*(.*?)\*\*/g;function jD(e){var t=e.tokens,n=e.mentionedUsers,r=void 0===n?[]:n,i=e.templatePrefix,a=void 0===i?xD:i;if(!(null==r?void 0:r.length))return t;var s=function(e,t){var n=t||xD;return RegExp("(".concat(e.map((function(e){var t=e.userId.replace(/([.*+?^${}()|[\]\\])/g,"\\$1");return"".concat(n,"\\{").concat(t,"\\}")})).join("|"),")"),"g")}(r,a);return t.map((function(e){return e.type!==BD?e:e.value.split(s).map((function(e){if(e.match(s)){var t=r.find((function(t){return"@{".concat(null==t?void 0:t.userId,"}")===e}));return{value:(null==t?void 0:t.nickname)||"(No name)",type:PD,userId:null==t?void 0:t.userId}}return{value:e,type:BD}}))})).flat()}function VD(e){var t=[];return e.forEach((function(e){if(e.type!==PD&&e.type!==HD){var n=e.value,r=Array.from(n.matchAll(GD)).map((function(e){var t,n=e[0],r=null!==(t=e.index)&&void 0!==t?t:0;return{text:n,start:r,end:r+n.length,groups:e.filter((function(e){return"string"==typeof e}))}})),i=n,a=0;if(r.forEach((function(e){var r,s=e.text,o=e.start,l=e.end,u=e.groups,c={type:BD,value:i.slice(0,o-a)};t.push(c),s.startsWith("[")?r="url":s.startsWith("**")&&(r="bold");var d={type:HD,markdownType:r,value:s,groups:u};t.push(d),i=n.slice(l),a=l})),i){var s={type:BD,value:i};t.push(s)}}else t.push(e)})),t}function qD(e){return e.reduce((function(e,t){var n=e[e.length-1];return(null==n?void 0:n.type)===UD&&t.type===UD?(n.value="".concat(n.value).concat(t.value),e):b(b([],e,!0),[t],!1)}),[])}function zD(e){var t,n,r=e.messageText,i=e.mentionedUsers,a=void 0===i?[]:i,s=e.templatePrefix,o=void 0===s?xD:s,l=e.includeMarkdown,u=void 0!==l&&l,c=jD({tokens:[{type:BD,value:r}],mentionedUsers:a,templatePrefix:o}),d=(t=u?VD(c):c,n=/(?:https?:\/\/|www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.(xn--)?[a-z]{2,20}\b([-a-zA-Z0-9@:%_+[\],.~#?&/=]*[-a-zA-Z0-9@:%_+~#?&/=])*/g,t.map((function(e){if(e.type!==BD)return e;var t=e.value,r=void 0===t?"":t,i=Array.from(r.matchAll(n)).map((function(e){var t,n=e[0],r=null!==(t=e.index)&&void 0!==t?t:0;return{text:n,start:r,end:r+n.length}})),a=[{value:r,type:UD}],s=0;return i.forEach((function(e){var t=e.text,n=e.start,r=e.end,i=a.pop().value,o=i.slice(0,n-s),l=t,u=i.slice(r-s);o.length>0&&a.push({value:o,type:UD}),a.push({value:l,type:FD}),u.length>0&&a.push({value:u,type:UD}),s=r})),a})).flat());return qD(d)}function KD(e){return YD(VD([{type:BD,value:e}]))}function YD(e){return e.map((function(e){return e.type===HD?YD(WD({messageText:e.groups[1]})):e.value})).join("")}function WD(e){var t=e.messageText;return qD(VD([{type:BD,value:t}]))}(LD=kD||(kD={})).BASE="base",LD.GROUP="group",LD.OPEN="open";var QD=function(){return null},XD=function(e){e&&e.current&&(e.current.innerHTML="")},ZD={targetString:"",startNodeIndex:null,startOffsetIndex:null,endNodeIndex:null,endOffsetIndex:null},JD=t.forwardRef((function(e,n){var r,i,a,s,o,l=e.channel,u=e.className,c=void 0===u?"":u,d=e.messageFieldId,h=void 0===d?"":d,f=e.isEdit,p=void 0!==f&&f,_=e.isMobile,v=void 0!==_&&_,g=e.isMentionEnabled,E=void 0!==g&&g,y=e.isVoiceMessageEnabled,C=void 0===y||y,T=e.isSelectingMultipleFilesEnabled,N=void 0!==T&&T,S=e.disabled,I=void 0!==S&&S,w=e.message,A=void 0===w?null:w,M=e.placeholder,O=void 0===M?"":M,R=e.maxLength,D=void 0===R?5e3:R,k=e.onFileUpload,L=void 0===k?QD:k,x=e.onSendMessage,U=void 0===x?QD:x,P=e.onUpdateMessage,F=void 0===P?QD:P,B=e.onCancelEdit,H=void 0===B?QD:B,G=e.onStartTyping,j=void 0===G?QD:G,V=e.channelUrl,q=void 0===V?"":V,z=e.mentionSelectedUser,K=void 0===z?null:z,Y=e.onUserMentioned,W=void 0===Y?QD:Y,Q=e.onMentionStringChange,X=void 0===Q?QD:Q,Z=e.onMentionedUserIdsUpdated,J=void 0===Z?QD:Z,$=e.onVoiceMessageIconClick,ee=void 0===$?QD:$,te=e.onKeyUp,ne=void 0===te?QD:te,re=e.onKeyDown,ie=void 0===re?QD:re,ae=e.renderFileUploadIcon,se=void 0===ae?QD:ae,oe=e.renderVoiceMessageIcon,le=void 0===oe?QD:oe,ue=e.renderSendMessageIcon,ce=void 0===ue?QD:ue,de=e.setMentionedUsers,he=void 0===de?QD:de,fe=e.acceptableMimeTypes,pe=n&&"current"in n?n:t.useRef(null),_e=t.useRef(null),me=h||"sendbird-message-input-text-field",ve=HN().stringSet,ge=yT().state,Ee=ge.config,be=ge.eventHandlers,ye=function(e){var t=e.channel,n=e.config;return tN(null==t?void 0:t.channelType).with(kD.GROUP,(function(){var e;return null===(e=null==n?void 0:n.groupChannel)||void 0===e?void 0:e.enableDocument})).with(kD.OPEN,(function(){var e;return null===(e=null==n?void 0:n.openChannel)||void 0===e?void 0:e.enableDocument})).otherwise((function(){return!0}))}({channel:l,config:Ee}),Ce=t.useRef(),Te=t.useState(!1),Ne=Te[0],Se=Te[1],Ie=t.useState([]),we=Ie[0],Ae=Ie[1],Me=t.useState(m({},ZD)),Oe=Me[0],Re=Me[1],De=null==e?void 0:e.value;t.useEffect((function(){var e=null==pe?void 0:pe.current;Ae([]),Se(!!(null==e?void 0:e.textContent)&&e.textContent.trim().length>0)}),[De]),t.useEffect((function(){p||(Se(!1),XD(pe))}),[q]),t.useEffect((function(){var e,t;if(p&&(null==A?void 0:A.messageId)){var n=null==pe?void 0:pe.current;if(E&&(null==A?void 0:A.mentionedUsers)&&A.mentionedUsers.length>0&&(null==A?void 0:A.mentionedMessageTemplate)&&A.mentionedMessageTemplate.length>0){var r=A.mentionedUsers,i=void 0===r?[]:r,a=zD({messageText:null==A?void 0:A.mentionedMessageTemplate,mentionedUsers:i,includeMarkdown:l.isGroupChannel()&&Ee.groupChannel.enableMarkdownForUserMessage});n&&(n.innerHTML=a.map((function(e){if(e.type===PD){var t=i.find((function(t){return t.userId===e.userId})),n="".concat(xD).concat((null==t?void 0:t.nickname)||e.value||ve.MENTION_NAME__NO_NAME);return yD({userId:e.userId,nickname:n})}return CD(e.value)})).join(""))}else{try{n&&(n.innerHTML=null!==(e=CD(null==A?void 0:A.message))&&void 0!==e?e:"")}catch(s){}Ae([])}Se(!!(null==n?void 0:n.textContent)&&(null===(t=null==n?void 0:n.textContent)||void 0===t?void 0:t.trim().length)>0)}}),[p,A]);var ke=t.useCallback((function(){var e,t=null==pe?void 0:pe.current;if(E&&t){var n=Array.from(t.getElementsByClassName("sendbird-mention-user-label")).map((function(e){var t;return null===(t=null==e?void 0:e.dataset)||void 0===t?void 0:t.userid}));(function(e,t){if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1})(we,n)&&0!==n.length||(J(n),Ae(n))}Se(!!(null==t?void 0:t.textContent)&&(null===(e=t.textContent)||void 0===e?void 0:e.trim().length)>0)}),[Oe,E]);t.useEffect((function(){var e,t,n,r;if(E&&K){var i=Oe.targetString,a=Oe.startNodeIndex,s=Oe.startOffsetIndex,o=Oe.endNodeIndex,l=Oe.endOffsetIndex,u=null==pe?void 0:pe.current;if(i&&null!==a&&null!==s&&null!==l&&null!==o&&u){var c=TD(null==u?void 0:u.childNodes),d=null!==(t=null===(e=c[a])||void 0===e?void 0:e.textContent)&&void 0!==t?t:"",h=document.createTextNode(d.slice(0,s)),f=null!==(r=null===(n=c[o])||void 0===n?void 0:n.textContent)&&void 0!==r?r:"",p=l&&document.createTextNode("".concat(f.slice(l))),_=yD({userId:null==K?void 0:K.userId,nickname:"".concat(IT).concat((null==K?void 0:K.nickname)||ve.MENTION_NAME__NO_NAME)}),v=document.createElement("div");v.innerHTML=_;var g=b(b(b([],c.slice(0,a),!0),[h,v.childNodes[0],p],!1),c.slice(o+1),!0);if(u&&(u.innerHTML="",g.forEach((function(e){e&&u.appendChild(e)}))),W(K),window.getSelection||document.getSelection){var y=window.getSelection()||document.getSelection();null==y||y.removeAllRanges();var C=new Range;C.selectNodeContents(u),C.setStart(u.childNodes[a+2],1),C.setEnd(u.childNodes[a+2],1),C.collapse(!1),null==y||y.addRange(C),u.focus()}Re(m({},ZD)),ke()}}}),[K,E]);var Le=t.useCallback((function(){var e,t,n=(null===(e=null===window||void 0===window?void 0:window.getSelection)||void 0===e?void 0:e.call(window))||(null===(t=null===document||void 0===document?void 0:document.getSelection)||void 0===t?void 0:t.call(document)),r=null==pe?void 0:pe.current;if((null==n?void 0:n.anchorNode)===r&&X(""),E&&r&&n&&n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset)for(var i="",a=null,s=null,o=function(e){var t,o=r.childNodes[e];if(o.nodeType===oR){var l=o===n.anchorNode?(null==o?void 0:o.textContent)?null==o?void 0:o.textContent.slice(0,n.anchorOffset):"":null!==(t=null==o?void 0:o.textContent)&&void 0!==t?t:"";if(i.length>0)i+=l;else{for(var u=l.lastIndexOf(IT),c=u-1;c>-1&&l[c]===IT;c-=1)u=c;u>-1&&(i=l,a=e,s=u)}}else i="",a=null,s=null;if(o===n.anchorNode){var d=i&&null!==s?i.slice(s):"";return Re({targetString:d,startNodeIndex:a,startOffsetIndex:s,endNodeIndex:e,endOffsetIndex:n.anchorOffset}),X(d),{value:void 0}}},l=0;l<r.childNodes.length;l+=1){var u=o(l);if("object"==typeof u)return u.value}}),[E]),xe=function(){var e,t;try{var n=null==pe?void 0:pe.current;if(!p&&(null==n?void 0:n.textContent)){var r=ID(n.childNodes),i=r.messageText,a=r.mentionTemplate;U({message:i,mentionTemplate:a}),XD(pe),WA(navigator.userAgent)?(_e.current&&_e.current.focus(),requestAnimationFrame((function(){return n.focus()}))):n.focus(),Se(!1)}}catch(s){null===(t=null===(e=null==be?void 0:be.message)||void 0===e?void 0:e.onSendMessageFailed)||void 0===t||t.call(e,A,s)}},Ue=!(null===(i=null===(r=null==pe?void 0:pe.current)||void 0===r?void 0:r.textContent)||void 0===i?void 0:i.trim()),Pe=DD({ref:pe,setMentionedUsers:he,channel:l,setIsInput:Se}),Fe=function(){var e,t=pe,n=window.getSelection();if(n&&0!==n.rangeCount){var r=n.getRangeAt(n.rangeCount-1).getBoundingClientRect(),i=null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect();if(i&&t.current)if(r.bottom>i.bottom){var a=Math.min(r.bottom-i.bottom,t.current.scrollHeight-t.current.clientHeight);t.current.scrollTop+=a}else if(r.top<i.top){a=Math.min(i.top-r.top,t.current.scrollTop);t.current.scrollTop-=a}}};return t.createElement("form",{className:WT.apply(void 0,b(b([],Array.isArray(c)?c:[c],!1),[p&&"sendbird-message-input__edit",I&&"sendbird-message-input-form__disabled"],!1))},t.createElement("div",{className:WT("sendbird-message-input",I&&"sendbird-message-input__disabled"),"data-testid":"sendbird-message-input"},WA(navigator.userAgent)&&t.createElement("input",{id:"ghost-input-reset-ime-cjk",ref:_e,style:{opacity:0,padding:0,margin:0,height:0,border:"none",position:"absolute",top:-9999},defaultValue:"_"}),t.createElement("div",{id:"".concat(me).concat(p?null==A?void 0:A.messageId:""),className:"sendbird-message-input--textarea ".concat(me),contentEditable:!I,role:"textbox","aria-label":"Text Input",ref:pe,disabled:I,maxLength:D,onKeyDown:function(e){var t,n,r,i;ie(e)?e.preventDefault():(!e.shiftKey&&e.key===nR&&!v&&(null===(t=null==pe?void 0:pe.current)||void 0===t?void 0:t.textContent)&&pe.current.textContent.trim().length>0&&!0!==(null===(n=null==e?void 0:e.nativeEvent)||void 0===n?void 0:n.isComposing)&&(e.preventDefault(),xe()),e.key!==aR||2!==(null===(i=null===(r=null==pe?void 0:pe.current)||void 0===r?void 0:r.childNodes)||void 0===i?void 0:i.length)||pe.current.childNodes[0].textContent||pe.current.childNodes[1].nodeType!==sR||pe.current.removeChild(pe.current.childNodes[1]))},onKeyUp:function(e){ne(e)?e.preventDefault():Le()},onClick:function(){Le()},onInput:function(){var e;j(),Se(!!(null===(e=null==pe?void 0:pe.current)||void 0===e?void 0:e.textContent)&&pe.current.textContent.trim().length>0),ke()},onPaste:function(e){Pe(e),setTimeout(Fe)}}),0===(null!==(o=null===(s=null===(a=null==pe?void 0:pe.current)||void 0===a?void 0:a.textContent)||void 0===s?void 0:s.length)&&void 0!==o?o:0)&&t.createElement(yN,{className:"sendbird-message-input--placeholder",type:CN.BODY_1,color:I?TN.ONBACKGROUND_4:TN.ONBACKGROUND_3},O||ve.MESSAGE_INPUT__PLACE_HOLDER),!p&&Ne&&t.createElement(nO,{className:"sendbird-message-input--send",height:"32px",width:"32px",onClick:function(){return xe()},testID:"sendbird-message-input-send-button"},(null==ce?void 0:ce())||t.createElement(pA,{type:_A.SEND,fillColor:I?mA.ON_BACKGROUND_4:mA.PRIMARY,width:"20px",height:"20px"})),!p&&!Ne&&((null==se?void 0:se())||ye&&t.createElement(nO,{className:WT("sendbird-message-input--attach",C&&"is-voice-message-enabled"),height:"32px",width:"32px",onClick:function(){var e,t;null===(t=null===(e=null==Ce?void 0:Ce.current)||void 0===e?void 0:e.click)||void 0===t||t.call(e)}},t.createElement(pA,{type:_A.ATTACH,fillColor:I?mA.ON_BACKGROUND_4:mA.CONTENT_INVERSE,width:"20px",height:"20px"}),t.createElement("input",{className:"sendbird-message-input--attach-input",type:"file",ref:Ce,onChange:function(e){return function(e){var t,n,r=e.currentTarget.files;try{r&&L(Array.from(r))}catch(i){null===(n=null===(t=null==be?void 0:be.message)||void 0===t?void 0:t.onFileUploadFailed)||void 0===n||n.call(t,i)}finally{e.target.value=""}}(e)},accept:eM(fe),multiple:N&&ND(l)}))),C&&!p&&!Ne&&t.createElement(nO,{className:"sendbird-message-input--voice-message",width:"32px",height:"32px",onClick:ee},(null==le?void 0:le())||t.createElement(pA,{type:_A.AUDIO_ON_LINED,fillColor:I?mA.ON_BACKGROUND_4:mA.CONTENT_INVERSE,width:"20px",height:"20px"}))),p&&t.createElement("div",{className:"sendbird-message-input--edit-action","data-testid":"sendbird-message-input--edit-action"},t.createElement(fR,{className:"sendbird-message-input--edit-action__cancel",type:ZO.SECONDARY,size:$O.SMALL,onClick:H},ve.BUTTON__CANCEL),t.createElement(fR,{className:"sendbird-message-input--edit-action__save",type:ZO.PRIMARY,size:$O.SMALL,disabled:Ue,onClick:function(){return function(){var e,t;try{var n=null==pe?void 0:pe.current,r=null==A?void 0:A.messageId;if(p&&r&&n){var i=ID(n.childNodes),a=i.messageText,s=i.mentionTemplate;F({messageId:r,message:a,mentionTemplate:s}),XD(pe)}}catch(o){null===(t=null===(e=null==be?void 0:be.message)||void 0===e?void 0:e.onUpdateMessageFailed)||void 0===t||t.call(e,A,o)}}()}},ve.BUTTON__SAVE)))}));function $D(e){XA(1,arguments);var t=ZA(e);return t.setHours(0,0,0,0),t}function ek(e,t){XA(2,arguments);var n=$D(e),r=$D(t);return n.getTime()===r.getTime()}function tk(e){return XA(1,arguments),function(e,t){XA(2,arguments);var n=ZA(e),r=ZA(t);return n.getFullYear()===r.getFullYear()}(e,Date.now())}function nk(e,t){return XA(2,arguments),function(e,t){XA(2,arguments);var n=ZA(e),r=lO(t);return isNaN(r)?new Date(NaN):r?(n.setDate(n.getDate()+r),n):n}(e,-lO(t))}var rk,ik,ak=function(e,t,n){var r;return void 0===n&&(n=NN),(null==e?void 0:e.name)||(null==e?void 0:e.members)?YM(e)?1===(null===(r=null==e?void 0:e.members)||void 0===r?void 0:r.length)?n.NO_MEMBERS:((null==e?void 0:e.members)||[]).filter((function(e){return e.userId!==t})).map((function(e){return e.nickname||n.NO_NAME})).join(", "):e.name:n.NO_TITLE},sk=function(e){var t,n=e.channel,r=e.locale,i=e.stringSet,a=void 0===i?NN:i,s=null===(t=null==n?void 0:n.lastMessage)||void 0===t?void 0:t.createdAt,o=r?{locale:r}:null;return s?function(e){return XA(1,arguments),ek(e,Date.now())}(s)?WO(s,a.DATE_FORMAT__LAST_MESSAGE_CREATED_AT__TODAY,o):function(e){return XA(1,arguments),ek(e,nk(Date.now(),1))}(s)?a.MESSAGE_STATUS__YESTERDAY||"Yesterday":tk(s)?WO(s,a.DATE_FORMAT__LAST_MESSAGE_CREATED_AT__THIS_YEAR,o):WO(s,a.DATE_FORMAT__LAST_MESSAGE_CREATED_AT__PREVIOUS_YEAR,o):""},ok=function(e,t){var n,r,i,a,s,o;return void 0===t&&(t=NN),aM(e)?null!==(n=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_GIF)&&void 0!==n?n:"":rM(e)?null!==(r=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_PHOTO)&&void 0!==r?r:"":iM(e)?null!==(i=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_VIDEO)&&void 0!==i?i:"":oM(e)?null!==(a=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_AUDIO)&&void 0!==a?a:"":MM(e)?null!==(s=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_VOICE_MESSAGE)&&void 0!==s?s:"":null!==(o=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_GENERAL)&&void 0!==o?o:""},lk=function(e,t){return void 0===t&&(t=NN),(null==e?void 0:e.lastMessage)?function(e,t){var n,r,i,a;if(void 0===e&&(e=null),void 0===t&&(t=NN),!e)return"";if(EM(e))return t.CHANNEL_PREVIEW_LAST_MESSAGE_TEMPLATE_MESSAGE;if(e.isFileMessage())return ok(e.type,t);if(e.isMultipleFilesMessage()){var s=null===(r=null===(n=e.fileInfoList)||void 0===n?void 0:n[0])||void 0===r?void 0:r.mimeType;return rM(s)||aM(s)?null!==(i=null==t?void 0:t.CHANNEL_PREVIEW_LAST_MESSAGE_FILE_TYPE_PHOTO)&&void 0!==i?i:"":ok(s,t)}return null!==(a=e.message)&&void 0!==a?a:""}(null==e?void 0:e.lastMessage,t):""},uk=function(e){return(null==e?void 0:e.unreadMessageCount)?e.unreadMessageCount:0},ck=((rk={})[BA.SENT]=_A.DONE,rk[BA.DELIVERED]=_A.DONE_ALL,rk[BA.READ]=_A.DONE_ALL,rk[BA.FAILED]=_A.ERROR,rk[BA.PENDING]=void 0,rk[BA.NONE]=void 0,rk),dk=((ik={})[BA.SENT]=mA.SENT,ik[BA.DELIVERED]=mA.SENT,ik[BA.READ]=mA.READ,ik[BA.FAILED]=mA.ERROR,ik[BA.PENDING]=void 0,ik[BA.NONE]=void 0,ik);function hk(e){var n,r,i=e.className,a=e.message,s=e.channel,o=e.isDateSeparatorConsidered,l=void 0===o||o,u=HN(),c=u.stringSet,d=u.dateLocale,h=KA(s,a),f=(null===(n=null==s?void 0:s.isGroupChannel)||void 0===n?void 0:n.call(s))&&(s.isSuper||s.isPublic||s.isBroadcast)&&!(h===BA.PENDING||h===BA.FAILED);return t.createElement("div",{className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-message-status"],!1).join(" ")},h===BA.PENDING?t.createElement(gA,{className:"sendbird-message-status__icon",testID:"sendbird-message-status-icon",width:"16px",height:"16px"},t.createElement(pA,{type:_A.SPINNER,fillColor:mA.PRIMARY,width:"16px",height:"16px"})):t.createElement(pA,{className:WT("sendbird-message-status__icon",f&&"hide-icon",h!==BA.FAILED&&"sendbird-message-status--sent"),testID:"sendbird-message-status-icon",type:ck[h]||_A.ERROR,fillColor:dk[h],width:"16px",height:"16px"}),((r=h)===BA.SENT||r===BA.DELIVERED||r===BA.READ)&&t.createElement(yN,{className:"sendbird-message-status__text",testID:"sendbird-message-status-text",type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},l?WO((null==a?void 0:a.createdAt)||0,c.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:d}):sk({channel:s,locale:d,stringSet:c})))}var fk="sendbird-sort-by-row";function pk(e){var n=e.className,r=void 0===n?"":n,i=e.maxItemCount,a=e.itemWidth,s=e.itemHeight,o=e.children;if(Array.isArray(o)&&o.length>i){for(var l=[],u=0;u<o.length;u+=i)l.push(t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),[fk],!1).join(" "),key:GN(),style:{width:a*i,height:s}},o.slice(u,u+i)));return t.createElement(t.Fragment,null,l)}return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),[fk],!1).join(" "),style:{width:a*(Array.isArray(o)?o.length:1),height:s}},o)}var _k="sendbird-app__layout",mk=function(e){function r(n){var r=e.call(this,n)||this;return r.menuRef=t.createRef(),r.setupEvents=function(){var e=r.props.closeDropdown,t=r.menuRef,n=function(n){var r,i;(null==t?void 0:t.current)&&!(null===(i=null===(r=null==t?void 0:t.current)||void 0===r?void 0:r.contains)||void 0===i?void 0:i.call(r,n.target))&&(null==e||e())};r.setState({handleClickOutside:n}),document.addEventListener("mousedown",n)},r.cleanUpEvents=function(){var e=r.state.handleClickOutside;document.removeEventListener("mousedown",e)},r.getMenuPosition=function(){var e,t,n,i=r.props,a=i.parentRef,s=i.openLeft,o=document.getElementById(_k),l=(null===(e=null==o?void 0:o.getBoundingClientRect)||void 0===e?void 0:e.call(o))||{top:0,left:0,width:window.innerWidth,height:window.innerHeight},u=null===(n=null===(t=null==a?void 0:a.current)||void 0===t?void 0:t.getBoundingClientRect)||void 0===n?void 0:n.call(t),c=((null==u?void 0:u.x)||(null==u?void 0:u.left)||0)-l.left,d=((null==u?void 0:u.y)||(null==u?void 0:u.top)||0)-l.top,h={top:d,left:c};if(!r.menuRef.current)return h;var f=r.menuRef.current.getBoundingClientRect();if(d+f.height+60>l.height&&(h.top-=f.height),c+f.width>l.width&&!s&&(h.left-=f.width),h.top<0&&(h.top=f.height<l.height?(l.height-f.height)/2:0),h.top+=32,s){var p=Number.isNaN(f.width-30)?108:f.width-30;h.left-=p}return h.left<0&&(h.left=f.width<l.width?(l.width-f.width)/2:0),r.setState({menuStyle:h}),h},r.state={menuStyle:{top:0,left:0},handleClickOutside:function(){}},r}return _(r,e),r.prototype.componentDidMount=function(){this.setupEvents(),this.getMenuPosition()},r.prototype.componentWillUnmount=function(){this.cleanUpEvents()},r.prototype.render=function(){var e=document.getElementById(Ak);if(!e)return t.createElement(t.Fragment,null);var r=this.state.menuStyle,i=this.props,a=i.children,s=i.style,o=i.className,l=void 0===o?"":o,u=i.testID,c=i.id;return n.createPortal(t.createElement("div",{className:WT(Tk,l),"data-testid":u,id:c},t.createElement("div",{className:"sendbird-dropdown__menu-backdrop"}),t.createElement("ul",{className:"".concat(l," sendbird-dropdown__menu"),ref:this.menuRef,style:m({display:"inline-block",position:"fixed",left:"".concat(Math.round(r.left),"px"),top:"".concat(Math.round(r.top),"px")},s),"data-testid":"sendbird-dropdown-menu"},a)),e)},r}(t.Component),vk={x:0,y:0,left:0,top:0,height:0},gk=t.createContext(void 0),Ek=function(e){var n=e.children,r=e.value;return t.createElement(gk.Provider,{value:r},n)},bk=function(){var e=t.useContext(gk);if(!e)throw new Error("useMessageMenuContext must be used within a MessageMenuProvider.");return e},yk=function(e){var n=e.className,r=e.disabled,i=e.tabIndex,a=void 0===i?0:i,s=e.testID,o=e.onClick,l=e.children,u=function(e){!r&&o&&o(e)};return t.createElement("li",{className:WT("sendbird-menu-item",n),role:"menuitem","aria-disabled":r,"data-testid":s,tabIndex:a,onClick:u,onKeyDown:function(e){"Enter"===e.code&&u(e)}},t.createElement(yN,{className:"sendbird-menu-item__text",type:CN.SUBTITLE_2,color:r?TN.ONBACKGROUND_4:TN.ONBACKGROUND_1},l))},Ck=function(e){var n=e.className,r=e.disabled,i=void 0!==r&&r,a=e.tabIndex,s=void 0===a?0:a,o=e.testID,l=e.onClick,u=e.children;return t.createElement("div",{className:WT("sendbird-message__bottomsheet--action",n),role:"menuitem",tabIndex:s,"aria-disabled":i,onClick:l,"data-testid":o},u)},Tk="sendbird-observing-message-menu",Nk=function(e){return"m_".concat(e)},Sk=mk,Ik=function(e){var r=e.id,i=e.children,a=e.parentRef,s=e.parentContainRef,o=e.spaceFromTrigger,l=void 0===o?{x:0,y:0}:o,u=e.closeDropdown,c=t.useState({left:0,top:0}),d=c[0],h=c[1],f=t.useRef(null);t.useEffect((function(){return s&&(null==s?void 0:s.current)&&s.current.classList.add("sendbird-reactions--pressed"),function(){s&&(null==s?void 0:s.current)&&s.current.classList.remove("sendbird-reactions--pressed")}}),[]),t.useEffect((function(){var e=function(e){var t,n;(null==f?void 0:f.current)&&!(null===(n=null===(t=null==f?void 0:f.current)||void 0===t?void 0:t.contains)||void 0===n?void 0:n.call(t,e.target))&&u()};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[]),t.useEffect((function(){var e,t,n,r,i=(null==l?void 0:l.x)||0,s=(null==l?void 0:l.y)||0,o=document.getElementById(_k),u=(null===(e=null==o?void 0:o.getBoundingClientRect)||void 0===e?void 0:e.call(o))||{top:0,left:0,width:window.innerWidth},c=null!==(n=null===(t=null==a?void 0:a.current)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==n?n:vk,d=((null==c?void 0:c.x)||(null==c?void 0:c.left)||0)-u.left,p={top:((null==c?void 0:c.y)||(null==c?void 0:c.top)||0)-u.top,left:d};if(null==f?void 0:f.current){var _=null===(r=null==f?void 0:f.current)||void 0===r?void 0:r.getBoundingClientRect();p.top<_.height?(p.top+=c.height,p.top+=s):(p.top-=_.height,p.top-=s),p.left-=_.width/2,p.left+=c.height/2-2,p.left+=i;var m=u.width-_.width;m<p.left&&(p.left=m),p.left<0&&(p.left=0),h(p)}else h(p)}),[]);var p=document.getElementById(Ok);return p?n.createPortal(t.createElement("div",{className:Tk,id:r},t.createElement("div",{className:"sendbird-dropdown__menu-backdrop"}),t.createElement("ul",{className:"sendbird-dropdown__reaction-bar","data-testid":"sendbird-dropdown__reaction-bar",ref:f,style:{display:"inline-block",position:"fixed",left:"".concat(Math.round(d.left),"px"),top:"".concat(Math.round(d.top),"px")}},t.createElement(pk,{className:"sendbird-dropdown__reaction-bar__row",maxItemCount:8,itemWidth:44,itemHeight:40},i))),p):null},wk=function(e){var n=e.className,r=void 0===n?"":n,i=e.children,a=e.onClick,s=e.disable,o=void 0!==s&&s,l=e.dataSbId,u=void 0===l?"":l,c=e.testID;return t.createElement(yk,{className:WT.apply(void 0,b(b([],Array.isArray(r)?r:[r],!1),["sendbird-dropdown__menu-item",o?"disable":""],!1)),disabled:o,testID:null!=c?c:u,onClick:a},i)},Ak="sendbird-dropdown-portal",Mk=function(){return t.createElement("div",{id:Ak,className:Ak})},Ok="sendbird-emoji-list-portal",Rk=function(){return t.createElement("div",{id:Ok})};function Dk(e){var n=e.menuTrigger,r=e.menuItems,i=e.isOpen,a=e.onClick,s=t.useState(!1),o=s[0],l=s[1];return t.createElement("div",{className:"sendbird-context-menu",onClick:a},null==n?void 0:n((function(){return l(!o)})),(o||i)&&r((function(){return l(!1)})))}var kk=function(e){var n=e.ref,r=e.onClick,i=void 0===r?zT:r,a=e.onBlur,s=void 0===a?zT:a,o=e.renderIcon,l=void 0===o?function(e){return t.createElement(pA,m({},e))}:o;return t.createElement(nO,{ref:n,width:"32px",height:"32px",onClick:i,onBlur:s},l({type:_A.MORE,fillColor:mA.CONTENT_INVERSE,width:"24px",height:"24px"}))},Lk=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu;return t.createElement(yk,m({},e,{onClick:function(t){var n;pM(a)&&GM(a.message),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__COPY)},xk=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.setQuoteMessage;return t.createElement(yk,m({},e,{disabled:a.parentMessageId>0,onClick:function(t){var n;o(a),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__REPLY)},Uk=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.onReplyInThread;return t.createElement(yk,m({},e,{onClick:function(t){var n;o({message:a}),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__THREAD)},Pk=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.onMoveToParentMessage;return t.createElement(yk,m({},e,{onClick:function(t){var n;s(),a(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__OPEN_IN_CHANNEL)},Fk=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.showEdit,o=i.isOnline;return t.createElement(yk,m({},e,{onClick:function(t){var n;o&&(s(!0),a(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__EDIT)},Bk=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.resendMessage,l=i.isOnline;return t.createElement(yk,m({},e,{onClick:function(t){var n;l&&(o(a),s(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:r.MESSAGE_MENU__RESEND)},Hk=function(e){var n,r,i,a=HN().stringSet,s=bk(),o=s.message,l=s.hideMenu,u=s.deleteMessage,c=s.showRemove,d=s.isOnline,h=s.disableDeleteMessage;return t.createElement(yk,m({},e,{disabled:"boolean"==typeof h?h:(null!==(r=null===(n=o.threadInfo)||void 0===n?void 0:n.replyCount)&&void 0!==r?r:0)>0,onClick:function(t){var n;dM(o)?u(o):d&&(c(!0),l(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(i=e.children)&&void 0!==i?i:a.MESSAGE_MENU__DELETE)},Gk=function(e){var t,n=e.channel,r=e.message;if(dM(r)||hM(r))return!1;if(!(null===(t=null==n?void 0:n.isGroupChannel)||void 0===t?void 0:t.call(n))||(null==n?void 0:n.isEphemeral))return!1;var i=null==n?void 0:n.isBroadcast,a=(null==n?void 0:n.myRole)===se.OPERATOR;return!i||a},jk=function(e){var n,r=e.className,i=e.message,a=e.channel,s=e.isByMe,o=e.replyType,l=e.renderTrigger,u=void 0===l?kk:l,c=e.renderMenuItems,d=e.disableDeleteMessage,h=void 0===d?null:d,f=e.showEdit,p=void 0===f?zT:f,_=e.showRemove,m=void 0===_?zT:_,v=e.deleteMessage,g=e.resendMessage,E=e.setQuoteMessage,b=e.onReplyInThread,y=e.onMoveToParentMessage,C=yT().state.config.isOnline,T=t.useRef(null),N=t.useRef(null),S=t.useState(!1),I=S[0],w=S[1],A=function(){return w(!1)},M=function(){return w((function(e){return!e}))},O={message:i,channel:a,isByMe:s,replyType:o,onReplyInThread:b,onMoveToParentMessage:y};return t.createElement("div",{className:WT("sendbird-message-menu",r),ref:N},t.createElement(Ek,{value:{message:i,hideMenu:A,showMenu:function(){return w(!0)},toggleMenu:M,setQuoteMessage:E,onReplyInThread:b,onMoveToParentMessage:y,showEdit:p,showRemove:m,deleteMessage:v,resendMessage:g,isOnline:C,disableDeleteMessage:h,triggerRef:T,containerRef:N}},u({ref:T,onClick:M}),I&&t.createElement(Sk,{id:Nk(i.messageId),parentRef:T,parentContainRef:N,closeDropdown:A,openLeft:s},null!==(n=null==c?void 0:c({items:{CopyMenuItem:Lk,ReplyMenuItem:xk,ThreadMenuItem:Uk,OpenInChannelMenuItem:Pk,EditMenuItem:Fk,ResendMenuItem:Bk,DeleteMenuItem:Hk}}))&&void 0!==n?n:t.createElement(t.Fragment,null,function(e){var t=e.message;return pM(t)}(O)&&t.createElement(Lk,null),function(e){var t=e.channel,n=e.message,r=e.replyType;return Gk({channel:t,message:n})&&"QUOTE_REPLY"===r}(O)&&t.createElement(xk,null),function(e){var t=e.channel,n=e.message,r=e.replyType,i=e.onReplyInThread;return Gk({channel:t,message:n})&&"THREAD"===r&&!(null==n?void 0:n.parentMessageId)&&"function"==typeof i}(O)&&t.createElement(Uk,null),function(e){var t=e.onMoveToParentMessage;return!!(void 0===t?void 0:t)}(O)&&t.createElement(Pk,null),function(e){var t=e.message,n=e.channel,r=e.isByMe;return!(null==n?void 0:n.isEphemeral)&&pM(t)&&uM(t)&&r}(O)&&t.createElement(Fk,null),function(e){var t=e.message,n=e.isByMe;return dM(t)&&(null==t?void 0:t.isResendable)&&n}(O)&&t.createElement(Bk,null),function(e){var t=e.message,n=e.channel,r=e.isByMe;return!(null==n?void 0:n.isEphemeral)&&!hM(t)&&r}(O)&&t.createElement(Hk,null)))))};function Vk(e){(function(e){return e&&"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()}function qk(e,n){var r=e.onLongPress,i=e.onClick,a=void 0===n?{}:n,s=a.delay,o=void 0===s?300:s,l=a.shouldPreventDefault,u=void 0===l||l,c=a.shouldStopPropagation,d=void 0!==c&&c,h=$M().isMobile,f=t.useState(!1),p=f[0],_=f[1],v=t.useState(!1),g=v[0],E=v[1],b=t.useRef(),y=t.useRef(),C=t.useCallback((function(e){e.persist();var t=m({},e);E(!1),d&&e.stopPropagation(),u&&e.target&&(e.target.addEventListener("touchend",Vk,{passive:!1}),y.current=e.target),b.current=setTimeout((function(){r(t),_(!0)}),o)}),[r,o,u,d,h]),T=t.useCallback((function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1),E(!!n),(null==b?void 0:b.current)&&clearTimeout(b.current),!t||p||g||null==i||i(e),_(!1),u&&y.current&&y.current.removeEventListener("touchend",Vk)}),[u,i,p,g]);return{onMouseDown:function(e){return C(e)},onMouseUp:function(e){return T(e)},onMouseLeave:function(e){return T(e,!1)},onTouchStart:function(e){return C(e)},onTouchMove:function(e){return T(e,!1,!0)},onTouchEnd:function(e){return T(e)}}}var zk=t.forwardRef((function(e,n){var r=e.className,i=e.width,a=e.height,s=e.selected,o=e.dataSbId,l=void 0===o?"":o,u=e.testID,c=e.onClick,d=e.children,h=qk({onLongPress:zT,onClick:c},{shouldPreventDefault:!0,shouldStopPropagation:!0});return t.createElement("div",m({className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-reaction-button".concat(s?"--selected":"")],!1).join(" "),ref:n,role:"button",style:{width:i,height:a}},h,{tabIndex:0,"data-sb-id":null!=u?u:l,"data-testid":null!=u?u:l}),t.createElement("div",{className:"sendbird-reaction-button__inner"},d))}));function Kk(e){var n=e.className,r=e.message,i=e.userId,a=e.spaceFromTrigger,s=void 0===a?{x:0,y:0}:a,o=e.emojiContainer,l=e.filterEmojiCategoryIds,u=e.toggleReaction,c=t.useRef(null),d=t.useRef(null),h=t.useMemo((function(){return VM(o,null==l?void 0:l(r))}),[o,l]);return hM(r)||dM(r)?null:t.createElement("div",{className:LM([null!=n?n:"","sendbird-message-item-reaction-menu"]),ref:d},t.createElement(Dk,{menuTrigger:function(e){return t.createElement(nO,{className:"sendbird-message-item-reaction-menu__trigger",ref:c,width:"32px",height:"32px",onClick:function(){e()}},t.createElement(pA,{className:"sendbird-message-item-reaction-menu__trigger__icon",testID:"sendbird-message-item-reaction-menu__trigger__icon",type:_A.EMOJI_MORE,fillColor:mA.CONTENT_INVERSE,width:"24px",height:"24px"}))},menuItems:function(e){return 0===h.length?null:t.createElement(Ik,{id:Nk(r.messageId),parentRef:c,parentContainRef:d,closeDropdown:e,spaceFromTrigger:s},h.map((function(n){var a,s,o,l=(null===(o=null===(s=null===(a=null==r?void 0:r.reactions)||void 0===a?void 0:a.find((function(e){return e.key===n.key})))||void 0===s?void 0:s.userIds)||void 0===o?void 0:o.some((function(e){return e===i})))||!1;return t.createElement(zk,{key:n.key,width:"36px",height:"36px",selected:l,onClick:function(){e(),null==u||u(r,n.key,l)},testID:"ui_emoji_reactions_menu_".concat(n.key)},t.createElement(kA,{url:n.url,width:"28px",height:"28px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.QUESTION,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}))})))}}))}var Yk=t.forwardRef((function(e,n){var r=e.className,i=void 0===r?"":r,a=e.testID,s=e.children,o=e.count,l=void 0===o?"":o,u=e.isAdd,c=void 0!==u&&u,d=e.selected,h=void 0!==d&&d,f=e.onClick,p=void 0===f?function(){}:f;return t.createElement("div",{className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-reaction-badge".concat(h&&!c?"--selected":c?"--is-add":"")],!1).join(" "),"data-testid":a,role:"button",ref:n,onClick:p,onKeyDown:p,onTouchEnd:p,tabIndex:0},t.createElement("div",{className:"sendbird-reaction-badge__inner"},t.createElement("div",{className:"sendbird-reaction-badge__inner__icon"},s),t.createElement(yN,{className:s&&l?"sendbird-reaction-badge__inner__count":"",type:CN.CAPTION_3,color:TN.ONBACKGROUND_1},l)))})),Wk="sendbird-modal-root",Qk=function(){return t.createElement("div",{id:Wk,className:Wk})},Xk=function(e){var n=e.titleText,r=e.onCloseClick;return t.createElement("div",{className:"sendbird-modal__header"},t.createElement(yN,{type:CN.H_1,color:TN.ONBACKGROUND_1},n),t.createElement("div",{className:"sendbird-modal__close"},t.createElement(nO,{width:"32px",height:"32px",onClick:r},t.createElement(pA,{type:_A.CLOSE,fillColor:mA.DEFAULT,width:"24px",height:"24px"}))))},Zk=function(e){var n=e.children;return t.createElement("div",{className:"sendbird-modal__body"},t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_2},n))},Jk=function(e){var n=e.submitText,r=e.disabled,i=void 0!==r&&r,a=e.hideCancelButton,s=void 0!==a&&a,o=e.type,l=void 0===o?ZO.DANGER:o,u=e.onSubmit,c=e.onCancel,d=t.useContext(FN).stringSet;return t.createElement("div",{className:"sendbird-modal__footer"},!s&&t.createElement(fR,{type:ZO.SECONDARY,onClick:c},t.createElement(yN,{type:CN.BUTTON_1,color:TN.ONBACKGROUND_1},d.BUTTON__CANCEL)),t.createElement(fR,{type:l,disabled:i,onClick:u},n))};function $k(e){var r,i=e.children,a=void 0===i?null:i,s=e.className,o=void 0===s?"":s,l=e.contentClassName,u=void 0===l?"":l,c=e.isCloseOnClickOutside,d=void 0!==c&&c,h=e.isFullScreenOnMobile,f=void 0!==h&&h,p=e.titleText,_=e.submitText,m=e.disabled,v=void 0!==m&&m,g=e.hideFooter,E=void 0!==g&&g,y=e.type,C=void 0===y?ZO.DANGER:y,T=e.renderHeader,N=e.onSubmit,S=void 0===N?zT:N,I=e.onClose,w=e.onCancel,A=e.customFooter,M=null!==(r=null!=I?I:w)&&void 0!==r?r:zT,O=yT().state.eventHandlers,R=t.useState((function(){return"sbu-modal-".concat(GN())}))[0];t.useEffect((function(){var e,t;return null===(t=null===(e=null==O?void 0:O.modal)||void 0===e?void 0:e.onMounted)||void 0===t?void 0:t.call(e,{close:M,id:R})}),[]);var D=$M().isMobile;return n.createPortal(t.createElement("div",{className:WT("sendbird-modal",o,f&&D&&"sendbird-modal--full-mobile")},t.createElement("div",{className:WT.apply(void 0,b(["sendbird-modal__content"],Array.isArray(u)?u:[u],!1))},(null==T?void 0:T())||t.createElement(Xk,{titleText:null!=p?p:"",onCloseClick:M}),t.createElement(Zk,null,a),!E&&(null!=A?A:t.createElement(Jk,{disabled:v,onCancel:M,onSubmit:S,submitText:null!=_?_:"",type:C}))),t.createElement("div",{className:WT("sendbird-modal__backdrop",d&&"sendbird-modal__backdrop--clickoutside"),onClick:function(e){null==e||e.stopPropagation(),d&&M()}})),document.getElementById(Wk))}var eL=t.createContext({openModal:zT}),tL=function(e){var n=e.children,r=t.useState([]),i=r[0],a=r[1],s=t.useCallback((function(e){a((function(t){return b(b([],t,!0),[e],!1)}))}),[]),o=t.useCallback((function(){a((function(e){return e.slice(1)}))}),[]),l=t.useMemo((function(){return function(){return tN(i).when((function(e){return 0===e.length}),(function(){return t.createElement(t.Fragment,null)})).otherwise((function(){var e=i[0],n=e.modalProps,r=e.childElement;return t.createElement($k,m({},n,{className:WT("sendbird-global-modal",null==n?void 0:n.className),onClose:function(){var e;null===(e=null==n?void 0:n.onClose)||void 0===e||e.call(n),o()}}),r({closeModal:o}))}))}}),[i]);return t.createElement(eL.Provider,{value:{openModal:s}},t.createElement(l,null),n)},nL=function(){return t.useContext(eL)},rL=function(e){var r,i=e.className,a=void 0===i?"":i,s=e.children,o=e.onBackdropClick,l=yT().state.config.logger,u=t.useRef();return u.current=document.getElementById(Wk),u.current||(u.current=document.createElement("div"),u.current.setAttribute("id",Wk),document.body.appendChild(u.current),null===(r=null==l?void 0:l.warning)||void 0===r||r.call(l,"@sendbird/uikit-react/ui/BottomSheet | Should put a ModalRoot to use the BottomSheet.")),n.createPortal(t.createElement("div",{className:"".concat(a," sendbird-bottomsheet")},t.createElement("div",{className:"sendbird-bottomsheet__content",role:"dialog","aria-modal":"true","aria-expanded":"true"},s),t.createElement("div",{className:"sendbird-bottomsheet__backdrop",onClick:function(e){null==e||e.stopPropagation(),null==o||o()}})),u.current)};function iL(e){var n=e.height,r=void 0===n?24:n,i=e.width,a=void 0===i?24:i;return t.createElement("div",{className:"sendbird-muted-avatar",style:{height:"".concat(r,"px"),width:"".concat(a,"px")}},t.createElement("div",{className:"sendbird-muted-avatar__icon"},t.createElement("div",{className:"sendbird-muted-avatar__bg",style:{height:"".concat(r,"px"),width:"".concat(a,"px")}}),t.createElement(pA,{type:_A.MUTE,fillColor:mA.WHITE,width:"".concat(r-8,"px"),height:"".concat(a-8,"px")})))}function aL(e){var n=e.id,r=e.checked,i=void 0!==r&&r,a=e.disabled,s=e.onChange,o=t.useState(i),l=o[0],u=o[1];return t.createElement("label",{className:["sendbird-checkbox",a?"disabled":""].join(" "),htmlFor:n},t.createElement("input",{disabled:a,id:n,type:"checkbox",checked:l,onClick:function(){a||u(!l)},onChange:s}),t.createElement("span",{className:["sendbird-checkbox--checkmark",a?"disabled":""].join(" ")}))}var sL=function(e){var t=e.stores,n=(void 0===t?{}:t).sdkStore;return(void 0===n?{}:n).sdk},oL=function(e){return function(t){return new Promise((function(n,r){var i=sL(e),a=function(e){var t=e.config;return(void 0===t?{}:t).pubSub}(e);i||r(new Error("Sdk not found")),i.groupChannel||r(new Error("Not found GroupChannelModule")),i.groupChannel.createChannel&&"function"==typeof i.groupChannel.createChannel||r(new Error('Not found the function "createChannel"')),i.groupChannel.createChannel(t).then((function(e){n(e),a.publish(jT.CREATE_CHANNEL,{channel:e})})).catch(r)}))}};function lL(e){var n,r,i=e.user,a=e.currentUserId,s=e.disableMessaging,o=void 0!==s&&s,l=e.onSuccess,u=yT().state,c=oL(u),d=null===(n=null==u?void 0:u.config)||void 0===n?void 0:n.logger,h=t.useContext(FN).stringSet,f=a||(null===(r=null==u?void 0:u.config)||void 0===r?void 0:r.userId),p=TT().onStartDirectMessage;return t.createElement("div",{className:"sendbird__user-profile"},t.createElement("section",{className:"sendbird__user-profile-avatar"},t.createElement(GA,{height:"80px",width:"80px",src:null==i?void 0:i.profileUrl})),t.createElement("section",{className:"sendbird__user-profile-name"},t.createElement(yN,{type:CN.H_2,color:TN.ONBACKGROUND_1},(null==i?void 0:i.nickname)||h.NO_NAME)),(null==i?void 0:i.userId)!==f&&!o&&t.createElement("section",{className:"sendbird__user-profile-message"},t.createElement(fR,{type:ZO.SECONDARY,onClick:function(){var e={isDistinct:!1,invitedUserIds:(null==i?void 0:i.userId)?[null==i?void 0:i.userId]:[],operatorUserIds:[f]};null==l||l(),c(e).then((function(e){d.info("UserProfile, channel create",e),null==p||p(e)}))}},h.USER_PROFILE__MESSAGE)),t.createElement("div",{className:"sendbird__user-profile-separator"}),t.createElement("section",{className:"sendbird__user-profile-userId"},t.createElement(yN,{className:"sendbird__user-profile-userId--label",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},h.USER_PROFILE__USER_ID),t.createElement(yN,{className:"sendbird__user-profile-userId--value",type:CN.BODY_1,color:TN.ONBACKGROUND_1},null==i?void 0:i.userId)))}function uL(e){var n=e.user,r=e.channel,i=e.className,a=void 0===i?void 0:i,s=e.checked,o=e.checkBox,l=e.isOperator,u=e.disabled,c=e.disableMessaging,d=e.action,h=e.onChange,f=e.avatarSize,p=void 0===f?"40px":f,_=e.onClick,m=e.onUserAvatarClick,v=e.renderListItemMenu,g=e.size,E=void 0===g?"normal":g,y=null!=l?l:"operator"===(null==n?void 0:n.role),C=n.userId,T=t.useRef(null),N=t.useRef(null),S=t.useRef(null),I=TT(),w=I.disableUserProfile,A=I.renderUserProfile,M=HN().stringSet,O=yT().state.config.userId,R="small"===E?"sendbird-user-list-item--small":"sendbird-user-list-item",D="small"===E?"sendbird-user-list-item--small__avatar":"sendbird-user-list-item__avatar",k="small"===E?"sendbird-user-list-item--small__title":"sendbird-user-list-item__title",L="small"===E?"sendbird-user-list-item--small__subtitle":"sendbird-user-list-item__subtitle",x="small"===E?"sendbird-user-list-item--small__checkbox":"sendbird-user-list-item__checkbox",U="small"===E?"sendbird-user-list-item--small__action":"sendbird-user-list-item__action",P="small"===E?"sendbird-user-list-item--small__operator":"sendbird-user-list-item__operator";return t.createElement("div",{className:WT.apply(void 0,b([R],Array.isArray(a)?a:[a],!1)),ref:N},t.createElement(Dk,{menuTrigger:function(e){return t.createElement(t.Fragment,null,t.createElement(GA,{className:D,ref:S,src:(null==n?void 0:n.profileUrl)||(null==n?void 0:n.plainProfileUrl)||"",width:p,height:p,onClick:function(){var t;w||(e(),null===(t=null!=m?m:_)||void 0===t||t())}}),(null==n?void 0:n.isMuted)&&t.createElement(iL,{height:xA(p),width:xA(p)}))},menuItems:function(e){return A?A({user:n,currentUserId:null!=O?O:"",close:e,avatarRef:S}):t.createElement(Sk,{openLeft:!0,parentRef:S,parentContainRef:S,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{disableMessaging:c,user:n,currentUserId:O,onSuccess:e}))}}),t.createElement(yN,{className:k,type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},n.nickname||M.NO_NAME,O===n.userId&&M.CHANNEL_SETTING__MEMBERS__YOU),!n.nickname&&t.createElement(yN,{className:L,type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},n.userId),o&&t.createElement("label",{className:x,htmlFor:C},t.createElement(aL,{id:C,checked:s,disabled:u,onChange:function(e){return null==h?void 0:h(e)}})),y&&t.createElement(yN,{className:WT(P,o&&"checkbox"),type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_2},M.LABEL__OPERATOR),!o&&!v&&d&&t.createElement("div",{className:U,ref:T},d({actionRef:T,parentRef:N})),!o&&v&&t.createElement("div",{className:U,ref:T},v({channel:r,user:n})))}function cL(e){var n=e.className,r=void 0===n?"":n,i=e.children,a=void 0===i?"":i;return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-tooltip"],!1).join(" ")},t.createElement(yN,{className:"sendbird-tooltip__text",type:CN.CAPTION_2,color:TN.ONCONTENT_1},a))}function dL(e){var n=e.className,r=void 0===n?"":n,i=e.children,a=e.hoverTooltip,s=t.useState(!1),o=s[0],l=s[1],u=t.useRef();return t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-tooltip-wrapper"],!1).join(" "),onMouseOver:function(){l(!0)},onFocus:function(){l(!0)},onMouseOut:function(){l(!1)},onBlur:function(){l(!1)}},t.createElement("div",{className:"sendbird-tooltip-wrapper__children",ref:u},i),o&&t.createElement("div",{className:"sendbird-tooltip-wrapper__hover-tooltip",style:{bottom:"calc(100% + ".concat(8,"px)")}},t.createElement("div",{className:"sendbird-tooltip-wrapper__hover-tooltip__inner"},t.createElement("div",{className:"sendbird-tooltip-wrapper__hover-tooltip__inner__tooltip-container",style:{left:u.current?"calc(".concat(u.current.offsetWidth/2,"px - 50%)"):void 0}},a))))}var hL=t.createContext({message:{},isByMe:!1}),fL=function(e){var n=e.children,r=e.message,i=e.isByMe,a=void 0!==i&&i;return t.createElement(hL.Provider,{value:{message:r,isByMe:a}},n)},pL=function(){var e=t.useContext(hL);if(void 0===e)throw new Error("useMessageContext must be used within a MessageProvider");return e},_L=function(e){var n,r,i,a=e.message,s=e.channel,o=e.emojiKey,l=void 0===o?"":o,u=e.hideMenu,c=e.emojiContainer,d=e.onPressUserProfileHandler,h=s.members,f=void 0===h?[]:h,p=t.useState(l),_=p[0],m=p[1];function v(){if(d&&a){var e=null==a?void 0:a.sender;d(e)}}return t.createElement(rL,{onBackdropClick:u},t.createElement("div",{className:"sendbird-message__bottomsheet"},t.createElement("div",{className:"sendbird-message__bottomsheet__reacted-members"},null===(n=a.reactions)||void 0===n?void 0:n.map((function(e){var n=function(e,t){var n,r,i,a=(i=null!=t?t:"",function(e){return e.key===i});return(null===(r=null===(n=null==e?void 0:e.emojiCategories.find((function(e){return e.emojis.some(a)})))||void 0===n?void 0:n.emojis.find(a))||void 0===r?void 0:r.url)||""}(c,e.key);return t.createElement("div",{key:e.key,className:WT("sendbird-message__bottomsheet__reacted-members__item",_===e.key&&"sendbird-message__bottomsheet__reacted-members__item__selected"),onClick:function(){m(e.key)}},t.createElement(kA,{url:n,width:"28px",height:"28px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.QUESTION,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}),t.createElement(yN,{type:CN.BUTTON_2,color:_===e.key?TN.PRIMARY:TN.ONBACKGROUND_3},e.userIds.length))}))),t.createElement("div",{className:"sendbird-message__bottomsheet__reactor-list"},(null===(i=null===(r=a.reactions)||void 0===r?void 0:r.find((function(e){return e.key===_})))||void 0===i?void 0:i.userIds.map((function(e){return f.find((function(t){return t.userId===e}))})).filter((function(e){return void 0!==e}))).map((function(e){return t.createElement(uL,{key:e.userId,className:"sendbird-message__bottomsheet__reactor-list__item",user:e,avatarSize:"36px",onUserAvatarClick:v})})))))};function mL(e){var n,r=e.reaction,i=e.memberNicknamesMap,a=e.setEmojiKey,s=e.toggleReaction,o=e.emojisMap,l=e.channel,u=e.message,c=e.isFiltered,d=nL().openModal,h=yT().state.config.userId,f=$M().isMobile,p=pL(),_=t.useContext(FN).stringSet,v=xM(h,r),g=r.userIds.length>0&&(null==l?void 0:l.isGroupChannel())&&!l.isSuper,E=function(){!c||v?(a(""),null==s||s(null!=u?u:null==p?void 0:p.message,r.key,v)):d({modalProps:{titleText:"Add reaction failed",hideFooter:!0,isCloseOnClickOutside:!0},childElement:function(e){var n=e.closeModal;return t.createElement(Jk,{type:ZO.PRIMARY,submitText:_.BUTTON__OK,hideCancelButton:!0,onCancel:n,onSubmit:n})}})},b=qk({onLongPress:function(){a(r.key)},onClick:E},{shouldPreventDefault:!0,shouldStopPropagation:!0});return t.createElement(dL,{className:"sendbird-emoji-reactions__reaction-badge",hoverTooltip:g?t.createElement(cL,null,UM(r,h,i,_)):t.createElement(t.Fragment,null)},t.createElement("div",m({},f?b:{onClick:E}),t.createElement(Yk,{count:r.userIds.length,selected:v},t.createElement(kA,{circle:!0,url:(null===(n=o.get(null==r?void 0:r.key))||void 0===n?void 0:n.url)||"",width:"20px",height:"20px",defaultComponent:t.createElement(pA,{width:"20px",height:"20px",type:_A.QUESTION})}))))}var vL=function(e){var n=qk({onLongPress:function(){},onClick:e.onClick},{shouldPreventDefault:!0,shouldStopPropagation:!0});return t.createElement("div",m({className:"sendbird-emoji-reactions__add-reaction-badge","data-testid":"sendbird-emoji-reactions__add-reaction-badge"},n),t.createElement(Yk,{isAdd:!0},t.createElement(pA,{type:_A.EMOJI_MORE,fillColor:mA.ON_BACKGROUND_3,width:"20px",height:"20px"})))},gL=function(e){var n=e.userId,r=e.message,i=e.emojiContainer,a=e.hideMenu,s=e.toggleReaction,o=t.useMemo((function(){return jM(i)}),[i]);return t.createElement(rL,{onBackdropClick:a},t.createElement("div",{className:"sendbird-message__bottomsheet sendbird-message__emojis-bottomsheet"},o.map((function(e){var i,o,l,u,c=null!==(u=null===(l=null===(o=null===(i=null==r?void 0:r.reactions)||void 0===i?void 0:i.find((function(t){return t.key===e.key})))||void 0===o?void 0:o.userIds)||void 0===l?void 0:l.some((function(e){return e===n})))&&void 0!==u&&u;return t.createElement(zk,{key:e.key,width:"44px",height:"44px",selected:c,onClick:function(t){null==t||t.stopPropagation(),null==s||s(r,e.key,c),a()},testID:"ui_mobile_emoji_reactions_menu_".concat(e.key)},t.createElement(kA,{url:e.url,width:"38px",height:"38px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.QUESTION,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}))}))))},EL=function(e){var n,r,i,a,s,o=e.className,l=void 0===o?"":o,u=e.userId,c=e.message,d=e.channel,h=e.emojiContainer,f=e.memberNicknamesMap,p=e.spaceFromTrigger,_=void 0===p?{x:0,y:0}:p,m=e.isByMe,v=void 0!==m&&m,g=e.toggleReaction,E=e.onPressUserProfile,b=e.filterEmojiCategoryIds,y=!1;try{var C=yT().state.config;y=!!d&&PT({channel:d,config:C})}catch(L){}var T=$M().isMobile,N=t.useRef(null),S=t.useState(!1),I=S[0],w=S[1],A=t.useState(""),M=A[0],O=A[1],R=function(e){var t,n=new Map;return null===(t=null==e?void 0:e.emojiCategories)||void 0===t||t.forEach((function(e){var t;null===(t=null==e?void 0:e.emojis)||void 0===t||t.forEach((function(e){e&&e.key&&n.set(e.key,e)}))})),n}(h),D=t.useMemo((function(){return VM(h,null==b?void 0:b(c))}),[h,b]),k=(null!==(r=null===(n=c.reactions)||void 0===n?void 0:n.length)&&void 0!==r?r:0)<R.size;return t.createElement("div",{className:LM([l,"sendbird-emoji-reactions",v?"outgoing":"incoming"])},(null!==(a=null===(i=c.reactions)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0&&(null===(s=c.reactions)||void 0===s?void 0:s.map((function(e){return t.createElement(mL,{key:null==e?void 0:e.key,reaction:e,memberNicknamesMap:f,setEmojiKey:O,toggleReaction:g,emojisMap:R,channel:d,message:c,isFiltered:VM(h,null==b?void 0:b(c)).every((function(t){return t.key!==(null==e?void 0:e.key)}))})}))),!T&&k&&t.createElement(Dk,{menuTrigger:function(e){return t.createElement(Yk,{className:"sendbird-emoji-reactions__add-reaction-badge",testID:"sendbird-emoji-reactions__add-reaction-badge",ref:N,isAdd:!0,onClick:function(t){var n;e(),null===(n=null==t?void 0:t.stopPropagation)||void 0===n||n.call(t)}},t.createElement(pA,{type:_A.EMOJI_MORE,fillColor:mA.ON_BACKGROUND_3,width:"20px",height:"20px"}))},menuItems:function(e){return 0===D.length?null:t.createElement(Ik,{parentRef:N,parentContainRef:N,closeDropdown:e,spaceFromTrigger:_},VM(h,null==b?void 0:b(c)).map((function(n){var r,i,a,s=(null===(a=null===(i=null===(r=null==c?void 0:c.reactions)||void 0===r?void 0:r.find((function(e){return e.key===n.key})))||void 0===i?void 0:i.userIds)||void 0===a?void 0:a.some((function(e){return e===u})))||!1;return t.createElement(zk,{key:n.key,width:"36px",height:"36px",selected:s,onClick:function(t){e(),null==g||g(c,n.key,s),null==t||t.stopPropagation()},testID:"ui_emoji_reactions_menu_".concat(n.key)},t.createElement(kA,{url:(null==n?void 0:n.url)||"",width:"28px",height:"28px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.QUESTION,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}))})))}}),T&&k&&t.createElement(vL,{onClick:function(){w(!0)}}),T&&I&&t.createElement(gL,{userId:u,message:c,emojiContainer:h,hideMenu:function(){w(!1)},toggleReaction:g}),T&&M&&null!==d&&y&&t.createElement(_L,{message:c,channel:d,emojiKey:M,hideMenu:function(){O("")},emojiContainer:h,onPressUserProfileHandler:E}))};function bL(e){var n,r=e.className,i=void 0===r?"":r,a=e.message;return((null==a?void 0:a.isAdminMessage)||(null==a?void 0:a.messageType))&&(null===(n=null==a?void 0:a.isAdminMessage)||void 0===n?void 0:n.call(a))&&"admin"===(null==a?void 0:a.messageType)?t.createElement("div",{className:b(b([],Array.isArray(i)?i:[i],!0),["sendbird-admin-message"],!1).join(" ")},t.createElement(yN,{className:"sendbird-admin-message__text",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},null==a?void 0:a.message)):null}function yL(e){return tN(e).when(_M,(function(){var t;return null!==(t=null==e?void 0:e.type)&&void 0!==t?t:""})).when(mM,(function(){var t,n;return null!==(n=null===(t=CL(e))||void 0===t?void 0:t.mimeType)&&void 0!==n?n:""})).otherwise((function(){return""}))}function CL(e){var t=e.fileInfoList;return t.length>0?t[0]:null}function TL(e){return tN(e).when(_M,(function(){var t;return null!==(t=null==e?void 0:e.name)&&void 0!==t?t:""})).when(mM,(function(){var t,n;return null!==(n=null===(t=CL(e))||void 0===t?void 0:t.fileName)&&void 0!==n?n:""})).otherwise((function(){return""}))}function NL(e){return tN(e).when(_M,(function(){var t;return null!==(t=null==e?void 0:e.url)&&void 0!==t?t:""})).when(mM,(function(){var t,n;return null!==(n=null===(t=CL(e))||void 0===t?void 0:t.url)&&void 0!==n?n:""})).otherwise((function(){return""}))}function SL(e){var t=function(e){return tN(e).when(_M,(function(){return e.thumbnails})).when(mM,(function(){var t,n;return null!==(n=null===(t=CL(e))||void 0===t?void 0:t.thumbnails)&&void 0!==n?n:[]})).otherwise((function(){return[]}))}(e);return t&&t.length>0?t[0].url:""}function IL(e){var n,r,i,a,s,o,l,u=e.message,c=e.userId,d=void 0===c?"":c,h=e.isByMe,f=void 0!==h&&h,p=e.className,_=void 0===p?"":p,v=e.isUnavailable,g=void 0!==v&&v,E=e.onClick,b=t.useContext(FN).stringSet,y=u.parentMessage,C=null==y?void 0:y.sender,T=d===(null==C?void 0:C.userId)?b.QUOTED_MESSAGE__CURRENT_USER:null==C?void 0:C.nickname,N=NL(y),S=yL(y),I=d===(null===(r=null==u?void 0:u.sender)||void 0===r?void 0:r.userId)?b.QUOTED_MESSAGE__CURRENT_USER:null===(i=null==u?void 0:u.sender)||void 0===i?void 0:i.nickname,w=t.useState(!1),A=w[0],M=w[1],O=m({},nM),R=null!==(s=null===(a=TL(y))||void 0===a?void 0:a.split("/"))&&void 0!==s?s:N.split("/");return t.createElement("div",{className:LM([_,"sendbird-quote-message",f?"outgoing":"incoming",g?"unavailable":""]),key:null==y?void 0:y.messageId,onClick:function(){!g&&E&&E()},onTouchEnd:function(){!g&&E&&E()}},t.createElement("div",{className:"sendbird-quote-message__replied-to"},t.createElement(pA,{className:"sendbird-quote-message__replied-to__icon",type:_A.REPLY,fillColor:mA.ON_BACKGROUND_3,width:"12px",height:"12px"}),t.createElement(yN,{className:"sendbird-quote-message__replied-to__text",testID:"sendbird-quote-message__replied-to__text",type:CN.CAPTION_2,color:TN.ONBACKGROUND_3},t.createElement("span",{className:"sendbird-quote-message__replied-to__text__nickname"},I),t.createElement("span",{className:"sendbird-quote-message__replied-to__text__text"},b.QUOTED_MESSAGE__REPLIED_TO),t.createElement("span",{className:"sendbird-quote-message__replied-to__text__nickname"},T))),t.createElement("div",{className:"sendbird-quote-message__replied-message"},g&&t.createElement("div",{className:"sendbird-quote-message__replied-message__text-message"},t.createElement(yN,{className:"sendbird-quote-message__replied-message__text-message__word",testID:"sendbird-quote-message__replied-message__text-message__word",type:CN.BODY_2,color:TN.ONBACKGROUND_1},b.QUOTED_MESSAGE__UNAVAILABLE)),pM(y)&&(null===(o=null==y?void 0:y.message)||void 0===o?void 0:o.length)>0&&!g&&t.createElement("div",{className:"sendbird-quote-message__replied-message__text-message"},t.createElement(yN,{className:"sendbird-quote-message__replied-message__text-message__word",testID:"sendbird-quote-message__replied-message__text-message__word",type:CN.BODY_2,color:TN.ONBACKGROUND_1},null==y?void 0:y.message)),OM(y)&&N&&!g&&t.createElement("div",{className:"sendbird-quote-message__replied-message__text-message"},t.createElement(yN,{className:"sendbird-quote-message__replied-message__text-message__word",testID:"sendbird-quote-message__replied-message__text-message__word",type:CN.BODY_2,color:TN.ONBACKGROUND_1},b.VOICE_MESSAGE)),(SM(y)||mM(y))&&N&&!g&&t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message"},t.createElement(kA,{className:"sendbird-quote-message__replied-message__thumbnail-message__image",url:N,alt:S,width:"144px",height:"108px",onLoad:function(){return M(!0)},defaultComponent:t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__placeholder"},t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__placeholder__icon"},t.createElement(pA,{type:iM(S)?_A.PLAY:_A.PHOTO,fillColor:mA.ON_BACKGROUND_2,width:"22px",height:"22px"})))}),iM(S)&&!((null===(l=null==y?void 0:y.thumbnails)||void 0===l?void 0:l.length)>0)&&t.createElement(t.Fragment,null,t.createElement("video",{className:"sendbird-quote-message__replied-message__thumbnail-message__video"},t.createElement("source",{src:N,type:S})),t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__cover"},t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__cover__icon"},t.createElement(pA,{type:_A.PLAY,fillColor:mA.ON_BACKGROUND_2,width:"14px",height:"14px"})))),A&&aM(S)&&t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__cover"},t.createElement("div",{className:"sendbird-quote-message__replied-message__thumbnail-message__cover__icon"},t.createElement(pA,{type:_A.GIF,fillColor:mA.THUMBNAIL_ICON,width:"14px",height:"14px"})))),DM(y)===tM.FILE&&N&&!g&&t.createElement("div",{className:"sendbird-quote-message__replied-message__file-message"},t.createElement(pA,{className:"sendbird-quote-message__replied-message__file-message__type-icon",type:(n={},n[O.IMAGE]=_A.PHOTO,n[O.VIDEO]=_A.PLAY,n[O.AUDIO]=_A.FILE_AUDIO,n[O.GIF]=_A.GIF,n[O.OTHERS]=_A.FILE_DOCUMENT,n)[lM(S)],fillColor:mA.ON_BACKGROUND_3,width:"16px",height:"16px"}),t.createElement(yN,{className:"sendbird-quote-message__replied-message__file-message__file-name",type:CN.BODY_2,color:TN.ONBACKGROUND_3},HM(R[R.length-1])))))}var wL=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu;return t.createElement(yk,m({},e,{onClick:function(t){var n;pM(a)&&GM(a.message),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__COPY),t.createElement(pA,{type:_A.COPY,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},AL=function(e){var n,r,i,a=HN().stringSet,s=bk(),o=s.message,l=s.hideMenu,u=s.setQuoteMessage;return t.createElement(yk,m({},e,{disabled:o.parentMessageId>0,onClick:function(t){var n;u(o),l(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:(null!==(r=o.parentMessageId)&&void 0!==r?r:0)>0?TN.ONBACKGROUND_4:TN.ONBACKGROUND_1},a.MESSAGE_MENU__REPLY),t.createElement(pA,{type:_A.REPLY,fillColor:(null!==(i=o.parentMessageId)&&void 0!==i?i:0)>0?mA.ON_BACKGROUND_4:mA.PRIMARY,width:"24px",height:"24px"})))},ML=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.onReplyInThread;return t.createElement(yk,m({},e,{onClick:function(t){var n;o({message:a}),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__THREAD),t.createElement(pA,{type:_A.THREAD,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},OL=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.showEdit,o=i.isOnline;return t.createElement(yk,m({},e,{onClick:function(t){var n;o&&(s(!0),a(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__EDIT),t.createElement(pA,{type:_A.EDIT,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},RL=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.resendMessage,l=i.isOnline;return t.createElement(yk,m({},e,{onClick:function(t){var n;l&&(o(a),s(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__RESEND),t.createElement(pA,{type:_A.REFRESH,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},DL=function(e){var n,r,i,a=HN().stringSet,s=bk(),o=s.message,l=s.hideMenu,u=s.deleteMessage,c=s.showRemove,d=s.isOnline,h=s.disableDeleteMessage;return t.createElement(yk,m({},e,{disabled:"boolean"==typeof h?h:(null!==(r=null===(n=o.threadInfo)||void 0===n?void 0:n.replyCount)&&void 0!==r?r:0)>0,onClick:function(t){var n;dM(o)?u(o):d&&(c(!0),l(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(i=e.children)&&void 0!==i?i:t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.SUBTITLE_1,color:h?TN.ONBACKGROUND_4:TN.ONBACKGROUND_1},a.MESSAGE_MENU__DELETE),t.createElement(pA,{type:_A.DELETE,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},kL=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.message,o=i.onDownloadClick,l=s.url;return t.createElement(yk,m({},e,{onClick:function(){a()}}),null!==(n=e.children)&&void 0!==n?n:t.createElement("a",{className:"sendbird-message__contextmenu--hyperlink",rel:"noopener noreferrer",href:l,target:"_blank",onClick:o},t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__SAVE),t.createElement(pA,{type:_A.DOWNLOAD,fillColor:mA.PRIMARY,width:"24px",height:"24px"})))},LL=function(e){var n,r,i,a,s=e.channel,o=e.message,l=e.replyType,u=e.userId,c=e.resendMessage,d=e.showEdit,h=e.showRemove,f=e.deleteMenuState,p=e.deleteMessage,_=e.setQuoteMessage,m=e.parentRef,v=e.onReplyInThread,g=e.isOpenedFromThread,E=void 0!==g&&g,b=e.onDownloadClick,y=void 0===b?null:b,C=e.renderMenuItems,T=e.hideMenu,N=(null===(n=null==o?void 0:o.sender)||void 0===n?void 0:n.userId)===u,S=yT().state.config.isOnline,I=pM(o),w=pM(o)&&uM(o)&&N,A=dM(o)&&(null==o?void 0:o.isResendable)&&N,M=!hM(o)&&N,O=N&&(void 0===f||"HIDE"!==f)&&M,R=!hM(o)&&_M(o)&&!(OM(o)&&(null==s?void 0:s.isSuper)||(null==s?void 0:s.isBroadcast)),D="QUOTE_REPLY"===l&&!dM(o)&&!hM(o)&&(null==s?void 0:s.isGroupChannel()),k="THREAD"===l&&!E&&!dM(o)&&!hM(o)&&!vM(o)&&(null==s?void 0:s.isGroupChannel()),L=void 0!==f&&"DISABLE"===f||(null!==(i=null===(r=null==o?void 0:o.threadInfo)||void 0===r?void 0:r.replyCount)&&void 0!==i?i:0)>0,x={message:o,hideMenu:T,setQuoteMessage:_,onReplyInThread:v,onMoveToParentMessage:zT,showEdit:d,showRemove:h,deleteMessage:p,resendMessage:c,isOnline:S,disableDeleteMessage:L,triggerRef:m,containerRef:m,onDownloadClick:y};return t.createElement(Ek,{value:x},t.createElement(Sk,{className:"sendbird-message__mobile-context-menu",parentRef:m,parentContainRef:m,closeDropdown:T},null!==(a=null==C?void 0:C({items:{CopyMenuItem:wL,ReplyMenuItem:AL,ThreadMenuItem:ML,EditMenuItem:OL,ResendMenuItem:RL,DeleteMenuItem:DL}}))&&void 0!==a?a:t.createElement(t.Fragment,null,I&&t.createElement(wL,null),D&&t.createElement(AL,null),k&&t.createElement(ML,null),w&&t.createElement(OL,null),A&&t.createElement(RL,null),O&&t.createElement(DL,null),R&&t.createElement(kL,null))))},xL=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu;return t.createElement(Ck,m({},e,{onClick:function(t){var n;pM(a)&&GM(a.message),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.COPY,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__COPY)))},UL=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.showEdit,o=i.isOnline;return t.createElement(Ck,m({},e,{onClick:function(t){var n;o&&(s(!0),a(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.EDIT,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__EDIT)))},PL=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.resendMessage,l=i.isOnline;return t.createElement(Ck,m({},e,{onClick:function(t){var n;l&&(o(a),s(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.REFRESH,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__RESEND)))},FL=function(e){var n,r,i,a=HN().stringSet,s=bk(),o=s.message,l=s.hideMenu,u=s.setQuoteMessage;return t.createElement(Ck,m({},e,{disabled:o.parentMessageId>0,onClick:function(t){var n;u(o),l(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.REPLY,fillColor:(null!==(r=o.parentMessageId)&&void 0!==r?r:0)>0?mA.ON_BACKGROUND_3:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:(null!==(i=o.parentMessageId)&&void 0!==i?i:0)>0?TN.ONBACKGROUND_4:TN.ONBACKGROUND_1},a.MESSAGE_MENU__REPLY)))},BL=function(e){var n,r=HN().stringSet,i=bk(),a=i.message,s=i.hideMenu,o=i.onReplyInThread;return t.createElement(Ck,m({},e,{onClick:function(t){var n;o({message:a}),s(),null===(n=e.onClick)||void 0===n||n.call(e,t)}}),null!==(n=e.children)&&void 0!==n?n:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.THREAD,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__THREAD)))},HL=function(e){var n,r,i,a=HN().stringSet,s=bk(),o=s.message,l=s.hideMenu,u=s.deleteMessage,c=s.showRemove,d=s.isOnline,h=s.disableDeleteMessage;return t.createElement(Ck,m({},e,{disabled:"boolean"==typeof h?h:(null!==(r=null===(n=o.threadInfo)||void 0===n?void 0:n.replyCount)&&void 0!==r?r:0)>0,onClick:function(t){var n;dM(o)?u(o):d&&(c(!0),l(),null===(n=e.onClick)||void 0===n||n.call(e,t))}}),null!==(i=e.children)&&void 0!==i?i:t.createElement(t.Fragment,null,t.createElement(pA,{type:_A.DELETE,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:h?TN.ONBACKGROUND_4:TN.ONBACKGROUND_1},a.MESSAGE_MENU__DELETE)))},GL=function(e){var n,r=HN().stringSet,i=bk(),a=i.hideMenu,s=i.message,o=i.onDownloadClick,l=s.url;return t.createElement(Ck,{onClick:function(){return a()}},null!==(n=e.children)&&void 0!==n?n:t.createElement("a",{className:"sendbird-message__bottomsheet--hyperlink",rel:"noopener noreferrer",href:l,target:"_blank",onClick:o},t.createElement(pA,{type:_A.DOWNLOAD,fillColor:mA.PRIMARY,width:"24px",height:"24px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},r.MESSAGE_MENU__SAVE)))},jL=function(e){var n,r,i,a,s=e.hideMenu,o=e.channel,l=e.emojiContainer,u=e.message,c=e.replyType,d=e.userId,h=e.resendMessage,f=e.deleteMessage,p=e.toggleReaction,_=e.isReactionEnabled,m=void 0!==_&&_,v=e.showEdit,g=e.showRemove,E=e.deleteMenuState,b=e.setQuoteMessage,y=e.onReplyInThread,C=e.isOpenedFromThread,T=void 0!==C&&C,N=e.onDownloadClick,S=e.renderMenuItems,I=(null===(n=null==u?void 0:u.sender)||void 0===n?void 0:n.userId)===d,w=yT().state.config.isOnline,A=pM(u),M=pM(u)&&uM(u)&&I,O=w&&dM(u)&&(null==u?void 0:u.isResendable)&&I,R=!hM(u)&&I,D=I&&(void 0===E||"HIDE"!==E)&&R,k=void 0!==E&&"DISABLE"===E||(null!==(i=null===(r=null==u?void 0:u.threadInfo)||void 0===r?void 0:r.replyCount)&&void 0!==i?i:0)>0,L=uM(u)&&_M(u)&&!OM(u),x=!dM(u)&&!hM(u)&&m,U="QUOTE_REPLY"===c&&!dM(u)&&!hM(u)&&(null==o?void 0:o.isGroupChannel())&&!(null==o?void 0:o.isBroadcast),P="THREAD"===c&&!T&&!dM(u)&&!hM(u)&&!vM(u)&&(null==o?void 0:o.isGroupChannel())&&!(null==o?void 0:o.isBroadcast),F=Math.floor(window.innerWidth/38)-1,B=t.useState(!1),H=B[0],G=B[1],j=l&&jM(l),V=H?j:null==j?void 0:j.slice(0,F),q=j&&j.length>F,z={message:u,hideMenu:s,setQuoteMessage:b,onReplyInThread:y,onMoveToParentMessage:function(){},showEdit:v,showRemove:g,deleteMessage:f,resendMessage:h,isOnline:w,disableDeleteMessage:k,triggerRef:null,containerRef:null,onDownloadClick:N};return t.createElement(Ek,{value:z},t.createElement(rL,{onBackdropClick:s},t.createElement("div",{className:"sendbird-message__bottomsheet"},x&&t.createElement("div",{className:"sendbird-message__bottomsheet-reactions"},t.createElement("ul",{className:"sendbird-message__bottomsheet-reaction-bar"},t.createElement("div",{className:WT("sendbird-message__bottomsheet-reaction-bar__row",H&&"sendbird-message__bottomsheet-reaction-bar__all")},V.map((function(e){var n,r,i,a=null===(i=null===(r=null===(n=null==u?void 0:u.reactions)||void 0===n?void 0:n.filter((function(t){return t.key===e.key}))[0])||void 0===r?void 0:r.userIds)||void 0===i?void 0:i.some((function(e){return e===d}));return t.createElement(zk,{key:e.key,width:"".concat(38,"px"),height:"".concat(38,"px"),selected:a,onClick:function(){s(),null==p||p(u,e.key,a)},testID:"ui_mobile_emoji_reactions_menu_".concat(e.key)},t.createElement(kA,{url:(null==e?void 0:e.url)||"",width:"28px",height:"28px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.QUESTION,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}))})),q&&!H&&t.createElement(zk,{key:"emoji_more",width:"38px",height:"38px",onClick:function(){return G(!0)},testID:"ui_mobile_emoji_reactions_menu_emojiadd"},t.createElement(kA,{url:"",width:"28px",height:"28px",placeHolder:function(e){var n=e.style;return t.createElement("div",{style:n},t.createElement(pA,{type:_A.EMOJI_MORE,fillColor:mA.ON_BACKGROUND_3,width:"28px",height:"28px"}))}}))))),!H&&t.createElement("div",{className:"sendbird-message__bottomsheet--actions"},null!==(a=null==S?void 0:S({items:{CopyMenuItem:xL,EditMenuItem:UL,ResendMenuItem:PL,ReplyMenuItem:FL,ThreadMenuItem:BL,DeleteMenuItem:HL}}))&&void 0!==a?a:t.createElement(t.Fragment,null,A&&t.createElement(xL,null),M&&t.createElement(UL,null),O&&t.createElement(PL,null),U&&t.createElement(FL,null),P&&t.createElement(BL,null),D&&t.createElement(HL,null),L&&t.createElement(GL,null))))))},VL=function(e){return t.createElement(t.Fragment,null,(null==e?void 0:e.isReactionEnabled)?t.createElement(jL,m({},e)):t.createElement(LL,m({},e)))};var qL=t.forwardRef((function(e,n){var r,i=e.className,a=e.threadInfo,s=e.onClick,o=a.mostRepliedUsers,l=void 0===o?[]:o,u=a.replyCount,c=HN().stringSet;return t.createElement("div",{className:"sendbird-ui-thread-replies ".concat(i),role:"button",onClick:function(e){null==s||s(e),null==e||e.stopPropagation()},onKeyDown:function(e){null==s||s(e),null==e||e.stopPropagation()},ref:n},t.createElement("div",{className:"sendbird-ui-thread-replies__user-profiles"},l.slice(0,4).map((function(e){return t.createElement(GA,{key:e.userId,className:"sendbird-ui-thread-replies__user-profiles__avatar",src:null==e?void 0:e.profileUrl,alt:"user profile",width:"20px",height:"20px"})})),(null==l?void 0:l.length)>=5&&t.createElement("div",{className:"sendbird-ui-thread-replies__user-profiles__avatar"},t.createElement(GA,{className:"sendbird-ui-thread-replies__user-profiles__avatar__image",src:null===(r=null==l?void 0:l[4])||void 0===r?void 0:r.profileUrl,alt:"user profile",width:"20px",height:"20px"}),t.createElement("div",{className:"sendbird-ui-thread-replies__user-profiles__avatar__cover"}),t.createElement("div",{className:"sendbird-ui-thread-replies__user-profiles__avatar__plus"},t.createElement(pA,{type:_A.PLUS,fillColor:mA.WHITE,width:"16px",height:"16px"})))),t.createElement(yN,{className:"sendbird-ui-thread-replies__reply-counts",type:CN.CAPTION_2,color:TN.PRIMARY},1===u?"".concat(u," ").concat(c.CHANNEL__THREAD_REPLY):"".concat(u>99?c.CHANNEL__THREAD_OVER_MAX:u," ").concat(c.CHANNEL__THREAD_REPLIES)),t.createElement(pA,{className:"sendbird-ui-thread-replies__icon",type:_A.CHEVRON_RIGHT,fillColor:mA.PRIMARY,width:"16px",height:"16px"}))}));function zL(e){var n,r,i,a=e.mentionTemplate,s=e.mentionedUserId,o=e.mentionedUserNickname,l=e.isByMe,u=t.useRef(),c=yT().state,d=null===(n=null==c?void 0:c.config)||void 0===n?void 0:n.userId,h=null===(i=null===(r=null==c?void 0:c.stores)||void 0===r?void 0:r.sdkStore)||void 0===i?void 0:i.sdk,f=d===s,p=t.useState(),_=p[0],m=p[1],v=t.useCallback((function(e){!_&&(null==h?void 0:h.createApplicationUserListQuery)?(null==h?void 0:h.createApplicationUserListQuery({userIdsFilter:[s]})).next().then((function(t){(null==t?void 0:t.length)>0&&m(t[0]),e()})):e()}),[h,s]);return t.createElement(Dk,{menuTrigger:function(e){return t.createElement("a",{className:WT("sendbird-word__mention",f&&"sendbird-word__mention--me"),onClick:function(){return v(e)},ref:u,"data-userid":s,"data-nickname":o,"data-sb-mention":!0},t.createElement(yN,{type:CN.CAPTION_1,color:l?TN.ONCONTENT_1:TN.ONBACKGROUND_1},"".concat(a).concat(o)))},menuItems:function(e){return t.createElement(Sk,{parentRef:u,parentContainRef:u,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:_,onSuccess:e,currentUserId:d}))}})}var KL=/https?:\/\//;function YL(e){var n=e.className,r=void 0===n?"":n,i=e.src,a=e.type,s=e.color,o=e.children,l=KL.test(i)?i:"http://".concat(i);return t.createElement("a",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-link-label",bN(s)],!1).join(" "),href:l,target:"_blank",rel:"noopener noreferrer",onTouchEnd:function(e){e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),YT(l)}},t.createElement(yN,{className:"sendbird-link-label__label",testID:"sendbird-link-label__label",type:a,color:s},o))}var WL=["https:","http:","tel:","mailto:"];function QL(e){var t=decodeURIComponent(e);try{var n=new URL(t).protocol;return WL.some((function(e){return e===n.toLowerCase()}))?t:"#"}catch(r){t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t)}return t}function XL(e){var n=e.tokens,r=pL(),i=null==r?void 0:r.message,a=null==r?void 0:r.isByMe,s=i.updatedAt,o=i.createdAt;return t.createElement(t.Fragment,null,null==n?void 0:n.map((function(e,n){var r=function(e,t,n){return"sb-msg_".concat(e,"_").concat(t,"_").concat(n)}(o,s,n);return tN(e.type).with(HD,(function(){var n=e,i=n.groups;return t.createElement("span",{className:"sendbird-word",key:r,"data-testid":"sendbird-ui-word"},tN(n.markdownType).with("bold",(function(){return t.createElement("span",{style:{fontWeight:"bold"}},t.createElement(XL,{tokens:WD({messageText:i[1]})}))})).with("url",(function(){return t.createElement("a",{className:a?"sendbird-label--color-oncontent-1":"sendbird-label--color-onbackground-1",href:QL(i[2])},t.createElement(XL,{tokens:WD({messageText:i[1]})}))})).otherwise((function(){return t.createElement(t.Fragment,null)})))})).with(PD,(function(){return t.createElement("span",{className:"sendbird-word",key:r,"data-testid":"sendbird-ui-word"},t.createElement(zL,{mentionTemplate:xD,mentionedUserId:e.userId,mentionedUserNickname:e.value,isByMe:a}))})).with(FD,(function(){return t.createElement("span",{className:"sendbird-word",key:r,"data-testid":"sendbird-ui-word"},t.createElement(YL,{src:e.value,type:CN.BODY_1,color:a?TN.ONCONTENT_1:TN.ONBACKGROUND_1},e.value))})).otherwise((function(){return t.createElement(t.Fragment,{key:r},e.value.split("\n").map((function(e){var t,n,r=(null===(t=e.match(/^\s*/))||void 0===t?void 0:t[0])||"",i=(null===(n=e.match(/\s*$/))||void 0===n?void 0:n[0])||"",a=r.replace(/ /g,""),s=i.replace(/ /g,"");return a+e.trim()+s})).join("\n"))}))})))}function ZL(e){var n,r,i,a,s=e.className,o=e.message,l=e.isByMe,u=void 0!==l&&l,c=e.mouseHover,d=void 0!==c&&c,h=e.isMentionEnabled,f=void 0!==h&&h,p=e.isReactionEnabled,_=void 0!==p&&p,m=e.isMarkdownEnabled,v=void 0!==m&&m,g=e.onMessageHeightChange,E=void 0===g?function(){}:g,b=t.useContext(FN).stringSet,y=f&&(null===(n=null==o?void 0:o.mentionedMessageTemplate)||void 0===n?void 0:n.length)>0&&(null==o?void 0:o.mentionedUsers)&&(null===(r=null==o?void 0:o.mentionedUsers)||void 0===r?void 0:r.length)>0,C=t.useMemo((function(){var e;return zD(y?{mentionedUsers:null!==(e=null==o?void 0:o.mentionedUsers)&&void 0!==e?e:void 0,messageText:null==o?void 0:o.mentionedMessageTemplate,includeMarkdown:v}:{messageText:null==o?void 0:o.message,includeMarkdown:v})}),[null==o?void 0:o.updatedAt,null==o?void 0:o.message]),T=function(){var e;return YT(null===(e=null==o?void 0:o.ogMetaData)||void 0===e?void 0:e.url)};return t.createElement("div",{className:LM([null!=s?s:"","sendbird-og-message-item-body",u?"outgoing":"incoming",d?"mouse-hover":"",_&&(null===(i=null==o?void 0:o.reactions)||void 0===i?void 0:i.length)>0?"reactions":""])},t.createElement(yN,{type:CN.BODY_1,color:u?TN.ONCONTENT_1:TN.ONBACKGROUND_1},t.createElement("div",{className:bD},t.createElement(XL,{tokens:C}),RM(o)&&t.createElement(yN,{className:"sendbird-og-message-item-body__text-bubble__message",type:CN.BODY_1,color:u?TN.ONCONTENT_2:TN.ONBACKGROUND_2}," ".concat(b.MESSAGE_EDITED," ")))),(null===(a=o.ogMetaData)||void 0===a?void 0:a.defaultImage)&&t.createElement(JL,{onClick:T,ogImage:o.ogMetaData.defaultImage,onMessageHeightChange:E}),o.ogMetaData&&t.createElement($L,{onClick:T,ogMetaData:o.ogMetaData,onMessageHeightChange:E}),t.createElement("div",{className:"sendbird-og-message-item-body__cover"}))}var JL=function(e){var n=e.onClick,r=e.ogImage,i=e.onMessageHeightChange,a=t.useRef(null),s=$M().isMobile;return t.createElement("div",{ref:a,className:WT("sendbird-og-message-item-body__og-thumbnail",!r.url&&"sendbird-og-message-item-body__og-thumbnail__empty"),onClick:function(){return n()}},t.createElement(kA,{className:"sendbird-og-message-item-body__og-thumbnail__image",url:r.url||"",alt:r.alt||"",width:"100%",height:s?"136px":"240px",onLoad:i,onError:function(){var e,t;try{null===(t=null===(e=null==a?void 0:a.current)||void 0===e?void 0:e.classList)||void 0===t||t.add("sendbird-og-message-item-body__og-thumbnail__empty")}catch(n){}},defaultComponent:t.createElement("div",{className:"sendbird-og-message-item-body__og-thumbnail__place-holder"},t.createElement(pA,{className:"sendbird-og-message-item-body__og-thumbnail__place-holder__icon",type:_A.THUMBNAIL_NONE,width:"56px",height:"56px"}))}))},$L=function(e){var n=e.onClick,r=e.ogMetaData,i=e.onMessageHeightChange;return t.useEffect((function(){i()}),[r.title,r.description,r.url]),t.createElement("div",{className:"sendbird-og-message-item-body__description",onClick:function(){return n()}},r.title&&t.createElement(yN,{className:"sendbird-og-message-item-body__description__title",type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_1},r.title),r.description&&t.createElement(yN,{className:"sendbird-og-message-item-body__description__description",type:CN.BODY_2,color:TN.ONBACKGROUND_1},r.description),r.url&&t.createElement(yN,{className:"sendbird-og-message-item-body__description__url",type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},r.url))};function ex(e){var n,r=e.className,i=void 0===r?"":r,a=e.message,s=e.isByMe,o=void 0!==s&&s,l=e.mouseHover,u=void 0!==l&&l,c=e.isMentionEnabled,d=void 0!==c&&c,h=e.isReactionEnabled,f=void 0!==h&&h,p=e.isMarkdownEnabled,_=void 0!==p&&p,m=t.useContext(FN).stringSet,v=d&&(null==a?void 0:a.mentionedMessageTemplate)&&a.mentionedMessageTemplate.length>0&&(null==a?void 0:a.mentionedUsers)&&a.mentionedUsers.length>0,g=t.useMemo((function(){var e;return zD(v?{mentionedUsers:null!==(e=null==a?void 0:a.mentionedUsers)&&void 0!==e?e:void 0,messageText:null==a?void 0:a.mentionedMessageTemplate,includeMarkdown:_}:{messageText:null==a?void 0:a.message,includeMarkdown:_})}),[null==a?void 0:a.updatedAt,null==a?void 0:a.message]);return t.createElement(yN,{type:CN.BODY_1,color:o?TN.ONCONTENT_1:TN.ONBACKGROUND_1},t.createElement("div",{className:LM([i,ED,o?"outgoing":"incoming",u?"mouse-hover":"",f&&(null===(n=null==a?void 0:a.reactions)||void 0===n?void 0:n.length)>0?"reactions":""])},t.createElement(XL,{tokens:g}),RM(a)&&t.createElement(yN,{className:"sendbird-text-message-item-body__message edited",type:CN.BODY_1,color:o?TN.ONCONTENT_2:TN.ONBACKGROUND_2}," ".concat(m.MESSAGE_EDITED," "))))}function tx(e){var n,r=this,i=e.className,a=void 0===i?"":i,s=e.message,o=e.isByMe,l=void 0!==o&&o,u=e.mouseHover,c=void 0!==u&&u,d=e.isReactionEnabled,h=void 0!==d&&d,f=e.truncateLimit,p=e.onBeforeDownloadFileMessage,_=null;try{var m=yT().state.config.logger;_=m}catch(T){}var v=$M().isMobile,b=null!=f?f:v?20:void 0,y=function(){return YT(null==s?void 0:s.url)},C=p?function(){return g(r,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,p({message:s})];case 1:return r.sent()?y():null===(t=null==_?void 0:_.info)||void 0===t||t.call(_,"FileMessageItemBody: Not allowed to download."),[3,3];case 2:return e=r.sent(),null===(n=null==_?void 0:_.error)||void 0===n||n.call(_,"FileMessageItemBody: Error occurred while determining download continuation:",e),[3,3];case 3:return[2]}}))}))}:y;return t.createElement("div",{className:LM([a,"sendbird-file-message-item-body",l?"outgoing":"incoming",c?"mouse-hover":"",h&&(null===(n=null==s?void 0:s.reactions)||void 0===n?void 0:n.length)>0?"reactions":""])},t.createElement("div",{className:"sendbird-file-message-item-body__file-icon"},t.createElement(pA,{className:"sendbird-file-message-item-body__file-icon__icon",type:{IMAGE:_A.PHOTO,VIDEO:_A.PLAY,AUDIO:_A.FILE_AUDIO,GIF:_A.GIF,OTHERS:_A.FILE_DOCUMENT}[lM(null==s?void 0:s.type)],fillColor:mA.PRIMARY,width:"24px",height:"24px"})),t.createElement(tO,{className:"sendbird-file-message-item-body__file-name",onClick:C,color:l?qM.ONCONTENT_1:qM.ONBACKGROUND_1},t.createElement(yN,{className:"sendbird-file-message-item-body__file-name__text",testID:"sendbird-file-message-item-body__file-name__text",type:CN.BODY_1,color:l?TN.ONCONTENT_1:TN.ONBACKGROUND_1},HM((null==s?void 0:s.name)||(null==s?void 0:s.url),b))))}function nx(e,n){return t.useLayoutEffect((function(){var t;null===(t=e.current)||void 0===t||t.focus()}),[e.current]),am((function(e){var t=n[e.key];null==t||t(e),e.stopPropagation()}))}var rx="MULTI";function ix(e){if(e.viewerType!==rx){var n=e.onDelete,r=e.isByMe,i=e.disableDelete,a=e.className;return r?t.createElement("div",{className:"sendbird-fileviewer__header__right__actions__delete ".concat(a)},t.createElement(pA,{className:i?"disabled":"",type:_A.DELETE,fillColor:i?mA.GRAY:mA.ON_BACKGROUND_1,height:"24px",width:"24px",onClick:function(e){i||null==n||n(e)}})):t.createElement(t.Fragment,null)}return t.createElement(t.Fragment,null)}function ax(e){if(e.viewerType===rx){var n=e.onClickLeft,r=e.onClickRight;return t.createElement("div",{className:"sendbird-file-viewer-slider"},t.createElement("div",{className:"sendbird-file-viewer-arrow--left"},t.createElement(pA,{type:_A.SLIDE_LEFT,fillColor:mA.ON_BACKGROUND_1,height:mg,width:mg,onClick:function(e){null==n||n(),e.stopPropagation()}})),t.createElement("div",{className:"sendbird-file-viewer-arrow--right"},t.createElement(pA,{type:_A.SLIDE_LEFT,fillColor:mA.ON_BACKGROUND_1,height:mg,width:mg,onClick:function(e){e.stopPropagation(),null==r||r()}})))}return t.createElement(t.Fragment,null)}var sx=function(e){var n=e.profileUrl,r=e.nickname,i=e.onClose,a=e.onDownloadClick,s=e,o=s.onClickLeft,l=s.onClickRight,u=t.useRef(null),c=nx(u,{Escape:function(e){return null==i?void 0:i(e)},ArrowLeft:function(){return null==o?void 0:o()},ArrowRight:function(){return null==l?void 0:l()}}),d=function(e){var t=e.props;if(t.viewerType===rx){var n=t;return n.fileInfoList[n.currentIndex]}var r=t;return{name:r.name,type:r.type,url:r.url}}({props:e}),h=d.name,f=d.type,p=d.url,_=t.useContext(FN).stringSet;return t.createElement($k,{onClose:i},t.createElement("div",{className:"sendbird-fileviewer","data-testid":"sendbird-fileviewer",onKeyDown:c,tabIndex:1,ref:u},t.createElement("div",{className:"sendbird-fileviewer__header"},t.createElement("div",{className:"sendbird-fileviewer__header__left"},t.createElement("div",{className:"sendbird-fileviewer__header__left__avatar"},t.createElement(GA,{height:"32px",width:"32px",src:n})),t.createElement("div",{className:"sendbird-fileviewer__header__left__text-container"},t.createElement(yN,{className:"sendbird-fileviewer__header__left__filename",type:CN.H_2,color:TN.ONBACKGROUND_1},h),t.createElement(yN,{className:"sendbird-fileviewer__header__left__sender-name",type:CN.BODY_1,color:TN.ONBACKGROUND_2},r))),t.createElement("div",{className:"sendbird-fileviewer__header__right"},sM(f)&&t.createElement("div",{className:"sendbird-fileviewer__header__right__actions"},t.createElement("a",{className:"sendbird-fileviewer__header__right__actions__download",rel:"noopener noreferrer",href:p,target:"_blank",onClick:a},t.createElement(pA,{type:_A.DOWNLOAD,fillColor:mA.ON_BACKGROUND_1,height:"24px",width:"24px"})),t.createElement(ix,m({className:"sendbird-fileviewer__header__right__actions__delete"},e))),t.createElement("div",{className:"sendbird-fileviewer__header__right__actions__close"},t.createElement(pA,{type:_A.CLOSE,fillColor:mA.ON_BACKGROUND_1,height:"24px",width:"24px",onClick:function(e){return null==i?void 0:i(e)}})))),t.createElement("div",{className:"sendbird-fileviewer__content"},iM(f)&&t.createElement("video",{controls:!0,className:"sendbird-fileviewer__content__video"},t.createElement("source",{src:p,type:f})),rM(f)&&t.createElement("img",{src:p,alt:h,className:e.viewerType===rx?"sendbird-fileviewer__content__img__multi":"sendbird-fileviewer__content__img"}),!sM(f)&&t.createElement("div",{className:"sendbird-fileviewer__content__unsupported"},t.createElement(yN,{type:CN.H_1,color:TN.ONBACKGROUND_1},(null==_?void 0:_.UI__FILE_VIEWER__UNSUPPORT)||"Unsupported message")),t.createElement(ax,m({},e)))))};function ox(e){var r,i,a,s=e.message,o=e.statefulFileInfoList,l=void 0===o?[]:o,u=e.onClose,c=e.isByMe,d=void 0!==c&&c,h=e.onDelete,f=e.currentIndex,p=e.onClickLeft,_=e.onClickRight,m=e.onDownloadClick;if(mM(s)){var v=s;return t.createElement(sx,{profileUrl:v.sender.profileUrl,nickname:v.sender.nickname,viewerType:rx,fileInfoList:l.filter((function(e){return e.url})).map((function(e){return{name:e.fileName||"",type:e.mimeType||"",url:e.url||""}})),currentIndex:f||0,onClickLeft:p||zT,onClickRight:_||zT,onClose:u,onDownloadClick:m})}if(_M(s)){v=s;return n.createPortal(t.createElement(sx,{profileUrl:null===(r=v.sender)||void 0===r?void 0:r.profileUrl,nickname:null===(i=v.sender)||void 0===i?void 0:i.nickname,name:v.name,type:v.type,url:null==v?void 0:v.url,isByMe:d,disableDelete:((null===(a=v.threadInfo)||void 0===a?void 0:a.replyCount)||0)>0,onClose:u,onDelete:h||zT,onDownloadClick:m}),document.getElementById(Wk))}return t.createElement(t.Fragment,null)}function lx(e){var n,r=e.children,i=e.className,a=e.message,s=e.isReactionEnabled;return t.createElement("div",{className:"sendbird-image-grid-wrap"},t.createElement("div",{className:LM([null!=i?i:"","sendbird-image-grid",s&&(null===(n=null==a?void 0:a.reactions)||void 0===n?void 0:n.length)>0?"reactions":""])},r))}var ux={CHAT_WEB:"calc(".concat(200,"px - ").concat(6,"px)"),CHAT_MOBILE:"calc(50vw - ".concat(77,"px)"),THREAD_PARENT_WEB:"calc(".concat(118,"px)"),THREAD_PARENT_MOBILE:"calc(50vw - ".concat(42,"px)"),THREAD_CHILD_WEB:"calc(".concat(94,"px)"),THREAD_CHILD_MOBILE:"calc(50vw - ".concat(72,"px)")},cx={CHAT_WEB:"6px",CHAT_MOBILE:"6px",THREAD_PARENT_WEB:"6px",THREAD_PARENT_MOBILE:"6px",THREAD_CHILD_WEB:"6px",THREAD_CHILD_MOBILE:"6px"},dx="34px",hx="parent",fx="child";function px(e){var n=this,r=e.className,i=e.message,a=e.isReactionEnabled,s=void 0!==a&&a,o=e.threadMessageKindKey,l=e.statefulFileInfoList,u=void 0===l?[]:l,c=e.onBeforeDownloadFileMessage,d=void 0===c?null:c,h=yT().state.config.logger,f=t.useState(-1),p=f[0],_=f[1];return o?t.createElement(t.Fragment,null,p>-1&&t.createElement(ox,{message:i,statefulFileInfoList:u,currentIndex:p,onClickLeft:function(){_(0===p?u.length-1:p-1)},onClickRight:function(){_(p===u.length-1?0:p+1)},onClose:function(){_(-1)},onDownloadClick:function(e){return g(n,void 0,void 0,(function(){var t,n,r;return E(this,(function(a){switch(a.label){case 0:if(!d)return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d({message:i,index:p})];case 2:return a.sent()||(e.preventDefault(),null===(n=null==h?void 0:h.info)||void 0===n||n.call(h,"MultipleFilesMessageItemBody: Not allowed to download.")),[3,4];case 3:return t=a.sent(),null===(r=null==h?void 0:h.error)||void 0===r||r.call(h,"MultipleFilesMessageItemBody: Error occurred while determining download continuation:",t),[3,4];case 4:return[2]}}))}))}}),t.createElement(lx,{className:r,message:i,isReactionEnabled:s},u.map((function(e,n){var r,a,s,l;return t.createElement("div",{className:"sendbird-multiple-files-image-renderer-wrapper",onClick:i.sendingStatus===pe.SUCCEEDED?function(){return _(n)}:void 0,key:"sendbird-multiple-files-image-renderer-".concat(n,"-").concat(e.url)},t.createElement(kA,{url:null!==(l=null!==(s=null===(a=null===(r=e.thumbnails)||void 0===r?void 0:r[0])||void 0===a?void 0:a.url)&&void 0!==s?s:e.url)&&void 0!==l?l:"",fixedSize:!1,width:ux[o],maxSideLength:ux.CHAT_WEB,height:ux[o],borderRadius:DA(cx[o],n,u.length),shadeOnHover:!0,isUploaded:!!e.isUploaded,placeHolder:function(n){var r=n.style;return e.mimeType&&aM(e.mimeType)?t.createElement(_x.GIF,{style:r}):t.createElement(_x.Default,{style:r})},defaultComponent:t.createElement(_x.LoadError,null)}))})))):t.createElement(t.Fragment,null)}var _x={Default:function(e){var n=e.style;return t.createElement("div",{className:"sendbird-multiple-files-image-renderer__thumbnail__placeholder",style:n},t.createElement(pA,{type:_A.PHOTO,fillColor:mA.ON_BACKGROUND_2,width:dx,height:dx}))},GIF:function(e){var n=e.style;return t.createElement("div",{className:"sendbird-multiple-files-image-renderer__thumbnail__placeholder",style:n},t.createElement("div",{className:"sendbird-multiple-files-image-renderer__thumbnail__placeholder__icon"},t.createElement(pA,{type:_A.GIF,fillColor:mA.THUMBNAIL_ICON,width:dx,height:dx})))},LoadError:function(){return t.createElement("div",{className:"sendbird-multiple-files-image-renderer__thumbnail__placeholder"},t.createElement(pA,{type:_A.THUMBNAIL_NONE,fillColor:mA.ON_BACKGROUND_2,width:dx,height:dx}))}};var mx="progress-bar-color--primary",vx="progress-bar-color--gray",gx=function(e){var n=e.className,r=void 0===n?"":n,i=e.disabled,a=void 0!==i&&i,s=e.maxSize,o=e.currentSize,l=void 0===o?0:o,u=e.colorType,c=void 0===u?mx:u,d=t.useMemo((function(){return"".concat(l/s*100,"%")}),[l,s]);return t.createElement("div",{className:WT("sendbird-progress-bar",r,c,a&&"progress-bar--disabled")},t.createElement("div",{className:"sendbird-progress-bar__fill",style:{width:d}}))},Ex="INITIALIZE_AUDIO_UNIT",bx="RESET_AUDIO_UNIT",yx="SET_CURRENT_PLAYER",Cx="ON_VOICE_PLAYER_PLAY",Tx="ON_VOICE_PLAYER_PAUSE",Nx="ON_CURRENT_TIME_UPDATE",Sx="IDLE",Ix="PREPARING",wx="PLAYING",Ax="PAUSED",Mx=function(){return{audioFile:null,playbackTime:0,duration:1e3,playingStatus:Sx}},Ox={currentPlayer:null,currentGroupKey:"",audioStorage:{}};function Rx(e,t){var n,r,i,a,s,o,l,u,c;switch(t.type){case Ex:var d=t.payload.groupKey;return(b=(null===(o=e.audioStorage)||void 0===o?void 0:o[d])?e.audioStorage[d]:Mx()).playingStatus=Ix,m(m({},e),{audioStorage:m(m({},e.audioStorage),(n={},n[d]=b,n))});case bx:d=t.payload.groupKey;return m(m({},e),{audioStorage:m(m({},e.audioStorage),(r={},r[d]=Mx(),r))});case yx:var h=t.payload,f=h.audioPlayer;d=h.groupKey;return m(m({},e),{currentPlayer:f,currentGroupKey:d});case Cx:var p=t.payload,_=(d=p.groupKey,p.audioFile);return(b=(null===(l=e.audioStorage)||void 0===l?void 0:l[d])?e.audioStorage[d]:Mx()).audioFile=_,b.playingStatus=wx,m(m({},e),{audioStorage:m(m({},e.audioStorage),(i={},i[d]=b,i))});case Tx:var v=t.payload,g=(d=v.groupKey,v.duration),E=v.currentTime;return(b=(null===(u=e.audioStorage)||void 0===u?void 0:u[d])?e.audioStorage[d]:Mx()).playingStatus=Ax,g===E&&(b.playbackTime=0),m(m({},e),{audioStorage:m(m({},e.audioStorage),(a={},a[d]=b,a))});case Nx:d=t.payload.groupKey;var b,y=e.currentPlayer;E=y.currentTime,g=y.duration;return(b=(null===(c=e.audioStorage)||void 0===c?void 0:c[d])?e.audioStorage[d]:Mx()).playbackTime===b.duration&&b.playingStatus===Ax?b.playbackTime=0:E>0&&g>0&&(b.playbackTime=E,b.duration=g),m(m({},e),{audioStorage:m(m({},e.audioStorage),(s={},s[d]=b,s))});default:return e}}var Dx,kx,Lx=function(e){return YA(navigator.userAgent)&&e.includes("m4a")?{name:"Voice_message.m4a",mimeType:"audio/x-m4a;sbu_type=voice"}:{name:dg,mimeType:hg}},xx=function(){},Ux=t.createContext({play:xx,pause:xx,stop:xx,voicePlayerStore:{currentGroupKey:"",currentPlayer:null,audioStorage:{}}}),Px=function(e){var n=e.children,r=t.useReducer(Rx,Ox),i=r[0],a=r[1],s=i.currentGroupKey,o=i.currentPlayer,l=i.audioStorage,u=yT().state.config.logger,c=function(e){o?e===s?(u.info("VoicePlayer: Pause playing(by group key)."),o.pause()):"ALL"===e&&(u.info("VoicePlayer: Pause playing(all)."),o.pause()):u.warning("VoicePlayer: No currentPlayer to pause.")};return t.createElement(Ux.Provider,{value:{play:function(e){var t=e.groupKey,n=e.audioFile,r=e.audioFileUrl,i=void 0===r?"":r,o=e.audioFileMimeType,d=void 0===o?hg:o;t!==s&&c(s);var h=document.getElementById(ug),f=document.getElementById(cg);h&&f&&h.removeChild(f),u.info("VoicePlayer: Start getting audio file."),new Promise((function(e,r){var s;if(a({type:Ex,payload:{groupKey:t}}),n)return u.info("VoicePlayer: Use the audioFile instance."),void e(n);var o=null===(s=null==l?void 0:l[t])||void 0===s?void 0:s.audioFile;if(o)return u.info("VoicePlayer: Get from the audioStorage."),void e(o);fetch(i).then((function(e){return e.blob()})).then((function(t){var n=new File([t],Lx(d).name,{lastModified:(new Date).getTime(),type:Lx(d).mimeType});e(n),u.info("VoicePlayer: Get the audioFile from URL.")})).catch(r)})).then((function(e){var n,r=document.getElementById(ug);u.info("VoicePlayer: Succeeded getting audio file.",{audioFile:e});var i=l[t]||Mx(),s=new Audio(null===(n=null===URL||void 0===URL?void 0:URL.createObjectURL)||void 0===n?void 0:n.call(URL,e));s.id=cg,s.currentTime=i.playbackTime,s.volume=1,s.loop=!1,s.onplaying=function(){u.info("VoicePlayer: OnPlaying event is called from audioPlayer",{groupKey:t,audioPlayer:s}),a({type:Cx,payload:{groupKey:t,audioFile:e}})},s.onpause=function(){u.info("VoicePlayer: OnPause event is called from audioPlayer",{groupKey:t,audioPlayer:s}),a({type:Tx,payload:{groupKey:t,duration:s.duration,currentTime:s.currentTime}})},s.ontimeupdate=function(){a({type:Nx,payload:{groupKey:t}})},s.onerror=function(e){u.error("VoicePlayer: Failed to load the audioFile on the audio player.",e),a({type:bx,payload:{groupKey:t}})},s.dataset.sbGroupId=t;try{null==r||r.childNodes.forEach((function(e){var n,i,a=e;(null===(n=a.dataset)||void 0===n?void 0:n.sbGroupKey)!==t&&(null===(i=null==a?void 0:a.pause)||void 0===i||i.call(a),r.removeChild(a),u.info("VoicePlayer: Removed other player.",{element:a}))}))}finally{null==s||s.play(),null==r||r.appendChild(s),a({type:yx,payload:{groupKey:t,audioPlayer:s}}),u.info("VoicePlayer: Succeeded playing audio player.",{groupKey:t,audioPlayer:s})}})).catch((function(e){u.warning("VoicePlayer: Failed loading audio file with URL.",e),a({type:bx,payload:{groupKey:t}})}))},pause:c,stop:function(e){void 0===e&&(e=""),s.includes(e)&&(u.info("VoicePlayer: Pause playing(by text)."),c(s))},voicePlayerStore:i}},t.createElement("div",{id:ug,style:{display:"none"}}),n)},Fx=t.createContext({start:zT,stop:zT,isRecordable:!1}),Bx=function(e){var n,r=e.children,i=yT().state.config,a=i.logger,s=i.groupChannel,o=t.useState(null),l=o[0],u=o[1],c=t.useState(!1),d=c[0],h=c[1],f=t.useState(!1),p=f[0],_=f[1],m=HN().stringSet,v=s.enableVoiceMessage,g=t.useState(null),E=g[0],b=g[1],y=null!==(n=lg.find((function(e){return MediaRecorder.isTypeSupported(e)})))&&void 0!==n?n:"";v&&!y&&a.error("VoiceRecorder: Browser does not support mimeType",{mimmeTypes:lg}),t.useEffect((function(){v&&!E&&Promise.resolve().then((()=>Xz)).then((function(e){return b(e)}))}),[v,E]);var C=t.useCallback((function(e){var t,n;if(!v||E){a.info("VoiceRecorder: Start recording."),l&&(T(),a.info("VoiceRecorder: Previous mediaRecorder is stopped.")),function(){try{navigator.permissions.query({name:"microphone"}).then((function(e){"denied"===e.state&&(a.warning("VoiceRecorder: Permission denied."),_(!0))}))}catch(e){a.warning("VoiceRecorder: Failed to check permission.",e)}}(),null===(n=null===(t=null===navigator||void 0===navigator?void 0:navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)||void 0===n||n.call(t,{audio:!0}).then((function(t){var n;a.info("VoiceRecorder: Succeeded getting media stream.",t),h(!0);var r=new MediaRecorder(t,{mimeType:y,audioBitsPerSecond:12e3});r.ondataavailable=function(n){a.info("VoiceRecorder: Succeeded getting an available data.",n.data);var r=new File([n.data],dg,{lastModified:(new Date).getTime(),type:hg});null==E||E.downsampleToWav(r,(function(t){var n,r=null==E?void 0:E.encodeMp3(t),i=new Blob(r,{type:hg}),s=new File([i],dg,{lastModified:(new Date).getTime(),type:hg});null===(n=null==e?void 0:e.onRecordingEnded)||void 0===n||n.call(e,s),a.info("VoiceRecorder: Succeeded converting audio file.",s)})),t.getAudioTracks().forEach((function(e){return e.stop()})),h(!1)},r.onstart=null!==(n=null==e?void 0:e.onRecordingStarted)&&void 0!==n?n:zT,null==r||r.start(),u(r)})).catch((function(e){a.error("VoiceRecorder: Failed getting media stream.",e),u(null)}))}else a.error("VoiceRecorder: Recording audio processor is being loaded.")}),[l,E]),T=t.useCallback((function(){null==l||l.stop(),u(null),h(!1),a.info("VoiceRecorder: Stop recording.")}),[l]);return t.createElement(Fx.Provider,{value:{start:C,stop:T,isRecordable:d}},r,p&&t.createElement($k,{hideFooter:!0,onClose:function(){return _(!1)}},t.createElement(t.Fragment,null,m.VOICE_RECORDING_PERMISSION_DENIED)))},Hx=function(){return t.useContext(Fx)},Gx=function(e){var n,r=e.key,i=void 0===r?"":r,a=e.channelUrl,s=void 0===a?"":a,o=e.audioFile,l=e.audioFileUrl,u=void 0===l?"":l,c=e.audioFileMimeType,d=void 0===c?hg:c,h=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),"".concat(e,"-").concat(t)}(s,i),f=t.useContext(Ux),p=f.play,_=f.pause,m=f.stop,v=f.voicePlayerStore,g=Hx().isRecordable,E=(null===(n=null==v?void 0:v.audioStorage)||void 0===n?void 0:n[h])||Mx();return t.useEffect((function(){return function(){var e;if(o||u){var t=document.getElementById(cg);null===(e=null==t?void 0:t.pause)||void 0===e||e.call(t)}}}),[]),{play:function(){g||null==p||p({groupKey:h,audioFile:o,audioFileUrl:u,audioFileMimeType:d})},pause:function(){null==_||_(h)},stop:function(e){void 0===e&&(e=""),null==m||m(e)},playbackTime:1e3*((null==E?void 0:E.playbackTime)||0),duration:1e3*((null==E?void 0:E.duration)||0),playingStatus:E.playingStatus}},jx=function(e){var n=e.className,r=e.time,i=void 0===r?0:r,a=e.labelType,s=void 0===a?CN.CAPTION_2:a,o=e.labelColor,l=void 0===o?TN.ONCONTENT_1:o,u=i<0?0:i,c=Math.floor(u/36e5),d=Math.floor(u%36e5/6e4),h=Math.floor(u%36e5%6e4/1e3);return t.createElement("div",{className:"sendbird-ui-play-time ".concat(n)},t.createElement(yN,{type:s,color:l},"".concat(c?c+":":"").concat(d<10?"0":"").concat(d||"0",":").concat(h<10?"0":"").concat(h)))},Vx=function(e){var n,r=e.className,i=e.message,a=e.channelUrl,s=e.isByMe,o=void 0!==s&&s,l=e.isReactionEnabled,u=void 0!==l&&l,c=t.useState(!1),d=c[0],h=c[1],f=Gx({channelUrl:a,key:"".concat(null==i?void 0:i.messageId),audioFileUrl:null==i?void 0:i.url,audioFileMimeType:null==i?void 0:i.type}),p=f.play,_=f.pause,m=f.playbackTime,v=void 0===m?0:m,g=f.duration,E=f.playingStatus,b=void 0===E?Sx:E;t.useEffect((function(){var e;u&&(null===(e=null==i?void 0:i.reactions)||void 0===e?void 0:e.length)>0?h(!0):h(!1)}),[u,null===(n=null==i?void 0:i.reactions)||void 0===n?void 0:n.length]);var y=t.useMemo((function(){var e;if(null==i?void 0:i.metaArrays){var t=null===(e=null==i?void 0:i.metaArrays.find((function(e){return"KEY_VOICE_MESSAGE_DURATION"===e.key})))||void 0===e?void 0:e.value[0];return t?parseInt(t):1}return 1}),[null==i?void 0:i.metaArrays]);return t.createElement("div",{className:WT("sendbird-voice-message-item-body",r,d&&"is-reactions-contained")},t.createElement(gx,{className:"sendbird-voice-message-item-body__progress-bar",maxSize:g||y,currentSize:v,colorType:o?mx:vx}),t.createElement("div",{className:"sendbird-voice-message-item-body__status-button"},(b===Sx||b===Ax)&&t.createElement("div",{className:"sendbird-voice-message-item-body__status-button__button",onClick:p},t.createElement(pA,{width:"18px",height:"18px",type:_A.PLAY,fillColor:mA.PRIMARY})),b===Ix&&t.createElement(gA,{width:"22.2px",height:"22.2px"},t.createElement(pA,{width:"22.2px",height:"22.2px",type:_A.SPINNER,fillColor:mA.PRIMARY_2})),b===wx&&t.createElement("div",{className:"sendbird-voice-message-item-body__status-button__button",onClick:function(){_()}},t.createElement("div",{className:"sendbird-voice-message-item-body__status-button__button__pause"},t.createElement("div",{className:"sendbird-voice-message-item-body__status-button__button__pause__inner"}),t.createElement("div",{className:"sendbird-voice-message-item-body__status-button__button__pause__inner"})))),t.createElement(jx,{className:"sendbird-voice-message-item-body__playback-time",time:y-v,labelType:CN.BODY_1,labelColor:o?TN.ONCONTENT_1:TN.ONBACKGROUND_1}))};function qx(e){var n,r,i=e.className,a=void 0===i?"":i,s=e.message,o=e.isByMe,l=void 0!==o&&o,u=e.mouseHover,c=void 0!==u&&u,d=e.isReactionEnabled,h=void 0!==d&&d,f=e.showFileViewer,p=void 0===f?zT:f,_=e.style,v=void 0===_?{}:_,g=SL(s),E=t.useState(!1),b=E[0],y=E[1],C=qk({onLongPress:zT,onClick:function(){uM(s)&&(null==p||p(!0))}});return t.createElement("div",m({className:LM([a,"sendbird-thumbnail-message-item-body",l?"outgoing":"incoming",c?"mouse-hover":"",h&&(null!==(r=null===(n=s.reactions)||void 0===n?void 0:n.length)&&void 0!==r?r:0)>0?"reactions":""])},C),t.createElement(kA,{className:"sendbird-thumbnail-message-item-body__thumbnail",url:g||NL(s),alt:yL(s),width:(null==v?void 0:v.width)||"360px",height:(null==v?void 0:v.height)||"270px",onLoad:function(){y(!0)},placeHolder:function(e){var n=e.style;return t.createElement("div",{className:"sendbird-thumbnail-message-item-body__placeholder",style:n})}}),wM(s)&&!g&&!b&&t.createElement("video",{className:"sendbird-thumbnail-message-item-body__video"},t.createElement("source",{src:NL(s),type:yL(s)})),t.createElement("div",{className:"sendbird-thumbnail-message-item-body__image-cover"}),(wM(s)||AM(s))&&t.createElement("div",{className:"sendbird-thumbnail-message-item-body__icon-wrapper"},t.createElement("div",{className:"sendbird-thumbnail-message-item-body__icon-wrapper__icon"},t.createElement(pA,{type:wM(s)?_A.PLAY:_A.GIF,fillColor:mA.THUMBNAIL_ICON,width:"34px",height:"34px"}))))}function zx(e){var n,r=e.className,i=e.message,a=e.isByMe,s=void 0!==a&&a,o=e.mouseHover,l=void 0!==o&&o,u=e.isReactionEnabled,c=void 0!==u&&u,d=t.useContext(FN).stringSet;return t.createElement("div",{className:LM([null!=r?r:"","sendbird-unknown-message-item-body",s?"outgoing":"incoming",l?"mouse-hover":"",c&&(null===(n=null==i?void 0:i.reactions)||void 0===n?void 0:n.length)>0?"reactions":""])},t.createElement(yN,{className:"sendbird-unknown-message-item-body__header",type:CN.BODY_1,color:s?TN.ONCONTENT_1:TN.ONBACKGROUND_1},d.UNKNOWN__UNKNOWN_MESSAGE_TYPE),t.createElement(yN,{className:"sendbird-unknown-message-item-body__description",type:CN.BODY_1,color:s?TN.ONCONTENT_2:TN.ONBACKGROUND_2},d.UNKNOWN__CANNOT_READ_MESSAGE))}(kx=Dx||(Dx={})).Box="box",kx.Text="text",kx.Image="image",kx.TextButton="textButton",kx.ImageButton="imageButton",kx.Carousel="carouselView";const Kx=(e,t)=>"string"!=typeof t[e]?{}:{[e]:Yx(t[e])};function Yx(e){return e.startsWith("#")?9===e.length?`#${e.slice(3)}${e[1]}${e[2]}`:5===e.length?`#${e.slice(2)}${e[1]}`:e:e}const Wx=e=>e?{viewStyle:Object.assign(Object.assign(Object.assign({},e),Kx("backgroundColor",e)),Kx("borderColor",e))}:{},Qx={run(e){return e.type===Dx.Text||e.type===Dx.TextButton?Object.assign(Object.assign(Object.assign({},e),Wx(e.viewStyle)),(t=e.textStyle)?{textStyle:Object.assign(Object.assign({},t),Kx("color",t))}:{}):e.type===Dx.ImageButton||e.type===Dx.Image?Object.assign(Object.assign(Object.assign({},e),Wx(e.viewStyle)),(n=e.imageStyle)?{imageStyle:Object.assign(Object.assign({},n),Kx("tintColor",n))}:{}):Object.assign(Object.assign({},e),Wx(e.viewStyle));var t,n}},Xx=e=>"string"==typeof e?!Number.isNaN(Number(e)):"number"==typeof e&&!Number.isNaN(e),Zx=(e,t)=>void 0===t[e]||null===t[e]?{}:Xx(t[e])?{[e]:Number(t[e])}:{},Jx=(e,t)=>t?{[e]:{left:Xx(t.left)?Number(t.left):t.left,right:Xx(t.right)?Number(t.right):t.right,top:Xx(t.top)?Number(t.top):t.top,bottom:Xx(t.bottom)?Number(t.bottom):t.bottom}}:{},$x=(e,t)=>t?{[e]:{type:t.type,value:Xx(t.value)?Number(t.value):t.value}}:{},eU=e=>{return Object.assign(Object.assign(Object.assign({},$x("width",e.width)),$x("height",e.height)),(t=e.viewStyle)?{viewStyle:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t),Zx("borderWidth",t)),Zx("radius",t)),Jx("margin",t.margin)),Jx("padding",t.padding))}:{});var t},tU=e=>{return Object.assign(Object.assign(Object.assign({},eU(e)),(t=e.textStyle)?{textStyle:Object.assign(Object.assign(Object.assign({},t),Zx("size",t)),Zx("weight",t))}:{}),Zx("maxTextLines",e));var t},nU=e=>{return Object.assign(Object.assign({},eU(e)),(t=e.metaData)?{metaData:{pixelWidth:Xx(t.pixelWidth)?Number(t.pixelWidth):t.pixelWidth,pixelHeight:Xx(t.pixelHeight)?Number(t.pixelHeight):t.pixelHeight}}:{});var t},rU=e=>{return Object.assign(Object.assign(Object.assign({},eU(e)),(t=e.carouselStyle)?{carouselStyle:Object.assign(Object.assign({},t),Zx("spacing",t))}:{}),{items:e.items.map((e=>Object.assign(Object.assign({},e),{body:Object.assign(Object.assign({},e.body),{items:e.body.items.map((e=>iU.run(e)))})})))});var t},iU={run:e=>e.type===Dx.Text||e.type===Dx.TextButton?Object.assign(Object.assign({},e),tU(e)):e.type===Dx.ImageButton||e.type===Dx.Image?Object.assign(Object.assign({},e),nU(e)):e.type===Dx.Carousel?Object.assign(Object.assign({},e),rU(e)):Object.assign(Object.assign({},e),eU(e))},aU=()=>{},sU=e=>{var t;const n=(null==e?void 0:e.defaultMapper)||aU,r={defaultMapper:n,mapBoxProps:(null==e?void 0:e.mapBoxProps)||n,mapTextProps:(null==e?void 0:e.mapTextProps)||n,mapImageProps:(null==e?void 0:e.mapImageProps)||n,mapTextButtonProps:(null==e?void 0:e.mapTextButtonProps)||n,mapImageButtonProps:(null==e?void 0:e.mapImageButtonProps)||n,mapCarouselProps:(null==e?void 0:e.mapCarouselProps)||n},i=[Qx,iU,...null!==(t=null==e?void 0:e.transforms)&&void 0!==t?t:[]],a=new Set;return{setTransforms(e){i.length=0,i.push(...e),a.clear()},addTransforms(e){i.push(...e)},parse(e,t){const n=i.reduce(((e,t)=>t.run(e)),e);switch(n.type){case Dx.Box:return{transformed:n,properties:r.mapBoxProps(n,t)};case Dx.Text:return{transformed:n,properties:r.mapTextProps(n,t)};case Dx.Image:return{transformed:n,properties:r.mapImageProps(n,t)};case Dx.TextButton:return{transformed:n,properties:r.mapTextButtonProps(n,t)};case Dx.ImageButton:return{transformed:n,properties:r.mapImageButtonProps(n,t)};case Dx.Carousel:return{transformed:n,properties:r.mapCarouselProps(n,t)};default:return{transformed:n,properties:void 0}}}}},oU=({children:e})=>t.createElement(t.Fragment,null,e);function lU(e){var t,n,r,i,a,s;return{box:(null===(t=null==e?void 0:e.views)||void 0===t?void 0:t.box)||oU,text:(null===(n=null==e?void 0:e.views)||void 0===n?void 0:n.text)||oU,image:(null===(r=null==e?void 0:e.views)||void 0===r?void 0:r.image)||oU,imageButton:(null===(i=null==e?void 0:e.views)||void 0===i?void 0:i.imageButton)||oU,textButton:(null===(a=null==e?void 0:e.views)||void 0===a?void 0:a.textButton)||oU,carouselView:(null===(s=null==e?void 0:e.views)||void 0===s?void 0:s.carouselView)||oU}}const uU=t.createContext({sizes:{},updateSize:()=>{}}),cU=({children:e})=>{const[n,r]=t.useState({}),i=t.useCallback((e=>{var{id:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["id"]);t&&r((e=>Object.assign(Object.assign({},e),{[t]:n})))}),[]);return t.createElement(uU.Provider,{value:{sizes:n,updateSize:i}},e)};var dU,hU,fU,pU,_U,mU,vU,gU,EU,bU;(hU=dU||(dU={})).Row="row",hU.Column="column",(pU=fU||(fU={})).Center="center",pU.Left="left",pU.Right="right",pU.Top="top",pU.Bottom="bottom",(mU=_U||(_U={}))[mU.FillParent=0]="FillParent",mU[mU.WrapContent=1]="WrapContent",(gU=vU||(vU={})).Normal="normal",gU.Bold="bold",(bU=EU||(EU={})).AspectFit="aspectFit",bU.AspectFill="aspectFill",bU.ScalesToFill="scalesToFill";const yU=[1,2],CU=e=>{switch(e){case fU.Right:case fU.Bottom:return"flex-end";case fU.Center:return"center";case fU.Left:case fU.Top:default:return"flex-start"}},TU=(e=>{const t=new Map,n=function(n){return(t.has(n)||t.set(n,e.call(this,n)))&&t.get(n)};return n.cache=t,n})((e=>{const t=(e,n)=>{"items"in e&&null!=(null==e?void 0:e.items)&&e.items.forEach(((e,r)=>{const i=`${n}-${r}`;e.id=i,t(e,i)}))};return e.forEach(((e,n)=>{const r=`${n}`;e.id=r,t(e,r)})),e})),NU={rootLayout:dU.Column,view:{size:{width:{type:"flex",value:_U.FillParent},height:{type:"flex",value:_U.WrapContent}}},box:{layout:dU.Row,align:{vertical:fU.Top,horizontal:fU.Left}},textButton:{maxTextLines:1},carousel:{style:{spacing:10,maxChildWidth:240}}},SU=e=>{const n=e.Container||t.Fragment,r=e.UnknownMessage||(()=>null),i=e.parser||sU(),a=e.renderer||lU(),s=({templateItems:e,templateVersion:n,parentLayout:o=NU.box.layout,depth:l=0})=>{if(!(e=>!e||yU.includes(Number(e)))(n))throw new Error(`Cannot parse template item due to unsupported template version: ${n}, ${yU}`);return t.createElement(t.Fragment,null,e.map(((e,u,c)=>{const d=i.parse(e,{parentLayout:o,depth:l,elemIdx:u,siblings:c}),h=d.transformed,f={key:u,siblings:c,parentLayout:o,parsedProperties:d.properties};switch(h.type){case Dx.Carousel:if(!Array.isArray(h.items)||0===h.items.length)throw new Error("Cannot parse template item as Carousel if carousel has no items.");return t.createElement(a.carouselView,Object.assign({},h,f),h.items.map(((e,n)=>t.createElement(s,{key:n,templateItems:e.body.items||[],depth:l+1,templateVersion:e.version}))));case Dx.Box:return t.createElement(a.box,Object.assign({},h,f),t.createElement(s,{templateItems:h.items||[],parentLayout:h.layout,depth:l+1,templateVersion:n}));case Dx.Text:return t.createElement(a.text,Object.assign({},h,f));case Dx.Image:return t.createElement(a.image,Object.assign({},h,f));case Dx.TextButton:return t.createElement(a.textButton,Object.assign({},h,f));case Dx.ImageButton:return t.createElement(a.imageButton,Object.assign({},h,f));default:return t.createElement(r,{item:h})}})))};return{MessageTemplate:({templateVersion:e,templateItems:r,parentLayout:i=NU.rootLayout})=>{const a=TU(r);return t.createElement(cU,null,t.createElement(n,null,t.createElement(s,{isRoot:!0,parentLayout:i,templateItems:a,templateVersion:e})))},MessageTemplateBase:s}};var IU,wU;(wU=IU||(IU={})).Web="web",wU.Custom="custom",wU.UIKit="uikit",Dx.Image,IU.Web,EU.AspectFill,Dx.Box,dU.Column,_U.FillParent,Dx.Box,_U.FillParent,_U.FillParent,Dx.Box,dU.Column,_U.FillParent,_U.WrapContent,Dx.Text,fU.Center,fU.Center,_U.FillParent,Dx.Image,IU.Web,_U.FillParent,EU.AspectFill,Dx.Box,_U.FillParent,Dx.Box,_U.FillParent,_U.FillParent,Dx.Box,dU.Column,Dx.Box,fU.Left,fU.Center,dU.Row,_U.FillParent,Dx.Text,_U.FillParent,fU.Center,fU.Left,vU.Bold,Dx.ImageButton,IU.UIKit,EU.AspectFit,Dx.Text,Dx.TextButton,IU.Web,vU.Bold,Dx.Image,IU.Web,EU.AspectFill,Dx.Box,dU.Column,_U.FillParent,Dx.Box,_U.FillParent,dU.Row,Dx.TextButton,IU.Web,vU.Bold,Dx.TextButton,IU.Web,_U.FillParent,vU.Bold,Dx.Box,_U.FillParent,dU.Row,Dx.Text,_U.FillParent,vU.Bold,Dx.ImageButton,IU.UIKit,EU.AspectFit,Dx.Text,Dx.Box,dU.Column,Dx.Image,EU.AspectFill,Dx.Box,dU.Column,Dx.Text,vU.Bold,Dx.Text,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.Image,EU.AspectFill,Dx.Box,fU.Left,fU.Center,dU.Column,Dx.Text,vU.Bold,Dx.Text,vU.Bold,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.Image,EU.AspectFill,Dx.Box,fU.Left,fU.Center,dU.Column,Dx.Text,vU.Bold,Dx.Text,vU.Bold,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.Image,EU.AspectFill,Dx.Box,fU.Left,fU.Center,dU.Column,Dx.Text,vU.Bold,Dx.Text,vU.Bold,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.TextButton,IU.Web,vU.Bold,Dx.TextButton,IU.Web,vU.Bold,Dx.Box,dU.Column,Dx.Image,Dx.Box,dU.Column,Dx.Box,dU.Row,Dx.Box,dU.Column,Dx.Text,vU.Bold,Dx.Text,Dx.ImageButton,IU.UIKit,Dx.Box,dU.Column,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.Image,EU.AspectFill,Dx.Box,dU.Column,Dx.Text,vU.Bold,Dx.Text,Dx.Box,fU.Left,fU.Center,dU.Row,Dx.Image,EU.AspectFill,Dx.Box,dU.Column,Dx.Text,vU.Bold,Dx.Text,_U.FillParent,_U.FillParent,_U.FillParent,_U.FillParent,_U.FillParent,_U.FillParent,_U.FillParent,_U.WrapContent,_U.FillParent,_U.FillParent;function AU({spacing:e,childrenLength:n,paddingInlineStart:r,paddingInlineEnd:i}){const a=r,s=i,o=t.useRef(null),l=t.useRef(Array.from({length:n},(()=>t.createRef()))),u=t.useRef(!1),c=t.useRef(!1),d=t.useRef(null),h=t.useRef({sx:null,sy:null,offset:0,translateX:0,currentIndex:0}),[f,p]=t.useState((()=>l.current.map((()=>0)))),_=t.useMemo((()=>{let t=a;return f.map(((n,r)=>{const i=t-(r>0?e:0),a=i-n;return t=a,{start:i,end:a}}))}),[f,e,a]),m=t.useMemo((()=>f.reduce(((e,t)=>e+t),0)+e*(n-1)),[f,e,n]);t.useLayoutEffect((()=>{p(l.current.map((e=>{var t,n;return null!==(n=null===(t=e.current)||void 0===t?void 0:t.clientWidth)&&void 0!==n?n:0})))}),[n]),t.useLayoutEffect((()=>{_.length>0&&(h.current.translateX=_[0].start,y())}),[_]);const v=()=>{o.current&&(u.current=!0,o.current.style.cursor="grabbing",o.current.style.transition="none",d.current=requestAnimationFrame(y))},g=()=>{o.current&&(u.current=!1,o.current.style.cursor="grab",o.current.style.transition="transform 0.5s ease",d.current&&(cancelAnimationFrame(d.current),d.current=null))},E=()=>{const{offset:e,currentIndex:t}=h.current,r=Math.abs(e)>=24;let i=t;r&&(e<0&&t<n-1)?i=t+1:r&&(e>0&&t>0)&&(i=t-1),h.current.currentIndex=i,h.current.translateX=function(e){var t,n;const r=null!==(n=null===(t=o.current)||void 0===t?void 0:t.clientWidth)&&void 0!==n?n:0,i=a,l=Math.min(0,r-m)-s;return Math.min(i,Math.max(l,e))}(_[i].start),h.current.offset=0},b=()=>{c.current=!1},y=()=>{o.current&&(o.current.style.transform=`translateX(${h.current.translateX+h.current.offset}px)`),d.current&&(d.current=requestAnimationFrame(y))};return{carouselRef:o,childrenRefs:l,handlers:{onMouseDown:e=>{v(),b(),h.current.sx=e.clientX,h.current.sy=e.clientY,h.current.offset=0,d.current=requestAnimationFrame(y)},onMouseMove:e=>{u.current&&null!==h.current.sx&&(h.current.offset=e.clientX-h.current.sx)},onMouseUp:()=>{u.current&&(b(),E(),g())},onMouseLeave:()=>{u.current&&(b(),E(),g())},onTouchStart:e=>{b(),g();const t=e.touches[0];h.current.sx=t.clientX,h.current.sy=t.clientY,h.current.offset=0,d.current=requestAnimationFrame(y)},onTouchMove:e=>{if(null===h.current.sx||null===h.current.sy||c.current)return;const{clientX:t,clientY:n}=e.touches[0],{sx:r,sy:i}=h.current;if(u.current)return void(h.current.offset=t-r);Math.abs(n-i)>Math.abs(t-r)?c.current=!0:(h.current.offset=t-r,o.current&&(o.current.style.touchAction="pan-x"),v())},onTouchEnd:()=>{o.current&&(o.current.style.touchAction="pan-y"),b(),E(),g()}}}}const MU=({children:e,style:n,spacing:r=NU.carousel.style.spacing,maxChildWidth:i=NU.carousel.style.maxChildWidth})=>{const a=null!=n?n:{},{paddingInlineStart:s=0,paddingInlineEnd:o=0}=a,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(a,["paddingInlineStart","paddingInlineEnd"]),{carouselRef:u,childrenRefs:c,handlers:d}=AU({spacing:r,childrenLength:e.length,paddingInlineStart:Number(s),paddingInlineEnd:Number(o)});return t.createElement("div",Object.assign({},d,{ref:u,className:"sb-message-template__carousel",style:Object.assign(Object.assign({},l),{gap:r,width:"100%",overflow:"visible"})}),e.map(((e,n)=>t.createElement(OU,{ref:c.current[n],key:n,maxChildWidth:i},e))))},OU=t.forwardRef((function({maxChildWidth:e,children:n},r){const i=function(e,t){return!!e.templateItems.find((e=>{var n,r,i,a;const s="flex"===(null===(n=e.width)||void 0===n?void 0:n.type)&&(null===(r=e.width)||void 0===r?void 0:r.value)===_U.FillParent,o="fixed"===(null===(i=e.width)||void 0===i?void 0:i.type)&&(null===(a=e.width)||void 0===a?void 0:a.value)>=t;return s||o}))}(n.props,e)?e:"fit-content";return t.createElement("div",{ref:r,style:{maxWidth:i,width:"100%",flexShrink:0,overflow:"hidden",userSelect:"none"}},n)}));function RU(e){var t;return e.type===Dx.Text&&(null===(t=e.width)||void 0===t?void 0:t.value)==_U.WrapContent}const DU=({size:e,option:t})=>"wrap"===t?"flex"===e.type&&e.value==_U.WrapContent:"fill"===t?"flex"===e.type&&e.value==_U.FillParent:"fixed"===e.type;const kU=e=>{const{imageSize:n,canvasRef:r,canvasProps:i}=LU(e);return t.createElement("canvas",Object.assign({},i,{ref:r,width:null==n?void 0:n.width,height:null==n?void 0:n.height,onError:e.onError}))},LU=e=>{var{metaData:n,tintColor:r}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["metaData","tintColor"]);const a=t.useRef(null),[s,o]=t.useState(),l=t.useMemo((()=>(null==n?void 0:n.pixelHeight)&&(null==n?void 0:n.pixelWidth)?{width:n.pixelWidth,height:n.pixelHeight}:s),[s,null==n?void 0:n.pixelHeight,null==n?void 0:n.pixelWidth]);return t.useEffect((()=>{if(null==l&&a.current){a.current.style.width="100%",a.current.style.height="100%";const e=a.current.getBoundingClientRect();o(e)}}),[l]),t.useEffect((()=>{if(i.src){const e=new Image,t=()=>{if(a.current&&r&&l){const t=a.current.getContext("2d");if(t){const{width:n,height:i}=l;t.clearRect(0,0,n,i),t.beginPath(),t.globalCompositeOperation="source-over",t.fillStyle="#000",t.drawImage(e,0,0,n,i),t.globalCompositeOperation="source-atop",t.fillStyle=r,t.fillRect(0,0,n,i)}}},n=e=>{var t;null===(t=i.onError)||void 0===t||t.call(i,e)};return e.addEventListener("load",t),e.addEventListener("error",n),e.src=i.src,()=>{e.removeEventListener("load",t),e.removeEventListener("error",n)}}}),[i.src,l,r]),{canvasRef:a,canvasProps:i,imageSize:l}},xU=e=>t.createElement("img",Object.assign({},e,{onError:e.onError,referrerPolicy:"no-referrer"})),UU=e=>t.createElement("div",{style:Object.assign(Object.assign({},e.style),{backgroundColor:"transparent"})});const PU=e=>{var{tintColor:n,metaData:r}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["tintColor","metaData"]);const{hasError:a,onError:s}=FU(i.src);return i.onError,a?t.createElement(UU,Object.assign({},i)):n&&!(e=>{var t;return"string"==typeof e&&"gif"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())})(i.src)?t.createElement(kU,Object.assign({},i,{onError:s,tintColor:n,metaData:r})):t.createElement(xU,Object.assign({},i,{onError:s}))},FU=e=>{const[n,r]=t.useState(!1);return t.useEffect((()=>r(!1)),[e]),{hasError:n,onError:t.useCallback((()=>r(!0)),[])}};function BU(e){return Object.assign({display:"flex",overflow:"hidden",boxSizing:"border-box"},e)}function HU(e,t,n){!function(e,t,n){var r,i;const{width:a,height:s}=NU.view.size,{parentLayout:o}=n,l=function(e,t,n){const r={};"flex"===e.type&&e.value==_U.FillParent?(r.width="100%",n===dU.Row&&(r.flex=1)):"fixed"===e.type&&e.value>=0&&(r.width=e.value);"flex"===t.type&&t.value==_U.FillParent?(r.height="100%",n===dU.Column&&(r.flex=1)):"fixed"===t.type&&t.value>=0&&(r.height=t.value);return r}(null!==(r=t.width)&&void 0!==r?r:a,null!==(i=t.height)&&void 0!==i?i:s,o);Object.assign(e,l)}(e,t,n),function(e,t){var n,r,i,a,s,o,l,u;const{viewStyle:c}=t;e.marginBlockStart=null===(n=null==c?void 0:c.margin)||void 0===n?void 0:n.top,e.marginBlockEnd=null===(r=null==c?void 0:c.margin)||void 0===r?void 0:r.bottom,e.marginInlineStart=null===(i=null==c?void 0:c.margin)||void 0===i?void 0:i.left,e.marginInlineEnd=null===(a=null==c?void 0:c.margin)||void 0===a?void 0:a.right;const d=(null!==(o=null===(s=null==c?void 0:c.margin)||void 0===s?void 0:s.left)&&void 0!==o?o:0)+(null!==(u=null===(l=null==c?void 0:c.margin)||void 0===l?void 0:l.right)&&void 0!==u?u:0);d>0&&"100%"===e.width&&(e.width=`calc(100% - ${d}px)`);(null==c?void 0:c.backgroundColor)&&(e.backgroundColor=c.backgroundColor);(null==c?void 0:c.backgroundImageUrl)&&(e.backgroundImage=`url(${JSON.stringify(c.backgroundImageUrl)})`,e.backgroundSize="100% 100%",e.backgroundPosition="center");!function(e,t,n,r){t&&(e["--border-width"]=`${t}px`,e["--border-color"]=n||"transparent");r&&(e.borderRadius=r,e["--border-radius"]=`${r}px`)}(e,null==c?void 0:c.borderWidth,null==c?void 0:c.borderColor,null==c?void 0:c.radius)}(e,t)}function GU(e,t=NU.box.layout,n=NU.box.align){t===dU.Row&&(e.flexDirection="row",e.alignItems=CU(n.vertical),e.justifyContent=CU(n.horizontal)),t===dU.Column&&(e.flexDirection="column",e.alignItems=CU(n.horizontal),e.justifyContent=CU(n.vertical))}function jU(e,t){const{contentMode:n=EU.AspectFit}=t||{};if(n)switch(n){case EU.AspectFill:e.objectFit="cover";break;case EU.AspectFit:e.objectFit="contain";break;case EU.ScalesToFill:e.objectFit="fill"}}function VU(e,t){var n,r,i,a;const s=null==t?void 0:t.metaData;(null==s?void 0:s.pixelHeight)&&(null==s?void 0:s.pixelWidth)&&"fixed"!==(null===(n=null==t?void 0:t.width)||void 0===n?void 0:n.type)&&"fixed"!==(null===(r=null==t?void 0:t.height)||void 0===r?void 0:r.type)&&(e.aspectRatio=`${null===(i=null==t?void 0:t.metaData)||void 0===i?void 0:i.pixelWidth} / ${null===(a=null==t?void 0:t.metaData)||void 0===a?void 0:a.pixelHeight}`)}function qU(e){return{WebkitLineClamp:e,WebkitBoxOrient:"vertical",display:"-webkit-box",overflow:"hidden",overflowWrap:"anywhere",flex:1}}function zU(e,t,n){const{textStyle:r,width:i}=t,{size:a,color:s,weight:o}=r||{};if(a&&(e.fontSize=a),s&&(e.color=s),o&&(e.fontWeight=o),"flex"===(null==i?void 0:i.type)&&(null==i?void 0:i.value)==_U.WrapContent&&(e.width="fit-content",e.maxWidth="100%"),t.type===Dx.Text){const{siblings:t,elemIdx:r}=n;null!=t&&t.length>=2&&t.every(RU)&&(e.flexShrink=t.length-1===r?1:0)}}const KU=t.createContext(null),YU=e=>{const{message:n,handleWebAction:r,handleCustomAction:i,handlePredefinedAction:a,children:s}=e,o=t.useMemo((()=>({message:n,handleWebAction:r,handleCustomAction:i,handlePredefinedAction:a})),[null==n?void 0:n.updatedAt]);return t.createElement(KU.Provider,{value:o},s)};function WU(e){const n=t.useRef(e);return t.useEffect((()=>{n.current=e}),[e]),t.useCallback(((...e)=>n.current(...e)),[n])}function QU(){}function XU(e){const n=WU(e);return function(e,n){const r=WU(e),i=t.useRef(QU);return t.useCallback((t=>{if(i.current(),i.current=QU,null!=t){const n=e(t);"function"==typeof n&&(i.current=n)}}),[r,...n])}((e=>{const t=new ResizeObserver((e=>{null!=e[0]&&n(e[0])}));return t.observe(e),()=>{t.unobserve(e)}}),[n])}function ZU({width:e=NU.view.size.width,height:t=NU.view.size.height,parentLayout:n=NU.box.layout,option:r}){return n===dU.Row?DU({size:e,option:r}):DU({size:t,option:r})}function JU(e){const{style:n,props:r}=e,i=function(){const[e,n]=t.useState(-1),[r,i]=t.useState(-1),[a,s]=t.useState(-1),[o,l]=t.useState(-1),[u,c]=t.useState(-1),[d,h]=t.useState(-1);return{ref:XU((e=>{const{width:t,height:r}=e.contentRect,a=e.target,{width:o,height:u}=a.getBoundingClientRect();n(o),i(u),s(t),l(r),c(o-t),h(u-r)})),width:e,height:r,contentWidth:a,contentHeight:o,paddingWidth:u,paddingHeight:d}}(),{ref:a}=i,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["ref"]),{updateSize:o,sizes:l}=t.useContext(uU),{id:u,siblings:c,parentLayout:d}=r,{width:h,height:f,paddingWidth:p,paddingHeight:_,contentWidth:m,contentHeight:v}=s;t.useEffect((()=>{o({id:r.id,width:h,height:f,paddingWidth:p,paddingHeight:_,contentWidth:m,contentHeight:v})}),[r.id,h,f,p,_,m,v,o]);return{recalculatedStyle:t.useMemo((()=>{const e=(e=0,t)=>{var n,r,i,a;return d===dU.Row?e+(null!==(r=null===(n=l[t.id])||void 0===n?void 0:n.contentWidth)&&void 0!==r?r:0):e+(null!==(a=null===(i=l[t.id])||void 0===i?void 0:i.contentHeight)&&void 0!==a?a:0)};if(ZU({width:r.width,height:r.height,parentLayout:d,option:"fill"})){const t=c.filter((({width:e,height:t})=>!ZU({width:e,height:t,parentLayout:d,option:"fill"}))).reduce(e,0),r=c.filter((({width:e,height:t})=>ZU({width:e,height:t,parentLayout:d,option:"fill"}))).length,i=d===dU.Row?{maxWidth:`calc((100% - ${t}px) / ${r})`}:{maxHeight:`calc((100% - ${t}px) / ${r})`};return Object.assign(Object.assign(Object.assign({},n),i),0==h&&{height:0})}{const t=c.findIndex((e=>e.id===u)),r=c.slice(0,t).filter((({width:e,height:t})=>ZU({width:e,height:t,parentLayout:d,option:"wrap"}))).reduce(e,0);return Object.assign(Object.assign(Object.assign({},n),0===h&&{height:0}),d===dU.Row?{maxWidth:`calc(100% - ${r}px)`}:{maxHeight:`calc(100% - ${r}px)`})}}),[r.width,r.height,d,l,c,n,h,u]),elemRef:a}}const $U=(e="")=>((e="")=>["http://","https://","ftp://"].some((t=>e.startsWith(t))))(e)?e:`https://${e}`,eP=({children:e,props:n,className:r,style:i})=>{var a,s,o,l,u,c,d,h,f;const{recalculatedStyle:p,elemRef:_}=JU({style:i,props:n}),{message:m,handleWebAction:v,handleCustomAction:g,handlePredefinedAction:E}=(()=>{const e=t.useContext(KU);if(!e)throw new Error("useMessageContext must be used within a MessageProvider");return e})(),b=(null===(a=n.viewStyle)||void 0===a?void 0:a.borderWidth)?"sb-message-template__border":"",y={paddingBlockStart:null===(o=null===(s=n.viewStyle)||void 0===s?void 0:s.padding)||void 0===o?void 0:o.top,paddingBlockEnd:null===(u=null===(l=n.viewStyle)||void 0===l?void 0:l.padding)||void 0===u?void 0:u.bottom,paddingInlineStart:null===(d=null===(c=n.viewStyle)||void 0===c?void 0:c.padding)||void 0===d?void 0:d.left,paddingInlineEnd:null===(f=null===(h=n.viewStyle)||void 0===h?void 0:h.padding)||void 0===f?void 0:f.right},C=e=>{var t,r,i,a,s,o,l;"web"===(null===(t=n.action)||void 0===t?void 0:t.type)?v?v(e,n.action,m):null===(i=null===window||void 0===window?void 0:window.open($U(null===(r=null==n?void 0:n.action)||void 0===r?void 0:r.data),"_blank","noopener noreferrer"))||void 0===i||i.focus():"custom"===(null===(a=n.action)||void 0===a?void 0:a.type)?g?g(e,n.action,m):null===(o=null===window||void 0===window?void 0:window.open($U(null===(s=null==n?void 0:n.action)||void 0===s?void 0:s.data),"_blank","noopener noreferrer"))||void 0===o||o.focus():"uikit"===(null===(l=n.action)||void 0===l?void 0:l.type)&&(null==E||E(e,n.action,m))};if(n.type===Dx.TextButton)return t.createElement("button",{className:tP(r,b),"data-sb-template-id":n.elementId,style:Object.assign(Object.assign({},i),y),onClick:C},e);const{display:T,flexDirection:N,justifyContent:S,alignItems:I,objectFit:w}=p,A=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(p,["display","flexDirection","justifyContent","alignItems","objectFit"]);return t.createElement("div",{ref:_,className:tP(r,b,n.action&&"sb-message-template__action"),"data-sb-template-id":n.elementId,style:A,onClick:C},t.createElement("div",{style:Object.assign({display:T,flexDirection:N,justifyContent:S,alignItems:I,objectFit:w,width:"100%",height:"100%"},y)},e))};function tP(...e){return e.filter((e=>!!e)).join(" ")}function nP(e){const{text:n,maxTextLines:r}=e,i=function(e){var t,n,r,i;const a=null===(t=null==e?void 0:e.height)||void 0===t?void 0:t.type,s=null===(n=null==e?void 0:e.width)||void 0===n?void 0:n.type,o="fixed"===a||"fixed"===s,l="flex"===a&&(null===(r=null==e?void 0:e.height)||void 0===r?void 0:r.value)===_U.FillParent||"flex"===s&&(null===(i=null==e?void 0:e.width)||void 0===i?void 0:i.value)===_U.FillParent;return o||l}(e),a="number"==typeof r&&r>0,s=function(e){return e.split("\n").map(((e,n)=>t.createElement(t.Fragment,{key:n},e,t.createElement("br",null))))}(n);if(a||i){const e=Object.assign(Object.assign({},(a||i)&&{maxWidth:"100%"}),i&&{maxHeight:"100%",overflow:"hidden"});return t.createElement("div",{style:e},a?t.createElement("div",{style:qU(r)},s):s)}return a?t.createElement("div",{style:qU(r)},s):s}const rP=lU({views:{box:e=>t.createElement(eP,{className:"sb-message-template__box",elementId:e.elementId,style:e.parsedProperties,props:e},e.children),text:e=>t.createElement(eP,{className:"sb-message-template__text",elementId:e.elementId,style:e.parsedProperties,props:e},nP(e)),image(e){var n;return t.createElement(eP,{className:"sb-message-template__image-container",elementId:e.elementId,style:e.parsedProperties,props:e},t.createElement(PU,{className:"sb-message-template__image",alt:"image",src:e.imageUrl,style:{width:"100%",height:"100%",aspectRatio:"inherit",objectFit:"inherit"},tintColor:null===(n=e.imageStyle)||void 0===n?void 0:n.tintColor,metaData:e.metaData}))},textButton:e=>t.createElement(eP,{className:"sb-message-template__text-button",elementId:e.elementId,style:e.parsedProperties,props:e},nP(Object.assign({maxTextLines:NU.textButton.maxTextLines},e))),imageButton(e){var n;return t.createElement(eP,{className:"sb-message-template__image-container sb-message-template__image-button",elementId:e.elementId,style:e.parsedProperties,props:e},t.createElement(PU,{className:"sb-message-template__image",alt:"image-button",src:e.imageUrl,style:{width:"100%",height:"100%",aspectRatio:"inherit",objectFit:"inherit"},tintColor:null===(n=e.imageStyle)||void 0===n?void 0:n.tintColor,metaData:e.metaData}))},carouselView(e){var n,r;return t.createElement(MU,{maxChildWidth:null===(n=e.carouselStyle)||void 0===n?void 0:n.maxChildWidth,spacing:null===(r=e.carouselStyle)||void 0===r?void 0:r.spacing,style:e.parsedProperties},e.children)}}}),iP=sU({mapBoxProps(e,t){const n=BU();return HU(n,e,t),GU(n,e.layout,e.align),n},mapTextProps(e,t){var n;const r=BU({whiteSpace:"pre-line",wordBreak:"break-word"});return HU(r,e,t),zU(r,e,t),GU(r,dU.Row,e.align),function(e,t=NU.box.align.horizontal){e.textAlign=t}(r,null===(n=e.align)||void 0===n?void 0:n.horizontal),r},mapImageProps(e,t){const n=BU();return HU(n,e,t),jU(n,e.imageStyle),VU(n,e),n},mapTextButtonProps(e,t){const n=BU({whiteSpace:"pre-line",alignItems:"center",justifyContent:"center"});return HU(n,e,t),zU(n,e,t),n},mapImageButtonProps(e,t){const n=BU();return HU(n,e,t),jU(n,e.imageStyle),VU(n,e),n},mapCarouselProps(e,t){var n,r,i,a,s,o,l,u;const c=BU();return HU(c,e,t),c.paddingBlockStart=null===(r=null===(n=e.viewStyle)||void 0===n?void 0:n.padding)||void 0===r?void 0:r.top,c.paddingBlockEnd=null===(a=null===(i=e.viewStyle)||void 0===i?void 0:i.padding)||void 0===a?void 0:a.bottom,c.paddingInlineStart=null===(o=null===(s=e.viewStyle)||void 0===s?void 0:s.padding)||void 0===o?void 0:o.left,c.paddingInlineEnd=null===(u=null===(l=e.viewStyle)||void 0===l?void 0:l.padding)||void 0===u?void 0:u.right,c}});SU({renderer:rP,parser:iP,Container:({children:e,className:n})=>t.createElement("div",{className:`sb-message-template__parent ${n}`,style:{display:"flex",flexDirection:"column",maxWidth:400,marginBlockEnd:24}},e)});var aP=SU({parser:iP,renderer:rP,Container:function(e){var n=e.children,r=e.className;return t.createElement("div",{className:["sb-message-template__parent ".concat(r),"sendbird-message-template__root"].join(" ")},n)}}).MessageTemplate;function sP(e){var n=e.templateItems,r=e.templateVersion;return t.createElement(aP,{templateItems:n,templateVersion:r})}function oP(e){var n=e.className,r=e.message,i=e.isByMe,a=t.useContext(FN).stringSet,s=r.message;return t.createElement("div",{className:LM([null!=n?n:"",i?"outgoing":"incoming","sendbird-template-message-item-body__fallback_message"])},s?t.createElement(t.Fragment,null,t.createElement(yN,{type:CN.BODY_1,color:TN.ONCONTENT_INVERSE_1},s)):t.createElement(t.Fragment,null,t.createElement(yN,{className:"sendbird-template-message-item-body__fallback_message__header",type:CN.BODY_1,color:TN.ONCONTENT_INVERSE_1},a.UNKNOWN__TEMPLATE_ERROR),t.createElement(yN,{className:"sendbird-template-message-item-body__fallback_message__description",type:CN.BODY_1,color:TN.ONCONTENT_INVERSE_3},a.UNKNOWN__CANNOT_READ_TEMPLATE)))}var lP="40px";function uP(e){var n=e.className,r=e.isByMe;return t.createElement("div",{className:WT(n,r?"outgoing":"incoming","sendbird-template-loading-message-item-body")},t.createElement(gA,{className:"sendbird-message-status__icon",testID:"sendbird-message-status-icon",width:lP,height:lP},t.createElement(pA,{type:_A.SPINNER,fillColor:mA.CONTENT_INVERSE_3,width:lP,height:lP})))}var cP=function(e){var n=e.message,r=e.templateVersion,i=e.templateItems;return t.createElement(YU,{message:n},t.createElement(sP,{templateVersion:r,templateItems:i}))},dP=function(e){var t={},n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=e[r];if("object"==typeof i&&null!==i){var a=dP(i),s=a[0],o=a[1];t[r]=s,n[r]=o}else if("string"==typeof i){var l=i.split(","),u=l[0],c=l[1];t[r]=u,n[r]=c||u}else t[r]=i,n[r]=i}return[t,n]};var hP=function(e){function t(t){var n=e.call(this,t)||this;return n.state={hasError:!1},n}return _(t,e),t.getDerivedStateFromError=function(){return{hasError:!0}},t.prototype.componentDidCatch=function(e,t){var n;null===(n=this.props.logger)||void 0===n||n.error("Error caught by ErrorBoundary: ",e,t)},t.prototype.render=function(){return this.state.hasError?this.props.fallbackMessage:this.props.children},t}(t.Component),fP=function(e,t,n){void 0===n&&(n="");for(var r=0,i=Object.entries(e);r<i.length;r++){var a=i[r],s=a[0],o=a[1],l=n?"".concat(n,".").concat(s):s;o&&"object"==typeof o?fP(o,t,l):t[l]=o}};var pP=function(e){var t=e.template,n=e.templateData,r=void 0===n?{}:n,i=e.colorVariables,a=e.theme,s={};i&&a&&(s=function(e){var t=e.colorVariables,n=e.theme,r=dP(t),i=r[0],a=r[1];return"light"===n?i:a}({colorVariables:i,theme:a}));var o,l=m(m({},r),s),u=(fP(l,o={}),o),c=t;return Object.entries(u).forEach((function(e){var t=e[0],n=e[1],r="\\{".concat(t,"\\}"),i=new RegExp(r,"g");c=c.replace(i,n)})),c};function _P(e){var n,r=e.className,i=void 0===r?"":r,a=e.message,s=e.isByMe,o=void 0!==s&&s,l=e.theme,u=void 0===l?"light":l,c=null===(n=a.extendedMessagePayload)||void 0===n?void 0:n[bg],d=function(){return t.createElement(oP,{className:i,message:a,isByMe:o})};if(!(null==c?void 0:c.key))return d();var h=c.key,f=yT().state;if(!f)return d();var p=f.config.logger,_=f.utils,m=_.getCachedTemplate,v=_.updateMessageTemplatesInfo,g=f.stores.appInfoStore.waitingTemplateKeysMap,E=Object.entries(g).map((function(e){var t=e[0],n=e[1];return[t,n.requestedAt,n.erroredMessageIds.join(",")].join("-")})).join("_"),b=t.useState(T()),y=b[0],C=b[1];function T(){var e={filledMessageTemplateItemsList:[],isErrored:!1},t=[],n=m(h);if(n||t.push(h),null==c?void 0:c.view_variables)try{Object.entries(c.view_variables).forEach((function(e){e[0];e[1].forEach((function(e){var n=null==e?void 0:e.key;!n||m(n)||t.includes(n)||t.push(n)}))}))}catch(O){return p.error("TemplateMessageItemBody | received view_variables is malformed: ",c),e.isErrored=!0,e}try{if(t.length>0)!function(e){if(e.length>0){var t=[];e.forEach((function(e){var n=g[e];t.push([e,n])}));var n=Date.now(),r=[];t.forEach((function(e){var t=e[0],i=e[1];if(!i||-1===i.erroredMessageIds.indexOf(a.messageId)&&n>i.requestedAt+500)r.push(t);else if(i.erroredMessageIds.indexOf(a.messageId)>-1)throw new Error("TemplateMessageItemBody | fetching template key ".concat(t," for messageId: ").concat(a.messageId," has failed."))})),r.length>0&&v(r,a.messageId,n)}}(t);else if(n){var r=function(e){var t=pP({template:e.uiTemplate,templateData:c.variables,colorVariables:e.colorVariables,theme:u});if(c.view_variables){var n={};Object.entries(c.view_variables).forEach((function(e){var t=e[0],r=e[1],i=[];r.forEach((function(e){var r=null==e?void 0:e.key;if(r){var a=m(r);a||p.error("TemplateMessageItemBody | simple template is expected to be cached: ",r);var s=pP({template:a.uiTemplate,templateData:e.variables,colorVariables:a.colorVariables,theme:u});i.push({version:a.version,body:{items:JSON.parse(s)}}),n[t]=JSON.stringify(i)}}))})),Object.entries(n).forEach((function(e){var n=e[0],r=e[1];t=function(e,t,n){return function(e,t,n){var r="",i=0;return t.forEach((function(t){var a=t.start,s=t.end;r+=e.slice(i,a)+n,i=s})),r+=e.slice(i)}(e,function(e,t){for(var n=[],r=0;-1!==(r=e.indexOf(t,r));)n.push({start:r,end:r+t.length}),r+=t.length;return n}(e,t),n)}(t,'"@{'.concat(n,'}"'),r)}))}return JSON.parse(t)}(n);e.filledMessageTemplateItemsList.push({version:n.version,items:r})}}catch(O){p.error("TemplateMessageItemBody | fetching non-cached templates by given template keys failed: ",O),e.isErrored=!0}return e}return t.useEffect((function(){if(!y.isErrored&&0===y.filledMessageTemplateItemsList.length){var e=T();C(e)}}),[c.key,E]),y.isErrored?d():0===y.filledMessageTemplateItemsList.length?t.createElement(uP,{className:i,isByMe:o}):t.createElement("div",{className:LM([i,o?"outgoing":"incoming","sendbird-template-message-item-body"])},t.createElement(hP,{fallbackMessage:t.createElement(oP,{className:i,message:a,isByMe:o}),logger:p},y.filledMessageTemplateItemsList.map((function(e,n){var r;return t.createElement(cP,{key:n,message:a,templateVersion:null!==(r=e.version)&&void 0!==r?r:0,templateItems:e.items})}))))}function mP(e){var n=e.text,r=e.onCancel,i=t.useContext(FN).stringSet,a=nx(t.useRef(null),{Enter:function(){return null==r?void 0:r()},Escape:function(){return null==r?void 0:r()}});return t.createElement("div",{onKeyDown:a},t.createElement($k,{contentClassName:"sendbird-message-feedback-modal-content__mobile",type:ZO.PRIMARY,onSubmit:r,onClose:r,submitText:i.BUTTON__OK,renderHeader:function(){return t.createElement("div",{className:"sendbird-modal__header"},t.createElement(yN,{type:CN.H_1,color:TN.ONBACKGROUND_1,className:"sendbird-message-feedback-modal-header"},n))},customFooter:t.createElement("div",{className:"sendbird-message-feedback-modal-footer__root_failed"},t.createElement(fR,{onClick:r},t.createElement(yN,{type:CN.BUTTON_3,color:TN.ONCONTENT_1},i.BUTTON__OK)))}))}function vP(e){var n=e.className,r=void 0===n?"":n,i=e.isByMe,a=e.displayThreadReplies,s=e.bottom,o=e.message,l=e.channel,u=e.userId,c=e.chainBottom,d=void 0!==c&&c,h=t.useRef(null),f=TT(),p=f.disableUserProfile,_=f.renderUserProfile;return i||d||!KM(o)?null:t.createElement(Dk,{menuTrigger:function(e){var n,i;return t.createElement(GA,{className:WT(r,a&&"use-thread-replies"),src:(null===(i=null===(n=null==l?void 0:l.members)||void 0===n?void 0:n.find((function(e){return(null==e?void 0:e.userId)===o.sender.userId})))||void 0===i?void 0:i.profileUrl)||o.sender.profileUrl||"",ref:h,width:"28px",height:"28px",bottom:s,onClick:function(){p||e()}})},menuItems:function(e){return _?_({user:o.sender,close:e,currentUserId:u,avatarRef:h}):t.createElement(Sk,{parentRef:h,parentContainRef:h,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:o.sender,onSuccess:e}))}})}var gP=function(e){var n=e.children;return t.createElement(yN,{className:"sendbird-form-message__input__label",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},n)},EP=function(e){var n=e.name,r=e.required,i=e.errorMessage,a=e.isValid,s=e.values,o=e.isInvalidated,l=e.isSubmitTried,u=e.style,c=e.onFocused,d=e.onChange,h=e.placeHolder,f=e.isSubmitted,p=u.layout,_=u.options,m=void 0===_?[]:_,v=u.resultCount,g=null!=v?v:{},E=g.min,b=void 0===E?1:E,y=g.max,C=void 0===y?1:y,T=f?m.map((function(e){return{state:s.includes(e)?"submittedSelected":"submittedDefault",option:e}})):m.map((function(e){return{state:s.includes(e)?"selected":"default",option:e}})),N=t.useContext(FN).stringSet,S=function(){null==c||c(!0)},I=function(){null==c||c(!1)};return t.createElement("div",{className:"sendbird-form-message__input__root"},t.createElement(gP,null,t.createElement("div",{className:"sendbird-form-message__input__title-container"},n," ",!r&&t.createElement("span",{className:"sendbird-form-message__input__title-optional"},"(optional)"))),t.createElement("div",{className:"sendbird-input_for_form"},function(){switch(p){case"chip":return t.createElement("div",{className:"sendbird-form-message__input__chip-container"},T.map((function(e,n){return t.createElement("div",{className:"sendbird-form-message__input__chip ".concat(e.state),key:n,onClick:function(){return function(e){var t;f||(t=1===b&&1===C?"selected"===T[e].state?[]:[T[e].option]:T.reduce((function(t,n,r){return r===e?"default"===n.state&&s.length<C&&t.push(n.option):"selected"===n.state&&t.push(n.option),t}),[]),d(t))}(n)}},t.createElement("div",{className:"sendbird-form-message__input__chip-text"},e.option),f&&"submittedSelected"===e.state&&t.createElement(pA,{className:"sendbird-form-message__submitted-check-icon-chip",type:_A.DONE,fillColor:mA.SECONDARY_2,width:"20px",height:"20px"}))})));case"textarea":var e=s.length>0?s[0]:"";return t.createElement("div",{className:"sendbird-form-message__input__container"},f?t.createElement("div",{className:"sendbird-form-message__submitted-input-box textarea"},t.createElement("div",{className:"sendbird-form-message__submitted-input-box-text"},e),a&&t.createElement("div",{className:"sendbird-form-message__submitted-check-icon-container"},t.createElement(pA,{type:_A.DONE,fillColor:mA.SECONDARY_2,width:"20px",height:"20px"})),!e&&t.createElement(yN,{className:"sendbird-input__placeholder",type:CN.BODY_1,color:TN.ONBACKGROUND_3},N.FORM_ITEM_OPTIONAL_EMPTY)):t.createElement(t.Fragment,null,t.createElement("textarea",{className:WT("sendbird-input__input",!!i&&"error","sendbird-form-message__input__textarea"),required:r,disabled:f,value:e,onFocus:S,onBlur:I,onChange:function(e){var t=e.target.value;d(t?[t]:[])}}),h&&!e&&t.createElement(yN,{className:"sendbird-input__placeholder textarea",type:CN.BODY_1,color:TN.ONBACKGROUND_3},h)));case"text":case"number":case"phone":case"email":e=s.length>0?s[0]:"";return t.createElement("div",{className:"sendbird-form-message__input__container"},f?t.createElement("div",{className:"sendbird-form-message__submitted-input-box"},t.createElement("div",{className:"sendbird-form-message__submitted-input-box-text"},e),a&&t.createElement("div",{className:"sendbird-form-message__submitted-check-icon-container"},t.createElement(pA,{type:_A.DONE,fillColor:mA.SECONDARY_2,width:"20px",height:"20px"})),!e&&t.createElement(yN,{className:"sendbird-input__placeholder",type:CN.BODY_1,color:TN.ONBACKGROUND_3},N.FORM_ITEM_OPTIONAL_EMPTY)):t.createElement(t.Fragment,null,t.createElement("input",{type:"number"===p?"text":p,inputMode:"number"===p?"numeric":"text",className:"sendbird-input__input ".concat(i?"error":""),name:n,required:r,disabled:f,value:e,onFocus:S,onBlur:I,onChange:function(e){var t=e.target.value;d(t?[t]:[])}}),h&&!e&&t.createElement(yN,{className:"sendbird-input__placeholder",type:CN.BODY_1,color:TN.ONBACKGROUND_3},h)));default:return t.createElement(t.Fragment,null)}}(),i&&(l||o)&&t.createElement(yN,{className:"sendbird-form-message__error-label",type:CN.CAPTION_3},i)))},bP=function(e){var n=e.isByMe,r=e.text;return t.createElement("div",{className:LM(["sendbird-unknown-message-item-body",n?"outgoing":"incoming"])},t.createElement(yN,{className:"sendbird-unknown-message-item-body__description",type:CN.BODY_1,color:n?TN.ONCONTENT_3:TN.ONBACKGROUND_3},r))};function yP(e){var n=this,r=e.message,i=e.form,a=e.isByMe,s=e.logger,o=i.items,l=i.id,u=t.useContext(FN).stringSet,c=t.useState(!1),d=c[0],h=c[1],f=t.useState(!1),p=f[0],_=f[1],v=t.useState((function(){var e=[];return o.forEach((function(t){var n=t.required,r=t.style,i=void 0===r?{}:r,a=i.layout,s=i.defaultOptions,o=void 0===s?[]:s;e.push({draftValues:"chip"===a?o:[],required:n,errorMessage:null,isInvalidated:!1})})),e})),b=v[0],y=v[1],C=i.isSubmitted,T=b.some((function(e){return!!e.errorMessage})),N=b.some((function(e){return e.isInvalidated})),S=T&&(p||N)||C,I=t.useCallback((function(){return g(n,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:_(!0),t.label=1;case 1:return t.trys.push([1,3,,4]),b.some((function(e){return e.errorMessage}))?[2]:b.some((function(e){return e.required&&(!e.draftValues||0===e.draftValues.length)}))?(y((function(e){return e.map((function(e){return e.required&&0===e.draftValues.length?m(m({},e),{errorMessage:u.FORM_ITEM_REQUIRED}):e}))})),[2]):(b.forEach((function(e,t){o[t].draftValues=e.draftValues})),[4,r.submitMessageForm()]);case 2:return t.sent(),[3,4];case 3:return e=t.sent(),h(!0),null==s||s.error(e),[3,4];case 4:return[2]}}))}))}),[b,r.messageId,r.submitMessageForm,l]);return xT(i.version)?t.createElement("div",{className:LM(["".concat(ED," disable-hover"),"sendbird-form-message__root","incoming"])},o.map((function(e,n){var r,i=e.name,a=e.placeholder,s=e.id,o=e.required,l=e.style,c=b[n],d=c.draftValues,h=void 0===d?[]:d,f=c.errorMessage;return t.createElement(EP,{key:s,style:l,placeHolder:a,values:null!==(r=e.submittedValues)&&void 0!==r?r:h,isInvalidated:b[n].isInvalidated,isSubmitTried:p,errorMessage:f,isValid:C,isSubmitted:C,name:i,required:o,onFocused:function(e){!f||e||b[n].isInvalidated?f||y((function(e){var t=e.slice(0);return t[n]=m(m({},t[n]),{isInvalidated:!1}),t})):y((function(e){var t=e.slice(0);return t[n]=m(m({},t[n]),{isInvalidated:!0}),t}))},onChange:function(t){y((function(r){var i=r.slice(0);return i[n]=m(m({},i[n]),{draftValues:t,errorMessage:e.isValid(t)?o&&0===t.length?u.FORM_ITEM_REQUIRED:null:u.FORM_ITEM_INVALID}),i}))}})})),t.createElement(fR,{className:"sendbird-form-message__submit-button",onClick:I,disabled:S,labelType:CN.BUTTON_2,labelColor:TN.ONCONTENT_1},C?"Submitted successfully":"Submit"),d&&t.createElement(mP,{text:"Submit failed.",onCancel:function(){h(!1)}})):t.createElement(bP,{isByMe:a,text:u.FORM_VERSION_ERROR})}var CP=function(e){var n,r=e.className,i=void 0===r?"sendbird-message-content__middle__message-item-body":r,a=e.message,s=e.channel,o=e.showFileViewer,l=e.onMessageHeightChange,u=e.onBeforeDownloadFileMessage,c=e.mouseHover,d=e.isMobile,h=e.config,f=e.isReactionEnabledInChannel,p=e.isByMe,_=null!==(n=e.customSubcomponentsProps)&&void 0!==n?n:{},v=function(e){var n=e.threadMessageKind,r=e.isMobile;return t.useMemo((function(){return tN(n).with(hx,(function(){return r?"THREAD_PARENT_MOBILE":"THREAD_PARENT_WEB"})).with(fx,(function(){return r?"THREAD_CHILD_MOBILE":"THREAD_CHILD_WEB"})).otherwise((function(){return r?"CHAT_MOBILE":"CHAT_WEB"}))}),[r,n])}({isMobile:d}),g=function(e){var n,r,i=t.useRef(new Map),a=function(e,t){return!i.current.has(e)&&t&&i.current.set(e,URL.createObjectURL(t)),i.current.get(e)},s=function(){i.current.size>0&&(i.current.forEach((function(e){return URL.revokeObjectURL(e)})),i.current.clear())};return t.useEffect((function(){return function(){return s()}}),[]),e&&e.isMultipleFilesMessage&&e.isMultipleFilesMessage()?e.sendingStatus===pe.SUCCEEDED?(s(),e.fileInfoList.map((function(e){var t,n;return m(m({},e),{url:e.url,isUploaded:!0,mimeType:null!==(t=e.mimeType)&&void 0!==t?t:void 0,fileName:null!==(n=e.fileName)&&void 0!==n?n:void 0})}))):null!==(r=null===(n=null==e?void 0:e.messageParams)||void 0===n?void 0:n.fileInfoList.map((function(e,t){var n,r;return m(m({},e),{url:null!==(r=null!==(n=a(t))&&void 0!==n?n:e.fileUrl)&&void 0!==r?r:e.file instanceof Blob?a(t,e.file):void 0,isUploaded:!e.file&&"string"==typeof e.fileUrl&&e.fileUrl.length>0})})))&&void 0!==r?r:[]:[]}(a),E=m({},tM),b=(null==s?void 0:s.isGroupChannel())&&h.groupChannel.enableOgtag,y=(null==s?void 0:s.isGroupChannel())&&h.groupChannel.enableFormTypeMessage,C=function(){return t.createElement(zx,{className:i,message:a,isByMe:p,mouseHover:c,isReactionEnabled:f})};return tN(a).when((function(e){return y&&gM(e)}),(function(){return t.createElement(yP,{isByMe:p,message:a,form:a.messageForm,logger:h.logger})})).when(EM,(function(){var e,n,r=a.extendedMessagePayload[bg];return bM(r)?t.createElement(_P,{className:i,message:a,isByMe:p,theme:null==h?void 0:h.theme}):(null===(n=null===(e=h.logger)||void 0===e?void 0:e.error)||void 0===n||n.call(e,"TemplateMessageItemBody: invalid type value in message.extendedMessagePayload.message_template.",r),C())})).when((function(e){return b&&KM(e)&&TM(e)}),(function(){var e;return t.createElement(ZL,{className:i,message:a,isByMe:p,mouseHover:c,isMentionEnabled:null!==(e=h.groupChannel.enableMention)&&void 0!==e&&e,isReactionEnabled:f,onMessageHeightChange:l,isMarkdownEnabled:h.groupChannel.enableMarkdownForUserMessage})})).when(NM,(function(){var e;return t.createElement(ex,{className:i,message:a,isByMe:p,mouseHover:c,isMentionEnabled:null!==(e=h.groupChannel.enableMention)&&void 0!==e&&e,isReactionEnabled:f,isMarkdownEnabled:h.groupChannel.enableMarkdownForUserMessage})})).when((function(e){return DM(e)===E.FILE}),(function(){return t.createElement(tx,{className:i,message:a,isByMe:p,mouseHover:c,isReactionEnabled:f,onBeforeDownloadFileMessage:u})})).when(mM,(function(){var e;return t.createElement(px,m({className:i,message:a,isByMe:p,mouseHover:c,isReactionEnabled:f,threadMessageKindKey:v,statefulFileInfoList:g,onBeforeDownloadFileMessage:u},null!==(e=_.MultipleFilesMessageItemBody)&&void 0!==e?e:{}))})).when(OM,(function(){var e;return t.createElement(Vx,{className:i,message:a,channelUrl:null!==(e=null==s?void 0:s.url)&&void 0!==e?e:"",isByMe:p,isReactionEnabled:f})})).when(SM,(function(){var e;return t.createElement(qx,m({className:i,message:a,isByMe:p,mouseHover:c,isReactionEnabled:f,showFileViewer:o,style:d?{width:"100%"}:{}},null!==(e=_.ThumbnailMessageItemBody)&&void 0!==e?e:{}))})).otherwise((function(){return C()}))},TP=function(e){var n,r,i=e.channel,a=e.message;return t.createElement(yN,{className:"sendbird-message-content__middle__sender-name",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},(null===(r=null===(n=null==i?void 0:i.members)||void 0===n?void 0:n.find((function(e){var t;return(null==e?void 0:e.userId)===(null===(t=null==a?void 0:a.sender)||void 0===t?void 0:t.userId)})))||void 0===r?void 0:r.nickname)||function(e){return(null==e?void 0:e.sender)&&((null==(t=null==e?void 0:e.sender)?void 0:t.friendName)||(null==t?void 0:t.nickname)||(null==t?void 0:t.userId));var t}(a))},NP=t.forwardRef((function(e,n){var r=e.children,i=e.isSelected,a=e.onClick,s=void 0===a?function(){}:a,o=e.disabled,l=void 0!==o&&o;return t.createElement("button",{className:["sendbird-iconbutton__feedback",i?"sendbird-iconbutton__feedback__pressed":"",l?"sendbird-iconbutton__feedback__disabled":""].join(" "),ref:n,type:"button",onClick:function(e){null==s||s(e)},disabled:l},t.createElement("span",{className:["sendbird-iconbutton__feedback__inner",i?"sendbird-iconbutton__feedback__inner__pressed":"",l?"sendbird-iconbutton__feedback__inner__disabled":""].join(" ")},r))}));function SP(e){var n=e.hideMenu,r=e.onEditFeedback,i=e.onRemoveFeedback,a=HN().stringSet;return t.createElement(rL,{onBackdropClick:n},t.createElement("div",{className:"sendbird-message__bottomsheet--feedback-options-menu"},t.createElement("div",{className:"sendbird-message__bottomsheet--feedback-option",onClick:function(){n(),r()}},t.createElement(yN,{type:CN.BODY_1,color:TN.ONBACKGROUND_1},a.EDIT_COMMENT)),t.createElement("div",{className:"sendbird-message__bottomsheet--feedback-option",onClick:function(){n(),i()}},t.createElement(yN,{type:CN.BODY_1,color:TN.ERROR},a.REMOVE_FEEDBACK))))}var IP,wP,AP=function(e){var n=e.children;return t.createElement(yN,{className:"sendbird-input-label",type:CN.CAPTION_3,color:TN.ONBACKGROUND_1},n)},MP=t.forwardRef((function(e,n){var r=e.name,i=e.required,a=e.disabled,s=e.value,o=e.placeHolder,l=e.autoFocus,u=void 0!==l&&l,c=t.useState(s),d=c[0],h=c[1];return t.createElement("div",{className:"sendbird-input"},t.createElement("input",{className:"sendbird-input__input",ref:n,name:r,required:i,disabled:a,value:d,onChange:function(e){h(e.target.value)},autoFocus:u}),o&&!d&&t.createElement(yN,{className:"sendbird-input__placeholder",type:CN.BODY_1,color:TN.ONBACKGROUND_3},o))}));function OP(e){var n,r,i=e.selectedFeedback,a=e.message,s=e.onClose,o=e.onSubmit,l=e.onUpdate,u=e.onRemove,c=t.useContext(FN).stringSet,d=$M().isMobile,h=(null==a?void 0:a.myFeedback)&&i===a.myFeedback.rating,f=null===(n=null==a?void 0:a.myFeedback)||void 0===n?void 0:n.comment,p=function(){var e,t,n;if(i){var r=null!==(t=null===(e=m.current)||void 0===e?void 0:e.value)&&void 0!==t?t:"";h?r!==(null===(n=a.myFeedback)||void 0===n?void 0:n.comment)?null==l||l(i,r):null==s||s():a.myFeedback||null==o||o(i,r)}},_=t.useRef(),m=t.useRef(),v=nx(_,{Enter:function(){return p()},Escape:function(){return null==s?void 0:s()}});return t.createElement("div",{onKeyDown:v},t.createElement($k,{contentClassName:"sendbird-message-feedback-modal-content__mobile",type:ZO.PRIMARY,onCancel:s,onSubmit:function(){p()},submitText:c.BUTTON__SUBMIT,renderHeader:function(){return t.createElement("div",{className:"sendbird-modal__header"},t.createElement(yN,{type:CN.H_1,color:TN.ONBACKGROUND_1,className:"sendbird-message-feedback-modal-header"},c.FEEDBACK_MODAL_TITLE))},customFooter:t.createElement("div",{className:"sendbird-message-feedback-modal-footer__root"},!d&&(null==a?void 0:a.myFeedback)&&i===a.myFeedback.rating?t.createElement(fR,{type:ZO.WARNING,onClick:u,labelType:CN.BUTTON_3},c.BUTTON__REMOVE_FEEDBACK):t.createElement("div",null),t.createElement("div",{className:"sendbird-message-feedback-modal-footer__right-content"},t.createElement(fR,{type:ZO.SECONDARY,onClick:s},t.createElement(yN,{type:CN.BUTTON_3,color:TN.ONBACKGROUND_1},c.BUTTON__CANCEL)),t.createElement(fR,{onClick:function(){return p()}},t.createElement(yN,{type:CN.BUTTON_3,color:TN.ONCONTENT_1},f?c.BUTTON__SAVE:c.BUTTON__SUBMIT))))},t.createElement("div",{className:"sendbird-message-feedback-modal-body__root"},t.createElement(MP,{name:"sendbird-message-feedback-modal-body__root",ref:m,value:h?null===(r=a.myFeedback)||void 0===r?void 0:r.comment:void 0,placeHolder:c.FEEDBACK_CONTENT_PLACEHOLDER,autoFocus:!0}))))}function RP(e){var n,r,i,a=e.channel,s=e.message,o=e.showFileViewer,l=e.onMessageHeightChange,u=e.onBeforeDownloadFileMessage,c=e.renderSenderProfile,d=e.renderMessageHeader,h=e.renderMessageBody,f=e.isByMe,p=e.displayThreadReplies,_=e.mouseHover,v=e.isMobile,g=e.isReactionEnabledInChannel,E=e.hoveredMenuClassName,b=e.templateType,y=e.useReplying,C=yT().state.config,T=HN().dateLocale,N=null!==(n=CM[b])&&void 0!==n?n:"",S=c(m(m({},e),{chainBottom:!1,className:"",isByMe:f,displayThreadReplies:p})),I=d(e),w=h({message:s,channel:a,showFileViewer:o,onMessageHeightChange:l,mouseHover:_,isMobile:v,config:C,isReactionEnabledInChannel:g,isByMe:f,onBeforeDownloadFileMessage:u}),A=t.createElement(yN,{className:WT("sendbird-message-content__middle__body-container__created-at","right",E,N),type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},WO((null==s?void 0:s.createdAt)||0,"p",{locale:T})),M=null===(r=s.extendedMessagePayload)||void 0===r?void 0:r[bg],O=null!==(i=null==M?void 0:M.container_options)&&void 0!==i?i:{},R=O.profile,D=void 0===R||R,k=O.time,L=void 0===k||k,x=O.nickname,U=void 0===x||x,P=D||U;return t.createElement("div",{className:"sendbird-message-content__sendbird-ui-container-type__default__root"},!f&&P&&!y&&t.createElement("div",{className:"sendbird-message-content__sendbird-ui-container-type__default__header-container"},t.createElement("div",{className:"sendbird-message-content__sendbird-ui-container-type__default__header-container__left__profile"},D&&S),U&&I),w,!f&&L&&t.createElement("div",{className:"sendbird-message-content__sendbird-ui-container-type__default__bottom"},A))}function DP(e){var n,r,i,a,s,o,l,u,c,d,h,f,p,_,v=this,b=e.className,y=e.userId,C=e.channel,T=e.message,N=e.disabled,S=void 0!==N&&N,I=e.chainTop,w=void 0!==I&&I,A=e.chainBottom,M=void 0!==A&&A,O=e.isReactionEnabled,R=void 0!==O&&O,D=e.disableQuoteMessage,k=void 0!==D&&D,L=e.replyType,x=e.threadReplySelectType,U=e.nicknamesMap,P=e.emojiContainer,F=e.scrollToMessage,B=e.showEdit,H=e.showRemove,G=e.showFileViewer,j=e.resendMessage,V=e.deleteMessage,q=e.toggleReaction,z=e.setQuoteMessage,K=e.onReplyInThread,Y=e.onQuoteMessageClick,W=e.onMessageHeightChange,Q=e.onBeforeDownloadFileMessage,X=e.filterEmojiCategoryIds,Z=KT(e),J=Z.renderSenderProfile,$=void 0===J?function(e){return t.createElement(vP,m({},e))}:J,ee=Z.renderMessageBody,te=void 0===ee?function(e){return t.createElement(CP,m({},e))}:ee,ne=Z.renderMessageHeader,re=void 0===ne?function(e){return t.createElement(TP,m({},e))}:ne,ie=Z.renderMessageMenu,ae=void 0===ie?function(e){return t.createElement(jk,m({},e))}:ie,se=Z.renderEmojiMenu,oe=void 0===se?function(e){return t.createElement(Kk,m({},e))}:se,le=Z.renderEmojiReactions,ue=void 0===le?function(e){return t.createElement(EL,m({},e))}:le,ce=Z.renderMobileMenuOnLongPress,de=void 0===ce?function(e){return t.createElement(VL,m({},e))}:ce,he=HN(),fe=he.dateLocale,pe=he.stringSet,_e=yT().state,me=_e.config,ve=_e.eventHandlers,ge=me.logger,Ee=null===(n=null==ve?void 0:ve.reaction)||void 0===n?void 0:n.onPressUserProfile,be=t.useRef(),ye=t.useRef(),Ce=t.useRef(),Te=$M().isMobile,Ne=t.useState(!1),Se=Ne[0],Ie=Ne[1],we=t.useState(!1),Ae=we[0],Me=we[1],Oe=function(e,n){var r=t.useState(!1),i=r[0],a=r[1];return t.useEffect((function(){var t,r,i=Array.isArray(n)?n:[n];r=null==i?void 0:i.map((function(t){return null==t?void 0:t.querySelector(e)})),a(null!==(t=null==r?void 0:r.some((function(e){return!!e})))&&void 0!==t&&t);var s=new MutationObserver((function(t){t.forEach((function(t){(t.addedNodes.length||t.removedNodes.length)&&(Array.from(t.addedNodes).forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&t.matches(e)&&a(!0)})),Array.from(t.removedNodes).forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&t.matches(e)&&a(!1)})))}))})),o={childList:!0,subtree:!0};return null==i||i.forEach((function(e){e&&s.observe(e,o)})),function(){s.disconnect()}}),[e,n]),i}("#".concat(Nk(T.messageId),".").concat(Tk),[document.getElementById(Ak),document.getElementById(Ok)]),Re=t.useState(!1),De=Re[0],ke=Re[1],Le=t.useState(!1),xe=Le[0],Ue=Le[1],Pe=t.useState(""),Fe=Pe[0],Be=Pe[1],He=y===(null===(r=null==T?void 0:T.sender)||void 0===r?void 0:r.userId)||"pending"===(null==T?void 0:T.sendingStatus)||"failed"===(null==T?void 0:T.sendingStatus),Ge=He?"outgoing":"incoming",je=w?"chain-top":"",Ve=R&&!(null==C?void 0:C.isEphemeral),qe=Ve?"use-reactions":"",ze=Oe?"sendbird-mouse-hover":"",Ke=!("QUOTE_REPLY"!==L&&"THREAD"!==L||!(null==T?void 0:T.parentMessageId)||!(null==T?void 0:T.parentMessage)||k),Ye=Ke?"use-quote":"",We=(null===(i=null==T?void 0:T.threadInfo)||void 0===i?void 0:i.replyCount)&&T.threadInfo.replyCount>0&&"THREAD"===L,Qe=!He&&!!(null==T?void 0:T.myFeedbackStatus)&&T.myFeedbackStatus!==IP.NOT_APPLICABLE,Xe=!!(null===(a=null==me?void 0:me.groupChannel)||void 0===a?void 0:a.enableFeedback)&&Qe,Ze=null===(s=null==T?void 0:T.myFeedback)||void 0===s?void 0:s.rating,Je=!EM(T)&&!gM(T),$e=Je&&Te,et=Je&&He&&!Te,tt=Je&&We,nt=Je&&!He&&!Te,rt=function(){Ue(!1)},it=function(e){void 0===e&&(e=!1),Te&&e?ke(!0):Ue(!0)},at=qk({onLongPress:function(){$e&&Ie(!0)},onClick:zT},{delay:300,shouldPreventDefault:!1});if(fM(T))return t.createElement(bL,{message:T});if(EM(T)){var st=T.extendedMessagePayload[bg];if(bM(st))return t.createElement(RP,m({},e,{renderSenderProfile:$,renderMessageHeader:re,renderMessageBody:te,isByMe:He,displayThreadReplies:We,mouseHover:Ae,isMobile:Te,isReactionEnabledInChannel:Ve,hoveredMenuClassName:ze,templateType:st.type,useReplying:Ke}))}return t.createElement("div",{className:LM([null!=b?b:"","sendbird-message-content",Ge]),onMouseOver:function(){return Me(!0)},onMouseLeave:function(){return Me(!1)}},t.createElement("div",{className:WT("sendbird-message-content__left",qe,Ge,Ye),"data-testid":"sendbird-message-content__left"},$(m(m({},e),{className:"sendbird-message-content__left__avatar",isByMe:He,displayThreadReplies:We,bottom:(_=2,ye.current&&(_+=4+ye.current.clientHeight),Ce.current&&(_+=4+Ce.current.clientHeight),_>0?_+"px":"")})),et&&t.createElement("div",{className:WT("sendbird-message-content-menu",qe,ze,Ge)},ae({channel:C,message:T,isByMe:He,replyType:L,showEdit:B,showRemove:H,resendMessage:j,setQuoteMessage:z,onReplyInThread:function(e){var t,n,r=e.message;x===ET.THREAD?null==K||K({message:r}):x===ET.PARENT&&(null==F||F(null!==(n=null===(t=r.parentMessage)||void 0===t?void 0:t.createdAt)&&void 0!==n?n:0,r.parentMessageId))},deleteMessage:V}),Ve&&oe({message:T,userId:y,emojiContainer:P,toggleReaction:q,filterEmojiCategoryIds:X}))),t.createElement("div",m({className:WT("sendbird-message-content__middle"),"data-testid":"sendbird-message-content__middle"},Te?m({},at):{},{ref:be}),!He&&!w&&!Ke&&re(e),Ke?t.createElement("div",{className:WT("sendbird-message-content__middle__quote-message",He?"outgoing":"incoming",Ye),"data-testid":"sendbird-message-content__middle__quote-message"},t.createElement(IL,{className:"sendbird-message-content__middle__quote-message__quote",message:T,userId:y,isByMe:He,isUnavailable:(null!==(o=null==C?void 0:C.messageOffsetTimestamp)&&void 0!==o?o:0)>(null!==(u=null===(l=T.parentMessage)||void 0===l?void 0:l.createdAt)&&void 0!==u?u:0),onClick:function(){var e;"THREAD"===L&&x===ET.THREAD&&(null==Y||Y({message:T})),("QUOTE_REPLY"===L||"THREAD"===L&&x===ET.PARENT)&&(null===(e=null==T?void 0:T.parentMessage)||void 0===e?void 0:e.createdAt)&&(null==T?void 0:T.parentMessageId)&&(null==F||F(T.parentMessage.createdAt,T.parentMessageId))}})):null,t.createElement("div",{className:WT("sendbird-message-content__middle__body-container")},He&&!M&&t.createElement("div",{className:WT("sendbird-message-content__middle__body-container__created-at","left",ze)},t.createElement("div",{className:"sendbird-message-content__middle__body-container__created-at__component-container"},t.createElement(hk,{message:T,channel:C}))),te({message:T,channel:C,showFileViewer:G,onMessageHeightChange:W,mouseHover:Ae,isMobile:Te,config:me,isReactionEnabledInChannel:Ve,isByMe:He,onBeforeDownloadFileMessage:Q}),Ve&&(null===(c=null==T?void 0:T.reactions)||void 0===c?void 0:c.length)>0&&t.createElement("div",{className:WT("sendbird-message-content-reactions",mM(T)?"image-grid":He&&!SM(T)&&!TM(T)&&"primary",Ae&&"mouse-hover")},ue({userId:y,message:T,channel:C,isByMe:He,emojiContainer:null!=P?P:new _m({}),memberNicknamesMap:null!=U?U:new Map,toggleReaction:q,onPressUserProfile:Ee,filterEmojiCategoryIds:X})),!He&&!M&&t.createElement(yN,{className:WT("sendbird-message-content__middle__body-container__created-at","right",ze),type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},WO((null==T?void 0:T.createdAt)||0,pe.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:fe}))),tt&&(null==T?void 0:T.threadInfo)&&t.createElement(qL,{className:"sendbird-message-content__middle__thread-replies",threadInfo:null==T?void 0:T.threadInfo,onClick:function(){return null==K?void 0:K({message:T})},ref:ye}),Xe&&t.createElement("div",{className:"sendbird-message-content__middle__body-container__feedback-buttons-container",ref:Ce},t.createElement(NP,{isSelected:(null===(d=null==T?void 0:T.myFeedback)||void 0===d?void 0:d.rating)===Co.GOOD,onClick:function(){return g(v,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:if(Ze)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,T.submitFeedback({rating:Co.GOOD})];case 2:return r.sent(),it(),[3,4];case 3:return e=r.sent(),null===(n=null===(t=null==me?void 0:me.logger)||void 0===t?void 0:t.error)||void 0===n||n.call(t,"Channel: Submit feedback failed.",e),Be(pe.FEEDBACK_FAILED_SUBMIT),[3,4];case 4:return[3,6];case 5:it(!0),r.label=6;case 6:return[2]}}))}))},disabled:!!(null==T?void 0:T.myFeedback)&&T.myFeedback.rating!==Co.GOOD},t.createElement(pA,{type:_A.FEEDBACK_LIKE,width:"24px",height:"24px"})),t.createElement(NP,{isSelected:(null===(h=null==T?void 0:T.myFeedback)||void 0===h?void 0:h.rating)===Co.BAD,onClick:function(){return g(v,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:if(Ze)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,T.submitFeedback({rating:Co.BAD})];case 2:return r.sent(),it(),[3,4];case 3:return e=r.sent(),null===(n=null===(t=null==me?void 0:me.logger)||void 0===t?void 0:t.error)||void 0===n||n.call(t,"Channel: Submit feedback failed.",e),Be(pe.FEEDBACK_FAILED_SUBMIT),[3,4];case 4:return[3,6];case 5:it(!0),r.label=6;case 6:return[2]}}))}))},disabled:!!(null==T?void 0:T.myFeedback)&&T.myFeedback.rating!==Co.BAD},t.createElement(pA,{type:_A.FEEDBACK_DISLIKE,width:"24px",height:"24px"})))),nt&&t.createElement("div",{className:WT("sendbird-message-content__right",je,qe,Ye),"data-testid":"sendbird-message-content__right"},t.createElement("div",{className:WT("sendbird-message-content-menu",je,ze,Ge)},Ve&&oe({className:"sendbird-message-content-menu__reaction-menu",message:T,userId:y,emojiContainer:P,toggleReaction:q,filterEmojiCategoryIds:X}),ae({className:"sendbird-message-content-menu__normal-menu",channel:C,message:T,isByMe:He,replyType:L,showRemove:H,resendMessage:j,setQuoteMessage:z,onReplyInThread:function(e){var t,n,r=e.message;x===ET.THREAD?null==K||K({message:r}):x===ET.PARENT&&(null==F||F(null!==(n=null===(t=r.parentMessage)||void 0===t?void 0:t.createdAt)&&void 0!==n?n:0,r.parentMessageId))},deleteMessage:V}))),Se&&KM(T)&&C&&de({parentRef:be,channel:C,hideMenu:function(){Ie(!1)},message:T,isReactionEnabled:Ve,isByMe:He,userId:y,replyType:L,disabled:S,showRemove:H,emojiContainer:P,resendMessage:j,deleteMessage:V,setQuoteMessage:z,toggleReaction:q,showEdit:B,onReplyInThread:function(e){var t,n=e.message;x===ET.THREAD?null==K||K({message:n}):x===ET.PARENT&&(null==F||F((null===(t=null==n?void 0:n.parentMessage)||void 0===t?void 0:t.createdAt)||0,(null==n?void 0:n.parentMessageId)||0))},onDownloadClick:function(e){return g(v,void 0,void 0,(function(){var t,n,r;return E(this,(function(i){switch(i.label){case 0:if(!Q)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Q({message:T})];case 2:return i.sent()||(e.preventDefault(),null===(n=null==ge?void 0:ge.info)||void 0===n||n.call(ge,"MessageContent: Not allowed to download.")),[3,4];case 3:return t=i.sent(),null===(r=null==ge?void 0:ge.error)||void 0===r||r.call(ge,"MessageContent: Error occurred while determining download continuation:",t),[3,4];case 4:return[2]}}))}))}}),(null===(f=null==T?void 0:T.myFeedback)||void 0===f?void 0:f.rating)&&De&&t.createElement(SP,{hideMenu:function(){ke(!1)},onEditFeedback:function(){ke(!1),Ue(!0)},onRemoveFeedback:function(){return g(v,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),null===T.myFeedback?[3,2]:[4,T.deleteFeedback(T.myFeedback.id)];case 1:r.sent(),r.label=2;case 2:return[3,4];case 3:return e=r.sent(),null===(n=null===(t=null==me?void 0:me.logger)||void 0===t?void 0:t.error)||void 0===n||n.call(t,"Channel: Delete feedback failed.",e),Be(pe.FEEDBACK_FAILED_DELETE),[3,4];case 4:return ke(!1),[2]}}))}))}}),(null===(p=null==T?void 0:T.myFeedback)||void 0===p?void 0:p.rating)&&xe&&t.createElement(OP,{selectedFeedback:T.myFeedback.rating,message:T,onUpdate:function(e,t){return g(v,void 0,void 0,(function(){var n,r,i,a;return E(this,(function(s){switch(s.label){case 0:if(null===T.myFeedback)return[3,4];n=new Mo({id:T.myFeedback.id,rating:e,comment:t}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,T.updateFeedback(n)];case 2:return s.sent(),[3,4];case 3:return r=s.sent(),null===(a=null===(i=null==me?void 0:me.logger)||void 0===i?void 0:i.error)||void 0===a||a.call(i,"Channel: Update feedback failed.",r),Be(pe.FEEDBACK_FAILED_SAVE),[3,4];case 4:return rt(),[2]}}))}))},onClose:rt,onRemove:function(){return g(v,void 0,void 0,(function(){var e,t,n;return E(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),null===T.myFeedback?[3,2]:[4,T.deleteFeedback(T.myFeedback.id)];case 1:r.sent(),r.label=2;case 2:return[3,4];case 3:return e=r.sent(),null===(n=null===(t=null==me?void 0:me.logger)||void 0===t?void 0:t.error)||void 0===n||n.call(t,"Channel: Delete feedback failed.",e),Be(pe.FEEDBACK_FAILED_DELETE),[3,4];case 4:return rt(),[2]}}))}))}}),Fe&&t.createElement(mP,{text:Fe,onCancel:function(){Be("")}}))}(wP=IP||(IP={})).NOT_APPLICABLE="NOT_APPLICABLE",wP.NO_FEEDBACK="NO_FEEDBACK",wP.SUBMITTED="SUBMITTED";var kP=function(e){var n=e.value,r=e.onClickReply,i=e.type,a=void 0===i?"vertical":i;return t.createElement("div",{className:"sendbird-suggested-replies__option ".concat(a),id:n,onClick:function(e){return r(e,n)}},n)},LP=function(e){var n=e.replyOptions,r=e.onSendMessage,i=e.type,a=void 0===i?"vertical":i,s=t.useState(!1),o=s[0],l=s[1],u=function(e,t){e.preventDefault(),r({message:t}),l(!0)};if(o)return null;var c=n.map((function(e,n){return t.createElement(kP,{key:n,value:e,onClickReply:u,type:a})}));return t.createElement("div",{className:"sendbird-suggested-replies ".concat(a)},c)};function xP(e){var n=e.member,r=e.isFocused,i=void 0!==r&&r,a=e.parentScrollRef,s=e.onClick,o=e.onMouseOver,l=e.onMouseMove,u=e.renderUserMentionItem,c=t.useRef(null),d=t.useContext(FN).stringSet;t.useEffect((function(){i&&null!=(null==a?void 0:a.current)&&null!=(null==c?void 0:c.current)&&(a.current.scrollTop>=c.current.offsetTop||a.current.scrollTop+a.current.clientHeight<=c.current.offsetTop)&&c.current.scrollIntoView({block:"nearest",inline:"nearest"})}),[i]);var h=t.useMemo((function(){if(u)return t.createElement("div",{className:"sendbird-mention-suggest-list__user-item",onClick:function(e){return null==s?void 0:s({event:e,member:n,itemRef:c})},onMouseOver:function(e){return null==o?void 0:o({event:e,member:n,itemRef:c})},onMouseMove:function(e){return null==l?void 0:l({event:e,member:n,itemRef:c})},key:(null==n?void 0:n.userId)||GN(),ref:c},u({user:n}))}),[u]);return h||t.createElement("div",{className:WT("sendbird-mention-suggest-list__user-item",i&&"focused"),onClick:function(e){return null==s?void 0:s({event:e,member:n,itemRef:c})},onMouseOver:function(e){return null==o?void 0:o({event:e,member:n,itemRef:c})},onMouseMove:function(e){return null==l?void 0:l({event:e,member:n,itemRef:c})},key:(null==n?void 0:n.userId)||GN(),ref:c},t.createElement(GA,{className:"sendbird-mention-suggest-list__user-item__avatar",src:null==n?void 0:n.profileUrl,alt:"user-profile",width:"24px",height:"24px"}),t.createElement(yN,{className:"sendbird-mention-suggest-list__user-item__nickname",testID:"sendbird-mention-suggest-list__user-item__nickname",type:CN.SUBTITLE_2,color:(null==n?void 0:n.nickname)?TN.ONBACKGROUND_1:TN.ONBACKGROUND_3},(null==n?void 0:n.nickname)||(null==d?void 0:d.MENTION_NAME__NO_NAME)),t.createElement(yN,{className:"sendbird-mention-suggest-list__user-item__user-id",testID:"sendbird-mention-suggest-list__user-item__user-id",type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_2},null==n?void 0:n.userId))}function UP(e,t,n,r){return g(this,void 0,void 0,(function(){return E(this,(function(i){return[2,t.members.sort((function(e,t){var n;return null===(n=e.nickname)||void 0===n?void 0:n.localeCompare(t.nickname)})).filter((function(t){var n;return(null===(n=t.nickname)||void 0===n?void 0:n.toLowerCase().startsWith(r.toLowerCase()))&&t.userId!==e&&t.isActive})).slice(0,n)]}))}))}function PP(e,t,n,r){return g(this,void 0,void 0,(function(){return E(this,(function(i){return[2,t.createMemberListQuery({limit:n+1,nicknameStartsWithFilter:r}).next().then((function(t){return t.filter((function(t){return e!==(null==t?void 0:t.userId)})).slice(0,n)}))]}))}))}var FP=function(e){var n,r,i,a=e.className,s=e.currentChannel,o=e.targetNickname,l=void 0===o?"":o,u=e.onUserItemClick,c=e.onFocusItemChange,d=e.onFetchUsers,h=e.renderUserMentionItem,f=e.inputEvent,p=e.ableAddMention,_=void 0===p||p,m=e.maxMentionCount,v=void 0===m?10:m,g=e.maxSuggestionCount,E=void 0===g?15:g,b=yT().state,y=b.config,C=b.stores,T=y.logger,N=(null===(i=null===(r=null===(n=null==C?void 0:C.sdkStore)||void 0===n?void 0:n.sdk)||void 0===r?void 0:r.currentUser)||void 0===i?void 0:i.userId)||"",S=t.useRef(null),I=HN().stringSet,w=t.useState(null),A=w[0],M=w[1],O=t.useState(""),R=O[0],D=O[1],k=t.useState(""),L=k[0],x=k[1],U=t.useState(null),P=U[0],F=U[1],B=t.useState([]),H=B[0],G=B[1];return t.useEffect((function(){clearTimeout(null!=A?A:void 0),M(setTimeout((function(){D(l)}),300))}),[l]),t.useEffect((function(){var e;((null==f?void 0:f.key)===nR&&P&&H.length>0&&(null==u||u(P)),(null==f?void 0:f.key)===rR)&&(0<(e=H.findIndex((function(e){return(null==e?void 0:e.userId)===(null==P?void 0:P.userId)})))&&(F(H[e-1]),null==c||c(H[e-1])));(null==f?void 0:f.key)===iR&&((e=H.findIndex((function(e){return(null==e?void 0:e.userId)===(null==P?void 0:P.userId)})))<H.length-1&&(F(H[e+1]),null==c||c(H[e+1])))}),[f]),t.useEffect((function(){L&&0===R.indexOf(L)&&0===H.length||(!(null==s?void 0:s.isSuper)||(null==s?void 0:s.createMemberListQuery)?((null==s?void 0:s.isSuper)?PP:UP)(N,s,E,R.slice(1)).then((function(e){e.length<1?T.info("SuggestedMentionList: Fetched member list is empty"):(T.info("SuggestedMentionList: Fetching member list succeeded",{memberList:e}),F(e[0])),x(R),null==d||d(e),G(e)})).catch((function(e){e&&T.error("SuggestedMentionList: Fetching member list failed",e)})):T.warning("SuggestedMentionList: Creating member list query failed"))}),[null==s?void 0:s.url,null==s?void 0:s.members.map((function(e){return e.nickname})).join(),null==s?void 0:s.members.map((function(e){return e.isActive})).join(),R,E,N,H.length,L]),_||0!==H.length?t.createElement("div",{className:WT("sendbird-mention-suggest-list",a),"data-testid":"sendbird-mention-suggest-list",key:"sendbird-mention-suggest-list",ref:S},_&&(null==H?void 0:H.map((function(e){return t.createElement(xP,{key:(null==e?void 0:e.userId)||GN(),member:e,isFocused:(null==e?void 0:e.userId)===(null==P?void 0:P.userId),parentScrollRef:S,onClick:function(e){var t=e.member;null==u||u(t)},onMouseOver:function(e){var t=e.member;F(t)},renderUserMentionItem:h})}))),!_&&t.createElement("div",{className:"sendbird-mention-suggest-list__notice-item"},t.createElement(pA,{className:"sendbird-mention-suggest-list__notice-item__icon",type:_A.INFO,fillColor:mA.ON_BACKGROUND_2,width:"20px",height:"20px"}),t.createElement(yN,{className:"sendbird-mention-suggest-list__notice-item__text",type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_2},I.MENTION_COUNT__OVER_LIMIT.replace("%d",String(v))))):null},BP=function(e,n){var r=t.useState(!1),i=r[0],a=r[1];t.useEffect((function(){i?e():a(!0)}),n)},HP=function(e){var n,r,i=e.message,a=e.children,s=e.hasSeparator,o=e.chainTop,l=e.chainBottom,u=e.handleScroll,c=e.channel,d=e.emojiContainer,h=e.editInputDisabled,f=e.shouldRenderSuggestedReplies,p=e.isReactionEnabled,_=e.replyType,v=e.threadReplySelectType,g=e.nicknamesMap,E=e.scrollToMessage,y=e.toggleReaction,C=e.setQuoteMessage,T=e.onQuoteMessageClick,N=e.onReplyInThreadClick,S=e.onBeforeDownloadFileMessage,I=e.sendUserMessage,w=e.updateUserMessage,A=e.resendMessage,M=e.deleteMessage,O=e.setAnimatedMessageId,R=e.animatedMessageId,D=e.onMessageAnimated,k=e.usedInLegacy,L=void 0===k||k,x=KT(e),U=x.renderUserMentionItem,P=x.renderMessage,F=x.renderMessageContent,B=void 0===F?function(e){return t.createElement(DP,m({},e))}:F,H=x.renderSuggestedReplies,G=void 0===H?function(e){return t.createElement(LP,m({},e))}:H,j=x.renderCustomSeparator,V=x.renderEditInput,q=x.renderFileViewer,z=x.renderRemoveMessageModal,K=x.filterEmojiCategoryIds,Y=HN(),W=Y.dateLocale,Q=Y.stringSet,X=yT().state.config,Z=X.userId,J=X.isOnline,$=X.userMention,ee=X.logger,te=X.groupChannel,ne=(null==$?void 0:$.maxMentionCount)||10,re=(null==$?void 0:$.maxSuggestionCount)||15,ie=t.useState(!1),ae=ie[0],se=ie[1],oe=t.useState(!1),le=oe[0],ue=oe[1],ce=t.useState(!1),de=ce[0],he=ce[1],fe=t.useState(!1),pe=fe[0],_e=fe[1],me=t.useState(""),ve=me[0],ge=me[1],Ee=t.useState([]),be=Ee[0],ye=Ee[1],Ce=t.useState([]),Te=Ce[0],Ne=Ce[1],Se=t.useState(null),Ie=Se[0],we=Se[1],Ae=t.useState(null),Me=Ae[0],Oe=Ae[1],Re=t.useState([]),De=Re[0],ke=Re[1],Le=t.useRef(null),xe=t.useRef(null),Ue=J&&te.enableMention&&ve.length>0&&!DT(c)&&!kT(c),Pe=XO({ref:Le},{logger:ee}),Fe=(null==Pe?void 0:Pe.length)<ne;t.useEffect((function(){ye(be.filter((function(e){var t=e.userId,n=Te.indexOf(t);return!(n<0)&&(Te.splice(n,1),!0)})))}),[Te]),BP((function(){null==u||u()}),[ae,null===(n=null==i?void 0:i.reactions)||void 0===n?void 0:n.length]),BP((function(){null==u||u(!0)}),[null==i?void 0:i.updatedAt,null==i?void 0:i.message]);var Be=t.useRef(f);t.useEffect((function(){Be.current!==f?null==u||u():Be.current=f}),[f]),t.useLayoutEffect((function(){L&&(null==u||u(!0))}),[]),t.useLayoutEffect((function(){var e=[];return R===i.messageId&&(null==xe?void 0:xe.current)?(e.push(setTimeout((function(){_e(!0)}),500)),e.push(setTimeout((function(){O(null),null==D||D()}),1600))):_e(!1),function(){e.forEach((function(e){return clearTimeout(e)}))}}),[R,xe.current,i.messageId]);var He=t.useMemo((function(){var e;return null!==(e=null==j?void 0:j({message:i}))&&void 0!==e?e:null}),[i,j]);return ae&&(null===(r=null==i?void 0:i.isUserMessage)||void 0===r?void 0:r.call(i))?(null==V?void 0:V())||t.createElement(t.Fragment,null,Ue&&t.createElement(FP,{currentChannel:c,targetNickname:ve,inputEvent:null!=Ie?Ie:void 0,renderUserMentionItem:U,onUserItemClick:function(e){e&&ye(b(b([],be,!0),[e],!1)),ge(""),Oe(e),we(null)},onFocusItemChange:function(){we(null)},onFetchUsers:function(e){ke(e)},ableAddMention:Fe,maxMentionCount:ne,maxSuggestionCount:re}),t.createElement(JD,{isEdit:!0,channel:c,disabled:h,ref:Le,mentionSelectedUser:Me,isMentionEnabled:te.enableMention,message:i,onStartTyping:function(){var e;null===(e=null==c?void 0:c.startTyping)||void 0===e||e.call(c)},onUpdateMessage:function(e){var t,n=e.messageId,r=e.message,i=e.mentionTemplate;w(n,{message:r,mentionedUsers:be,mentionedMessageTemplate:i}),se(!1),null===(t=null==c?void 0:c.endTyping)||void 0===t||t.call(c)},onCancelEdit:function(){var e;ge(""),ye([]),Ne([]),ke([]),se(!1),null===(e=null==c?void 0:c.endTyping)||void 0===e||e.call(c)},onUserMentioned:function(e){(null==Me?void 0:Me.userId)===(null==e?void 0:e.userId)&&(Oe(null),ge(""))},onMentionStringChange:function(e){ge(e)},onMentionedUserIdsUpdated:function(e){Ne(e)},onKeyDown:function(e){return!!(Ue&&(null==De?void 0:De.length)>0&&(e.key===nR&&Fe||e.key===rR||e.key===iR))&&(we(e),!0)}})):t.createElement("div",{className:WT("sendbird-msg-hoc sendbird-msg--scroll-ref",pe&&"sendbird-msg-hoc__animated"),"data-testid":"sendbird-message-view",style:a||P?void 0:{marginBottom:"2px"},"data-sb-message-id":i.messageId,"data-sb-created-at":i.createdAt,ref:xe},s&&(He||t.createElement(tR,null,t.createElement(yN,{type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},WO(i.createdAt,Q.DATE_FORMAT__MESSAGE_LIST__DATE_SEPARATOR,{locale:W})))),function(){if(a)return a;if(P){var n=m(m({},e),{renderMessage:void 0});return P(n)}return t.createElement(t.Fragment,null,B({className:"sendbird-message-hoc__message-content",userId:Z,scrollToMessage:E,channel:c,message:i,disabled:!J,chainTop:o,chainBottom:l,isReactionEnabled:p,replyType:_,threadReplySelectType:v,nicknamesMap:g,emojiContainer:d,showEdit:se,showRemove:ue,showFileViewer:he,resendMessage:A,deleteMessage:M,toggleReaction:y,setQuoteMessage:C,onReplyInThread:N,onQuoteMessageClick:T,onMessageHeightChange:u,onBeforeDownloadFileMessage:S,filterEmojiCategoryIds:K}),f&&G({replyOptions:PM(i),onSendMessage:I,type:null==te?void 0:te.suggestedRepliesDirection}),le&&(null==z?void 0:z({message:i,onCancel:function(){return ue(!1)}})),de&&q({message:i,onCancel:function(){return he(!1)}}))}())},GP=function(e){var r=e.message,i=e.onCancel,a=e.deleteMessage,s=e.onDownloadClick,o=r.sender,l=r.type,u=r.url,c=r.name,d=void 0===c?"":c,h=r.threadInfo,f=o.profileUrl,p=o.nickname,_=o.userId,m=yT().state.config;return n.createPortal(t.createElement(jP,{profileUrl:f,nickname:p,type:l,url:u,name:d,onCancel:i,onDelete:function(){return a(r).then((function(){return i()}))},isByMe:m.userId===_,disableDelete:!!(null==h?void 0:h.replyCount)&&h.replyCount>0,onDownloadClick:s}),document.getElementById(Wk))},jP=function(e){var n=e.profileUrl,r=e.nickname,i=e.name,a=e.type,s=e.url,o=e.isByMe,l=e.onCancel,u=e.onDelete,c=e.disableDelete,d=e.onDownloadClick;return t.createElement($k,{onClose:l},t.createElement("div",{className:"sendbird-fileviewer","data-testid":"sendbird-fileviewer"},t.createElement("div",{className:"sendbird-fileviewer__header"},t.createElement("div",{className:"sendbird-fileviewer__header__left"},t.createElement("div",{className:"sendbird-fileviewer__header__left__avatar"},t.createElement(GA,{height:"32px",width:"32px",src:n})),t.createElement("div",{className:"sendbird-fileviewer__header__left__text-container"},t.createElement(yN,{className:"sendbird-fileviewer__header__left__filename",type:CN.H_2,color:TN.ONBACKGROUND_1},i),t.createElement(yN,{className:"sendbird-fileviewer__header__left__sender-name",type:CN.BODY_1,color:TN.ONBACKGROUND_2},r))),t.createElement("div",{className:"sendbird-fileviewer__header__right"},sM(a)&&t.createElement("div",{className:"sendbird-fileviewer__header__right__actions"},t.createElement("a",{className:"sendbird-fileviewer__header__right__actions__download",rel:"noopener noreferrer",href:s,target:"_blank",onClick:d},t.createElement(pA,{type:_A.DOWNLOAD,fillColor:mA.ON_BACKGROUND_1,height:"24px",width:"24px"})),u&&o&&t.createElement("div",{className:"sendbird-fileviewer__header__right__actions__delete"},t.createElement(pA,{className:c?"disabled":"",type:_A.DELETE,fillColor:c?mA.GRAY:mA.ON_BACKGROUND_1,height:"24px",width:"24px",onClick:function(){c||u()}}))),t.createElement("div",{className:"sendbird-fileviewer__header__right__actions__close"},t.createElement(pA,{type:_A.CLOSE,fillColor:mA.ON_BACKGROUND_1,height:"24px",width:"24px",onClick:l})))),t.createElement("div",{className:"sendbird-fileviewer__content"},iM(a)&&t.createElement("video",{controls:!0,className:"sendbird-fileviewer__content__video"},t.createElement("source",{src:s,type:a})),rM(a)&&t.createElement("img",{src:s,alt:i,className:"sendbird-fileviewer__content__img"}),!sM(a)&&t.createElement("div",{className:"sendbird-fileviewer__content__unsupported"},t.createElement(yN,{type:CN.H_1,color:TN.ONBACKGROUND_1},NN.UI__FILE_VIEWER__UNSUPPORT)))))},VP=function(e){var n=iN(),r=n.state.onBeforeDownloadFileMessage,i=n.actions.deleteMessage,a=yT().state.config.logger;return t.createElement(GP,m({},e,{deleteMessage:i,onDownloadClick:function(t){return g(void 0,void 0,void 0,(function(){var n,i,s;return E(this,(function(o){switch(o.label){case 0:if(!r)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r({message:e.message})];case 2:return o.sent()||(t.preventDefault(),null===(i=a.info)||void 0===i||i.call(a,"FileViewer: Not allowed to download.")),[3,4];case 3:return n=o.sent(),null===(s=a.error)||void 0===s||s.call(a,"FileViewer: Error occurred while determining download continuation:",n),[3,4];case 4:return[2]}}))}))}}))};function qP(e,t){return tN(t).when(mM,(function(){var e=t.fileInfoList.length;return"Do you want to delete all ".concat(e," photos?")})).otherwise((function(){return e.MODAL__DELETE_MESSAGE__TITLE}))}var zP=function(e){var n,r=e.onSubmit,i=void 0===r?function(){}:r,a=e.onCancel,s=e.message,o=e.deleteMessage,l=t.useContext(FN).stringSet;return t.createElement($k,{type:ZO.DANGER,disabled:(null===(n=null==s?void 0:s.threadInfo)||void 0===n?void 0:n.replyCount)?s.threadInfo.replyCount>0:void 0,onCancel:a,onSubmit:function(){(s.isUserMessage()||s.isFileMessage()||s.isMultipleFilesMessage())&&o(s).then((function(){i(),a()}))},submitText:l.MESSAGE_MENU__DELETE,titleText:qP(l,s)})},KP=function(e){var n=iN().actions.deleteMessage;return t.createElement(zP,m({},e,{deleteMessage:n}))},YP=function(e){var n=yT().state,r=n.config,i=n.emojiManager,a=iN(),s=a.state,o=s.loading,l=s.currentChannel,u=s.animatedMessageId,c=s.replyType,d=s.threadReplySelectType,h=s.isReactionEnabled,f=s.nicknamesMap,p=s.renderUserMentionItem,_=s.filterEmojiCategoryIds,v=s.onQuoteMessageClick,g=s.onReplyInThreadClick,E=s.onMessageAnimated,b=s.onBeforeDownloadFileMessage,y=s.messages,C=a.actions,T=C.toggleReaction,N=C.setQuoteMessage,S=C.setAnimatedMessageId,I=C.scrollToMessage,w=C.updateUserMessage,A=C.sendUserMessage,M=C.resendMessage,O=C.deleteMessage,R=e.message,D=!o&&Boolean(l),k=jv((function(){var e=r.groupChannel,t=e.enableSuggestedReplies,n=e.showSuggestedRepliesFor,i=y[y.length-1],a=KM(i)&&"succeeded"!==i.sendingStatus,s="all_messages"===n||R.messageId===i.messageId;return t&&PM(R).length>0&&!a&&s}));return t.createElement(HP,m({},e,{channel:l,emojiContainer:i.emojiContainer,editInputDisabled:!D||DT(null!=l?l:void 0)||kT(null!=l?l:void 0)||!r.isOnline,shouldRenderSuggestedReplies:k,isReactionEnabled:null!=h&&h,replyType:null!=c?c:"NONE",threadReplySelectType:null!=d?d:ET.PARENT,nicknamesMap:f,renderUserMentionItem:p,filterEmojiCategoryIds:_,scrollToMessage:I,toggleReaction:T,setQuoteMessage:N,onQuoteMessageClick:v,onReplyInThreadClick:g,sendUserMessage:A,updateUserMessage:w,resendMessage:M,deleteMessage:O,animatedMessageId:u,setAnimatedMessageId:S,onMessageAnimated:E,renderFileViewer:function(e){return t.createElement(VP,m({},e))},renderRemoveMessageModal:function(e){return t.createElement(KP,m({},e))},usedInLegacy:!1,onBeforeDownloadFileMessage:b}))},WP=function(e){var n=e.className,r=void 0===n?"":n,i=e.count,a=void 0===i?0:i,s=e.time,o=void 0===s?"":s,l=e.onClick,u=e.lastReadAt,c=t.useContext(FN),d=c.stringSet,h=c.dateLocale,f=t.useMemo((function(){var e,t;if("on"!==d.CHANNEL__MESSAGE_LIST__NOTIFICATION__ON){var n=(null===(t=null===(e=null==o?void 0:o.toString)||void 0===e?void 0:e.call(o))||void 0===t?void 0:t.split(" "))||[];return null==n||n.splice(-2,0,d.CHANNEL__MESSAGE_LIST__NOTIFICATION__ON),n.join(" ")}if(u)return WO(u,d.DATE_FORMAT__MESSAGE_LIST__NOTIFICATION__UNREAD_SINCE,{locale:h})}),[o,u]);return t.createElement("div",{className:WT(a<1?"sendbird-notification--hide":"sendbird-notification",r),"data-testid":"sendbird-notification",onClick:l},t.createElement(yN,{className:"sendbird-notification__text",testID:"sendbird-notification__text",color:TN.ONCONTENT_1,type:CN.CAPTION_2},"".concat(a," "),d.CHANNEL__MESSAGE_LIST__NOTIFICATION__NEW_MESSAGE," ".concat(f)),t.createElement(pA,{width:"24px",height:"24px",type:_A.CHEVRON_DOWN,fillColor:mA.CONTENT}))},QP=function(e){var n=e.className,r=void 0===n?"":n,i=t.useContext(FN).stringSet;return t.createElement("div",{className:WT("sendbird-notification","sendbird-notification--frozen",r),"data-testid":"sendbird-notification"},t.createElement(yN,{className:"sendbird-notification__text",testID:"sendbird-notification__text",type:CN.CAPTION_2},i.CHANNEL_FROZEN))},XP=function(){return t.createElement("div",{className:"typing-dots-container"},t.createElement("span",null),t.createElement("span",null),t.createElement("span",null))},ZP=function(e){var n=e.sources,r=e.max;return t.createElement(t.Fragment,null," ",n.slice(0,r).map((function(e,n){return t.createElement(GA,{className:"sendbird-message-content__left__avatar multiple",src:e||"",key:"avatar_stack_item_".concat(e),width:"".concat(28,"px"),height:"".concat(28,"px"),zIndex:n,left:"".concat(24*n-2,"px")})}))," ")},JP=function(e){var n=e.typingMembers,r=n.length,i=Math.min(r,4),a=r-3,s=8*(i-1);return t.createElement("div",{className:"sendbird-message-content__left incoming",style:{minWidth:32*i-s+12}},t.createElement(ZP,{sources:n.map((function(e){return e.profileUrl})),max:3}),a>0?t.createElement(GA,{className:"sendbird-message-content__left__avatar multiple",width:"".concat(28,"px"),height:"".concat(28,"px"),zIndex:3,left:"".concat(72,"px"),customDefaultComponent:function(e){var n=e.width,r=e.height;return t.createElement(UA,{width:n,height:r,text:"+".concat(a)})}}):null)},$P=function(e){var n=e.typingMembers,r=e.handleScroll;return t.useLayoutEffect((function(){null==r||r(!0)}),[]),0===n.length?null:t.createElement("div",{className:"sendbird-message-content incoming",style:{marginBottom:"2px"}},t.createElement(JP,{typingMembers:n}),t.createElement("div",{className:"sendbird-message-content__middle"},t.createElement(XP,null)))},eF=function(e,t,n,r,i,a){if(!i||"group"!==i.channelType)return[nF(e,t,r),nF(t,n,r)];if("THREAD"===a&&(null==t?void 0:t.threadInfo))return[!1,!1];var s=(null==t?void 0:t.sendingStatus)||"",o="pending"!==s&&"failed"!==s;return[nF(e,t,r,i)&&o,nF(t,n,r,i)&&o]},tF=function(e,t){return WO(e.createdAt,t.DATE_FORMAT__MESSAGE_CREATED_AT)},nF=function(e,t,n,r){var i,a;return!!(e&&t&&e.messageType&&"admin"!==e.messageType&&t.messageType&&"admin"!==(null==t?void 0:t.messageType)&&"sender"in e&&"sender"in t&&e.createdAt&&t.createdAt&&e.sender.userId&&t.sender.userId)&&((null==e?void 0:e.sendingStatus)===(null==t?void 0:t.sendingStatus)&&(null===(i=null==e?void 0:e.sender)||void 0===i?void 0:i.userId)===(null===(a=null==t?void 0:t.sender)||void 0===a?void 0:a.userId)&&tF(e,n)===tF(t,n)&&(!r||cM(r,e)===cM(r,t)))},rF=function(e,t,n){void 0===e&&(e=0);var r=e;if(!(r>10))try{var i=(null==t?void 0:t.current)||document.querySelector(".sendbird-conversation__messages-padding");i&&(i.scrollTop=i.scrollHeight),null==n||n(!0)}catch(a){setTimeout((function(){rF(r+1,t,n)}),500*r)}},iF=function(e,t,n){return Math.abs(e-t)<=n},aF=t.forwardRef((function(e,n){var r=e.messages,i=e.renderMessage,a=e.scrollPositionRef,s=e.scrollDistanceFromBottomRef,o=e.onLoadPrevious,l=e.onLoadNext,u=e.loadThreshold,c=void 0===u?.05:u,d=e.typingIndicator,h=e.onScrollPosition,f=void 0===h?zT:h,p=e.initDeps,_=t.useRef(!1),m=t.useRef(),v=t.useRef(0);t.useLayoutEffect((function(){n.current&&(n.current.scrollTop=n.current.scrollHeight)}),p),t.useLayoutEffect((function(){n.current&&("top"===m.current&&(n.current.scrollTop=n.current.scrollHeight-a.current),"bottom"===m.current&&(n.current.scrollTop=v.current),m.current=void 0)}),[n.current,r.length]);var b=t.useCallback((function(){return g(void 0,void 0,void 0,(function(){var e,t;return E(this,(function(r){switch(r.label){case 0:return n.current?(e=n.current,f(function(e){if(iF(e.scrollTop,0,ag))return"top";if(iF(e.scrollHeight,e.clientHeight+e.scrollTop,ag))return"bottom";return"middle"}(e)),a.current=e.scrollHeight-e.scrollTop,s.current=a.current-e.clientHeight,v.current=e.scrollTop,_.current?[2]:(t=e.clientHeight*Math.min(Math.max(0,c),1),e.scrollTop<=t?(_.current=!0,m.current="top",[4,o()]):[3,2])):[2];case 1:return r.sent(),_.current=!1,[3,5];case 2:return e.scrollHeight-e.scrollTop-e.clientHeight<=t?(_.current=!0,m.current="bottom",[4,l()]):[3,4];case 3:return r.sent(),_.current=!1,[3,5];case 4:m.current=void 0,r.label=5;case 5:return[2]}}))}))}),[r.length]);return t.createElement("div",{className:"sendbird-conversation__scroll-container"},t.createElement("div",{className:"sendbird-conversation__padding"}),t.createElement("div",{ref:n,className:"sendbird-conversation__messages-padding","data-testid":"sendbird-message-list-container",onScroll:b},r.map((function(e,t){return i({message:e,index:t})})),d))}));var sF=function(e){var n,r,i,a,s,o=e.className,l=void 0===o?"":o,u=KT(e),c=u.renderMessage,d=void 0===c?function(e){return t.createElement(YP,m({},e))}:c,h=u.renderMessageContent,f=u.renderSuggestedReplies,p=u.renderCustomSeparator,_=u.renderPlaceholderLoader,v=void 0===_?function(){return t.createElement(IA,{type:EA})}:_,g=u.renderPlaceholderEmpty,E=void 0===g?function(){return t.createElement(IA,{className:"sendbird-conversation__no-messages",type:yA})}:g,b=u.renderFrozenNotification,y=void 0===b?function(){return t.createElement(QP,{className:"sendbird-conversation__messages__notification"})}:b,C=iN(),T=C.state,N=T.channelUrl,S=T.hasNext,I=T.loading,w=T.messages,A=T.newMessages,M=T.isScrollBottomReached,O=T.isMessageGroupingEnabled,R=T.currentChannel,D=T.replyType,k=T.scrollPubSub,L=T.loadNext,x=T.loadPrevious,U=T.resetNewMessages,P=T.scrollRef,F=T.scrollPositionRef,B=T.scrollDistanceFromBottomRef,H=C.actions,G=H.scrollToBottom,j=H.setIsScrollBottomReached,V=yT().state,q=HN().stringSet,z=t.useState(),K=z[0],Y=z[1];t.useEffect((function(){Y(M?void 0:new Date)}),[M]);var W,Q,X=function(e){void 0===e&&(e=!1);var t=P.current;if(t){var n=B.current,r=t.scrollHeight-t.scrollTop-t.offsetHeight;if(n<r&&(!e||n<ag)){var i=r-n;k.publish("scroll",{top:t.scrollTop+i,lazy:!1,animated:!1})}}},Z=function(){return R&&R.isFrozen?y():null},J=function(){return M||!K?null:t.createElement(WP,{className:"sendbird-conversation__messages__notification",count:A.length,lastReadAt:K,onClick:function(){return G()}})},$=function(){return!S()&&M?null:t.createElement("div",{className:"sendbird-conversation__scroll-bottom-button",onClick:function(){return G()},onKeyDown:function(){return G()},tabIndex:0,role:"button"},t.createElement(pA,{width:"24px",height:"24px",type:_A.CHEVRON_DOWN,fillColor:mA.PRIMARY}))};return I?v():0===w.length?E():t.createElement(t.Fragment,null,t.createElement("div",{className:"sendbird-conversation__messages ".concat(l),dir:(W=V.config.htmlTextDirection,Q=V.config.forceLeftToRightMessageLayout,Q?"ltr":W)},t.createElement(aF,{ref:P,initDeps:[N],scrollPositionRef:F,scrollDistanceFromBottomRef:B,onLoadNext:L,onLoadPrevious:x,onScrollPosition:function(e){var t="bottom"===e;A.length>0&&t&&U(),j(t)},messages:w,renderMessage:function(e){var n=e.message,r=e.index,i=function(e){var t=e.allMessages,n=e.stringSet,r=e.isMessageGroupingEnabled,i=void 0===r||r,a=e.currentIndex,s=void 0===a?0:a,o=e.currentMessage,l=e.currentChannel,u=void 0===l?null:l,c=e.replyType,d=void 0===c?"":c,h=t[s-1],f=t[s+1],p=i?eF(h,o,f,n,u,d):[!1,!1],_=p[0],m=p[1],v=null==h?void 0:h.createdAt,g=o.createdAt;return{chainTop:_,chainBottom:m,hasSeparator:!("sendingStatus"in o&&"succeeded"!==o.sendingStatus||v&&ek(g,v))}}({allMessages:w,stringSet:q,replyType:null!=D?D:"NONE",isMessageGroupingEnabled:null!=O&&O,currentIndex:r,currentMessage:n,currentChannel:R}),a=i.chainTop,s=i.chainBottom,o=i.hasSeparator,l=KM(n)&&n.sender.userId===V.config.userId;return t.createElement(fL,{message:n,key:wT(n),isByMe:l},d({handleScroll:X,message:n,hasSeparator:o,chainTop:a,chainBottom:s,renderMessageContent:h,renderSuggestedReplies:f,renderCustomSeparator:p}))},typingIndicator:!S()&&(null===(r=null===(n=null==V?void 0:V.config)||void 0===n?void 0:n.groupChannel)||void 0===r?void 0:r.enableTypingIndicator)&&(null===(s=null===(a=null===(i=null==V?void 0:V.config)||void 0===i?void 0:i.groupChannel)||void 0===a?void 0:a.typingIndicatorTypes)||void 0===s?void 0:s.has(kN.Bubble))&&t.createElement(oF,{channelUrl:N,handleScroll:X})}),t.createElement(t.Fragment,null,Z()),t.createElement(t.Fragment,null,J()),t.createElement(t.Fragment,null,$())))},oF=function(e){var n=yT().state.stores,r=iN().state,i=r.isScrollBottomReached,a=r.scrollPubSub,s=t.useState([]),o=s[0],l=s[1];return im(n.sdkStore.sdk,{onTypingStatusUpdated:function(t){t.url===e.channelUrl&&l(t.getTypingUsers()),i&&AT()&&setTimeout((function(){a.publish("scrollToBottom",{})}),10)}}),t.createElement($P,{typingMembers:o,handleScroll:e.handleScroll})},lF=function(e){return t.createElement(FP,m({},e))},uF="sendbird-quote_message_input__avatar";function cF(e){var n,r=e.message;if(!_M(r)&&!mM(r)||OM(r))return t.createElement(t.Fragment,null);var i,a=SL(r);return a||(IM(r)||wM(r)?a=NL(r):mM(r)&&((i=null===(n=r.fileInfoList)||void 0===n?void 0:n[0])&&i.mimeType&&(rM(i.mimeType)||aM(i.mimeType)))&&(a=r.fileInfoList[0].url)),wM(r)&&a?t.createElement("div",{className:uF},t.createElement("video",{style:{width:"44px",height:"44px"},src:a})):(SM(r)||mM(r))&&a?t.createElement(kA,{className:uF,url:a,alt:yL(r),width:"44px",height:"44px",fixedSize:!0}):function(e){return!(!e||!_M(e))&&oM(e.type)}(r)?t.createElement("div",{className:uF},t.createElement(pA,{type:_A.FILE_AUDIO,fillColor:mA.ON_BACKGROUND_2,width:"24px",height:"24px"})):t.createElement("div",{className:uF},t.createElement(pA,{type:_A.FILE_DOCUMENT,fillColor:mA.ON_BACKGROUND_2,width:"24px",height:"24px"}))}function dF(e){var n=e.className,r=e.replyingMessage,i=e.onClose,a=t.useContext(FN).stringSet,s=r,o=null==r?void 0:r.sender,l=(_M(r)||mM(r))&&!OM(r);return t.createElement("div",{className:LM(["sendbird-quote_message_input",null!=n?n:""])},l&&t.createElement(cF,{message:s}),t.createElement("div",{className:"sendbird-quote_message_input__body",style:{width:"calc(100% - ".concat(l?"164px":"120px",")"),left:l?"92px":"40px"}},t.createElement(yN,{className:"sendbird-quote_message_input__body__sender-name",type:CN.CAPTION_1,color:TN.ONBACKGROUND_1},"".concat(a.QUOTE_MESSAGE_INPUT__REPLY_TO," ").concat(o&&o.nickname?o.nickname:a.NO_NAME)),t.createElement(yN,{className:"sendbird-quote_message_input__body__message-content",type:CN.BODY_2,color:TN.ONBACKGROUND_3},IM(s)&&!AM(s)&&a.QUOTE_MESSAGE_INPUT__FILE_TYPE_IMAGE,wM(s)&&a.QUOTE_MESSAGE_INPUT__FILE_TYPE__VIDEO,AM(s)&&a.QUOTE_MESSAGE_INPUT__FILE_TYPE_GIF,pM(r)&&r.message,DM(r)===tM.FILE&&TL(s),mM(r)&&"".concat(s.fileInfoList.length," Photos"),OM(r)&&a.VOICE_MESSAGE)),t.createElement(pA,{className:"sendbird-quote_message_input__close-button",type:_A.CLOSE,fillColor:mA.ON_BACKGROUND_2,width:"24px",height:"24px",onClick:function(){return null==i?void 0:i(r)}}))}var hF="PREPARING",fF="READY_TO_RECORD",pF="RECORDING",_F="COMPLETED",mF=function(e){var n=e.onRecordingStarted,r=void 0===n?zT:n,i=e.onRecordingEnded,a=void 0===i?zT:i,s=yT().state.config.voiceRecord,o=null==s?void 0:s.maxRecordingTime,l=Hx(),u=l.isRecordable,c=t.useState(null),d=c[0],h=c[1],f=t.useState(hF),p=f[0],_=f[1];t.useEffect((function(){u&&p===hF&&_(fF)}),[u]);var m=t.useCallback((function(){null==l||l.start({onRecordingStarted:function(){_(pF),r(),T(),y(0),C.current=setInterval((function(){y((function(e){var t=e+100;return t>o&&T(),t}))}),100)},onRecordingEnded:function(e){_(_F),a(e),h(e),T()}})}),[r,a]),v=t.useCallback((function(){null==l||l.stop(),T()}),[l]),g=t.useCallback((function(){v(),h(null)}),[l]),E=t.useState(0),b=E[0],y=E[1],C=t.useRef(null);function T(){C.current&&(clearInterval(C.current),C.current=null)}return t.useEffect((function(){b>o&&v()}),[b,o,v]),{start:m,stop:v,cancel:g,recordingStatus:p,recordingTime:b,recordedFile:d,recordingLimit:o}},vF="READY_TO_RECORD",gF="RECORDING",EF="READY_TO_PLAY",bF="PLAYING",yF=function(e){switch(e.inputState){case vF:return t.createElement("div",{className:"sendbird-controler-icon record-icon"});case gF:return t.createElement("div",{className:"sendbird-controler-icon stop-icon"});case EF:return t.createElement(pA,{className:"sendbird-controler-icon play-icon",width:"20px",height:"20px",type:_A.PLAY,fillColor:mA.ON_BACKGROUND_1});case bF:return t.createElement("div",{className:"sendbird-controler-icon pause-icon"},t.createElement("div",{className:"sendbird-controler-icon pause-icon-inner"}),t.createElement("div",{className:"sendbird-controler-icon pause-icon-inner"}));default:return t.createElement(t.Fragment,null)}},CF=function(e){var n=e.minRecordTime,r=void 0===n?sg:n,i=e.maximumValue,a=e.currentValue,s=void 0===a?0:a,o=e.currentType,l=e.onCancelClick,u=e.onControlClick,c=e.onSubmitClick,d=e.renderCancelButton,h=e.renderControlButton,f=e.renderSubmitButton,p=t.useState(0),_=p[0],m=p[1],v=t.useMemo((function(){return o===vF}),[o]),g=t.useMemo((function(){return o===gF}),[o]),E=t.useMemo((function(){return(o===vF||o===gF)&&r>s}),[o,r,s]),b=t.useMemo((function(){return o===EF||o===bF}),[o]),y=HN().stringSet;return t.createElement("div",{className:"sendbird-voice-message-input"},t.createElement("div",{className:"sendbird-voice-message-input__indicator"},t.createElement("div",{className:"sendbird-voice-message-input__indicator__progress-bar"},t.createElement(gx,{className:"sendbird-voice-message-input__indicator__progress-bar__bar",disabled:v,maxSize:i,currentSize:s})),g?t.createElement("div",{className:"sendbird-voice-message-input__indicator__on-rec"}):null,t.createElement(jx,{className:"sendbird-voice-message-input__indicator__playback-time",time:b?i-s:s,labelColor:v?TN.ONBACKGROUND_4:TN.ONCONTENT_1})),t.createElement("div",{className:"sendbird-voice-message-input__controler"},(null==d?void 0:d())||t.createElement(tO,{className:"sendbird-voice-message-input__controler__cancel",onClick:function(){var e=Date.now();e-_>250&&(null==l||l(),m(e))},disableUnderline:!0},t.createElement(yN,{type:CN.BUTTON_1,color:TN.PRIMARY},y.BUTTON__CANCEL)),(null==h?void 0:h(o))||t.createElement("div",{className:"sendbird-voice-message-input__controler__main",onClick:function(){var e=Date.now();e-_>250&&(null==u||u(o),m(e))}},t.createElement(yF,{inputState:o})),(null==f?void 0:f())||t.createElement("div",{className:WT("sendbird-voice-message-input__controler__submit",E&&"voice-message--disabled"),onClick:function(){var e=Date.now();e-_>250&&(E||null==c||c(),m(e))}},t.createElement(pA,{width:"19px",height:"19px",type:_A.SEND,fillColor:E?mA.ON_BACKGROUND_4:mA.CONTENT}))))},TF=function(e){var t=e.imageFile,n=e.compressionRate,r=e.resizingWidth,i=e.resizingHeight,a=e.outputFormat,s=document.createElement("img");return new Promise((function(e,o){s.src=URL.createObjectURL(t),s.onerror=o,s.onload=function(){URL.revokeObjectURL(s.src);var l=document.createElement("canvas"),u=s.width,c=s.height,d=!r||r>u?u:r,h=!i||i>c?c:i,f=u/d,p=c/h;f>p?h=c/(r?f:1):p>f&&(d=u/(i?p:1)),l.width=d,l.height=h;var _=l.getContext("2d");if(_){_.drawImage(s,0,0,d,h);var m="preserve"===a?t.type:"image/".concat(a),v=m.split("/").pop(),g=t.name.lastIndexOf("."),E="".concat(-1===g?t.name:t.name.substring(0,g),".").concat(v);_.canvas.toBlob((function(t){if(t){var n=new File([t],E,{type:m});e(n)}else o(new Error("Failed to compress image"))}),m,n)}else o(new Error("Failed to get canvas 2d context"))}}))},NF=function(e){return g(void 0,[e],void 0,(function(e){var t,n,r,i,a,s,o=e.files,l=e.logger,u=e.imageCompression;return E(this,(function(e){switch(e.label){case 0:return t=u.compressionRate,n=u.outputFormat,r=void 0===n?"preserve":n,i=u.resizingWidth?xA(u.resizingWidth):void 0,a=u.resizingHeight?xA(u.resizingHeight):void 0,s={failedIndexes:[],compressedFiles:[]},Array.isArray(o)&&o.length>0?!t||t<0||1<t?(null==l||l.warning("utils - compressImages: The compressionRate is not acceptable.",t),[2,s]):[4,Promise.all(o.map((function(e,n){return g(void 0,void 0,void 0,(function(){var o,u;return E(this,(function(c){switch(c.label){case 0:if("image/jpg"!==e.type&&"image/png"!==e.type&&"image/jpeg"!==e.type)return null==l||l.warning("utils - compressImages: The fileType is not compressible.",{file:e,index:n}),s.failedIndexes.push(n),s.compressedFiles.push(e),[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,TF({imageFile:e,compressionRate:t,resizingWidth:i,resizingHeight:a,outputFormat:r})];case 2:return o=c.sent(),s.compressedFiles.push(o),[3,4];case 3:return u=c.sent(),s.compressedFiles.push(e),s.failedIndexes.push(n),null==l||l.warning("utils - compressImages: Failed to compress image file",{file:e,err:u}),[3,4];case 4:return[2]}}))}))})))]:(null==l||l.warning("utils - compressImages: There are no files.",o),[2,s]);case 1:return e.sent(),null==l||l.info("utils - compressImages: Finished compressing images",s),[2,s]}}))}))},SF=function(e){var n=e.channel,r=e.onCancelClick,i=e.onSubmitClick,a=t.useRef(GN()).current,s=t.useState(null),o=s[0],l=s[1],u=t.useState(vF),c=u[0],d=u[1],h=t.useState(!1),f=h[0],p=h[1],_=t.useState(!1),m=_[0],v=_[1],g=t.useState(!1),E=g[0],b=g[1],y=HN().stringSet,C=yT().state.config,T=mF({onRecordingStarted:function(){d(gF)},onRecordingEnded:function(e){l(e)}}),N=T.start,S=T.stop,I=T.cancel,w=T.recordingTime,A=T.recordingStatus,M=T.recordingLimit,O=Gx({channelUrl:null==n?void 0:n.url,key:a,audioFile:null!=o?o:void 0}),R=O.play,D=O.pause,k=O.playbackTime,L=O.playingStatus,x=O.stop;return t.useEffect((function(){DT(n)||kT(n)?v(!0):v(!1)}),[null==n?void 0:n.myRole,null==n?void 0:n.isFrozen,null==n?void 0:n.myMutedState]),t.useEffect((function(){f&&o&&(null==i||i(o,w),p(!1),l(null))}),[f,o,w]),t.useEffect((function(){o&&(w<C.voiceRecord.minRecordingTime?(d(vF),l(null)):d(L===wx?bF:EF))}),[o,w,L]),t.createElement("div",{className:"sendbird-voice-message-input-wrapper"},t.createElement(CF,{currentValue:A===_F?k:w,maximumValue:A===_F?w:M,currentType:c,onCancelClick:function(){null==r||r(),I(),x()},onSubmitClick:function(){m?(b(!0),d(vF)):(S(),D(),p(!0))},onControlClick:function(e){switch(e){case vF:x(),N();break;case gF:w>=C.voiceRecord.minRecordingTime&&!m?S():m?(I(),b(!0),d(vF)):(I(),d(vF));break;case EF:R();break;case bF:D()}}}),E&&t.createElement($k,{className:"sendbird-voice-message-input-wrapper-alert",titleText:kT(n)?y.MODAL__VOICE_MESSAGE_INPUT_DISABLED__TITLE_MUTED:y.MODAL__VOICE_MESSAGE_INPUT_DISABLED__TITLE_FROZEN,hideFooter:!0,isCloseOnClickOutside:!0,onClose:function(){b(!1),null==r||r()}},t.createElement("div",{className:"sendbird-voice-message-input-wrapper-alert__body"},t.createElement(fR,{className:"sendbird-voice-message-input-wrapper-alert__body__ok-button",type:ZO.PRIMARY,size:$O.BIG,onClick:function(){b(!1),null==r||r()}},y.BUTTON__OK))))},IF=t.forwardRef((function(e,n){var r,i=e.currentChannel,a=e.messages,s=e.loading,o=e.quoteMessage,l=e.setQuoteMessage,u=e.messageInputRef,c=e.sendUserMessage,d=e.sendFileMessage,h=e.sendVoiceMessage,f=e.sendMultipleFilesMessage,p=e.renderUserMentionItem,_=e.renderFileUploadIcon,m=e.renderVoiceMessageIcon,v=e.renderSendMessageIcon,y=e.acceptableMimeTypes,C=e.disabled,T=HN().stringSet,N=$M().isMobile,S=yT().state,I=S.stores,w=S.config,A=w.isOnline,M=w.userMention,O=w.logger,R=w.groupChannel,D=I.sdkStore.sdk,k=M.maxMentionCount,L=M.maxSuggestionCount,x=null==i?void 0:i.isBroadcast,U="operator"===(null==i?void 0:i.myRole),P=null!==(r=e.isMultipleFilesMessageEnabled)&&void 0!==r?r:w.isMultipleFilesMessageEnabled,F=R.enableMention,B=R.enableVoiceMessage,H=t.useState(""),G=H[0],j=H[1],V=t.useState([]),q=V[0],z=V[1],K=t.useState([]),Y=K[0],W=K[1],Q=t.useState(null),X=Q[0],Z=Q[1],J=t.useState([]),$=J[0],ee=J[1],te=t.useState(null),ne=te[0],re=te[1],ie=t.useState(!1),ae=ie[0],se=ie[1],oe=s||!i||!D||!D.isCacheEnabled&&!A||DT(i)||kT(i)||LT(i,w.groupChannel.enableSuggestedReplies)||UT(a,w.groupChannel.enableFormTypeMessage)||C,le=!oe&&F&&G.length>0&&!x,ue=XO({ref:n||u},{logger:O}),ce=(null==ue?void 0:ue.length)<k;t.useEffect((function(){j(""),z([]),W([]),Z(null),ee([]),re(null),se(!1)}),[null==i?void 0:i.url]),t.useEffect((function(){z(q.filter((function(e){var t=e.userId,n=Y.indexOf(t);return!(n<0)&&(Y.splice(n,1),!0)})))}),[Y]);var de=function(e,n){var r=e.sendFileMessage,i=e.sendMultipleFilesMessage,a=e.quoteMessage,s=n.logger,o=HN().stringSet,l=yT().state.config,u=l.imageCompression,c=null==l?void 0:l.uikitUploadSizeLimit,d=null==l?void 0:l.uikitMultipleFilesMessageLimit,h=nL().openModal;return t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){var n,l,f,p,_;return E(this,(function(m){switch(m.label){case 0:return 0===e.length?(s.warning("Channel|useHandleUploadFiles: given file list is empty.",{files:e}),[2]):e.length>d?(s.info("Channel|useHandleUploadFiles: Cannot upload files more than ".concat(d)),h({modalProps:{titleText:o.FILE_UPLOAD_NOTIFICATION__COUNT_LIMIT.replace("%d","".concat(c)),hideFooter:!0},childElement:function(e){var n=e.closeModal;return t.createElement(Jk,{type:ZO.PRIMARY,submitText:o.BUTTON__OK,hideCancelButton:!0,onCancel:n,onSubmit:n})}}),[2]):e.some((function(e){return e.size>c}))?(s.info("Channel|useHandleUploadFiles: Cannot upload file size exceeding ".concat(c)),h({modalProps:{titleText:o.FILE_UPLOAD_NOTIFICATION__SIZE_LIMIT.replace("%d","".concat(Math.floor(c/1048576))),hideFooter:!0},childElement:function(e){var n=e.closeModal;return t.createElement(Jk,{type:ZO.PRIMARY,submitText:o.BUTTON__OK,hideCancelButton:!0,onCancel:n,onSubmit:n})}}),[2]):[4,NF({files:e,imageCompression:u,logger:s})];case 1:return n=m.sent().compressedFiles,1===(l=n).length?(s.info("Channel|useHandleUploadFiles: sending one file."),f=l[0],[2,r({file:f,parentMessageId:null==a?void 0:a.messageId})]):l.length>1?(s.info("Channel|useHandleUploadFiles: sending multiple files."),p=[],_=[],l.forEach((function(e){rM(e.type)?p.push(e):_.push(e)})),[2,_.reduce((function(e,t){return e.then((function(){return r({file:t,parentMessageId:null==a?void 0:a.messageId})}))}),0===p.length?Promise.resolve():1===p.length?r({file:p[0]}):i({fileInfoList:p.map((function(e){return{file:e,fileName:e.name,fileSize:e.size,mimeType:e.type}})),parentMessageId:null==a?void 0:a.messageId}))]):[2]}}))}))}),[r,i,a])}({sendFileMessage:d,sendMultipleFilesMessage:f,quoteMessage:null!=o?o:void 0},{logger:O});return x&&!U?null:t.createElement("div",{className:ae?"sendbird-message-input-wrapper--voice-message":"sendbird-message-input-wrapper"},le&&t.createElement(lF,{currentChannel:i,targetNickname:G,inputEvent:null!=ne?ne:void 0,renderUserMentionItem:p,onUserItemClick:function(e){e&&z(b(b([],q,!0),[e],!1)),j(""),Z(e),re(null)},onFocusItemChange:function(){re(null)},onFetchUsers:function(e){ee(e)},ableAddMention:ce,maxMentionCount:k,maxSuggestionCount:L}),o&&t.createElement("div",{className:"sendbird-message-input-wrapper__quote-message-input"},t.createElement(dF,{replyingMessage:o,onClose:function(){return l(null)}})),ae?t.createElement(SF,{channel:null!=i?i:void 0,onSubmitClick:function(e,t){h({file:e,parentMessageId:null==o?void 0:o.messageId},t),l(null),se(!1)},onCancelClick:function(){se(!1)}}):t.createElement(JD,{className:"sendbird-message-input-wrapper__message-input",channel:i,channelUrl:null==i?void 0:i.url,isMobile:N,acceptableMimeTypes:y,mentionSelectedUser:X,isMentionEnabled:F,isVoiceMessageEnabled:B,isSelectingMultipleFilesEnabled:P,onVoiceMessageIconClick:function(){se(!0)},setMentionedUsers:z,placeholder:o&&T.MESSAGE_INPUT__QUOTE_REPLY__PLACE_HOLDER||DT(i)&&T.MESSAGE_INPUT__PLACE_HOLDER__FROZEN||kT(i)&&(N?T.MESSAGE_INPUT__PLACE_HOLDER__MUTED_SHORT:T.MESSAGE_INPUT__PLACE_HOLDER__MUTED)||LT(i,w.groupChannel.enableSuggestedReplies)&&T.MESSAGE_INPUT__PLACE_HOLDER__SUGGESTED_REPLIES||UT(a,w.groupChannel.enableFormTypeMessage)&&T.MESSAGE_INPUT__PLACE_HOLDER__MESSAGE_FORM||C&&T.MESSAGE_INPUT__PLACE_HOLDER__DISABLED||void 0,ref:n||u,disabled:oe,renderFileUploadIcon:_,renderSendMessageIcon:v,renderVoiceMessageIcon:m,onStartTyping:function(){null==i||i.startTyping()},onSendMessage:function(e){var t,n=e.message,r=e.mentionTemplate;c({message:n,mentionedUsers:q,mentionedMessageTemplate:r,parentMessageId:null==o?void 0:o.messageId}),j(""),z([]),l(null),null===(t=null==i?void 0:i.endTyping)||void 0===t||t.call(i)},onFileUpload:function(e){de(e),l(null)},onUserMentioned:function(e){(null==X?void 0:X.userId)===(null==e?void 0:e.userId)&&(Z(null),j(""))},onMentionStringChange:function(e){j(e)},onMentionedUserIdsUpdated:function(e){W(e)},onKeyDown:function(e){return!!(le&&(null==$?void 0:$.length)>0&&(e.key===nR&&ce||e.key===rR||e.key===iR))&&(re(e),!0)}}))})),wF=function(e){var n=iN(),r=n.state,i=n.actions;return t.createElement(IF,m({},e,r,i))},AF=function(e){var n=fN(),r=iN().state,i=r.channelUrl,a=r.fetchChannelError,s=KT(e),o=s.renderChannelHeader,l=void 0===o?function(e){return t.createElement(sO,m({},e))}:o,u=s.renderMessageList,c=void 0===u?function(e){return t.createElement(sF,m({},e,{className:"sendbird-conversation__message-list"}))}:u,d=s.renderMessageInput,h=void 0===d?function(){return t.createElement(wF,m({},e))}:d;return t.createElement(wA,m({},e,n,{isInvalid:null!==a,channelUrl:i,renderChannelHeader:l,renderMessageList:c,renderMessageInput:h}))},MF=function(e){return t.createElement(dN,m({},e),t.createElement(AF,m({},e)))},OF=function(){function e(e){var t,n=this,r=e.sdk,i=e.logger;null===(t=null==r?void 0:r.getAllEmoji)||void 0===t||t.call(r).then((function(e){n._emojiContainer=e,null==i||i.info("EmojiManager | Succeeded getting all emojis. ",e)})).catch((function(){null==i||i.warning("EmojiManager | Failed getting all emojis.")}))}return Object.defineProperty(e.prototype,"AllEmojisAsArray",{get:function(){return this._emojiContainer.emojiCategories.flatMap((function(e){return e.emojis}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AllEmojisAsMap",{get:function(){return this._emojiContainer.emojiCategories.flatMap((function(e){return e.emojis})).reduce((function(e,t){return e.set(t.key,t.url),e}),new Map)},enumerable:!1,configurable:!0}),e.prototype.getAllEmojis=function(e){var t=this;return tN(e).when((function(e){return["array","arr"].includes(e)}),(function(){return t.AllEmojisAsArray})).when((function(e){return["map"].includes(e)}),(function(){return t.AllEmojisAsMap})).otherwise((function(){return t.AllEmojisAsArray}))},e.prototype.getEmojiUrl=function(e){var t,n;return null!==(n=null===(t=this.AllEmojisAsArray.find((function(t){return t.key===e})))||void 0===t?void 0:t.url)&&void 0!==n?n:""},Object.defineProperty(e.prototype,"emojiContainer",{get:function(){return this._emojiContainer},enumerable:!1,configurable:!0}),e}(),RF={100:"extra-light",200:"light",300:"main",400:"dark",500:"extra-dark","overlay-01":"overlay-dark","overlay-02":"overlay-light","onlight-01":"onlight-text-high-emphasis","onlight-02":"onlight-text-mid-emphasis","onlight-03":"onlight-text-low-emphasis","onlight-04":"onlight-text-disabled","ondark-01":"ondark-text-high-emphasis","ondark-02":"ondark-text-mid-emphasis","ondark-03":"ondark-text-low-emphasis","ondark-04":"ondark-text-disabled"},DF=Object.values(RF).sort((function(e,t){return t.length-e.length})),kF=new Map(Object.entries(RF).map((function(e){var t=e[0];return[e[1],t]})));
/*!
   * css-vars-ponyfill
   * v2.4.9
   * https://jhildenbiddle.github.io/css-vars-ponyfill/
   * (c) 2018-2024 John Hildenbiddle <http://hildenbiddle.com>
   * MIT license
   */
function LF(){return LF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},LF.apply(this,arguments)}
/*!
   * get-css-data
   * v2.1.0
   * https://github.com/jhildenbiddle/get-css-data
   * (c) 2018-2022 John Hildenbiddle <http://hildenbiddle.com>
   * MIT license
   */function xF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={mimeType:t.mimeType||null,onBeforeSend:t.onBeforeSend||Function.prototype,onSuccess:t.onSuccess||Function.prototype,onError:t.onError||Function.prototype,onComplete:t.onComplete||Function.prototype},r=Array.isArray(e)?e:[e],i=Array.apply(null,Array(r.length)).map((function(e){return null}));function a(e){var t="string"==typeof e,n=t&&"<"===e.trim().charAt(0);return t&&!n}function s(e,t){n.onError(e,r[t],t)}function o(e,t){var a=n.onSuccess(e,r[t],t);e=!1===a?"":a||e,i[t]=e,-1===i.indexOf(null)&&n.onComplete(i)}var l=document.createElement("a");r.forEach((function(e,t){if(l.setAttribute("href",e),l.href=String(l.href),Boolean(document.all&&!window.atob)&&l.host.split(":")[0]!==location.host.split(":")[0]){if(l.protocol===location.protocol){var r=new XDomainRequest;r.open("GET",e),r.timeout=0,r.onprogress=Function.prototype,r.ontimeout=Function.prototype,r.onload=function(){var e=r.responseText;a(e)?o(e,t):s(r,t)},r.onerror=function(e){s(r,t)},setTimeout((function(){r.send()}),0)}else s(null,t)}else{var i=new XMLHttpRequest;i.open("GET",e),n.mimeType&&i.overrideMimeType&&i.overrideMimeType(n.mimeType),n.onBeforeSend(i,e,t),i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText;i.status<400&&a(e)||0===i.status&&a(e)?o(e,t):s(i,t)}},i.send()}}))}
/**
   * Gets CSS data from <style> and <link> nodes (including @imports), then
   * returns data in order processed by DOM. Allows specifying nodes to
   * include/exclude and filtering CSS data using RegEx.
   *
   * @preserve
   * @param {object}   [options] The options object
   * @param {object}   [options.rootElement=document] Root element to traverse for
   *                   <link> and <style> nodes.
   * @param {string}   [options.include] CSS selector matching <link> and <style>
   *                   nodes to include
   * @param {string}   [options.exclude] CSS selector matching <link> and <style>
   *                   nodes to exclude
   * @param {object}   [options.filter] Regular expression used to filter node CSS
   *                   data. Each block of CSS data is tested against the filter,
   *                   and only matching data is included.
   * @param {boolean}  [options.skipDisabled=true] Determines if disabled
   *                   stylesheets will be skipped while collecting CSS data.
   * @param {boolean}  [options.useCSSOM=false] Determines if CSS data will be
   *                   collected from a stylesheet's runtime values instead of its
   *                   text content. This is required to get accurate CSS data
   *                   when a stylesheet has been modified using the deleteRule()
   *                   or insertRule() methods because these modifications will
   *                   not be reflected in the stylesheet's text content.
   * @param {function} [options.onBeforeSend] Callback before XHR is sent. Passes
   *                   1) the XHR object, 2) source node reference, and 3) the
   *                   source URL as arguments.
   * @param {function} [options.onSuccess] Callback on each CSS node read. Passes
   *                   1) CSS text, 2) source node reference, and 3) the source
   *                   URL as arguments.
   * @param {function} [options.onError] Callback on each error. Passes 1) the XHR
   *                   object for inspection, 2) soure node reference, and 3) the
   *                   source URL that failed (either a <link> href or an @import)
   *                   as arguments
   * @param {function} [options.onComplete] Callback after all nodes have been
   *                   processed. Passes 1) concatenated CSS text, 2) an array of
   *                   CSS text in DOM order, and 3) an array of nodes in DOM
   *                   order as arguments.
   *
   * @example
   *
   *   getCssData({
   *     rootElement : document,
   *     include     : 'style,link[rel="stylesheet"]',
   *     exclude     : '[href="skip.css"]',
   *     filter      : /red/,
   *     skipDisabled: true,
   *     useCSSOM    : false,
   *     onBeforeSend(xhr, node, url) {
   *       // ...
   *     }
   *     onSuccess(cssText, node, url) {
   *       // ...
   *     }
   *     onError(xhr, node, url) {
   *       // ...
   *     },
   *     onComplete(cssText, cssArray, nodeArray) {
   *       // ...
   *     }
   *   });
   */function UF(e){var t=/\/\*[\s\S]+?\*\//g,n=/(?:@import\s*)(?:url\(\s*)?(?:['"])([^'"]*)(?:['"])(?:\s*\))?(?:[^;]*;)/g,r={rootElement:e.rootElement||document,include:e.include||'style,link[rel="stylesheet"]',exclude:e.exclude||null,filter:e.filter||null,skipDisabled:!1!==e.skipDisabled,useCSSOM:e.useCSSOM||!1,onBeforeSend:e.onBeforeSend||Function.prototype,onSuccess:e.onSuccess||Function.prototype,onError:e.onError||Function.prototype,onComplete:e.onComplete||Function.prototype},i=Array.apply(null,r.rootElement.querySelectorAll(r.include)).filter((function(e){return t=e,n=r.exclude,!(t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector).call(t,n);var t,n})),a=Array.apply(null,Array(i.length)).map((function(e){return null}));function s(){if(-1===a.indexOf(null)){a.reduce((function(e,t,n){return""===t&&e.push(n),e}),[]).reverse().forEach((function(e){return[i,a].forEach((function(t){return t.splice(e,1)}))}));var e=a.join("");r.onComplete(e,a,i)}}function o(e,t,n,i){var o=r.onSuccess(e,n,i);u(e=void 0!==o&&!1===Boolean(o)?"":o||e,n,i,(function(e,i){null===a[t]&&(i.forEach((function(e){return r.onError(e.xhr,n,e.url)})),!r.filter||r.filter.test(e)?a[t]=e:a[t]="",s())}))}function l(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a={};return a.rules=(e.replace(t,"").match(n)||[]).filter((function(e){return-1===i.indexOf(e)})),a.urls=a.rules.map((function(e){return e.replace(n,"$1")})),a.absoluteUrls=a.urls.map((function(e){return PF(e,r)})),a.absoluteRules=a.rules.map((function(e,t){var n=a.urls[t],i=PF(a.absoluteUrls[t],r);return e.replace(n,i)})),a}function u(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=l(e,n,s);o.rules.length?xF(o.absoluteUrls,{onBeforeSend:function(e,n,i){r.onBeforeSend(e,t,n)},onSuccess:function(e,n,i){var a=r.onSuccess(e,t,n),o=l(e=!1===a?"":a||e,n,s);return o.rules.forEach((function(t,n){e=e.replace(t,o.absoluteRules[n])})),e},onError:function(r,l,c){a.push({xhr:r,url:l}),s.push(o.rules[c]),u(e,t,n,i,a,s)},onComplete:function(r){r.forEach((function(t,n){e=e.replace(o.rules[n],t)})),u(e,t,n,i,a,s)}}):i(e,a)}i.length?i.forEach((function(e,t){var n=e.getAttribute("href"),i=e.getAttribute("rel"),l="link"===e.nodeName.toLowerCase()&&n&&i&&-1!==i.toLowerCase().indexOf("stylesheet"),u=!1!==r.skipDisabled&&e.disabled,c="style"===e.nodeName.toLowerCase();if(l&&!u)if(-1!==n.indexOf("data:text/css")){var d=decodeURIComponent(n.substring(n.indexOf(",")+1));r.useCSSOM&&(d=Array.apply(null,e.sheet.cssRules).map((function(e){return e.cssText})).join("")),o(d,t,e,location.href)}else xF(n,{mimeType:"text/css",onBeforeSend:function(t,n,i){r.onBeforeSend(t,e,n)},onSuccess:function(r,i,a){var s=PF(n);o(r,t,e,s)},onError:function(n,i,o){a[t]="",r.onError(n,e,i),s()}});else if(c&&!u){var h=e.textContent;r.useCSSOM&&(h=Array.apply(null,e.sheet.cssRules).map((function(e){return e.cssText})).join("")),o(h,t,e,location.href)}else a[t]="",s()})):r.onComplete("",[])}function PF(e,t){var n=document.implementation.createHTMLDocument(""),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),r.href=t||document.baseURI||(document.querySelector("base")||{}).href||location.href,i.href=e,i.href}var FF=BF;function BF(e,t,n){e instanceof RegExp&&(e=HF(e,n)),t instanceof RegExp&&(t=HF(t,n));var r=GF(e,t,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+e.length,r[1]),post:n.slice(r[1]+t.length)}}function HF(e,t){var n=t.match(e);return n?n[0]:null}function GF(e,t,n){var r,i,a,s,o,l=n.indexOf(e),u=n.indexOf(t,l+1),c=l;if(l>=0&&u>0){if(e===t)return[l,u];for(r=[],a=n.length;c>=0&&!o;)c==l?(r.push(c),l=n.indexOf(e,c+1)):1==r.length?o=[r.pop(),u]:((i=r.pop())<a&&(a=i,s=u),u=n.indexOf(t,c+1)),c=l<u&&l>=0?l:u;r.length&&(o=[a,s])}return o}function jF(e){var t=LF({},{preserveStatic:!0,removeComments:!1},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});function n(e){throw new Error("CSS parse error: ".concat(e))}function r(t){var n=t.exec(e);if(n)return e=e.slice(n[0].length),n}function i(){return r(/^{\s*/)}function a(){return r(/^}/)}function s(){r(/^\s*/)}function o(){if(s(),"/"===e[0]&&"*"===e[1]){for(var t=2;e[t]&&("*"!==e[t]||"/"!==e[t+1]);)t++;if(!e[t])return n("end of comment is missing");var r=e.slice(2,t);return e=e.slice(t+2),{type:"comment",comment:r}}}function l(){for(var e,n=[];e=o();)n.push(e);return t.removeComments?[]:n}function u(){for(s();"}"===e[0];)n("extra closing bracket");var t=r(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(t){var i,a=t[0].trim();/\/\*/.test(a)&&(a=a.replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,""));var o=/["']\w*,\w*["']/.test(a);return o&&(a=a.replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(e){return e.replace(/,/g,"")}))),i=/,/.test(a)?a.split(/\s*(?![^(]*\)),\s*/):[a],o&&(i=i.map((function(e){return e.replace(/\u200C/g,",")}))),i}}function c(){if("@"===e[0])return f();r(/^([;\s]*)+/);var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,i=r(/^(\*?[-#/*\\\w.]+(\[[0-9a-z_-]+\])?)\s*/);if(i){if(i=i[0].trim(),!r(/^:\s*/))return n("property missing ':'");var a=r(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),s={type:"declaration",property:i.replace(t,""),value:a?a[0].replace(t,"").trim():""};return r(/^[;\s]*/),s}}function d(){if(!i())return n("missing '{'");for(var e,t=l();e=c();)t.push(e),t=t.concat(l());return a()?t:n("missing '}'")}function h(){s();for(var e,t=[];e=r(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)t.push(e[1]),r(/^,\s*/);if(t.length)return{type:"keyframe",values:t,declarations:d()}}function f(){if(s(),"@"===e[0]){var o=function(){var e=r(/^@(import|charset|namespace)\s*([^;]+);/);if(e)return{type:e[1],name:e[2].trim()}}()||function(){if(r(/^@font-face\s*/))return{type:"font-face",declarations:d()}}()||function(){var e=r(/^@media([^{]+)*/);if(e)return{type:"media",media:(e[1]||"").trim(),rules:_()}}()||function(){var e=r(/^@([-\w]+)?keyframes\s*/);if(e){var t=e[1];if(!(e=r(/^([-\w]+)\s*/)))return n("@keyframes missing name");var s,o=e[1];if(!i())return n("@keyframes missing '{'");for(var u=l();s=h();)u.push(s),u=u.concat(l());return a()?{type:"keyframes",name:o,vendor:t,keyframes:u}:n("@keyframes missing '}'")}}()||function(){var e=r(/^@supports *([^{]+)/);if(e)return{type:"supports",supports:e[1].trim(),rules:_()}}()||function(){var e=r(/^@([-\w]+)?document *([^{]+)/);if(e)return{type:"document",document:e[2].trim(),vendor:e[1]?e[1].trim():null,rules:_()}}()||function(){var e=r(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(e)return{type:"custom-media",name:e[1].trim(),media:e[2].trim()}}()||function(){if(r(/^@host\s*/))return{type:"host",rules:_()}}()||function(){if(r(/^@page */))return{type:"page",selectors:u()||[],declarations:d()}}()||function(){var e=r(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(e)return{type:"page-margin-box",name:"".concat(e[1],"-").concat(e[2])+(e[3]?"-".concat(e[3]):""),declarations:d()}}();if(o&&!t.preserveStatic){var c=!1;if(o.declarations)c=o.declarations.some((function(e){return/var\(/.test(e.value)}));else c=(o.keyframes||o.rules||[]).some((function(e){return(e.declarations||[]).some((function(e){return/var\(/.test(e.value)}))}));return c?o:{}}return o}}function p(){if(!t.preserveStatic){var r=FF("{","}",e);if(r){var i=/:(?:root|host)(?![.:#(])/.test(r.pre)&&/--\S*\s*:/.test(r.body),a=/var\(/.test(r.body);if(!i&&!a)return e=e.slice(r.end+1),{}}}var s=u()||[],o=t.preserveStatic?d():d().filter((function(e){var t=s.some((function(e){return/:(?:root|host)(?![.:#(])/.test(e)}))&&/^--\S/.test(e.property),n=/var\(/.test(e.value);return t||n}));return s.length||n("selector missing"),{type:"rule",selectors:s,declarations:o}}function _(t){if(!t&&!i())return n("missing '{'");for(var r,s=l();e.length&&(t||"}"!==e[0])&&(r=f()||p());)r.type&&s.push(r),s=s.concat(l());return t||a()?s:n("missing '}'")}return{type:"stylesheet",stylesheet:{rules:_(!0),errors:[]}}}function VF(e){var t=LF({},{parseHost:!1,store:{},onWarning:function(){}},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=new RegExp(":".concat(t.parseHost?"host":"root","$"));return"string"==typeof e&&(e=jF(e,t)),e.stylesheet.rules.forEach((function(e){"rule"===e.type&&e.selectors.some((function(e){return n.test(e)}))&&e.declarations.forEach((function(e,n){var r=e.property,i=e.value;r&&0===r.indexOf("--")&&(t.store[r]=i)}))})),t.store}function qF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r={charset:function(e){return"@charset "+e.name+";"},comment:function(e){return 0===e.comment.indexOf("__CSSVARSPONYFILL")?"/*"+e.comment+"*/":""},"custom-media":function(e){return"@custom-media "+e.name+" "+e.media+";"},declaration:function(e){return e.property+":"+e.value+";"},document:function(e){return"@"+(e.vendor||"")+"document "+e.document+"{"+i(e.rules)+"}"},"font-face":function(e){return"@font-face{"+i(e.declarations)+"}"},host:function(e){return"@host{"+i(e.rules)+"}"},import:function(e){return"@import "+e.name+";"},keyframe:function(e){return e.values.join(",")+"{"+i(e.declarations)+"}"},keyframes:function(e){return"@"+(e.vendor||"")+"keyframes "+e.name+"{"+i(e.keyframes)+"}"},media:function(e){return"@media "+e.media+"{"+i(e.rules)+"}"},namespace:function(e){return"@namespace "+e.name+";"},page:function(e){return"@page "+(e.selectors.length?e.selectors.join(", "):"")+"{"+i(e.declarations)+"}"},"page-margin-box":function(e){return"@"+e.name+"{"+i(e.declarations)+"}"},rule:function(e){var t=e.declarations;if(t.length)return e.selectors.join(",")+"{"+i(t)+"}"},supports:function(e){return"@supports "+e.supports+"{"+i(e.rules)+"}"}};function i(e){for(var i="",a=0;a<e.length;a++){var s=e[a];n&&n(s);var o=r[s.type](s);o&&(i+=o,o.length&&s.selectors&&(i+=t))}return i}return i(e.stylesheet.rules)}function zF(e,t){e.rules.forEach((function(n){n.rules?zF(n,t):n.keyframes?n.keyframes.forEach((function(e){"keyframe"===e.type&&t(e.declarations,n)})):n.declarations&&t(n.declarations,e)}))}BF.range=GF;function KF(e){var t=LF({},{preserveStatic:!0,preserveVars:!1,variables:{},onWarning:function(){}},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"string"==typeof e&&(e=jF(e,t)),zF(e.stylesheet,(function(e,n){for(var r=0;r<e.length;r++){var i=e[r],a=i.type,s=i.property,o=i.value;if("declaration"===a)if(t.preserveVars||!s||0!==s.indexOf("--")){if(-1!==o.indexOf("var(")){var l=WF(o,t);l!==i.value&&(l=YF(l),t.preserveVars?(e.splice(r,0,{type:a,property:s,value:l}),r++):i.value=l)}}else e.splice(r,1),r--}})),qF(e)}function YF(e){return(e.match(/calc\(([^)]+)\)/g)||[]).forEach((function(t){var n="calc".concat(t.split("calc").join(""));e=e.replace(t,n)})),e}function WF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(-1===e.indexOf("var("))return e;var r,i,a,s,o,l,u=FF("(",")",e);return u?"var"===u.pre.slice(-3)?0===u.body.trim().length?(t.onWarning("var() must contain a non-whitespace string"),e):u.pre.slice(0,-3)+(r=u.body,i=r.split(",")[0].replace(/[\s\n\t]/g,""),a=(r.match(/(?:\s*,\s*){1}(.*)?/)||[])[1],s=Object.prototype.hasOwnProperty.call(t.variables,i)?String(t.variables[i]):void 0,o=s||(a?String(a):void 0),l=n||r,s||t.onWarning('variable "'.concat(i,'" is undefined')),o&&"undefined"!==o&&o.length>0?WF(o,t,l):"var(".concat(l,")"))+WF(u.post,t):u.pre+"(".concat(WF(u.body,t),")")+WF(u.post,t):(-1!==e.indexOf("var(")&&t.onWarning('missing closing ")" in the value "'.concat(e,'"')),e)}var QF="undefined"!=typeof window,XF=QF&&window.CSS&&window.CSS.supports&&window.CSS.supports("(--a: 0)"),ZF={group:0,job:0},JF={rootElement:QF?document:null,shadowDOM:!1,include:"style,link[rel=stylesheet]",exclude:"",variables:{},onlyLegacy:!0,preserveStatic:!0,preserveVars:!1,silent:!1,updateDOM:!0,updateURLs:!0,watch:null,onBeforeSend:function(){},onError:function(){},onWarning:function(){},onSuccess:function(){},onComplete:function(){},onFinally:function(){}},$F={cssComments:/\/\*[\s\S]+?\*\//g,cssKeyframes:/@(?:-\w*-)?keyframes/,cssMediaQueries:/@media[^{]+\{([\s\S]+?})\s*}/g,cssUrls:/url\((?!['"]?(?:data|http|\/\/):)['"]?([^'")]*)['"]?\)/g,cssVarDeclRules:/(?::(?:root|host)(?![.:#(])[\s,]*[^{]*{\s*[^}]*})/g,cssVarDecls:/(?:[\s;]*)(-{2}\w[\w-]*)(?:\s*:\s*)([^;]*);/g,cssVarFunc:/var\(\s*--[\w-]/,cssVars:/(?:(?::(?:root|host)(?![.:#(])[\s,]*[^{]*{\s*[^;]*;*\s*)|(?:var\(\s*))(--[^:)]+)(?:\s*[:)])/},eB={dom:{},job:{},user:{}},tB=!1,nB=null,rB=0,iB=null,aB=!1;
/**
   * Fetches, parses, and transforms CSS custom properties from specified
   * <style> and <link> elements into static values, then appends a new <style>
   * element with static values to the DOM to provide CSS custom property
   * compatibility for legacy browsers. Also provides a single interface for
   * live updates of runtime values in both modern and legacy browsers.
   *
   * @preserve
   * @param {object}   [options] Options object
   * @param {object}   [options.rootElement=document] Root element to traverse for
   *                   <link> and <style> nodes
   * @param {boolean}  [options.shadowDOM=false] Determines if shadow DOM <link>
   *                   and <style> nodes will be processed.
   * @param {string}   [options.include="style,link[rel=stylesheet]"] CSS selector
   *                   matching <link re="stylesheet"> and <style> nodes to
   *                   process
   * @param {string}   [options.exclude] CSS selector matching <link
   *                   rel="stylehseet"> and <style> nodes to exclude from those
   *                   matches by options.include
   * @param {object}   [options.variables] A map of custom property name/value
   *                   pairs. Property names can omit or include the leading
   *                   double-hyphen (), and values specified will override
   *                   previous values
   * @param {boolean}  [options.onlyLegacy=true] Determines if the ponyfill will
   *                   only generate legacy-compatible CSS in browsers that lack
   *                   native support (i.e., legacy browsers)
   * @param {boolean}  [options.preserveStatic=true] Determines if CSS
   *                   declarations that do not reference a custom property will
   *                   be preserved in the transformed CSS
   * @param {boolean}  [options.preserveVars=false] Determines if CSS custom
   *                   property declarations will be preserved in the transformed
   *                   CSS
   * @param {boolean}  [options.silent=false] Determines if warning and error
   *                   messages will be displayed on the console
   * @param {boolean}  [options.updateDOM=true] Determines if the ponyfill will
   *                   update the DOM after processing CSS custom properties
   * @param {boolean}  [options.updateURLs=true] Determines if relative url()
   *                   paths will be converted to absolute urls in external CSS
   * @param {boolean}  [options.watch=false] Determines if a MutationObserver will
   *                   be created that will execute the ponyfill when a <link> or
   *                   <style> DOM mutation is observed
   * @param {function} [options.onBeforeSend] Callback before XHR is sent. Passes
   *                   1) the XHR object, 2) source node reference, and 3) the
   *                   source URL as arguments
   * @param {function} [options.onError] Callback after a CSS parsing error has
   *                   occurred or an XHR request has failed. Passes 1) an error
   *                   message, and 2) source node reference, 3) xhr, and 4 url as
   *                   arguments.
   * @param {function} [options.onWarning] Callback after each CSS parsing warning
   *                   has occurred. Passes 1) a warning message as an argument.
   * @param {function} [options.onSuccess] Callback after CSS data has been
   *                   collected from each node and before CSS custom properties
   *                   have been transformed. Allows modifying the CSS data before
   *                   it is transformed by returning any string value (or false
   *                   to skip). Passes 1) CSS text, 2) source node reference, and
   *                   3) the source URL as arguments.
   * @param {function} [options.onComplete] Callback after all CSS has been
   *                   processed, legacy-compatible CSS has been generated, and
   *                   (optionally) the DOM has been updated. Passes 1) a CSS
   *                   string with CSS variable values resolved, 2) an array of
   *                   output <style> node references that have been appended to
   *                   the DOM, 3) an object containing all custom properies names
   *                   and values, and 4) the ponyfill execution time in
   *                   milliseconds.
   * @param {function} [options.onFinally] Callback in modern and legacy browsers
   *                   after the ponyfill has finished all tasks. Passes 1) a
   *                   boolean indicating if the last ponyfill call resulted in a
   *                   style change, 2) a boolean indicating if the current
   *                   browser provides native support for CSS custom properties,
   *                   and 3) the ponyfill execution time in milliseconds.
   * @example
   *
   *   cssVars({
   *     rootElement   : document,
   *     shadowDOM     : false,
   *     include       : 'style,link[rel="stylesheet"]',
   *     exclude       : '',
   *     variables     : {},
   *     onlyLegacy    : true,
   *     preserveStatic: true,
   *     preserveVars  : false,
   *     silent        : false,
   *     updateDOM     : true,
   *     updateURLs    : true,
   *     watch         : false,
   *     onBeforeSend(xhr, node, url) {},
   *     onError(message, node, xhr, url) {},
   *     onWarning(message) {},
   *     onSuccess(cssText, node, url) {},
   *     onComplete(cssText, styleNode, cssVariables, benchmark) {},
   *     onFinally(hasChanged, hasNativeSupport, benchmark)
   *   });
   */
function sB(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=LF({},JF,e);function n(e,n,r,i){!t.silent&&window.console,t.onError(e,n,r,i)}function r(e){!t.silent&&window.console,t.onWarning(e)}function i(e){t.onFinally(Boolean(e),XF,lB()-t.__benchmark)}if(QF){if(t.watch)return t.watch=JF.watch,function(e){function t(e){var t=n(e)&&e.hasAttribute("disabled"),r=(e.sheet||{}).disabled;return t||r}function n(e){return"link"===e.nodeName.toLowerCase()&&-1!==(e.getAttribute("rel")||"").indexOf("stylesheet")}function r(e){return"style"===e.nodeName.toLowerCase()}function i(r){var i=!1;if("attributes"===r.type&&n(r.target)&&!t(r.target)){var a="disabled"===r.attributeName,s="href"===r.attributeName,o="skip"===r.target.getAttribute("data-cssvars"),l="src"===r.target.getAttribute("data-cssvars");a?i=!o&&!l:s&&(o?r.target.setAttribute("data-cssvars",""):l&&uB(e.rootElement,!0),i=!0)}return i}function a(e){var t=!1;if("childList"===e.type){var n=r(e.target),i="out"===e.target.getAttribute("data-cssvars");t=n&&!i}return t}function s(e){var i=!1;return"childList"===e.type&&(i=[].slice.call(e.addedNodes).some((function(e){var i=1===e.nodeType&&e.hasAttribute("data-cssvars"),a=r(e)&&$F.cssVars.test(e.textContent);return!i&&(n(e)||a)&&!t(e)}))),i}function o(t){var n=!1;return"childList"===t.type&&(n=[].slice.call(t.removedNodes).some((function(t){var n=1===t.nodeType,r=n&&"out"===t.getAttribute("data-cssvars"),i=n&&"src"===t.getAttribute("data-cssvars"),a=i;if(i||r){var s=t.getAttribute("data-cssvars-group"),o=e.rootElement.querySelector('[data-cssvars-group="'.concat(s,'"]'));i&&uB(e.rootElement,!0),o&&o.parentNode.removeChild(o)}return a}))),n}if(!window.MutationObserver)return;nB&&(nB.disconnect(),nB=null);nB=new MutationObserver((function(t){t.some((function(e){return i(e)||a(e)||s(e)||o(e)}))&&sB(e)})),nB.observe(document.documentElement,{attributes:!0,attributeFilter:["disabled","href"],childList:!0,subtree:!0})}(t),void sB(t);if(!1===t.watch&&nB&&(nB.disconnect(),nB=null),!t.__benchmark){if(tB===t.rootElement)return void function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;clearTimeout(iB),iB=setTimeout((function(){e.__benchmark=null,sB(e)}),t)}(e);var a=[].slice.call(t.rootElement.querySelectorAll('[data-cssvars]:not([data-cssvars="out"])'));if(t.__benchmark=lB(),t.exclude=[nB?'[data-cssvars]:not([data-cssvars=""])':'[data-cssvars="out"]',"link[disabled]:not([data-cssvars])",t.exclude].filter((function(e){return e})).join(","),t.variables=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=/^-{2}/;return Object.keys(e).reduce((function(n,r){return n[t.test(r)?r:"--".concat(r.replace(/^-+/,""))]=e[r],n}),{})}(t.variables),a.forEach((function(e){var t="style"===e.nodeName.toLowerCase()&&e.__cssVars.text,n=t&&e.textContent!==e.__cssVars.text;t&&n&&(e.sheet&&(e.sheet.disabled=!1),e.setAttribute("data-cssvars",""))})),!nB)[].slice.call(t.rootElement.querySelectorAll('[data-cssvars="out"]')).forEach((function(e){var n=e.getAttribute("data-cssvars-group");(n?t.rootElement.querySelector('[data-cssvars="src"][data-cssvars-group="'.concat(n,'"]')):null)||e.parentNode.removeChild(e)})),rB&&a.length<rB&&(rB=a.length,eB.dom={})}if("loading"!==document.readyState)if(XF&&t.onlyLegacy){var s=!1;if(t.updateDOM){var o=t.rootElement.host||(t.rootElement===document?document.documentElement:t.rootElement);Object.keys(t.variables).forEach((function(e){var n=t.variables[e];s=s||n!==getComputedStyle(o).getPropertyValue(e),o.style.setProperty(e,n)}))}i(s)}else!aB&&(t.shadowDOM||t.rootElement.shadowRoot||t.rootElement.host)?UF({rootElement:JF.rootElement,include:JF.include,exclude:t.exclude,skipDisabled:!1,onSuccess:function(e,t,n){return!((t.sheet||{}).disabled&&!t.__cssVars)&&((e=((e=e.replace($F.cssComments,"").replace($F.cssMediaQueries,"")).match($F.cssVarDeclRules)||[]).join(""))||!1)},onComplete:function(e,n,i){VF(e,{store:eB.dom,onWarning:r}),aB=!0,sB(t)}}):(tB=t.rootElement,UF({rootElement:t.rootElement,include:t.include,exclude:t.exclude,skipDisabled:!1,onBeforeSend:t.onBeforeSend,onError:function(e,t,r){var i=e.responseURL||oB(r,location.href),a=e.statusText?"(".concat(e.statusText,")"):"Unspecified Error"+(0===e.status?" (possibly CORS related)":"");n("CSS XHR Error: ".concat(i," ").concat(e.status," ").concat(a),t,e,i)},onSuccess:function(e,n,r){if((n.sheet||{}).disabled&&!n.__cssVars)return!1;var i="link"===n.nodeName.toLowerCase(),a="style"===n.nodeName.toLowerCase()&&e!==n.textContent,s=t.onSuccess(e,n,r);return e=void 0!==s&&!1===Boolean(s)?"":s||e,t.updateURLs&&(i||a)&&(e=function(e,t){var n=e.replace($F.cssComments,"").match($F.cssUrls)||[];return n.forEach((function(n){var r=n.replace($F.cssUrls,"$1"),i=oB(r,t);e=e.replace(n,n.replace(r,i))})),e}(e,r)),e},onComplete:function(e,a){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=LF({},eB.dom,eB.user);if(eB.job={},s.forEach((function(e,i){var s=a[i];if(e.__cssVars=e.__cssVars||{},e.__cssVars.text=s,$F.cssVars.test(s))try{var o=jF(s,{preserveStatic:t.preserveStatic,removeComments:!0});VF(o,{parseHost:Boolean(t.rootElement.host),store:eB.dom,onWarning:r}),e.__cssVars.tree=o}catch(l){n(l.message,e)}})),LF(eB.job,eB.dom),t.updateDOM?(LF(eB.user,t.variables),LF(eB.job,eB.user)):(LF(eB.job,eB.user,t.variables),LF(o,t.variables)),ZF.job>0&&Boolean(Object.keys(eB.job).length>Object.keys(o).length||Boolean(Object.keys(o).length&&Object.keys(eB.job).some((function(e){return eB.job[e]!==o[e]})))))uB(t.rootElement),sB(t);else{var l=[],u=[],c=!1;if(t.updateDOM&&ZF.job++,s.forEach((function(e,i){var s=!e.__cssVars.tree;if(e.__cssVars.tree)try{KF(e.__cssVars.tree,LF({},t,{variables:eB.job,onWarning:r}));var o=qF(e.__cssVars.tree);if(t.updateDOM){var d=a[i],h=$F.cssVarFunc.test(d);if(e.getAttribute("data-cssvars")||e.setAttribute("data-cssvars","src"),o.length&&h){var f=e.getAttribute("data-cssvars-group")||++ZF.group,p=o.replace(/\s/g,""),_=t.rootElement.querySelector('[data-cssvars="out"][data-cssvars-group="'.concat(f,'"]'))||document.createElement("style");c=c||$F.cssKeyframes.test(o),t.preserveStatic&&e.sheet&&(e.sheet.disabled=!0),_.hasAttribute("data-cssvars")||_.setAttribute("data-cssvars","out"),p===e.textContent.replace(/\s/g,"")?(s=!0,_&&_.parentNode&&(e.removeAttribute("data-cssvars-group"),_.parentNode.removeChild(_))):p!==_.textContent.replace(/\s/g,"")&&([e,_].forEach((function(e){e.setAttribute("data-cssvars-job",ZF.job),e.setAttribute("data-cssvars-group",f)})),_.textContent=o,l.push(o),u.push(_),_.parentNode||e.parentNode.insertBefore(_,e.nextSibling))}}else e.textContent.replace(/\s/g,"")!==o&&l.push(o)}catch(m){n(m.message,e)}s&&e.setAttribute("data-cssvars","skip"),e.hasAttribute("data-cssvars-job")||e.setAttribute("data-cssvars-job",ZF.job)})),rB=t.rootElement.querySelectorAll('[data-cssvars]:not([data-cssvars="out"])').length,t.shadowDOM)for(var d,h=[].concat(t.rootElement).concat([].slice.call(t.rootElement.querySelectorAll("*"))),f=0;d=h[f];++f){if(d.shadowRoot&&d.shadowRoot.querySelector("style"))sB(LF({},t,{rootElement:d.shadowRoot}))}t.updateDOM&&c&&function(e){var t=["animation-name","-moz-animation-name","-webkit-animation-name"].filter((function(e){return getComputedStyle(document.body)[e]}))[0];if(t){for(var n=[].slice.call(e.querySelectorAll("*")),r=[],i="__CSSVARSPONYFILL-KEYFRAMES__",a=0,s=n.length;a<s;a++){var o=n[a];"none"!==getComputedStyle(o)[t]&&(o.style[t]+=i,r.push(o))}document.body.offsetHeight;for(var l=0,u=r.length;l<u;l++){var c=r[l].style;c[t]=c[t].replace(i,"")}}}(t.rootElement),tB=!1,t.onComplete(l.join(""),u,JSON.parse(JSON.stringify(eB.job)),lB()-t.__benchmark),i(u.length)}}}));else document.addEventListener("DOMContentLoaded",(function t(n){sB(e),document.removeEventListener("DOMContentLoaded",t)}))}}function oB(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:location.href,n=document.implementation.createHTMLDocument(""),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),r.href=t,i.href=e,i.href}function lB(){return QF&&(window.performance||{}).now?window.performance.now():(new Date).getTime()}function uB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];[].slice.call(e.querySelectorAll('[data-cssvars="skip"],[data-cssvars="src"]')).forEach((function(e){return e.setAttribute("data-cssvars","")})),t&&(eB.dom={})}function cB(e,n){void 0===n&&(n=[]),t.useLayoutEffect((function(){return function(){e()}}),n)}function dB(e,n){var r,i,a=t.useState("undefined"==typeof window||(null===(i=null===(r=null===window||void 0===window?void 0:window.navigator)||void 0===r?void 0:r.onLine)||void 0===i||i)),s=a[0],o=a[1];return t.useEffect((function(){var t=GN();try{n.warning("sdk changed",t);var r=new zc({onDisconnected:function(){o(!1),n.warning("onDisconnected",{isOnline:s})},onReconnectStarted:function(){o(!1),n.warning("onReconnectStarted",{isOnline:s})},onReconnectSucceeded:function(){o(!0),n.warning("onReconnectSucceeded",{isOnline:s})},onReconnectFailed:function(){e.reconnect(),n.warning("onReconnectFailed")}});(null==e?void 0:e.addConnectionHandler)&&(e.addConnectionHandler(t,r),n.info("Added ConnectionHandler",t))}catch(i){}return function(){try{e.removeConnectionHandler(t),n.info("Removed ConnectionHandler",t)}catch(i){}}}),[e]),t.useEffect((function(){var t=function(){try{n.warning("Try reconnecting SDK"),"OPEN"!==e.connectionState&&e.reconnect()}catch(t){}};return window.addEventListener("online",t),function(){window.removeEventListener("online",t)}}),[e]),t.useEffect((function(){var t=document.querySelector("body");if(s||(null==e?void 0:e.isCacheEnabled))try{null==t||t.classList.remove("sendbird__offline"),n.info("Removed class sendbird__offline from body")}catch(O){}else try{null==t||t.classList.add("sendbird__offline"),n.info("Added class sendbird__offline to body")}catch(O){}}),[s,null==e?void 0:e.isCacheEnabled]),s}sB.reset=function(){for(var e in ZF.job=0,ZF.group=0,tB=!1,nB&&(nB.disconnect(),nB=null),rB=0,iB=null,aB=!1,eB)eB[e]={}};function hB(e){var t=e.logger,n=e.timeout,r=e.cb,i=[],a=null;return{push:function(e){if(i.find((function(t){return t.url===e.url}))?t.info("Channel: Mark as read already in queue",{channel:e}):i.push(e),!a){var s=i.shift();s&&r(s),a=setInterval((function(){if(0===i.length&&a)return clearInterval(a),void(a=null);var e=i.shift();e&&r(e)}),n||2e3)}},clear:function(){i=[],a&&(clearInterval(a),a=null)},getQueue:function(){return i}}}function fB(e,n){var r=this,i=e.isConnected,a=n.logger,s=t.useMemo((function(){return hB({logger:a,cb:function(e){return g(r,void 0,void 0,(function(){var t;return E(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.markAsDelivered()];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),null==a||a.warning("Channel: Mark as delivered failed",{channel:e,error:t}),[3,3];case 3:return[2]}}))}))}})}),[]);return t.useEffect((function(){i||s.clear()}),[i]),cB((function(){s.clear()})),s}var pB={getItem:function(e){return g(this,void 0,void 0,(function(){var t;return E(this,(function(n){return[2,null!==(t=localStorage.getItem(e))&&void 0!==t?t:null]}))}))},setItem:function(e,t){return g(this,void 0,void 0,(function(){return E(this,(function(n){return[2,localStorage.setItem(e,t)]}))}))}},_B=function(e){var n=e.children;return t.createElement(Px,null,t.createElement(Bx,null,n))},mB="debug",vB="warning",gB="error",EB="info",bB="all",yB=function(e){e.level,e.title,e.description,e.payload},CB=function(e,t){var n=yB,r=Array.isArray(e)?e:[e],i=function(e){return function(t,r){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];return n({level:e,title:t,description:r,payload:i})}};return r.reduce((function(e,t){return t===mB||t===bB?m(m({},e),{info:i(EB),error:i(gB),warning:i(vB)}):t===EB?m(m({},e),{info:i(EB)}):t===gB?m(m({},e),{error:i(gB)}):t===vB?m(m({},e),{warning:i(vB)}):m({},e)}),{info:zT,error:zT,warning:zT})},TB={"--sendbird-dark-primary-500":"#4d2aa6","--sendbird-dark-primary-400":"#6440C4","--sendbird-dark-primary-300":"#7B53EF","--sendbird-dark-primary-200":"#9E8CF5","--sendbird-dark-primary-100":"#E2DFFF","--sendbird-dark-secondary-500":"#007A7A","--sendbird-dark-secondary-400":"#189A8D","--sendbird-dark-secondary-300":"#2EBA9F","--sendbird-dark-secondary-200":"#6FD6BE","--sendbird-dark-secondary-100":"#AEF2DC","--sendbird-dark-information-100":"#b2d9ff","--sendbird-dark-error-500":"#A30E2D","--sendbird-dark-error-400":"#C11F41","--sendbird-dark-error-300":"#E53157","--sendbird-dark-error-200":"#FF6183","--sendbird-dark-error-100":"#FFABBD","--sendbird-dark-background-700":"#000000","--sendbird-dark-background-600":"#161616","--sendbird-dark-background-500":"#2C2C2C","--sendbird-dark-background-400":"#393939","--sendbird-dark-background-300":"#A8A8A8","--sendbird-dark-background-200":"#D9D9D9","--sendbird-dark-background-100":"#F0F0F0","--sendbird-dark-background-50":"#FFFFFF","--sendbird-dark-overlay":"rgba(0, 0, 0, 0.32)","--sendbird-dark-onlight-01":"rgba(0, 0, 0, 0.88)","--sendbird-dark-onlight-02":"rgba(0, 0, 0, 0.50)","--sendbird-dark-onlight-03":"rgba(0, 0, 0, 0.38)","--sendbird-dark-onlight-04":"rgba(0, 0, 0, 0.12)","--sendbird-dark-ondark-01":"rgba(255, 255, 255, 0.88)","--sendbird-dark-ondark-02":"rgba(255, 255, 255, 0.50)","--sendbird-dark-ondark-03":"rgba(255, 255, 255, 0.38)","--sendbird-dark-ondark-04":"rgba(255, 255, 255, 0.12)","--sendbird-dark-shadow-01":"0 1px 5px 0 rgba(33, 34, 66, 0.04), 0 0 3px 0 rgba(0, 0, 0, 0.08), 0 2px 1px 0 rgba(0, 0, 0, 0.12)","--sendbird-dark-shadow-02":"0 3px 5px -3px rgba(33, 34, 66, 0.04), 0 3px 14px 2px rgba(0, 0, 0, 0.08), 0 8px 10px 1px rgba(0, 0, 0, 0.12)","--sendbird-dark-shadow-03":"0 6px 10px -5px rgba(0, 0, 0, 0.04), 0 6px 30px 5px rgba(0, 0, 0, 0.08), 0 16px 24px 2px rgba(0, 0, 0, 0.12)","--sendbird-dark-shadow-04":"0 9px 15px -7px rgba(0, 0, 0, 0.04), 0 9px 46px 8px rgba(0, 0, 0, 0.08), 0 24px 38px 3px rgba(0, 0, 0, 0.12)","--sendbird-dark-shadow-message-input":"0 1px 5px 0 rgba(33, 34, 66, 0.12), 0 0 1px 0 rgba(33, 34, 66, 0.16), 0 2px 1px 0 rgba(33, 34, 66, 0.08), 0 1px 5px 0 rgba(0, 0, 0, 0.12)","--sendbird-light-primary-500":"#4d2aa6","--sendbird-light-primary-400":"#6440C4","--sendbird-light-primary-300":"#7B53EF","--sendbird-light-primary-200":"#9E8CF5","--sendbird-light-primary-100":"#E2DFFF","--sendbird-light-secondary-500":"#007A7A","--sendbird-light-secondary-400":"#189A8D","--sendbird-light-secondary-300":"#2EBA9F","--sendbird-light-secondary-200":"#6FD6BE","--sendbird-light-secondary-100":"#AEF2DC","--sendbird-light-information-100":"#b2d9ff","--sendbird-light-error-500":"#A30E2D","--sendbird-light-error-400":"#C11F41","--sendbird-light-error-300":"#E53157","--sendbird-light-error-200":"#FF6183","--sendbird-light-error-100":"#FFABBD","--sendbird-light-background-700":"#000000","--sendbird-light-background-600":"#161616","--sendbird-light-background-500":"#2C2C2C","--sendbird-light-background-400":"#393939","--sendbird-light-background-300":"#A8A8A8","--sendbird-light-background-200":"#D9D9D9","--sendbird-light-background-100":"#F0F0F0","--sendbird-light-background-50":" #FFFFFF","--sendbird-light-overlay":"rgba(0, 0, 0, 0.32)","--sendbird-light-onlight-01":"rgba(0, 0, 0, 0.88)","--sendbird-light-onlight-02":"rgba(0, 0, 0, 0.50)","--sendbird-light-onlight-03":"rgba(0, 0, 0, 0.38)","--sendbird-light-onlight-04":"rgba(0, 0, 0, 0.12)","--sendbird-light-ondark-01":"rgba(255, 255, 255, 0.88)","--sendbird-light-ondark-02":"rgba(255, 255, 255, 0.50)","--sendbird-light-ondark-03":"rgba(255, 255, 255, 0.38)","--sendbird-light-ondark-04":"rgba(255, 255, 255, 0.12)","--sendbird-light-shadow-01":"0 1px 5px 0 rgba(33, 34, 66, 0.04), 0 0 3px 0 rgba(0, 0, 0, 0.08), 0 2px 1px 0 rgba(0, 0, 0, 0.12)","--sendbird-light-shadow-02":"0 3px 5px -3px rgba(33, 34, 66, 0.04), 0 3px 14px 2px rgba(0, 0, 0, 0.08), 0 8px 10px 1px rgba(0, 0, 0, 0.12)","--sendbird-light-shadow-03":"0 6px 10px -5px rgba(0, 0, 0, 0.04), 0 6px 30px 5px rgba(0, 0, 0, 0.08), 0 16px 24px 2px rgba(0, 0, 0, 0.12)","--sendbird-light-shadow-04":"0 9px 15px -7px rgba(0, 0, 0, 0.04), 0 9px 46px 8px rgba(0, 0, 0, 0.08), 0 24px 38px 3px rgba(0, 0, 0, 0.12)","--sendbird-light-shadow-message-input":"0 1px 5px 0 rgba(33, 34, 66, 0.12), 0 0 1px 0 rgba(33, 34, 66, 0.16), 0 2px 1px 0 rgba(33, 34, 66, 0.08), 0 1px 5px 0 rgba(0, 0, 0, 0.12)"},NB=function(e){t.useLayoutEffect((function(){var t,n;(function(e){if(null==e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})})(e)||sB({variables:m(m({},TB),(t=e,n={},Object.entries(t).forEach((function(e){for(var t=e[0],r=e[1],i=t,a=0,s=DF;a<s.length;a++){var o=s[a],l=new RegExp("-".concat(o,"$"));if(l.test(t)){var u=kF.get(o);if(u){i=t.replace(l,"-".concat(u));break}}}n[i]=r})),n))})}),[e])},SB=function(e){return{version:Number(e.ui_template.version),uiTemplate:JSON.stringify(e.ui_template.body.items),colorVariables:e.color_variables}},IB=function(e){var t={};return e.forEach((function(e){t[e.key]=SB(e)})),t};var wB=function(e){var n,r=e.appId,i=e.userId,a=e.accessToken,s=e.customApiHost,o=e.customWebSocketHost,l=e.configureSession,u=e.theme,c=void 0===u?"light":u,d=e.logger,h=e.config,f=void 0===h?{}:h,p=e.nickname,_=void 0===p?"":p,v=e.colorSet,b=e.profileUrl,y=void 0===b?"":b,C=e.voiceRecord,T=e.userListQuery,N=e.imageCompression,S=void 0===N?{}:N,I=e.allowProfileEdit,w=void 0!==I&&I,A=e.disableMarkAsDelivered,M=void 0!==A&&A,R=e.renderUserProfile,D=e.onUserProfileMessage,k=e.onStartDirectMessage,L=e.isUserIdUsedForNickname,x=void 0===L||L,U=e.sdkInitParams,P=e.customExtensionParams,F=e.isMultipleFilesMessageEnabled,B=void 0!==F&&F,H=e.eventHandlers,G=e.htmlTextDirection,j=void 0===G?"ltr":G,V=e.forceLeftToRightMessageLayout,q=void 0!==V&&V,z=null!=k?k:D,K=f.userMention,Y=void 0===K?{}:K,W=f.isREMUnitEnabled,Q=void 0!==W&&W,X=f.pubSub,Z=$M().isMobile,J=t.useState(null!=X?X:ST())[0],$=VC(zC,(function(e){return e}),jC),ee=$.state,te=$.updateState,ne=yT().actions,re=ee.stores,ie=re.sdkStore,ae=re.appInfoStore,se=t.useContext(rg),oe=se.configs,le=se.configsWithAppAttr,ue=se.initDashboardConfigs,ce=ie.initialized,de=null==ie?void 0:ie.sdk,he=null!==(n=null==de?void 0:de.appInfo)&&void 0!==n?n:{},fe=he.uploadSizeLimit,pe=he.multipleFilesMessageFileCountLimit;NB(v);var _e=function(e){var n,r=this,i=e.sdk,a=e.logger,s=e.appInfoStore,o=e.actions,l=null==s?void 0:s.messageTemplatesInfo,u=t.useCallback((function(e){var t,n;if(!l)return null;var r=null,i=null!==(t=null==l?void 0:l.templatesMap)&&void 0!==t?t:null;return i&&(r=null!==(n=i[e])&&void 0!==n?n:null),r}),[null==s?void 0:s.messageTemplatesInfo]),c=function(e){return g(r,void 0,void 0,(function(){var t,n,r,i;return E(this,(function(a){switch(a.label){case 0:t=!0,n=null,r=[],a.label=1;case 1:return t?[4,e.message.getMessageTemplatesByToken(n,{limit:20})]:[3,3];case 2:return i=a.sent(),t=i.hasMore,n=i.token,i.templates.forEach((function(e){r.push(JSON.parse(e.template))})),[3,1];case 3:return[2,r]}}))}))};return{getCachedTemplate:u,updateMessageTemplatesInfo:t.useCallback((function(e,t,n){return g(r,void 0,void 0,(function(){var r,s,l,u,c,d,h,f,p;return E(this,(function(_){switch(_.label){case 0:o.upsertWaitingTemplateKeys({keys:e,requestedAt:n}),r=[],_.label=1;case 1:_.trys.push([1,5,,6]),s=!0,l=null,_.label=2;case 2:return s?[4,i.message.getMessageTemplatesByToken(l,{keys:e})]:[3,4];case 3:return(u=_.sent()).templates.forEach((function(e){r.push(JSON.parse(e.template))})),s=u.hasMore,l=u.token,[3,2];case 4:return[3,6];case 5:return c=_.sent(),null===(p=null==a?void 0:a.error)||void 0===p||p.call(a,"Sendbird | fetchProcessedMessageTemplates failed",c,e),[3,6];case 6:return r.length>0?((d=localStorage.getItem(Eg))?(h=JSON.parse(d),f=h.map((function(e){return e.key})),r.forEach((function(e){f.includes(e.key)||h.push(e)})),localStorage.setItem(Eg,JSON.stringify(h))):localStorage.setItem(Eg,JSON.stringify([r])),o.upsertMessageTemplates({payload:r.map((function(e){return{key:e.key,template:SB(e)}}))})):o.markErrorWaitingTemplateKeys({keys:e,messageId:t}),[2]}}))}))}),[o.upsertMessageTemplates,o.upsertWaitingTemplateKeys,null===(n=null==i?void 0:i.message)||void 0===n?void 0:n.getMessageTemplatesByToken]),initializeMessageTemplatesInfo:function(e){return g(r,void 0,void 0,(function(){var t,n,r,i,a,s;return E(this,(function(l){switch(l.label){case 0:return(t=null===(s=e.appInfo)||void 0===s?void 0:s.messageTemplateInfo.token)?(n=localStorage.getItem(gg),r=localStorage.getItem(Eg),n&&n===t?[3,2]:[4,c(e)]):(localStorage.removeItem(gg),localStorage.removeItem(Eg),[2]);case 1:return i=l.sent(),a={token:t,templatesMap:IB(i)},o.initMessageTemplateInfo({payload:a}),localStorage.setItem(gg,t),localStorage.setItem(Eg,JSON.stringify(i)),[3,3];case 2:n&&n===t&&r&&(i=JSON.parse(r),a={token:t,templatesMap:IB(i)},o.initMessageTemplateInfo({payload:a})),l.label=3;case 3:return[2]}}))}))}}}({sdk:de,logger:d,appInfoStore:ae,actions:ne}),me=_e.getCachedTemplate,ve=_e.updateMessageTemplatesInfo,ge=_e.initializeMessageTemplatesInfo;t.useEffect((function(){ne.connect({appId:r,userId:i,accessToken:a,isUserIdUsedForNickname:x,isMobile:Z,logger:d,nickname:_,profileUrl:y,configureSession:l,customApiHost:s,customWebSocketHost:o,sdkInitParams:U,customExtensionParams:P,initDashboardConfigs:ue,eventHandlers:H,initializeMessageTemplatesInfo:ge})}),[r,i]),cB((function(){ne.disconnect({logger:d})}));var Ee,be=t.useState(c),ye=be[0],Ce=be[1];t.useEffect((function(){Ce(c)}),[c]),t.useEffect((function(){var e=document.querySelector("body");null==e||e.classList.remove("sendbird-experimental__rem__units"),Q&&(null==e||e.classList.add("sendbird-experimental__rem__units"))}),[Q]),t.useEffect((function(){d.info("Setup theme","Theme: ".concat(ye));try{var e=document.querySelector("body");null==e||e.classList.remove("sendbird-theme--light"),null==e||e.classList.remove("sendbird-theme--dark"),null==e||e.classList.add("sendbird-theme--".concat(ye||"light")),d.info("Finish setup theme")}catch(O){d.warning("Setup theme failed","".concat(O))}return function(){try{var e=document.querySelector("body");null==e||e.classList.remove("sendbird-theme--light"),null==e||e.classList.remove("sendbird-theme--dark")}catch(t){}}}),[ye]),Ee=j,t.useEffect((function(){document.getElementById(ug).parentElement.dir=Ee}),[Ee]);var Te=dB(ie.sdk,d),Ne=function(e,n){var r=e.isConnected,i=n.logger,a=t.useMemo((function(){return hB({logger:i,cb:function(e){try{e.markAsRead()}catch(t){i.warning("Channel: Mark as delivered failed",{channel:e,error:t})}}})}),[]);return t.useEffect((function(){r||a.clear()}),[r]),cB((function(){a.clear()})),a}({isConnected:Te},{logger:d}),Se=fB({isConnected:Te},{logger:d}),Ie=t.useMemo((function(){return Math.min(10,null!=pe?pe:Number.MAX_SAFE_INTEGER)}),[pe]),we=t.useMemo((function(){return new OF({sdk:de,logger:d})}),[ie.initialized]),Ae=t.useMemo((function(){return{common:{enableUsingDefaultUserProfile:oe.common.enableUsingDefaultUserProfile},groupChannel:{enableOgtag:ce&&le(de).groupChannel.channel.enableOgtag,enableTypingIndicator:oe.groupChannel.channel.enableTypingIndicator,enableReactions:ce&&le(de).groupChannel.channel.enableReactions,enableMention:oe.groupChannel.channel.enableMention,replyType:oe.groupChannel.channel.replyType,threadReplySelectType:oe.groupChannel.channel.threadReplySelectType,enableVoiceMessage:oe.groupChannel.channel.enableVoiceMessage,enableDocument:oe.groupChannel.channel.input.enableDocument,typingIndicatorTypes:oe.groupChannel.channel.typingIndicatorTypes,enableFeedback:oe.groupChannel.channel.enableFeedback,enableSuggestedReplies:oe.groupChannel.channel.enableSuggestedReplies,showSuggestedRepliesFor:oe.groupChannel.channel.showSuggestedRepliesFor,suggestedRepliesDirection:oe.groupChannel.channel.suggestedRepliesDirection,enableMarkdownForUserMessage:oe.groupChannel.channel.enableMarkdownForUserMessage,enableFormTypeMessage:oe.groupChannel.channel.enableFormTypeMessage,enableReactionsSupergroup:ce&&le(de).groupChannel.channel.enableReactionsSupergroup},groupChannelList:{enableTypingIndicator:oe.groupChannel.channelList.enableTypingIndicator,enableMessageReceiptStatus:oe.groupChannel.channelList.enableMessageReceiptStatus},groupChannelSettings:{enableMessageSearch:ce&&le(de).groupChannel.setting.enableMessageSearch},openChannel:{enableOgtag:ce&&le(de).openChannel.channel.enableOgtag,enableDocument:oe.openChannel.channel.input.enableDocument}}}),[ce,oe.common,oe.groupChannel.channel,oe.groupChannel.channelList,oe.groupChannel.setting,oe.openChannel.channel]),Me=t.useMemo((function(){return{stores:{sdkStore:ee.stores.sdkStore,userStore:ee.stores.userStore,appInfoStore:ee.stores.appInfoStore}}}),[ee.stores.sdkStore,ee.stores.userStore,ee.stores.appInfoStore]),Oe=t.useMemo((function(){return null!=fe?fe:vg}),[fe,vg]),Re=t.useMemo((function(){return m({compressionRate:.7,outputFormat:"preserve"},S)}),[S]),De=t.useMemo((function(){var e,t;return{maxRecordingTime:null!==(e=null==C?void 0:C.maxRecordingTime)&&void 0!==e?e:og,minRecordingTime:null!==(t=null==C?void 0:C.minRecordingTime)&&void 0!==t?t:sg}}),[null==C?void 0:C.maxRecordingTime,null==C?void 0:C.minRecordingTime]),ke=t.useMemo((function(){return{maxMentionCount:(null==Y?void 0:Y.maxMentionCount)||10,maxSuggestionCount:(null==Y?void 0:Y.maxSuggestionCount)||15}}),[null==Y?void 0:Y.maxMentionCount,null==Y?void 0:Y.maxSuggestionCount]),Le=t.useMemo((function(){return{disableUserProfile:!oe.common.enableUsingDefaultUserProfile,isReactionEnabled:ce&&le(de).groupChannel.channel.enableReactions,isMentionEnabled:oe.groupChannel.channel.enableMention,isVoiceMessageEnabled:oe.groupChannel.channel.enableVoiceMessage,replyType:FT(oe.groupChannel.channel.replyType).upperCase,isTypingIndicatorEnabledOnChannelList:oe.groupChannel.channelList.enableTypingIndicator,isMessageReceiptStatusEnabledOnChannelList:oe.groupChannel.channelList.enableMessageReceiptStatus,showSearchIcon:ce&&le(de).groupChannel.setting.enableMessageSearch}}),[ce,le,oe.common.enableUsingDefaultUserProfile,oe.groupChannel.channel.enableReactions,oe.groupChannel.channel.enableMention,oe.groupChannel.channel.enableVoiceMessage,oe.groupChannel.channel.replyType,oe.groupChannel.channelList.enableTypingIndicator,oe.groupChannel.channelList.enableMessageReceiptStatus,oe.groupChannel.setting.enableMessageSearch]),xe=t.useMemo((function(){return{config:m(m({disableMarkAsDelivered:M,renderUserProfile:R,onStartDirectMessage:z,onUserProfileMessage:z,allowProfileEdit:w,isOnline:Te,userId:i,appId:r,accessToken:a,theme:ye,setCurrentTheme:Ce,setCurrenttheme:Ce,isMultipleFilesMessageEnabled:B,uikitMultipleFilesMessageLimit:Ie,logger:d,pubSub:J,userListQuery:T,htmlTextDirection:j,forceLeftToRightMessageLayout:q,markAsReadScheduler:Ne,markAsDeliveredScheduler:Se,uikitUploadSizeLimit:Oe,imageCompression:Re,voiceRecord:De,userMention:ke},Ae),Le)}}),[M,R,z,w,Te,i,r,a,ye,Ce,B,Ie,d,J,T,j,q,Ne,Se,Oe,Re,De,ke,Ae,Le]),Ue=t.useMemo((function(){return{utils:{updateMessageTemplatesInfo:ve,getCachedTemplate:me}}}),[ve,me]);return qT((function(){te(m(m(m(m({},Me),Ue),xe),{eventHandlers:H,emojiManager:we}))}),[Me,xe,H,we,Ue]),null},AB=function(e){var n,r,i,a,s,o,l,u,c,d=e.children,h=e.stringSet,f=e.breakpoint,p=e.dateLocale,_=KT({config:{renderUserProfile:null==e?void 0:e.renderUserProfile,onStartDirectMessage:null==e?void 0:e.onStartDirectMessage,allowProfileEdit:null==e?void 0:e.allowProfileEdit,appId:null==e?void 0:e.appId,userId:null==e?void 0:e.userId,accessToken:null==e?void 0:e.accessToken,theme:null==e?void 0:e.theme,htmlTextDirection:null==e?void 0:e.htmlTextDirection,forceLeftToRightMessageLayout:null==e?void 0:e.forceLeftToRightMessageLayout,pubSub:null===(n=null==e?void 0:e.config)||void 0===n?void 0:n.pubSub,logger:null==e?void 0:e.logger,userListQuery:null==e?void 0:e.userListQuery,voiceRecord:{maxRecordingTime:null!==(i=null===(r=null==e?void 0:e.voiceRecord)||void 0===r?void 0:r.maxRecordingTime)&&void 0!==i?i:og,minRecordingTime:null!==(s=null===(a=null==e?void 0:e.voiceRecord)||void 0===a?void 0:a.minRecordingTime)&&void 0!==s?s:sg},userMention:{maxMentionCount:(null===(l=null===(o=null==e?void 0:e.config)||void 0===o?void 0:o.userMention)||void 0===l?void 0:l.maxMentionCount)||10,maxSuggestionCount:(null===(c=null===(u=null==e?void 0:e.config)||void 0===u?void 0:u.userMention)||void 0===c?void 0:c.maxSuggestionCount)||15},imageCompression:m({compressionRate:.7,outputFormat:"preserve"},null==e?void 0:e.imageCompression),disableMarkAsDelivered:null==e?void 0:e.disableMarkAsDelivered,isMultipleFilesMessageEnabled:null==e?void 0:e.isMultipleFilesMessageEnabled},eventHandlers:null==e?void 0:e.eventHandlers}),v=t.useRef(function(e){return GC({config:m(m({},jC.config),null==e?void 0:e.config),stores:m(m({},jC.stores),null==e?void 0:e.stores),eventHandlers:m(m({},jC.eventHandlers),null==e?void 0:e.eventHandlers),emojiManager:jC.emojiManager,utils:m(m({},jC.utils),null==e?void 0:e.utils)})}(_)),g=t.useMemo((function(){return m(m({},mN("en")),h)}),[h]);return t.createElement(zC.Provider,{value:v.current},t.createElement(JM,{logger:v.current.getState().config.logger,breakpoint:f},t.createElement(BN,{stringSet:g,dateLocale:p},t.createElement(_B,null,t.createElement(tL,null,d)))),t.createElement(Rk,null),t.createElement(Qk,null),t.createElement(Mk,null))},MB=function(e){var n=e.children,r=e.config,i=null==r?void 0:r.logLevel,a=t.useState(CB(i)),s=a[0],o=a[1];return t.useEffect((function(){o(CB(i))}),[i]),t.createElement(AB,m({},e,{logger:s}),t.createElement(wB,m({},e,{logger:s})),n)},OB=function(e){var n,r,i,a,s,o,l,u,c,d,h,f,p,_,v,g,E,b,y,C,T,N,S,I,w,A,M,O,R,D,k,L,x,U,P,F,B,H,G,j,V,q,z,K,Y=(n={legacyConfig:{replyType:e.replyType,isMentionEnabled:e.isMentionEnabled,isReactionEnabled:e.isReactionEnabled,disableUserProfile:e.disableUserProfile,isVoiceMessageEnabled:e.isVoiceMessageEnabled,isTypingIndicatorEnabledOnChannelList:e.isTypingIndicatorEnabledOnChannelList,isMessageReceiptStatusEnabledOnChannelList:e.isMessageReceiptStatusEnabledOnChannelList,showSearchIcon:e.showSearchIcon},uikitOptions:e.uikitOptions},U=n.legacyConfig,P=n.uikitOptions,F=void 0===P?{}:P,B=U.replyType,H=U.isMentionEnabled,G=U.isReactionEnabled,j=U.disableUserProfile,V=U.isVoiceMessageEnabled,q=U.isTypingIndicatorEnabledOnChannelList,z=U.isMessageReceiptStatusEnabledOnChannelList,K=U.showSearchIcon,{common:{enableUsingDefaultUserProfile:null!==(i=null===(r=F.common)||void 0===r?void 0:r.enableUsingDefaultUserProfile)&&void 0!==i?i:"boolean"==typeof j?!j:void 0},groupChannel:{enableOgtag:null===(a=F.groupChannel)||void 0===a?void 0:a.enableOgtag,enableMention:null!==(o=null===(s=F.groupChannel)||void 0===s?void 0:s.enableMention)&&void 0!==o?o:H,enableReactions:null!==(u=null===(l=F.groupChannel)||void 0===l?void 0:l.enableReactions)&&void 0!==u?u:G,enableReactionsSupergroup:null===(c=F.groupChannel)||void 0===c?void 0:c.enableReactionsSupergroup,enableTypingIndicator:null===(d=F.groupChannel)||void 0===d?void 0:d.enableTypingIndicator,enableVoiceMessage:null!==(f=null===(h=F.groupChannel)||void 0===h?void 0:h.enableVoiceMessage)&&void 0!==f?f:V,replyType:null!==(_=null===(p=F.groupChannel)||void 0===p?void 0:p.replyType)&&void 0!==_?_:null!=B?FT(B).lowerCase:void 0,threadReplySelectType:null===(v=F.groupChannel)||void 0===v?void 0:v.threadReplySelectType,input:{enableDocument:null===(E=null===(g=F.groupChannel)||void 0===g?void 0:g.input)||void 0===E?void 0:E.enableDocument},typingIndicatorTypes:null===(b=F.groupChannel)||void 0===b?void 0:b.typingIndicatorTypes,enableFeedback:null===(y=F.groupChannel)||void 0===y?void 0:y.enableFeedback,enableSuggestedReplies:null===(C=F.groupChannel)||void 0===C?void 0:C.enableSuggestedReplies,showSuggestedRepliesFor:null===(T=F.groupChannel)||void 0===T?void 0:T.showSuggestedRepliesFor,suggestedRepliesDirection:null===(N=F.groupChannel)||void 0===N?void 0:N.suggestedRepliesDirection,enableMarkdownForUserMessage:null===(S=F.groupChannel)||void 0===S?void 0:S.enableMarkdownForUserMessage,enableFormTypeMessage:null===(I=F.groupChannel)||void 0===I?void 0:I.enableFormTypeMessage},groupChannelList:{enableTypingIndicator:null!==(A=null===(w=F.groupChannelList)||void 0===w?void 0:w.enableTypingIndicator)&&void 0!==A?A:q,enableMessageReceiptStatus:null!==(O=null===(M=F.groupChannelList)||void 0===M?void 0:M.enableMessageReceiptStatus)&&void 0!==O?O:z},groupChannelSettings:{enableMessageSearch:null!==(D=null===(R=F.groupChannelSettings)||void 0===R?void 0:R.enableMessageSearch)&&void 0!==D?D:K},openChannel:{enableOgtag:null===(k=F.openChannel)||void 0===k?void 0:k.enableOgtag,input:{enableDocument:null===(x=null===(L=F.openChannel)||void 0===L?void 0:L.input)||void 0===x?void 0:x.enableDocument}}});return t.createElement(ig,{storage:pB,localConfigs:{common:null==Y?void 0:Y.common,groupChannel:{channel:null==Y?void 0:Y.groupChannel,channelList:null==Y?void 0:Y.groupChannelList,setting:null==Y?void 0:Y.groupChannelSettings},openChannel:{channel:null==Y?void 0:Y.openChannel}}},t.createElement(MB,m({},e)))};const RB=({width:e=26,height:t=26,color:n="#B4B4BE"})=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:t,viewBox:"0 0 26 26",fill:"none",children:[f.jsx("g",{clipPath:"url(#clip0_8040_135368)",children:f.jsx("path",{d:"M21.2959 14.7941L10.5021 19.3473C8.93209 20.0137 7.47499 18.1856 8.47599 16.8019L10.7639 13.6316C10.7852 13.6316 10.7958 13.6315 10.817 13.6316L14.3625 13.637C14.7765 13.6377 15.1104 13.3038 15.1097 12.8899C15.1144 12.4706 14.7795 12.1357 14.3602 12.1403L10.8201 12.1295C10.7989 12.1295 10.7776 12.1294 10.7617 12.1347L8.34155 8.79261C7.34693 7.41643 8.76665 5.60346 10.344 6.23748L21.2524 10.6381C23.1165 11.3894 23.1471 14.0168 21.2959 14.7941Z",fill:n})}),f.jsx("defs",{children:f.jsx("clipPath",{id:"clip0_8040_135368",children:f.jsx("rect",{width:"18",height:"18",fill:"white",transform:"translate(13) rotate(45)"})})})]});var DB=function(){var e=t.useContext(kB);if(!e)throw new Error("useGroupChannelList must be used within a GroupChannelListProvider");var n=t.useCallback((function(t){e.setState((function(e){return m(m({},e),{groupChannels:t})}),!0)}),[]);return{state:Ag.useSyncExternalStore(e.subscribe,e.getState),actions:t.useMemo((function(){return{setGroupChannels:n}}),[n])}},kB=t.createContext(null),LB={className:"",selectedChannelUrl:"",disableAutoSelect:!1,allowProfileEdit:!1,isTypingIndicatorEnabled:!1,isMessageReceiptStatusEnabled:!1,onChannelSelect:function(){},onChannelCreated:function(){},onThemeChange:zT,onCreateChannelClick:zT,onBeforeCreateChannel:null,onUserProfileUpdated:zT,typingChannelUrls:[],refreshing:!1,initialized:!1,groupChannels:[],refresh:null,loadMore:null,scrollRef:{current:null}},xB=function(e){var n,r,i,a,s,o,l=e.className,u=void 0===l?"":l,c=e.selectedChannelUrl,d=void 0===c?"":c,h=e.disableAutoSelect,f=void 0!==h&&h,p=e.channelListQueryParams,_=e.onThemeChange,g=e.onChannelSelect,E=e.onChannelCreated,b=e.onCreateChannelClick,y=e.onBeforeCreateChannel,C=e.onUserProfileUpdated,T=v(e,["className","selectedChannelUrl","disableAutoSelect","channelListQueryParams","onThemeChange","onChannelSelect","onChannelCreated","onCreateChannelClick","onBeforeCreateChannel","onUserProfileUpdated"]),N=yT().state,S=N.config,I=N.stores,w=DB(),A=w.state,M=w.actions,O=VC(kB,(function(e){return e}),LB).updateState,R=I.sdkStore.sdk,D=fB({isConnected:dB(R,S.logger)},S),k=t.useRef(null),L=cm(R,{collectionCreator:FB(R,p),markAsDelivered:function(e){return e.forEach(D.push)},onChannelsDeleted:function(e){e.forEach((function(e){e===d&&g(null)}))},onChannelsUpdated:function(){M.setGroupChannels(P)}}),x=L.refreshing,U=L.initialized,P=L.groupChannels,F=L.refresh,B=L.loadMore;t.useEffect((function(){var e;!f&&I.sdkStore.initialized&&U&&(d||g(null!==(e=P[0])&&void 0!==e?e:null))}),[f,I.sdkStore.initialized,U,d]),t.useEffect((function(){null==F||F()}),[Object.keys(null!=p?p:{}).sort().map((function(e){return"".concat(e,"=").concat(encodeURIComponent(JSON.stringify(p[e])))})).join("&")]);var H=A.typingChannelUrls;im(R,{onTypingStatusUpdated:function(e){var t,n=H.filter((function(t){return t!==e.url}));(null===(t=e.getTypingUsers())||void 0===t?void 0:t.length)>0?O({typingChannelUrls:n.concat(e.url)}):O({typingChannelUrls:n})}});var G=null===(r=null!==(n=T.allowProfileEdit)&&void 0!==n?n:S.allowProfileEdit)||void 0===r||r,j=null!==(a=null!==(i=T.isTypingIndicatorEnabled)&&void 0!==i?i:S.groupChannelList.enableTypingIndicator)&&void 0!==a&&a,V=null!==(o=null!==(s=T.isMessageReceiptStatusEnabled)&&void 0!==s?s:S.groupChannelList.enableMessageReceiptStatus)&&void 0!==o&&o,q=t.useMemo((function(){return{onChannelSelect:g,onChannelCreated:E,onThemeChange:_,onCreateChannelClick:b,onBeforeCreateChannel:y,onUserProfileUpdated:C}}),[g,E,_,b,y,C]),z=t.useMemo((function(){return{className:u,selectedChannelUrl:d,disableAutoSelect:f,allowProfileEdit:G,isTypingIndicatorEnabled:j,isMessageReceiptStatusEnabled:V,typingChannelUrls:H,refreshing:x,initialized:U,refresh:F,loadMore:B}}),[u,d,f,G,j,V,H,x,U,k]);return qT((function(){O(m(m(m({},q),z),{groupChannels:P}))}),[z,q,P.map((function(e){return e.serialize()}))]),null},UB=function(e){var n=e.children,r=KT({onChannelSelect:null==e?void 0:e.onChannelSelect,onChannelCreated:null==e?void 0:e.onChannelCreated,className:null==e?void 0:e.className,selectedChannelUrl:null==e?void 0:e.selectedChannelUrl,allowProfileEdit:null==e?void 0:e.allowProfileEdit,disableAutoSelect:null==e?void 0:e.disableAutoSelect,isTypingIndicatorEnabled:null==e?void 0:e.isTypingIndicatorEnabled,isMessageReceiptStatusEnabled:null==e?void 0:e.isMessageReceiptStatusEnabled,channelListQueryParams:null==e?void 0:e.channelListQueryParams,onThemeChange:null==e?void 0:e.onThemeChange,onCreateChannelClick:null==e?void 0:e.onCreateChannelClick,onBeforeCreateChannel:null==e?void 0:e.onBeforeCreateChannel,onUserProfileUpdated:null==e?void 0:e.onUserProfileUpdated}),i=t.useRef(function(e){return GC(m(m({},LB),e))}(r));return t.createElement(kB.Provider,{value:i.current},n)},PB=function(e){var n=e.children,r=e.className;return t.createElement(UB,m({},e),t.createElement(xB,m({},e)),t.createElement(NT,m({},e),t.createElement("div",{className:"sendbird-channel-list ".concat(r)},n)))};function FB(e,t){return function(n){var r=m(m({},n),t);return e.groupChannel.createGroupChannelCollection(m(m({},r),{filter:new Sf(r)}))}}var BB=function(e){var n=e.renderTitle,r=e.renderIconButton,i=e.onEdit,a=e.allowProfileEdit,s=e.renderLeft,o=e.renderMiddle,l=e.renderRight,u=yT().state.stores.userStore.user,c=HN().stringSet,d=null!=o?o:n;return t.createElement(iO,{className:WT("sendbird-channel-header",a&&"sendbird-channel-header--allow-edit"),renderLeft:s,renderMiddle:function(){var e;return null!==(e=null==d?void 0:d())&&void 0!==e?e:t.createElement("div",{className:"sendbird-channel-header__title",role:"button",onClick:function(){null==i||i()},onKeyDown:function(){null==i||i()},tabIndex:0},t.createElement("div",{className:"sendbird-channel-header__title__left"},t.createElement(GA,{width:"32px",height:"32px",src:u.profileUrl,alt:u.nickname})),t.createElement("div",{className:"sendbird-channel-header__title__right"},t.createElement(yN,{className:"sendbird-channel-header__title__right__name",type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_1},u.nickname||c.NO_NAME),t.createElement(yN,{className:"sendbird-channel-header__title__right__user-id",type:CN.BODY_2,color:TN.ONBACKGROUND_2},u.userId)))},renderRight:null!=l?l:r})},HB=t.createContext(null),GB=function(e){var n=e.children,r=v(e,["children"]);return t.createElement(HB.Provider,{value:r},n)},jB=function(e){var n,r=e.formRef,i=e.inputRef,a=e.onThemeChange,s=e.setProfileImage,o=yT().state,l=o.stores,u=o.config,c=u.theme,d=u.setCurrentTheme,h=null===(n=l.userStore)||void 0===n?void 0:n.user,f=HN().stringSet,p=t.useState(null),_=p[0],m=p[1],v=t.useRef(null);return t.createElement("form",{className:"sendbird-edit-user-profile",ref:r,onSubmit:function(e){e.preventDefault()}},t.createElement("section",{className:"sendbird-edit-user-profile__img"},t.createElement(AP,null,f.EDIT_PROFILE__IMAGE_LABEL),t.createElement("div",{className:"sendbird-edit-user-profile__img__avatar"},t.createElement(GA,{width:"80px",height:"80px",src:_||(null==h?void 0:h.profileUrl)})),t.createElement("input",{ref:v,type:"file",accept:"image/gif, image/jpeg, image/png",style:{display:"none"},onChange:function(e){e.target.files&&(m(URL.createObjectURL(e.target.files[0])),s(e.target.files[0])),v.current&&(v.current.value="")}}),t.createElement(tO,{className:"sendbird-edit-user-profile__img__avatar-button",disableUnderline:!0,onClick:function(){var e;return null===(e=v.current)||void 0===e?void 0:e.click()}},t.createElement(yN,{type:CN.BUTTON_1,color:TN.PRIMARY},f.EDIT_PROFILE__IMAGE_UPLOAD))),t.createElement("section",{className:"sendbird-edit-user-profile__name"},t.createElement(AP,null,f.EDIT_PROFILE__NICKNAME_LABEL),t.createElement(MP,{required:""!==(null==h?void 0:h.nickname),name:"sendbird-edit-user-profile__name__input",ref:i,value:null==h?void 0:h.nickname,placeHolder:f.EDIT_PROFILE__NICKNAME_PLACEHOLDER})),t.createElement("section",{className:"sendbird-edit-user-profile__userid"},t.createElement(AP,null,f.EDIT_PROFILE__USERID_LABEL),t.createElement(MP,{disabled:!0,name:"sendbird-edit-user-profile__userid__input",value:null==h?void 0:h.userId})),t.createElement("section",{className:"sendbird-edit-user-profile__theme"},t.createElement(AP,null,f.EDIT_PROFILE__THEME_LABEL),t.createElement("div",{className:"sendbird-edit-user-profile__theme__theme-icon"},"dark"===c?t.createElement(pA,{onClick:function(){d("light"),null==a||a("light")},type:_A.TOGGLE_ON,width:44,height:24}):t.createElement(pA,{onClick:function(){d("dark"),null==a||a("dark")},type:_A.TOGGLE_OFF,width:44,height:24}))))},VB=function(){var e=function(){var e=t.useContext(HB);if(!e)throw new Error("EditUserProfileContext not found. Use within the EditUserProfile module.");return e}(),n=e.onEditProfile,r=e.onCancel,i=e.onThemeChange,a=t.useContext(FN).stringSet,s=function(e){var n=e.onEditProfile,r=yT(),i=r.state,a=r.actions,s=t.useRef(null),o=t.useRef(null),l=t.useState(null),u=l[0],c=l[1];return{formRef:o,inputRef:s,updateUserInfo:function(){!function(e){var t,n,r,i=e.globalContext,a=e.formRef,s=e.inputRef,o=e.profileImage,l=e.onEditProfile,u=e.updateUserInfo,c=i.stores,d=c.sdkStore.sdk,h=c.userStore.user;""===(null==h?void 0:h.nickname)||s.current.value?null==d||d.updateCurrentUserInfo({nickname:null===(r=null==s?void 0:s.current)||void 0===r?void 0:r.value,profileImage:null!=o?o:void 0}).then((function(e){u(e),null==l||l(e)})):null===(n=(t=a.current).reportValidity)||void 0===n||n.call(t)}({globalContext:i,formRef:o,inputRef:s,profileImage:u,onEditProfile:n,updateUserInfo:a.updateUserInfo})},profileImage:u,setProfileImage:c}}({onEditProfile:n}),o=s.formRef,l=s.inputRef,u=s.updateUserInfo,c=s.setProfileImage;return t.createElement($k,{titleText:a.EDIT_PROFILE__TITLE,submitText:a.BUTTON__SAVE,type:ZO.PRIMARY,onCancel:r,isFullScreenOnMobile:!0,onSubmit:u},t.createElement(jB,{formRef:o,inputRef:l,setProfileImage:c,onThemeChange:i}))},qB=function(e){var n=e.onEditProfile,r=e.onCancel,i=e.onThemeChange;return t.createElement(GB,{onEditProfile:n,onCancel:r,onThemeChange:i},t.createElement(VB,null))};function zB(e,n,r){void 0===r&&(r={leading:!0,trailing:!1});var i=t.useRef(null),a=t.useRef(null);return t.useEffect((function(){return function(){i.current&&clearTimeout(i.current)}}),[]),am((function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if(i.current)a.current=t;else{r.leading?e.apply(void 0,t):a.current=t;var o=function(){r.trailing&&a.current?(e.apply(void 0,a.current),a.current=null,i.current=setTimeout(o,n)):i.current=null};i.current=setTimeout(o,n)}}))}var KB=function(e){var n=e.channel,r=e.onSubmit,i=e.onCancel,a=yT().state.config,s=a.logger,o=a.isOnline,l=HN().stringSet;if(n)return t.createElement($k,{disabled:!o,onCancel:i,onSubmit:function(){s.info("LeaveGroupChannel: Leaving channel",n),n.leave().then((function(){s.info("LeaveGroupChannel: Leaving channel successful!",n),null==r||r()}))},submitText:l.MODAL__LEAVE_CHANNEL__FOOTER,titleText:l.MODAL__LEAVE_CHANNEL__TITLE})};function YB(e){var n=e.channel,r=e.disabled,i=void 0!==r&&r,a=e.onLeaveChannel,s=t.useRef(null),o=t.useRef(null),l=t.useState(!1),u=l[0],c=l[1],d=t.useContext(FN).stringSet;return t.createElement("div",{ref:o,tabIndex:0,role:"button",style:{display:"inline-block"},onKeyDown:function(e){return e.stopPropagation()},onClick:function(e){return e.stopPropagation()}},t.createElement(Dk,{menuTrigger:function(e){return t.createElement(nO,{ref:s,onClick:e,height:"32px",width:"32px"},t.createElement(pA,{type:_A.MORE,fillColor:mA.PRIMARY,width:"24px",height:"24px"}))},menuItems:function(e){return t.createElement(Sk,{parentRef:s,parentContainRef:o,closeDropdown:e},t.createElement(wk,{onClick:function(){i||(c(!0),e())},testID:"channel_list_item_context_menu_leave_channel"},d.CHANNEL_SETTING__LEAVE_CHANNEL__TITLE))}}),u&&t.createElement(KB,{channel:n,onSubmit:function(){c(!1),null==a||a()},onCancel:function(){return c(!1)}}))}function WB(e){var n=e.count,r=e.maxLevel,i=void 0===r?2:r,a=e.className,s=void 0===a?"":a,o=t.useContext(FN).stringSet,l=parseInt("9".repeat(i>6?6:i),10);return t.createElement("div",{className:b(b([],Array.isArray(s)?s:[s],!0),["sendbird-badge"],!1).join(" ")},t.createElement("div",{className:"sendbird-badge__text"},t.createElement(yN,{type:CN.CAPTION_2,color:TN.ONCONTENT_1},"string"==typeof n?n:n>l?"".concat(l).concat(o.BADGE__OVER):n)))}function QB(e){var n=e.className,r=void 0===n?"":n,i=e.children,a=e.isReverse,s=void 0!==a&&a,o=e.color,l=e.userId;return t.createElement("span",{className:WT(gD,r,s&&"reverse",o),contentEditable:!1,"data-userid":l,"data-sb-mention":!0},i)}var XB=function(e){var n=e.channel,r=e.tabIndex,i=e.isTyping,a=e.isSelected,s=e.channelName,o=e.isMessageStatusEnabled,l=void 0===o||o,u=e.onClick,c=void 0===u?zT:u,d=e.onLeaveChannel,h=void 0===d?function(){return Promise.resolve()}:d,f=e.renderChannelAction,p=yT().state.config,_=p.theme,v=p.userId,g=HN(),E=g.dateLocale,b=g.stringSet,y=$M().isMobile,C=p.groupChannel.enableMention,T=lk(n,b),N=p.groupChannel.enableMarkdownForUserMessage?KD(T):T,S=t.useState(!1),I=S[0],w=S[1],A=qk({onLongPress:function(){y&&w(!0)},onClick:c},{delay:1e3});return t.createElement(t.Fragment,null,t.createElement("div",m({className:["sendbird-channel-preview",a?"sendbird-channel-preview--active":""].join(" "),role:"link",tabIndex:r},y?m({},A):{onClick:c}),t.createElement("div",{className:"sendbird-channel-preview__avatar"},t.createElement(qA,{channel:n,userId:v,theme:_})),t.createElement("div",{className:"sendbird-channel-preview__content"},t.createElement("div",{className:"sendbird-channel-preview__content__upper"},t.createElement("div",{className:"sendbird-channel-preview__content__upper__header"},!!n.isBroadcast&&t.createElement("div",{className:"sendbird-channel-preview__content__upper__header__broadcast-icon"},t.createElement(pA,{type:_A.BROADCAST,fillColor:mA.SECONDARY,height:"16px",width:"16px"})),t.createElement(yN,{className:"sendbird-channel-preview__content__upper__header__channel-name",testID:"sendbird-channel-preview__content__upper__header__channel-name",type:CN.SUBTITLE_2,color:TN.ONBACKGROUND_1},s),t.createElement(yN,{className:"sendbird-channel-preview__content__upper__header__total-members",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},function(e){return(null==e?void 0:e.memberCount)?e.memberCount:0}(n)),n.isFrozen&&t.createElement("div",{title:"Frozen",className:"sendbird-channel-preview__content__upper__header__frozen-icon"},t.createElement(pA,{type:_A.FREEZE,fillColor:mA.PRIMARY,height:12,width:12}))),!n.isEphemeral&&l&&t.createElement(hk,{className:"sendbird-channel-preview__content__upper__last-message-at",channel:n,message:n.lastMessage,isDateSeparatorConsidered:!1}),!n.isEphemeral&&!l&&t.createElement(yN,{className:"sendbird-channel-preview__content__upper__last-message-at",type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},sk({channel:n,locale:E,stringSet:b}))),t.createElement("div",{className:"sendbird-channel-preview__content__lower"},t.createElement(yN,{className:"sendbird-channel-preview__content__lower__last-message",type:CN.BODY_2,color:TN.ONBACKGROUND_3},i&&t.createElement(jN,{members:n.getTypingUsers()}),!i&&!OM(n.lastMessage)&&N,!i&&OM(n.lastMessage)&&b.VOICE_MESSAGE),!a&&!n.isEphemeral&&t.createElement("div",{className:"sendbird-channel-preview__content__lower__unread-message-count"},C&&n.unreadMentionCount>0?t.createElement(QB,{className:"sendbird-channel-preview__content__lower__unread-message-count__mention",color:"purple"},"@"):null,uk(n)?t.createElement(WB,{count:uk(n)}):null))),!y&&t.createElement("div",{className:"sendbird-channel-preview__action"},f({channel:n}))),I&&y&&t.createElement($k,{className:"sendbird-channel-preview__leave--mobile",titleText:s,hideFooter:!0,isCloseOnClickOutside:!0,onCancel:function(){return w(!1)}},t.createElement(tO,{onClick:function(){h(),w(!1)},className:"sendbird-channel-preview__leave-label--mobile"},t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},b.CHANNEL_PREVIEW_MOBILE_LEAVE))))},ZB=function(e){var n,r,i,a=e.channel,s=e.isSelected,o=e.isTyping,l=e.renderChannelAction,u=e.onLeaveChannel,c=e.onClick,d=e.tabIndex,h=yT().state.config,f=HN().stringSet,p=DB().state,_=p.isTypingIndicatorEnabled,m=p.isMessageReceiptStatusEnabled,v=h.userId,g=m&&!(null===(n=a.lastMessage)||void 0===n?void 0:n.isAdminMessage())&&(null===(i=null===(r=a.lastMessage)||void 0===r?void 0:r.sender)||void 0===i?void 0:i.userId)===v;return t.createElement(XB,{channel:a,tabIndex:d,channelName:ak(a,v,f),isTyping:_&&o,isSelected:s,isMessageStatusEnabled:g,onClick:c,onLeaveChannel:u,renderChannelAction:l})},JB=function(e){return null==e};function $B(e,t){return!JB(e)&&!JB(t)&&e.toString()===t.toString()}var eH=function(e){void 0===e&&(e=0);var t=e;if(!(t>10))try{var n=document.querySelector(".sendbird-thread-ui--scroll");n&&(n.scrollTop=n.scrollHeight)}catch(r){setTimeout((function(){eH(t+1)}),500*t)}},tH=function(e,n){var r=e.currentChannel,i=e.onBeforeSendMultipleFilesMessage,a=e.publishingModules,s=n.logger,o=n.pubSub,l=n.scrollRef;return[t.useCallback((function(e,t){return new Promise((function(n,u){r||(s.warning("Channel: Sending MFm failed, because currentChannel is null.",{currentChannel:r}),u()),e.length<=1&&(s.warning("Channel: Sending MFM failed, because there are no multiple files.",{files:e}),u());var c={fileInfoList:e.map((function(e){return{file:e,fileName:e.name,fileSize:e.size,mimeType:e.type}}))};t&&(c.isReplyToChannel=!0,c.parentMessageId=t.messageId),"function"==typeof i&&(c=i(e,t)),s.info("Channel: Start sending MFM",{messageParams:c});try{null==r||r.sendMultipleFilesMessage(c).onFileUploaded((function(e,t,n,i){s.info("Channel: onFileUploaded during sending MFM",{requestId:e,index:t,error:i,uploadableFileInfo:n}),o.publish(jT.ON_FILE_INFO_UPLOADED,{response:{channelUrl:r.url,requestId:e,index:t,uploadableFileInfo:n,error:i},publishingModules:a})})).onPending((function(e){s.info("Channel: in progress of sending MFM",{pendingMessage:e,fileInfoList:c.fileInfoList}),o.publish(jT.SEND_MESSAGE_START,{message:e,channel:r,publishingModules:a}),setTimeout((function(){var e;l&&(e=a,GT(OT.CHANNEL,e))&&rF(0,l),function(e){return GT(OT.THREAD,e)}(a)&&eH(0)}),100)})).onFailed((function(e,t){s.error("Channel: Sending MFM failed.",{error:e,failedMessage:t}),o.publish(jT.SEND_MESSAGE_FAILED,{channel:r,message:t,publishingModules:a}),u(e)})).onSucceeded((function(e){s.info("Channel: Sending voice message success!",{succeededMessage:e}),o.publish(jT.SEND_FILE_MESSAGE,{channel:r,message:e,publishingModules:a}),n(e)}))}catch(d){s.error("Channel: Sending MFM failed.",{error:d}),u(d)}}))}),[r,i,a])]};t.createContext(null),t.createContext(null),t.createContext(null),t.createContext(void 0);var nH,rH,iH,aH,sH,oH,lH,uH,cH=function(){},dH={checked:null,defaultChecked:!1,disabled:!1,onChange:cH,onFocus:cH,onBlur:cH};t.createContext(dH),(rH=nH||(nH={})).SCORE="score",rH.TIMESTAMP="ts",t.createContext(null),(aH=iH||(iH={})).NIL="NIL",aH.LOADING="LOADING",aH.INVALID="INVALID",aH.INITIALIZED="INITIALIZED",(oH=sH||(sH={})).NIL="NIL",oH.LOADING="LOADING",oH.INVALID="INVALID",oH.INITIALIZED="INITIALIZED",(uH=lH||(lH={})).NIL="NIL",uH.LOADING="LOADING",uH.INVALID="INVALID",uH.INITIALIZED="INITIALIZED";function hH(e,n){var r=e.isMentionEnabled,i=e.currentChannel,a=e.onBeforeSendUserMessage,s=e.sendMessageStart,o=e.sendMessageFailure,l=n.logger,u=n.pubSub;return t.useCallback((function(e){var t,n=e.message,c=e.quoteMessage,d=e.mentionTemplate,h=e.mentionedUsers,f=null!==(t=null==a?void 0:a(n,c))&&void 0!==t?t:function(){var e={};e.message=n;var t=(null==h?void 0:h.length)||0;return r&&t&&(e.mentionedUsers=h),r&&d&&t&&(e.mentionedMessageTemplate=d),c&&(e.isReplyToChannel=!0,e.parentMessageId=c.messageId),e}();l.info("Thread | useSendUserMessageCallback: Sending user message start.",f),(null==i?void 0:i.sendUserMessage)&&(null==i||i.sendUserMessage(f).onPending((function(e){s(e)})).onFailed((function(e,t){l.info("Thread | useSendUserMessageCallback: Sending user message failed.",{message:t,error:e}),o(t)})).onSucceeded((function(e){l.info("Thread | useSendUserMessageCallback: Sending user message succeeded.",e),u.publish(jT.SEND_USER_MESSAGE,{channel:i,message:e,publishingModules:[OT.THREAD]})})))}),[r,i])}function fH(e,n){var r=e.currentChannel,i=e.onBeforeSendFileMessage,a=e.sendMessageStart,s=e.sendMessageFailure,o=n.logger,l=n.pubSub;return t.useCallback((function(e,t){return new Promise((function(n,u){var c,d,h=null!==(c=null==i?void 0:i(e,t))&&void 0!==c?c:((d={}).file=e,t&&(d.isReplyToChannel=!0,d.parentMessageId=t.messageId),d);o.info("Thread | useSendFileMessageCallback: Sending file message start.",h),null==r?(o.warning("Thread | useSendFileMessageCallback: currentChannel is null. Skipping file message send."),n(null)):r.sendFileMessage(h).onPending((function(t){a(m(m({},t),{url:URL.createObjectURL(e),sendingStatus:pe.PENDING,isUserMessage:t.isUserMessage,isFileMessage:t.isFileMessage,isAdminMessage:t.isAdminMessage,isMultipleFilesMessage:t.isMultipleFilesMessage})),setTimeout((function(){return eH()}),100)})).onFailed((function(t,n){n.localUrl=URL.createObjectURL(e),n.file=e,o.info("Thread | useSendFileMessageCallback: Sending file message failed.",{message:n,error:t}),s(n),u(t)})).onSucceeded((function(e){o.info("Thread | useSendFileMessageCallback: Sending file message succeeded.",e),l.publish(jT.SEND_FILE_MESSAGE,{channel:r,message:e,publishingModules:[OT.THREAD]}),n(e)}))}))}),[r])}var pH=function(e,n){var r=e.currentChannel,i=e.onBeforeSendVoiceMessage,a=e.sendMessageStart,s=e.sendMessageFailure,o=n.logger,l=n.pubSub;return t.useCallback((function(e,t,n){var u=i&&"function"==typeof i?i(e,n):{file:e,fileName:dg,mimeType:hg,metaArrays:[new Ro({key:fg,value:["".concat(t)]}),new Ro({key:pg,value:[_g]})]};n&&(u.isReplyToChannel=!0,u.parentMessageId=n.messageId),o.info("Thread | useSendVoiceMessageCallback:  Start sending voice message",u),null==r||r.sendFileMessage(u).onPending((function(t){a(m(m({},t),{url:URL.createObjectURL(e),sendingStatus:pe.PENDING,isUserMessage:t.isUserMessage,isFileMessage:t.isFileMessage,isAdminMessage:t.isAdminMessage,isMultipleFilesMessage:t.isMultipleFilesMessage})),setTimeout((function(){return eH()}),100)})).onFailed((function(t,n){n.localUrl=URL.createObjectURL(e),n.file=e,o.info("Thread | useSendVoiceMessageCallback: Sending voice message failed.",{message:n,error:t}),s(n)})).onSucceeded((function(e){o.info("Thread | useSendVoiceMessageCallback: Sending voice message succeeded.",e),l.publish(jT.SEND_FILE_MESSAGE,{channel:r,message:e,publishingModules:[OT.THREAD]})}))}),[r,i])};function _H(e,n){var r=e.currentChannel,i=e.resendMessageStart,a=e.sendMessageSuccess,s=e.sendMessageFailure,o=n.logger,l=n.pubSub;return t.useCallback((function(e){var t,n,u,c,d;if(null==e?void 0:e.isResendable)if(o.info("Thread | useResendMessageCallback: Resending failedMessage start.",e),(null===(t=null==e?void 0:e.isUserMessage)||void 0===t?void 0:t.call(e))||(null==e?void 0:e.messageType)===le.USER)try{null==r||r.resendMessage(e).onPending((function(e){o.info("Thread | useResendMessageCallback: Resending user message started.",e),i(e)})).onSucceeded((function(e){o.info("Thread | useResendMessageCallback: Resending user message succeeded.",e),a(e),l.publish(jT.SEND_USER_MESSAGE,{channel:r,message:e,publishingModules:[OT.THREAD]})})).onFailed((function(t){o.warning("Thread | useResendMessageCallback: Resending user message failed.",t),e.sendingStatus=pe.FAILED,s(e)}))}catch(h){o.warning("Thread | useResendMessageCallback: Resending user message failed.",h),e.sendingStatus=pe.FAILED,s(e)}else if(null===(n=null==e?void 0:e.isFileMessage)||void 0===n?void 0:n.call(e))try{null===(u=null==r?void 0:r.resendMessage)||void 0===u||u.call(r,e).onPending((function(e){o.info("Thread | useResendMessageCallback: Resending file message started.",e),i(e)})).onSucceeded((function(t){o.info("Thread | useResendMessageCallback: Resending file message succeeded.",t),a(t),l.publish(jT.SEND_FILE_MESSAGE,{channel:r,message:e,publishingModules:[OT.THREAD]})})).onFailed((function(t){o.warning("Thread | useResendMessageCallback: Resending file message failed.",t),e.sendingStatus=pe.FAILED,s(e)}))}catch(h){o.warning("Thread | useResendMessageCallback: Resending file message failed.",h),e.sendingStatus=pe.FAILED,s(e)}else if(null===(c=null==e?void 0:e.isMultipleFilesMessage)||void 0===c?void 0:c.call(e))try{null===(d=null==r?void 0:r.resendMessage)||void 0===d||d.call(r,e).onPending((function(e){o.info("Thread | useResendMessageCallback: Resending multiple files message started.",e),i(e)})).onFileUploaded((function(e,t,n,i){o.info("Thread | useResendMessageCallback: onFileUploaded during resending multiple files message.",{requestId:e,index:t,error:i,uploadableFileInfo:n}),l.publish(jT.ON_FILE_INFO_UPLOADED,{response:{channelUrl:r.url,requestId:e,index:t,uploadableFileInfo:n,error:i},publishingModules:[OT.THREAD]})})).onSucceeded((function(e){o.info("Thread | useResendMessageCallback: Resending MFM succeeded.",e),a(e),l.publish(jT.SEND_FILE_MESSAGE,{channel:r,message:e,publishingModules:[OT.THREAD]})})).onFailed((function(e,t){o.warning("Thread | useResendMessageCallback: Resending MFM failed.",e),s(t)}))}catch(h){o.warning("Thread | useResendMessageCallback: Resending MFM failed.",h),s(e)}else o.warning("Thread | useResendMessageCallback: Message is not resendable.",e),e.sendingStatus=pe.FAILED,s(e);else o.warning("Thread | useResendMessageCallback: Message is not resendable.",e)}),[r])}function mH(e,n){var r=e.currentChannel,i=e.isMentionEnabled,a=e.onMessageUpdated,s=n.logger,o=n.pubSub;return t.useCallback((function(e){var t,n,l=e.messageId,u=e.message,c=e.mentionedUsers,d=e.mentionTemplate,h=((n={}).message=u,i&&c&&(null==c?void 0:c.length)>0&&(n.mentionedUsers=c),n.mentionedMessageTemplate=i&&d?d:u,n);s.info("Thread | useUpdateMessageCallback: Message update start.",h),null!=r?null===(t=r.updateUserMessage)||void 0===t||t.call(r,l,h).then((function(e){s.info("Thread | useUpdateMessageCallback: Message update succeeded.",e),a(r,e),o.publish(jT.UPDATE_USER_MESSAGE,{fromSelector:!0,channel:r,message:e,publishingModules:[OT.THREAD]})})):s.warning("Thread | useUpdateMessageCallback: currentChannel is null.")}),[r,i])}function vH(e,n){var r=e.currentChannel,i=e.onMessageDeletedByReqId,a=e.onMessageDeleted,s=n.logger;return t.useCallback((function(e){s.info("Thread | useDeleteMessageCallback: Deleting message.",e);var t=e.sendingStatus;return new Promise((function(n,o){var l;s.info("Thread | useDeleteMessageCallback: Deleting message requestState:",t),"failed"!==t&&"pending"!==t||(s.info("Thread | useDeleteMessageCallback: Deleted message from local:",e),i(e.reqId),n()),null==r&&(s.info("Thread | useDeleteMessageCallback: No current channel"),n()),s.info("Thread | useDeleteMessageCallback: Deleting message from remote:",t),null===(l=r.deleteMessage)||void 0===l||l.call(r,e).then((function(){s.info("Thread | useDeleteMessageCallback: Deleting message success!",e),a(r,e.messageId),n()})).catch((function(e){s.warning("Thread | useDeleteMessageCallback: Deleting message failed!",e),o(e)}))}))}),[r])}function gH(e){return m({prevResultSize:30,nextResultSize:30,includeMetaArray:!0},e)}var EH=function(){var e,n,r=t.useContext(bH);if(!r)throw new Error("useThread must be used within a ThreadProvider");var i=yT().state,a=i.stores,s=i.config,o=s.logger,l=s.pubSub,u=s.groupChannel.enableMention,c=s.groupChannel.enableReactions,d=Ag.useSyncExternalStore(r.subscribe,r.getState),h=d.message,f=d.parentMessage,p=d.currentChannel,_=d.threadListState,v=d.allThreadMessages,y=d.onBeforeSendUserMessage,C=d.onBeforeSendFileMessage,T=d.onBeforeSendVoiceMessage,N=d.onBeforeSendMultipleFilesMessage,S={sendMessageStart:function(e){return r.setState((function(t){return m(m({},t),{localThreadMessages:b(b([],t.localThreadMessages,!0),[e],!1)})}))},sendMessageSuccess:function(e){return r.setState((function(t){return m(m({},t),{allThreadMessages:b(b([],t.allThreadMessages.filter((function(t){return!$B(null==t?void 0:t.reqId,null==e?void 0:e.reqId)})),!0),[e],!1),localThreadMessages:t.localThreadMessages.filter((function(t){return!$B(null==t?void 0:t.reqId,null==e?void 0:e.reqId)}))})}))},sendMessageFailure:function(e){return r.setState((function(t){return m(m({},t),{localThreadMessages:t.localThreadMessages.map((function(t){return $B(null==t?void 0:t.reqId,null==e?void 0:e.reqId)?e:t}))})}))},resendMessageStart:function(e){return r.setState((function(t){return m(m({},t),{localThreadMessages:t.localThreadMessages.map((function(t){return $B(null==t?void 0:t.reqId,null==e?void 0:e.reqId)?e:t}))})}))}},I=function(e,n){var r=e.currentChannel,i=n.logger;return t.useCallback((function(e,t,n){var a,s;n?null===(a=null==r?void 0:r.deleteReaction)||void 0===a||a.call(r,e,t).then((function(e){i.info("Thread | useToggleReactionsCallback: Delete reaction succeeded.",e)})).catch((function(e){i.warning("Thread | useToggleReactionsCallback: Delete reaction failed.",e)})):null===(s=null==r?void 0:r.addReaction)||void 0===s||s.call(r,e,t).then((function(e){i.info("Thread | useToggleReactionsCallback: Add reaction succeeded.",e)})).catch((function(e){i.warning("Thread | useToggleReactionsCallback: Add reaction failed.",e)}))}),[r])}({currentChannel:p},{logger:o}),w={sendMessage:hH({isMentionEnabled:u,currentChannel:p,onBeforeSendUserMessage:y,sendMessageStart:S.sendMessageStart,sendMessageFailure:S.sendMessageFailure},{logger:o,pubSub:l}),sendFileMessage:fH({currentChannel:p,onBeforeSendFileMessage:C,sendMessageStart:S.sendMessageStart,sendMessageFailure:S.sendMessageFailure},{logger:o,pubSub:l}),sendVoiceMessage:pH({currentChannel:p,onBeforeSendVoiceMessage:T,sendMessageStart:S.sendMessageStart,sendMessageFailure:S.sendMessageFailure},{logger:o,pubSub:l}),sendMultipleFilesMessage:tH({currentChannel:p,onBeforeSendMultipleFilesMessage:N,publishingModules:[OT.THREAD]},{logger:o,pubSub:l})[0],resendMessage:_H({resendMessageStart:S.resendMessageStart,sendMessageSuccess:S.sendMessageSuccess,sendMessageFailure:S.sendMessageFailure,currentChannel:p},{logger:o,pubSub:l})},A={onMessageUpdated:function(e,t){return r.setState((function(n){var r,i,a;return(null===(r=n.currentChannel)||void 0===r?void 0:r.url)!==(null==e?void 0:e.url)?n:m(m({},n),{parentMessage:(null===(i=n.parentMessage)||void 0===i?void 0:i.messageId)===(null==t?void 0:t.messageId)?t:n.parentMessage,allThreadMessages:null===(a=n.allThreadMessages)||void 0===a?void 0:a.map((function(e){return(null==e?void 0:e.messageId)===(null==t?void 0:t.messageId)?t:e}))})}))},onMessageDeleted:function(e,t){return r.setState((function(n){var r,i,a,s;return(null===(r=n.currentChannel)||void 0===r?void 0:r.url)!==(null==e?void 0:e.url)?n:(null===(i=null==n?void 0:n.parentMessage)||void 0===i?void 0:i.messageId)===t?m(m({},n),{parentMessage:null,parentMessageState:sH.NIL,allThreadMessages:[]}):m(m({},n),{allThreadMessages:null===(a=n.allThreadMessages)||void 0===a?void 0:a.filter((function(e){return(null==e?void 0:e.messageId)!==t})),localThreadMessages:null===(s=n.localThreadMessages)||void 0===s?void 0:s.filter((function(e){return(null==e?void 0:e.messageId)!==t}))})}))},onMessageDeletedByReqId:function(e){return r.setState((function(t){return m(m({},t),{localThreadMessages:t.localThreadMessages.filter((function(t){return!$B(t.reqId,e)}))})}))}},M={updateMessage:mH({currentChannel:p,isMentionEnabled:u,onMessageUpdated:A.onMessageUpdated},{logger:o,pubSub:l}),deleteMessage:vH({currentChannel:p,onMessageDeleted:A.onMessageDeleted,onMessageDeletedByReqId:A.onMessageDeletedByReqId},{logger:o})},O={initializeThreadListStart:function(){return r.setState((function(e){return m(m({},e),{threadListState:lH.LOADING,allThreadMessages:[]})}))},initializeThreadListSuccess:function(e,t,n){return r.setState((function(r){var i=(null==t?void 0:t.messageId)?null==t?void 0:t.createdAt:null==e?void 0:e.createdAt,a=n.findIndex((function(e){return(null==e?void 0:e.createdAt)>i})),s=a>-1?n.slice(0,a):n,o=(null==t?void 0:t.messageId)?[t]:[],l=a>-1?n.slice(a):[];return m(m({},r),{threadListState:lH.INITIALIZED,hasMorePrev:-1===a||30===a,hasMoreNext:n.length-a==30,allThreadMessages:[s,o,l].flat()})}))},initializeThreadListFailure:function(){return r.setState((function(e){return m(m({},e),{threadListState:lH.LOADING,allThreadMessages:[]})}))},getPrevMessagesStart:function(){return r.setState((function(e){return m({},e)}))},getPrevMessagesSuccess:function(e){return r.setState((function(t){return m(m({},t),{hasMorePrev:30===e.length,allThreadMessages:b(b([],e,!0),t.allThreadMessages,!0)})}))},getPrevMessagesFailure:function(){return r.setState((function(e){return m(m({},e),{hasMorePrev:!1})}))},getNextMessagesStart:function(){return r.setState((function(e){return m({},e)}))},getNextMessagesSuccess:function(e){return r.setState((function(t){return m(m({},t),{hasMoreNext:30===e.length,allThreadMessages:b(b([],t.allThreadMessages,!0),e,!0)})}))},getNextMessagesFailure:function(){return r.setState((function(e){return m(m({},e),{hasMoreNext:!1})}))}},R=function(e){var n=e.isReactionEnabled,r=e.anchorMessage,i=e.parentMessage,a=e.logger,s=e.oldestMessageTimeStamp,o=e.latestMessageTimeStamp,l=e.threadListState,u=e.initializeThreadListStart,c=e.initializeThreadListSuccess,d=e.initializeThreadListFailure,h=e.getPrevMessagesStart,f=e.getPrevMessagesSuccess,p=e.getPrevMessagesFailure,_=e.getNextMessagesStart,m=e.getNextMessagesSuccess,v=e.getNextMessagesFailure,b=yT().state.stores,y=(null==r?void 0:r.createdAt)||0;return{initializeThreadFetcher:t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){var t,s,o,l,h;return E(this,(function(f){switch(f.label){case 0:if(!b.sdkStore.initialized||!i)return[2];u(),f.label=1;case 1:return f.trys.push([1,3,,4]),t=gH({includeReactions:n}),a.info("Thread | useGetThreadList: Initialize thread list start.",{timestamp:y,params:t}),[4,i.getThreadedMessagesByTimestamp(y,t)];case 2:return s=f.sent(),o=s.threadedMessages,l=s.parentMessage,a.info("Thread | useGetThreadList: Initialize thread list succeeded.",{staleParentMessage:i,threadedMessages:o}),c(l,r,o),setTimeout((function(){return null==e?void 0:e(o)})),[3,4];case 3:return h=f.sent(),a.info("Thread | useGetThreadList: Initialize thread list failed.",h),d(),[3,4];case 4:return[2]}}))}))}),[b.sdkStore.initialized,i,r,n]),fetchPrevThreads:t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){var t,r,o,u,c;return E(this,(function(d){switch(d.label){case 0:if(l!==lH.INITIALIZED||0===s||!i)return[2];h(),d.label=1;case 1:return d.trys.push([1,3,,4]),t=gH({nextResultSize:0,includeReactions:n}),[4,i.getThreadedMessagesByTimestamp(s,t)];case 2:return r=d.sent(),o=r.threadedMessages,u=r.parentMessage,a.info("Thread | useGetPrevThreadsCallback: Fetch prev threads succeeded.",{parentMessage:u,threadedMessages:o}),f(o),setTimeout((function(){return null==e?void 0:e(o)})),[3,4];case 3:return c=d.sent(),a.info("Thread | useGetPrevThreadsCallback: Fetch prev threads failed.",c),p(),[3,4];case 4:return[2]}}))}))}),[l,s,n,i]),fetchNextThreads:t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){var t,r,s,u,c;return E(this,(function(d){switch(d.label){case 0:if(l!==lH.INITIALIZED||0===o||!i)return[2];_(),d.label=1;case 1:return d.trys.push([1,3,,4]),t=gH({prevResultSize:0,includeReactions:n}),[4,i.getThreadedMessagesByTimestamp(o,t)];case 2:return r=d.sent(),s=r.threadedMessages,u=r.parentMessage,a.info("Thread | useGetNextThreadsCallback: Fetch next threads succeeded.",{parentMessage:u,threadedMessages:s}),m(s),setTimeout((function(){return null==e?void 0:e(s)})),[3,4];case 3:return c=d.sent(),a.info("Thread | useGetNextThreadsCallback: Fetch next threads failed.",c),v(),[3,4];case 4:return[2]}}))}))}),[l,o,n,i])}}({parentMessage:f,anchorMessage:(null==h?void 0:h.messageId)!==(null==f?void 0:f.messageId)&&h||void 0,logger:o,isReactionEnabled:c,threadListState:_,oldestMessageTimeStamp:(null===(e=v[0])||void 0===e?void 0:e.createdAt)||0,latestMessageTimeStamp:(null===(n=v[v.length-1])||void 0===n?void 0:n.createdAt)||0,initializeThreadListStart:O.initializeThreadListStart,initializeThreadListSuccess:O.initializeThreadListSuccess,initializeThreadListFailure:O.initializeThreadListFailure,getPrevMessagesStart:O.getPrevMessagesStart,getPrevMessagesSuccess:O.getPrevMessagesSuccess,getPrevMessagesFailure:O.getPrevMessagesFailure,getNextMessagesStart:O.getNextMessagesStart,getNextMessagesSuccess:O.getNextMessagesSuccess,getNextMessagesFailure:O.getNextMessagesFailure}),D=R.initializeThreadFetcher,k=R.fetchPrevThreads,L=R.fetchNextThreads,x=t.useMemo((function(){return m(m(m(m(m(m({setCurrentUserId:function(e){return r.setState((function(t){return m(m({},t),{currentUserId:e})}))},getChannelStart:function(){return r.setState((function(e){return m(m({},e),{channelState:iH.LOADING,currentChannel:null})}))},getChannelSuccess:function(e){return r.setState((function(t){var n,r;return m(m({},t),{channelState:iH.INITIALIZED,currentChannel:e,isMuted:(null===(r=null===(n=null==e?void 0:e.members)||void 0===n?void 0:n.find((function(e){return(null==e?void 0:e.userId)===t.currentUserId})))||void 0===r?void 0:r.isMuted)||!1,isChannelFrozen:(null==e?void 0:e.isFrozen)||!1})}))},getChannelFailure:function(){return r.setState((function(e){return m(m({},e),{channelState:iH.INVALID,currentChannel:null})}))},getParentMessageStart:function(){return r.setState((function(e){return m(m({},e),{parentMessageState:sH.LOADING,parentMessage:null})}))},getParentMessageSuccess:function(e){return r.setState((function(t){return m(m({},t),{parentMessageState:sH.INITIALIZED,parentMessage:e})}))},getParentMessageFailure:function(){return r.setState((function(e){return m(m({},e),{parentMessageState:sH.INVALID,parentMessage:null})}))},setEmojiContainer:function(e){return r.setState((function(t){return m(m({},t),{emojiContainer:e})}))},onMessageReceived:function(e,t){return r.setState((function(n){var r,i,a,s;if((null===(r=n.currentChannel)||void 0===r?void 0:r.url)!==(null==e?void 0:e.url)||n.hasMoreNext||(null===(i=null==t?void 0:t.parentMessage)||void 0===i?void 0:i.messageId)!==(null===(a=null==n?void 0:n.parentMessage)||void 0===a?void 0:a.messageId))return n;var o=n.allThreadMessages.findIndex((function(e){return e.messageId===t.messageId}))>-1;return m(m({},n),{parentMessage:(null===(s=n.parentMessage)||void 0===s?void 0:s.messageId)===(null==t?void 0:t.messageId)?t:n.parentMessage,allThreadMessages:o?n.allThreadMessages.map((function(e){return e.messageId===t.messageId?t:e})):b(b([],n.allThreadMessages.filter((function(e){return(null==e?void 0:e.reqId)!==(null==t?void 0:t.reqId)})),!0),[t],!1)})}))},onReactionUpdated:function(e){return r.setState((function(t){var n,r,i;return(null===(n=null==t?void 0:t.parentMessage)||void 0===n?void 0:n.messageId)===(null==e?void 0:e.messageId)&&(null===(i=null===(r=t.parentMessage)||void 0===r?void 0:r.applyReactionEvent)||void 0===i||i.call(r,e)),m(m({},t),{allThreadMessages:t.allThreadMessages.map((function(t){var n;return(null==e?void 0:e.messageId)===(null==t?void 0:t.messageId)?(null===(n=null==t?void 0:t.applyReactionEvent)||void 0===n||n.call(t,e),t):t}))})}))},onUserMuted:function(e,t){return r.setState((function(n){var r;return(null===(r=n.currentChannel)||void 0===r?void 0:r.url)!==(null==e?void 0:e.url)||n.currentUserId!==(null==t?void 0:t.userId)?n:m(m({},n),{isMuted:!0})}))},onUserUnmuted:function(e,t){return r.setState((function(n){var r;return(null===(r=n.currentChannel)||void 0===r?void 0:r.url)!==(null==e?void 0:e.url)||n.currentUserId!==(null==t?void 0:t.userId)?n:m(m({},n),{isMuted:!1})}))},onUserBanned:function(){return r.setState((function(e){return m(m({},e),{channelState:iH.NIL,threadListState:lH.NIL,parentMessageState:sH.NIL,currentChannel:null,parentMessage:null,allThreadMessages:[],hasMorePrev:!1,hasMoreNext:!1})}))},onUserUnbanned:function(){return r.setState((function(e){return m({},e)}))},onUserLeft:function(){return r.setState((function(e){return m(m({},e),{channelState:iH.NIL,threadListState:lH.NIL,parentMessageState:sH.NIL,currentChannel:null,parentMessage:null,allThreadMessages:[],hasMorePrev:!1,hasMoreNext:!1})}))},onChannelFrozen:function(){return r.setState((function(e){return m(m({},e),{isChannelFrozen:!0})}))},onChannelUnfrozen:function(){return r.setState((function(e){return m(m({},e),{isChannelFrozen:!1})}))},onOperatorUpdated:function(e){return r.setState((function(t){var n;return(null==e?void 0:e.url)===(null===(n=t.currentChannel)||void 0===n?void 0:n.url)?m(m({},t),{currentChannel:e}):t}))},onTypingStatusUpdated:function(e,t){return r.setState((function(n){var r;return $B(e.url,null===(r=n.currentChannel)||void 0===r?void 0:r.url)?m(m({},n),{typingMembers:t}):n}))},onFileInfoUpdated:function(e){var t=e.channelUrl,n=e.requestId,i=e.index,a=e.uploadableFileInfo,s=e.error;return r.setState((function(e){var r,o;if(!$B(t,null===(r=e.currentChannel)||void 0===r?void 0:r.url))return e;if(s)return e;var l=e.localThreadMessages,u=l.find((function(e){return $B(function(e){return"reqId"in e}(e)&&e.reqId,n)})),c=null===(o=u.messageParams)||void 0===o?void 0:o.fileInfoList;return Array.isArray(c)&&(c[i]=a),m(m({},e),{localThreadMessages:l})}))},toggleReaction:I},S),w),A),M),O),{initializeThreadFetcher:D,fetchPrevThreads:k,fetchNextThreads:L})}),[r,p,a.sdkStore.initialized,f]);return{state:d,actions:x}};iH.NIL,sH.NIL,lH.NIL;var bH=t.createContext(null),yH=function(e){var n=EH().state.currentChannel;return t.createElement(FP,m({},e,{currentChannel:n}))},CH="operator";t.forwardRef((function(e,n){var r,i=e.className,a=e.renderFileUploadIcon,s=e.renderVoiceMessageIcon,o=e.renderSendMessageIcon,l=e.acceptableMimeTypes,u=yT().state.config,c=$M().isMobile,d=HN().stringSet,h=u.isOnline,f=u.userMention,p=u.logger,_=u.groupChannel,m=EH(),v=m.state,y=v.currentChannel,C=v.parentMessage,T=v.isMuted,N=v.isChannelFrozen,S=v.allThreadMessages,I=m.actions,w=I.sendMessage,A=I.sendFileMessage,M=I.sendVoiceMessage,O=I.sendMultipleFilesMessage,R=t.useRef(),D=_.enableMention,k=_.enableVoiceMessage,L=null!==(r=m.state.isMultipleFilesMessageEnabled)&&void 0!==r?r:u.isMultipleFilesMessageEnabled,x=e.disabled||!h||T||!((null==y?void 0:y.myRole)===CH)&&N||null===C,U=function(e,n){var r=e.sendFileMessage,i=e.sendMultipleFilesMessage,a=e.quoteMessage,s=n.logger,o=HN().stringSet,l=yT().state.config,u=l.imageCompression,c=null==l?void 0:l.uikitUploadSizeLimit,d=null==l?void 0:l.uikitMultipleFilesMessageLimit,h=nL().openModal;return t.useCallback((function(e){return g(void 0,void 0,void 0,(function(){var n,l,f,p,_;return E(this,(function(m){switch(m.label){case 0:return r&&i?0===e.length?(s.warning("Channel|useHandleUploadFiles: given file list is empty.",{files:e}),[2]):e.length>d?(s.info("Channel|useHandleUploadFiles: Cannot upload files more than ".concat(d)),h({modalProps:{titleText:o.FILE_UPLOAD_NOTIFICATION__COUNT_LIMIT.replace("%d","".concat(d)),hideFooter:!0},childElement:function(e){var n=e.closeModal;return t.createElement(Jk,{type:ZO.PRIMARY,submitText:o.BUTTON__OK,hideCancelButton:!0,onCancel:n,onSubmit:n})}}),[2]):e.some((function(e){return e.size>c}))?(s.info("Channel|useHandleUploadFiles: Cannot upload file size exceeding ".concat(c)),h({modalProps:{titleText:o.FILE_UPLOAD_NOTIFICATION__SIZE_LIMIT.replace("%d","".concat(Math.floor(c/1048576))),hideFooter:!0},childElement:function(e){var n=e.closeModal;return t.createElement(Jk,{type:ZO.PRIMARY,submitText:o.BUTTON__OK,hideCancelButton:!0,onCancel:n,onSubmit:n})}}),[2]):[4,NF({files:e,imageCompression:u,logger:s})]:(s.warning("Channel|useHandleUploadFiles: required functions are undefined",{sendFileMessage:r,sendMultipleFilesMessage:i}),[2]);case 1:if(n=m.sent().compressedFiles,1===(l=n).length)s.info("Channel|useHandleUploadFiles: sending one file."),f=l[0],r(f,a);else if(l.length>1)return s.info("Channel|useHandleUploadFiles: sending multiple files."),p=[],_=[],l.forEach((function(e){rM(e.type)?p.push(e):_.push(e)})),[2,_.reduce((function(e,t){return e.then((function(){return r(t,a)}))}),0===p.length?Promise.resolve():1===p.length?r(p[0],a):i(p,a))];return[2]}}))}))}),[r,i,a])}({sendFileMessage:A,sendMultipleFilesMessage:O,quoteMessage:C},{logger:p}),P=t.useState(""),F=P[0],B=P[1],H=t.useState([]),G=H[0],j=H[1],V=t.useState([]),q=V[0],z=V[1],K=t.useState(null),Y=K[0],W=K[1],Q=t.useState([]),X=Q[0],Z=Q[1],J=t.useState(null),$=J[0],ee=J[1],te=t.useState(!1),ne=te[0],re=te[1],ie=h&&D&&F.length>0&&!function(e){return(null==e?void 0:e.isFrozen)&&!function(e){return"operator"===(null==e?void 0:e.myRole)}(e)}(y)&&!function(e){return"muted"===(null==e?void 0:e.myMutedState)}(y)&&!(null==y?void 0:y.isBroadcast);t.useEffect((function(){re(!1)}),[null==y?void 0:y.url]);var ae=XO({ref:n||R},{logger:p}),se=(null==ae?void 0:ae.length)<(null==f?void 0:f.maxMentionCount);return t.useEffect((function(){j(G.filter((function(e){var t=e.userId,n=q.indexOf(t);return!(n<0)&&(q.splice(n,1),!0)})))}),[q]),(null==y?void 0:y.isBroadcast)&&(null==y?void 0:y.myRole)!==CH?t.createElement(t.Fragment,null):t.createElement("div",{className:WT(ne?"sendbird-thread-message-input--voice-message":"sendbird-thread-message-input",i)},ie&&t.createElement(yH,{targetNickname:F,inputEvent:null!=$?$:void 0,onUserItemClick:function(e){e&&j(b(b([],G,!0),[e],!1)),B(""),W(e),ee(null)},onFocusItemChange:function(){ee(null)},onFetchUsers:function(e){Z(e)},ableAddMention:se,maxMentionCount:null==f?void 0:f.maxMentionCount,maxSuggestionCount:null==f?void 0:f.maxSuggestionCount}),ne?t.createElement(SF,{channel:y,onSubmitClick:function(e,t){M(e,t,C),re(!1)},onCancelClick:function(){re(!1)}}):t.createElement(JD,{className:"sendbird-thread-message-input__message-input",messageFieldId:"sendbird-message-input-text-field--thread",channel:y,channelUrl:null==y?void 0:y.url,isMobile:c,disabled:x,acceptableMimeTypes:l,setMentionedUsers:j,mentionSelectedUser:Y,isMentionEnabled:D,isVoiceMessageEnabled:k,isSelectingMultipleFilesEnabled:L,onVoiceMessageIconClick:function(){re(!0)},renderFileUploadIcon:a,renderVoiceMessageIcon:s,renderSendMessageIcon:o,ref:n||R,placeholder:(null==y?void 0:y.isFrozen)&&!((null==y?void 0:y.myRole)===CH)&&d.MESSAGE_INPUT__PLACE_HOLDER__DISABLED||(null==y?void 0:y.myMutedState)===oe.MUTED&&d.MESSAGE_INPUT__PLACE_HOLDER__MUTED_SHORT||(S.length>0?d.THREAD__INPUT__REPLY_TO_THREAD:d.THREAD__INPUT__REPLY_IN_THREAD),onStartTyping:function(){var e;null===(e=null==y?void 0:y.startTyping)||void 0===e||e.call(y)},onSendMessage:function(e){var t,n=e.message,r=e.mentionTemplate;w({message:n,mentionedUsers:G,mentionTemplate:r,quoteMessage:C}),B(""),j([]),null===(t=null==y?void 0:y.endTyping)||void 0===t||t.call(y)},onFileUpload:U,onUserMentioned:function(e){(null==Y?void 0:Y.userId)===(null==e?void 0:e.userId)&&(W(null),B(""))},onMentionStringChange:function(e){B(e)},onMentionedUserIdsUpdated:function(e){z(e)},onKeyDown:function(e){return!!(ie&&(null==X?void 0:X.length)>0&&(e.key===nR&&se||e.key===rR||e.key===iR))&&(ee(e),!0)}}))}));var TH=t.createContext(null),NH=function(){var e=t.useContext(TH);if(!e)throw new Error("OpenChannelContext not found. Use within the OpenChannel module");return e};t.forwardRef((function(e,n){var r=NH(),i=r.currentOpenChannel,a=r.disabled,s=r.handleSendMessage,o=r.handleFileUpload,l=r.amIMuted,u=i,c=t.useContext(FN).stringSet,d=e.value;return u?t.createElement("div",{className:"sendbird-openchannel-footer"},t.createElement(JD,{channel:i,ref:n,value:d,disabled:a,isVoiceMessageEnabled:!1,onSendMessage:s,onFileUpload:o,placeholder:l?c.MESSAGE_INPUT__PLACE_HOLDER__MUTED:a?c.MESSAGE_INPUT__PLACE_HOLDER__DISABLED:""})):null}));var SH=function(e){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(n){return!1}finally{document.body.removeChild(t)}}return!1},IH="pending",wH="failed",AH="succeeded",MH=function(e){return e.sender||e._sender},OH=function(e){return e===AH},RH=function(e){return e===IH},DH=function(e){return e===wH},kH=function(e,t){return MH(e).userId===t},LH=function(e){var t,n=e.message;return"user"===(null==n?void 0:n.messageType)&&(null===(t=null==n?void 0:n.message)||void 0===t?void 0:t.length)>0},xH=function(e){var t=e.message,n=e.status,r=e.userId;return kH(t,r)&&DH(n)&&(null==t?void 0:t.isResendable)},UH=function(e){var t,n=e.message,r=e.status,i=e.userId;return kH(n,i)&&OH(r)&&(null===(t=null==n?void 0:n.isUserMessage)||void 0===t?void 0:t.call(n))},PH=function(e){var t=e.message,n=e.userId;return kH(t,n)},FH=function(e){var t=e.message,n=e.status,r=e.userId;return"user"===t.messageType?PH({message:t,userId:r})||UH({message:t,status:n,userId:r})||LH({message:t})||xH({message:t,status:n,userId:r}):PH({message:t,userId:r})||xH({message:t,status:n,userId:r})},BH=function(e){var n=e.message,r=e.parentRef,i=e.resendMessage,a=e.showEdit,s=e.showRemove,o=e.copyToClipboard,l=e.hideMenu,u=e.isEphemeral,c=void 0!==u&&u,d=n,h=null==n?void 0:n.sendingStatus,f=HN().stringSet,p=yT().state.config.userId,_=n;return t.createElement(Dk,{isOpen:!0,menuItems:function(){return t.createElement(Sk,{className:"sendbird-openchannel__mobile-menu",parentRef:r,parentContainRef:r,closeDropdown:l},LH({message:d})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__copy",onClick:function(){null==o||o()},testID:"open_channel_mobile_context_menu_copy"},t.createElement(t.Fragment,null,f.CONTEXT_MENU_DROPDOWN__COPY)),!c&&UH({message:n,userId:p,status:h})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__edit",onClick:function(){null==a||a()},testID:"open_channel_mobile_context_menu_edit"},t.createElement(t.Fragment,null,f.CONTEXT_MENU_DROPDOWN__EDIT)),xH({message:n,userId:p,status:h})&&t.createElement(wk,{onClick:function(){null==i||i()},testID:"open_channel_mobile_context_menu_resend"},t.createElement(t.Fragment,null,f.CONTEXT_MENU_DROPDOWN__RESEND)),!c&&PH({message:n,userId:p})&&t.createElement(wk,{onClick:function(){null==s||s()},testID:"open_channel_mobile_context_menu_delete"},t.createElement(t.Fragment,null,f.CONTEXT_MENU_DROPDOWN__DELETE)),function(e){var t,n=e.message,r=e.status;return!(!(null===(t=null==n?void 0:n.isFileMessage)||void 0===t?void 0:t.call(n))||!OH(r))}({message:n,status:h})&&t.createElement(wk,{onClick:function(){l()},testID:"open_channel_mobile_context_menu_download_file"},t.createElement("a",{className:"sendbird-openchannel__mobile-menu-hyperlink",rel:"noopener noreferrer",href:null==_?void 0:_.url,target:"_blank"},f.CONTEXT_MENU_DROPDOWN__SAVE)))}})};function HH(e){var n=e.className,r=e.message,i=e.isOperator,a=e.isEphemeral,s=void 0!==a&&a,o=e.userId,l=e.resendMessage,u=e.disabled,c=e.showEdit,d=e.showRemove,h=e.chainTop,f=HN(),p=f.stringSet,_=f.dateLocale,v=TT(),g=v.disableUserProfile,E=v.renderUserProfile,y=t.useRef(),C=t.useRef(),T=t.useRef(),N=t.useRef(),S=t.useState({}),I=S[0],w=S[1],A=t.useState(!1),M=A[0],O=A[1],R=null==r?void 0:r.sendingStatus,D=RH(R),k=DH(R),L=MH(r);t.useEffect((function(){var e;(null===(e=null==y?void 0:y.current)||void 0===e?void 0:e.clientHeight)&&y.current.clientHeight>36?w({top:"8px "}):w({top:"2px"})}),[window.innerWidth]);var x=qk({onLongPress:function(){O(!0)}}),U=$M().isMobile;return r&&"user"===r.messageType?t.createElement(t.Fragment,null,t.createElement("div",{className:b(b([],Array.isArray(n)?n:[n],!0),["sendbird-openchannel-user-message"],!1).join(" "),ref:y},t.createElement("div",{className:"sendbird-openchannel-user-message__left"},!h&&t.createElement(Dk,{menuTrigger:function(e){return t.createElement(GA,{className:"sendbird-openchannel-user-message__left__avatar",src:L.profileUrl||"",ref:C,width:"28px",height:"28px",onClick:function(){g||e()}})},menuItems:function(e){return E?E({user:L,close:e,currentUserId:o,avatarRef:C}):t.createElement(Sk,{parentRef:C,parentContainRef:C,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:L,onSuccess:e,disableMessaging:!0}))}})),t.createElement("div",{className:"sendbird-openchannel-user-message__right"},!h&&t.createElement("div",{className:"sendbird-openchannel-user-message__right__top"},t.createElement(yN,{className:"sendbird-openchannel-user-message__right__top__sender-name",type:CN.CAPTION_2,color:i?TN.SECONDARY_3:TN.ONBACKGROUND_2},L&&(L.friendName||L.nickname||L.userId)),t.createElement(yN,{className:"sendbird-openchannel-user-message__right__top__sent-at",type:CN.CAPTION_3,color:TN.ONBACKGROUND_3},(null==r?void 0:r.createdAt)&&WO(null==r?void 0:r.createdAt,p.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:_}))),t.createElement("div",m({},U?m({},x):{},{className:"sendbird-openchannel-user-message__right__bottom",ref:N}),t.createElement(yN,{className:"sendbird-openchannel-user-message__right__bottom__message",type:CN.BODY_1,color:TN.ONBACKGROUND_1},null==r?void 0:r.message,RM(r)&&t.createElement(yN,{key:GN(),type:CN.BODY_1,color:TN.ONBACKGROUND_2,className:"sendbird-openchannel-user-message-word"}," ".concat(p.MESSAGE_EDITED," ")))),(D||k)&&t.createElement("div",{className:"sendbird-openchannel-user-message__right__tail"},D&&t.createElement(gA,{width:"16px",height:"16px"},t.createElement(pA,{className:"sendbird-openchannel-user-message__right__tail__pending",type:_A.SPINNER,fillColor:mA.PRIMARY,width:"16px",height:"16px"})),k&&t.createElement(pA,{className:"sendbird-openchannel-user-message__right__tail__failed",type:_A.ERROR,fillColor:mA.ERROR,width:"16px",height:"16px"}))),!U&&t.createElement("div",{className:"sendbird-openchannel-user-message__context-menu",ref:T,style:I},t.createElement(Dk,{menuTrigger:function(e){return FH({message:r,userId:o,status:R})&&t.createElement(nO,{className:"sendbird-openchannel-user-message__context-menu--icon",width:"32px",height:"32px",onClick:function(){e()}},t.createElement(pA,{type:_A.MORE,fillColor:mA.CONTENT_INVERSE,width:"24px",height:"24px"}))},menuItems:function(e){return t.createElement(Sk,{parentRef:T,parentContainRef:T,closeDropdown:e,openLeft:!0},LH({message:r})&&t.createElement(wk,{className:"sendbird-openchannel-user-message__context-menu__copy",onClick:function(){SH(r.message),e()},testID:"open_channel_user_message_menu_copy"},p.CONTEXT_MENU_DROPDOWN__COPY),!s&&UH({message:r,userId:o,status:R})&&t.createElement(wk,{className:"sendbird-openchannel-user-message__context-menu__edit",onClick:function(){u||(c(!0),e())},testID:"open_channel_user_message_menu_edit"},p.CONTEXT_MENU_DROPDOWN__EDIT),xH({message:r,userId:o,status:R})&&t.createElement(wk,{className:"sendbird-openchannel-user-message__context-menu__resend",onClick:function(){l(r),e()},testID:"open_channel_user_message_menu_resend"},p.CONTEXT_MENU_DROPDOWN__RESEND),!s&&PH({message:r,userId:o})&&t.createElement(wk,{className:"sendbird-openchannel-user-message__context-menu__delete",onClick:function(){u||(d(!0),e())},testID:"open_channel_user_message_menu_delete"},p.CONTEXT_MENU_DROPDOWN__DELETE))}}))),M&&t.createElement(BH,{message:r,parentRef:N,hideMenu:function(){O(!1)},showRemove:function(){O(!1),d(!0)},showEdit:function(){O(!1),c(!0)},copyToClipboard:function(){O(!1),SH(null==r?void 0:r.message)},resendMessage:function(){O(!1),l(r)}})):t.createElement(t.Fragment,null)}function GH(e){var n=e.className,r=e.message;return t.createElement("div",{className:b(b([],Array.isArray(n)?n:[n],!0),["sendbird-openchannel-admin-message"],!1).join(" ")},t.createElement(yN,{className:"sendbird-openchannel-admin-message__text",type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},r.message||""))}function jH(e){var n,r,i,a=e.message,s=e.isOperator,o=e.isEphemeral,l=void 0!==o&&o,u=e.className,c=e.disabled,d=e.showEdit,h=e.showRemove,f=e.resendMessage,p=e.chainTop,_=e.userId,v=null==a?void 0:a.sendingStatus,g=null!==(n=a.ogMetaData)&&void 0!==n?n:null,E=null==g?void 0:g.defaultImage,y=HN(),C=y.stringSet,T=y.dateLocale,N=$M().isMobile,S=TT(),I=S.disableUserProfile,w=S.renderUserProfile,A=t.useState({}),M=A[0],O=A[1],R=t.useState(!1),D=R[0],k=R[1],L=function(){return YT(null==g?void 0:g.url)},x=qk({onLongPress:function(){return k(!0)},onClick:L},{delay:300}),U=t.useRef(),P=t.useRef(),F=t.useRef(),B=t.useRef(),H=RH(v),G=DH(v),j=MH(a),V=t.useMemo((function(){return zD({messageText:a.message})}),[null==a?void 0:a.updatedAt,null==a?void 0:a.message]);return t.useEffect((function(){var e,t;(null===(e=null==U?void 0:U.current)||void 0===e?void 0:e.clientHeight)&&(null===(t=null==U?void 0:U.current)||void 0===t?void 0:t.clientHeight)>36?O({top:"8px "}):O({top:"2px"})}),[window.innerWidth]),a&&"user"===a.messageType?t.createElement(t.Fragment,null,t.createElement("div",m({className:b(b([],Array.isArray(u)?u:[u],!0),["sendbird-openchannel-og-message"],!1).join(" "),ref:U},N?m({},x):{}),t.createElement("div",{className:"sendbird-openchannel-og-message__top"},t.createElement("div",{className:"sendbird-openchannel-og-message__top__left"},!p&&t.createElement(Dk,{menuTrigger:function(e){return t.createElement(GA,{className:"sendbird-openchannel-og-message__top__left__avatar",src:j.profileUrl||"",ref:B,width:"28px",height:"28px",onClick:function(){I||e()}})},menuItems:function(e){return w?w({user:j,close:e,currentUserId:_,avatarRef:B}):t.createElement(Sk,{parentRef:B,parentContainRef:B,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:j,onSuccess:e,disableMessaging:!0}))}})),t.createElement("div",{className:"sendbird-openchannel-og-message__top__right"},!p&&t.createElement("div",{className:"sendbird-openchannel-og-message__top__right__title"},t.createElement(yN,{className:"sendbird-openchannel-og-message__top__right__title__sender-name",type:CN.CAPTION_2,color:s?TN.SECONDARY_3:TN.ONBACKGROUND_2},j&&(j.friendName||j.nickname||j.userId)),t.createElement(yN,{className:"sendbird-openchannel-og-message__top__right__title__sent-at",type:CN.CAPTION_3,color:TN.ONBACKGROUND_3},(null==a?void 0:a.createdAt)&&WO(null==a?void 0:a.createdAt,C.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:T}))),t.createElement("div",{className:"sendbird-openchannel-og-message__top__right__description"},t.createElement(yN,{className:"sendbird-openchannel-og-message__top__right__description__message",type:CN.BODY_1,color:TN.ONBACKGROUND_1},t.createElement(XL,{tokens:V}),(null!==(r=null==a?void 0:a.updatedAt)&&void 0!==r?r:0)>0&&t.createElement(yN,{key:GN(),className:"sendbird-openchannel-og-message--word",type:CN.BODY_1,color:TN.ONBACKGROUND_2},C.MESSAGE_EDITED)))),!N&&t.createElement("div",{className:"sendbird-openchannel-og-message__top__context-menu",ref:P,style:M},t.createElement(Dk,{menuTrigger:function(e){return FH({message:a,userId:_,status:v})&&t.createElement(nO,{className:"sendbird-openchannel-og-message__top__context-menu--icon",width:"32px",height:"32px",onClick:function(){e()}},t.createElement(pA,{type:_A.MORE,fillColor:mA.CONTENT_INVERSE,width:"24px",height:"24px"}))},menuItems:function(e){return t.createElement(Sk,{parentRef:P,parentContainRef:P,closeDropdown:e,openLeft:!0},LH({message:a})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__copy",onClick:function(){SH(a.message),e()},testID:"open_channel_og_message_menu_copy"},C.CONTEXT_MENU_DROPDOWN__COPY),!l&&UH({message:a,userId:_,status:v})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__edit",onClick:function(){c||(d(!0),e())},testID:"open_channel_og_message_menu_edit"},C.CONTEXT_MENU_DROPDOWN__EDIT),xH({message:a,userId:_,status:v})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__resend",onClick:function(){f(a),e()},testID:"open_channel_og_message_menu_resend"},C.CONTEXT_MENU_DROPDOWN__RESEND),!l&&PH({message:a,userId:_})&&t.createElement(wk,{className:"sendbird-openchannel-og-message__top__context-menu__delete",onClick:function(){c||(h(!0),e())},testID:"open_channel_og_message_menu_delete"},C.CONTEXT_MENU_DROPDOWN__DELETE))}}))),t.createElement("div",{className:"sendbird-openchannel-og-message__bottom"},t.createElement("div",{className:"sendbird-openchannel-og-message__bottom__og-tag",ref:F},(null==g?void 0:g.url)&&t.createElement(yN,{className:"sendbird-openchannel-og-message__bottom__og-tag__url",type:CN.CAPTION_3,color:TN.ONBACKGROUND_2},g.url),(null==g?void 0:g.title)&&t.createElement(YL,{className:"sendbird-openchannel-og-message__bottom__og-tag__title",src:null!==(i=g.url)&&void 0!==i?i:"",type:CN.SUBTITLE_2,color:TN.PRIMARY},g.title),(null==g?void 0:g.description)&&t.createElement(yN,{className:"sendbird-openchannel-og-message__bottom__og-tag__description",type:CN.BODY_2,color:TN.ONBACKGROUND_1},g.description),(null==g?void 0:g.url)&&t.createElement("div",{className:"sendbird-openchannel-og-message__bottom__og-tag__thumbnail",role:"button",onClick:L,onKeyDown:L,tabIndex:0},E&&t.createElement(kA,{className:"sendbird-openchannel-og-message__bottom__og-tag__thumbnail__image",url:E.url||"",alt:E.alt||"",width:"334px",height:"189px",defaultComponent:t.createElement("div",{className:"sendbird-openchannel-og-message__bottom__og-tag__thumbnail__image--placeholder"},t.createElement(pA,{type:_A.THUMBNAIL_NONE,width:"56px",height:"56px"}))}))),(H||G)&&t.createElement("div",{className:"sendbird-openchannel-og-message__top__right__tail"},H&&t.createElement(gA,{width:"16px",height:"16px"},t.createElement(pA,{className:"sendbird-openchannel-og-message__top__right__tail__pending",type:_A.SPINNER,fillColor:mA.PRIMARY,width:"16px",height:"16px"})),G&&t.createElement(pA,{className:"sendbird-openchannel-og-message__top__right__tail__failed",type:_A.ERROR,fillColor:mA.ERROR,width:"16px",height:"16px"})))),D&&t.createElement(BH,{message:a,parentRef:F,hideMenu:function(){k(!1)},showRemove:function(){k(!1),h(!0)},showEdit:function(){k(!1),d(!0)},copyToClipboard:function(){k(!1),SH(null==a?void 0:a.message)},resendMessage:function(){k(!1),f(a)}})):t.createElement(t.Fragment,null)}var VH="IMAGE",qH="VIDEO",zH="UNSUPPORTED",KH={IMAGE:["image/jpeg","image/jpg","image/png","image/gif","image/webp"],VIDEO:["video/mpeg","video/ogg","video/webm","video/mp4"]};function YH(e){var n,r=e.className,i=e.message,a=e.isOperator,s=e.isEphemeral,o=void 0!==s&&s,l=e.disabled,u=e.userId,c=e.chainTop,d=e.onClick,h=e.showRemove,f=e.resendMessage,p=i.type,_=i.url,v=i.thumbnails,g=i.localUrl,E=null==i?void 0:i.sendingStatus,y=v&&v.length>0&&v[0].url||null,C=HN(),T=C.stringSet,N=C.dateLocale,S=TT(),I=S.disableUserProfile,w=S.renderUserProfile,A=t.useState(360),M=A[0],O=A[1],R=t.useState(!1),D=R[0],k=R[1],L=t.useRef(null),x=t.useRef(null),U=t.useRef(null),P=t.useRef(null),F=qk({onLongPress:function(){k(!0)},onClick:function(){d(!0)}}),B=$M().isMobile,H=t.useMemo((function(){return function(e){return function(n){var r=n.style;return t.createElement("div",{style:r},t.createElement(pA,{type:e,fillColor:mA.ON_BACKGROUND_2,width:"56px",height:"56px"}))}}}),[]),G=OH(E),j=RH(E),V=DH(E),q=MH(i);return t.useEffect((function(){var e,t,n=(null!==(t=null===(e=null==L?void 0:L.current)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:0)-80;O(n>360?360:n)}),[]),t.createElement(t.Fragment,null,t.createElement("div",{className:b(b([],Array.isArray(r)?r:[r],!0),["sendbird-openchannel-thumbnail-message"],!1).join(" "),ref:L},t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__left"},!c&&t.createElement(Dk,{menuTrigger:function(e){return t.createElement(GA,{className:"sendbird-openchannel-thumbnail-message__left__avatar",src:q.profileUrl||"",ref:P,width:"28px",height:"28px",onClick:function(){I||e()}})},menuItems:function(e){return w?w({user:q,close:e,currentUserId:u,avatarRef:P}):t.createElement(Sk,{parentRef:P,parentContainRef:P,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:q,onSuccess:e,disableMessaging:!0}))}})),t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right"},!c&&t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right__title"},t.createElement(yN,{className:"sendbird-openchannel-thumbnail-message__right__title__sender-name",type:CN.CAPTION_2,color:a?TN.SECONDARY_3:TN.ONBACKGROUND_2},q&&(q.friendName||q.nickname||q.userId)),t.createElement(yN,{className:"sendbird-openchannel-thumbnail-message__right__title__sent-at",type:CN.CAPTION_3,color:TN.ONBACKGROUND_3},(null==i?void 0:i.createdAt)&&WO(i.createdAt,T.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:N}))),t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right__body",ref:x},t.createElement("div",m({className:"sendbird-openchannel-thumbnail-message__right__body__wrap",role:"button",onClick:function(){G&&d(!0)},onKeyDown:function(){G&&d(!0)},tabIndex:0},B?m({},F):{}),t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__overlay"}),(n={},n[qH]=_||g?t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__video"},y?t.createElement(kA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__video",url:y,width:M,height:"270px",alt:"image",placeHolder:H(_A.PLAY)}):t.createElement("video",{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__video__video"},t.createElement("source",{src:_||g,type:p})),t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__video__icon",type:_A.PLAY,fillColor:mA.ON_BACKGROUND_2,width:"56px",height:"56px"})):t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__video--icon",type:_A.PHOTO,fillColor:mA.ON_BACKGROUND_2,width:"56px",height:"56px"}),n[VH]=_||g?t.createElement(kA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__image",url:y||_||g||"",alt:"image",width:M,height:"270px",placeHolder:H(_A.PHOTO)}):t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__image--icon",type:_A.PHOTO,fillColor:mA.ON_BACKGROUND_2,width:"56px",height:"56px"}),n[zH]=t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__body__wrap__unknown",type:_A.PHOTO,fillColor:mA.ON_BACKGROUND_2,width:"56px",height:"56px"}),n)[function(e){return KH.IMAGE.indexOf(e)>=0?VH:KH.VIDEO.indexOf(e)>=0?qH:zH}(p)])),(j||V)&&t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__right__tail"},j&&t.createElement(gA,{width:"16px",height:"16px"},t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__tail__pending",type:_A.SPINNER,fillColor:mA.PRIMARY,width:"16px",height:"16px"})),V&&t.createElement(pA,{className:"sendbird-openchannel-thumbnail-message__right__tail__failed",type:_A.ERROR,fillColor:mA.ERROR,width:"16px",height:"16px"}))),!B&&t.createElement("div",{className:"sendbird-openchannel-thumbnail-message__context-menu",ref:U},(xH({message:i,userId:u,status:E})||!o)&&t.createElement(Dk,{menuTrigger:function(e){return FH({message:i,userId:u,status:E})&&t.createElement(nO,{className:"sendbird-openchannel-thumbnail-message__context-menu--icon",width:"32px",height:"32px",onClick:e},t.createElement(pA,{type:_A.MORE,fillColor:mA.CONTENT_INVERSE,width:"24px",height:"24px"}))},menuItems:function(e){return t.createElement(Sk,{parentRef:U,parentContainRef:U,closeDropdown:e,openLeft:!0},xH({message:i,userId:u,status:E})&&t.createElement(wk,{onClick:function(){f(i),e()},testID:"open_channel_thumbnail_message_menu_resend"},T.CONTEXT_MENU_DROPDOWN__RESEND),!o&&PH({message:i,userId:u})&&t.createElement(wk,{onClick:function(){l||(h(!0),e())},testID:"open_channel_thumbnail_message_menu_delete"},T.CONTEXT_MENU_DROPDOWN__DELETE))}}))),D&&t.createElement(BH,{message:i,parentRef:x,hideMenu:function(){k(!1)},showRemove:function(){k(!1),h(!0)},resendMessage:function(){k(!1),f(i)}}))}var WH=function(e){return/(\.mp3)$/i.test(e)?_A.FILE_AUDIO:/(\.gif)$/i.test(e)?_A.GIF:_A.FILE_DOCUMENT};function QH(e){var n=e.className,r=e.message,i=e.isOperator,a=e.isEphemeral,s=void 0!==a&&a,o=e.userId,l=e.disabled,u=e.chainTop,c=e.showRemove,d=e.resendMessage,h=null==r?void 0:r.sendingStatus,f=HN(),p=f.dateLocale,_=f.stringSet,v=t.useRef(null),g=t.useRef(null),E=t.useRef(null),y=TT(),C=y.disableUserProfile,T=y.renderUserProfile,N=$M().isMobile,S=function(){return YT(r.url)},I=RH(h),w=DH(h),A=MH(r),M=t.useState(!1),O=M[0],R=M[1],D=qk({onLongPress:function(){N&&R(!0)},onClick:S},{delay:300});return t.createElement(t.Fragment,null,t.createElement("div",{className:b(b([],Array.isArray(n)?n:[n],!0),["sendbird-openchannel-file-message"],!1).join(" "),ref:g},t.createElement("div",{className:"sendbird-openchannel-file-message__left"},!u&&t.createElement(Dk,{menuTrigger:function(e){return t.createElement(GA,{className:"sendbird-openchannel-file-message__left__avatar",src:A.profileUrl||"",ref:E,width:"28px",height:"28px",onClick:function(){C||e()}})},menuItems:function(e){return T?T({user:A,close:e,currentUserId:o,avatarRef:E}):t.createElement(Sk,{parentRef:E,parentContainRef:E,closeDropdown:e,style:{paddingTop:"0px",paddingBottom:"0px"}},t.createElement(lL,{user:A,onSuccess:e,disableMessaging:!0}))}})),t.createElement("div",{className:"sendbird-openchannel-file-message__right"},!u&&t.createElement("div",{className:"sendbird-openchannel-file-message__right__title"},t.createElement(yN,{className:"sendbird-openchannel-file-message__right__title__sender-name",type:CN.CAPTION_2,color:i?TN.SECONDARY_3:TN.ONBACKGROUND_2},A&&(A.friendName||A.nickname||A.userId)),t.createElement(yN,{className:"sendbird-openchannel-file-message__right__title__sent-at",type:CN.CAPTION_3,color:TN.ONBACKGROUND_3},(null==r?void 0:r.createdAt)&&WO(r.createdAt,_.DATE_FORMAT__MESSAGE_CREATED_AT,{locale:p}))),t.createElement("div",m({className:"sendbird-openchannel-file-message__right__body"},N?m({},D):{}),WH(r.url)&&t.createElement(pA,{className:"sendbird-openchannel-file-message__right__body__icon",type:WH(r.url),fillColor:mA.PRIMARY,width:"48px",height:"48px"}),t.createElement(tO,{className:"sendbird-openchannel-file-message__right__body__file-name",onClick:S},t.createElement(yN,{className:"sendbird-openchannel-file-message__right__body__file-name__label",type:CN.BODY_1,color:TN.ONBACKGROUND_1},function(e,t){if(null==e)return"";if(e.length<=t)return e;var n=t-3,r=Math.ceil(n/2),i=Math.floor(n/2);return e.substr(0,r)+"..."+e.substr(e.length-i)}(r.name||r.url,40)))),(I||w)&&t.createElement("div",{className:"sendbird-openchannel-file-message__right__tail"},I&&t.createElement(gA,{width:"16px",height:"16px"},t.createElement(pA,{className:"sendbird-openchannel-file-message__right__tail__pending",type:_A.SPINNER,fillColor:mA.PRIMARY,width:"16px",height:"16px"})),w&&t.createElement(pA,{className:"sendbird-openchannel-file-message__right__tail__failed",type:_A.ERROR,fillColor:mA.ERROR,width:"16px",height:"16px"}))),!N&&t.createElement("div",{className:"sendbird-openchannel-file-message__context-menu",ref:v},(xH({message:r,userId:o,status:h})||!s)&&t.createElement(Dk,{menuTrigger:function(e){return FH({message:r,userId:o,status:h})&&t.createElement(nO,{className:"sendbird-openchannel-file-message__context-menu__icon",width:"32px",height:"32px",onClick:e},t.createElement(pA,{type:_A.MORE,width:"24px",height:"24px"}))},menuItems:function(e){return t.createElement(Sk,{parentRef:v,parentContainRef:v,closeDropdown:e,openLeft:!0},xH({message:r,userId:o,status:h})&&t.createElement(wk,{onClick:function(){l||(d(r),e())},testID:"open_channel_file_message_context_menu_resend"},_.CONTEXT_MENU_DROPDOWN__RESEND),!s&&PH({message:r,userId:o})&&t.createElement(wk,{onClick:function(){l||(c(!0),e())},testID:"open_channel_file_message_context_menu_delete"},_.CONTEXT_MENU_DROPDOWN__DELETE))}}))),O&&t.createElement(BH,{message:r,hideMenu:function(){R(!1)},parentRef:g,showRemove:function(){R(!1),c(!0)}}))}function XH(e){var n=e.message,r=e.onCloseModal,i=e.onDeleteMessage,a=t.useContext(FN).stringSet;return t.createElement($k,{onCancel:r,onSubmit:i,submitText:a.MESSAGE_MENU__DELETE,titleText:qP(a,n)})}var ZH="ADMIN",JH="USER",$H="FILE",eG="THUMBNAIL",tG="OG",nG="UNKNOWN",rG="failed",iG="pending";function aG(e){var n,r,i,a=e.message,s=e.chainTop,o=e.chainBottom,l=e.hasSeparator,u=e.renderMessage,c=NH(),d=c.currentOpenChannel,h=c.deleteMessage,f=c.updateMessage,p=c.resendMessage,_=HN(),m=_.dateLocale,v=_.stringSet,g=null==d?void 0:d.isFrozen,E=yT().state,b=null===(r=null==E?void 0:E.config)||void 0===r?void 0:r.userId,y=E.config.openChannel.enableOgtag;"admin"!==(null==a?void 0:a.messageType)&&(i=null==a?void 0:a.sender);var C=t.useState(!1),T=C[0],N=C[1],S=t.useState(!1),I=S[0],w=S[1],A=t.useState(!1),M=A[0],O=A[1],R=t.useRef(null),D=!1;return i&&"admin"!==(null==a?void 0:a.messageType)&&(D=b===i.userId||(null==a?void 0:a.sendingStatus)===iG||(null==a?void 0:a.sendingStatus)===rG),u?t.createElement("div",{className:"sendbird-open-channel-msg-hoc sendbird-msg--scroll-ref","data-testid":"sendbird-message-hoc"},u({message:a,chainTop:s,chainBottom:o})):"user"===(null==a?void 0:a.messageType)&&T?t.createElement(JD,{isEdit:!0,channel:d,disabled:g,ref:R,message:a,onUpdateMessage:function(e){var t=e.messageId,n=e.message;f(t,n),N(!1)},onCancelEdit:function(){N(!1)}}):t.createElement("div",{className:"sendbird-open-channel-msg-hoc sendbird-msg--scroll-ref","data-testid":"sendbird-message-hoc"},t.createElement(t.Fragment,null,l&&(null==a?void 0:a.createdAt)&&t.createElement(tR,null,t.createElement(yN,{type:CN.CAPTION_2,color:TN.ONBACKGROUND_2},WO(null==a?void 0:a.createdAt,v.DATE_FORMAT__MESSAGE_LIST__DATE_SEPARATOR,{locale:m}))),(n={},n[ZH]=function(){if("admin"===(null==a?void 0:a.messageType))return t.createElement(GH,{message:a})}(),n[$H]=function(){var e;if("file"===(null==a?void 0:a.messageType))return t.createElement(QH,{message:a,isOperator:null==d?void 0:d.isOperator(null===(e=null==a?void 0:a.sender)||void 0===e?void 0:e.userId),isEphemeral:null==d?void 0:d.isEphemeral,disabled:g,userId:b,showRemove:w,resendMessage:p,chainTop:s,chainBottom:o})}(),n[tG]=function(){var e;if("user"===(null==a?void 0:a.messageType)&&y)return t.createElement(jH,{message:a,isOperator:null==d?void 0:d.isOperator(null===(e=null==a?void 0:a.sender)||void 0===e?void 0:e.userId),isEphemeral:null==d?void 0:d.isEphemeral,userId:b,showEdit:N,disabled:g,showRemove:w,resendMessage:p,chainTop:s,chainBottom:o})}(),n[eG]=function(){var e;if("file"===(null==a?void 0:a.messageType))return t.createElement(YH,{message:a,isOperator:null==d?void 0:d.isOperator(null===(e=null==a?void 0:a.sender)||void 0===e?void 0:e.userId),isEphemeral:null==d?void 0:d.isEphemeral,disabled:g,userId:b,showRemove:w,resendMessage:p,onClick:O,chainTop:s,chainBottom:o})}(),n[JH]=function(){var e;if("user"===(null==a?void 0:a.messageType))return t.createElement(HH,{message:a,isOperator:null==d?void 0:d.isOperator(null===(e=null==a?void 0:a.sender)||void 0===e?void 0:e.userId),isEphemeral:null==d?void 0:d.isEphemeral,userId:b,disabled:g,showEdit:N,showRemove:w,resendMessage:p,chainTop:s,chainBottom:o})}(),n[nG]=void 0,n)[function(e,t){var n,r,i=null==t?void 0:t.isOgMessageEnabledInOpenChannel;return(null===(n=null==e?void 0:e.isUserMessage)||void 0===n?void 0:n.call(e))||"user"===(null==e?void 0:e.messageType)?(null==e?void 0:e.ogMetaData)&&i?tG:JH:(null===(r=null==e?void 0:e.isAdminMessage)||void 0===r?void 0:r.call(e))?ZH:"file"===(null==e?void 0:e.messageType)?rM(e.type)||iM(e.type)?eG:$H:nG}(a,{isOgMessageEnabledInOpenChannel:y})],I&&t.createElement(XH,{message:a,onCloseModal:function(){return w(!1)},onDeleteMessage:function(){"admin"!==(null==a?void 0:a.messageType)&&h(a)}}),M&&"file"===(null==a?void 0:a.messageType)&&t.createElement(ox,{onClose:function(){return O(!1)},message:a,onDelete:function(){return h(a)},isByMe:D})))}t.forwardRef((function(e,n){var r=NH(),i=r.isMessageGroupingEnabled,a=void 0===i||i,s=r.allMessages,o=r.hasMore,l=r.onScroll,u=yT().state,c=HN().stringSet,d=u.config.userId,h=t.useRef(null),f=n||h,p=t.useState(!1),_=p[0],m=p[1],v=function(){f&&"current"in f&&f.current&&(f.current.scrollTo(0,f.current.scrollHeight),m(!1))},g=function(e){var t=e.hasMore,n=e.hasNext,r=e.onScroll,i=e.scrollRef,a=e.setShowScrollDownButton;return zB(am((function(){var e=null==i?void 0:i.current;if(null!=e){var s=e.scrollTop,o=e.scrollHeight,l=e.clientHeight,u=function(e,t){return e-t}(o,s);"function"==typeof a&&a(o>s+l+1),t&&iF(s,0,ag)&&r((function(){e.scrollHeight>o&&(e.scrollTop=e.scrollHeight-u)})),n&&iF(l+s,o,ag)&&r((function(){e.scrollHeight>o&&(e.scrollTop=s)}))}})),100,{trailing:!0})}({setShowScrollDownButton:m,hasMore:o,onScroll:l,scrollRef:f}),E=t.useMemo((function(){var n;return s.length>0?s.map((function(n,r){var i,o=s[r-1],l=s[r-1],u=o&&o.createdAt,h=null==n?void 0:n.createdAt,f=!(u&&ek(h,u)),p=a?eF(o,n,l,c):[!1,!1],_=p[0],m=p[1],v=(null===(i=null==n?void 0:n.sender)||void 0===i?void 0:i.userId)===d,g=(null==n?void 0:n.messageId)||(null==n?void 0:n.reqId);return t.createElement(fL,{message:n,isByMe:v,key:g},t.createElement(aG,{message:n,chainTop:_,chainBottom:m,hasSeparator:f,renderMessage:null==e?void 0:e.renderMessage}))})):(null===(n=null==e?void 0:e.renderPlaceHolderEmptyList)||void 0===n?void 0:n.call(e))||t.createElement(IA,{className:"sendbird-openchannel-conversation-scroll__container__place-holder",type:yA})}),[s]);return t.createElement("div",{className:"sendbird-openchannel-conversation-scroll"},t.createElement("div",{className:"sendbird-openchannel-conversation-scroll__container"},t.createElement("div",{className:"sendbird-openchannel-conversation-scroll__container__padding"}),t.createElement("div",{className:["sendbird-openchannel-conversation-scroll__container__item-container",s.length>0?"":"no-messages"].join(" "),onScroll:g,ref:f},E)),_&&t.createElement("div",{className:"sendbird-openchannel-conversation-scroll__container__scroll-bottom-button",onClick:v,onKeyDown:v,tabIndex:0,role:"button"},t.createElement(pA,{width:"24px",height:"24px",type:_A.CHEVRON_DOWN,fillColor:mA.CONTENT})))})),t.createContext(null),t.createContext({openedListKeys:[],addOpenedListKey:zT,removeOpenedListKey:zT,clearOpenedListKeys:zT,allowMultipleOpen:!1});var sG,oG,lG=function(e){var n=e.renderHeader,r=e.renderPlaceHolderError,i=e.renderPlaceHolderLoading,a=e.renderPlaceHolderEmptyList,s=e.onChangeTheme,o=e.onUserProfileUpdated,l=e.allowProfileEdit,u=e.channels,c=e.onLoadMore,d=e.initialized,h=e.renderChannel,f=e.renderAddChannel,p=e.scrollRef,_=t.useState(!1),m=_[0],v=_[1],g=yT().state.stores,E={addChannel:f,channel:h,placeholder:{loading:function(){return d?null:i?i():t.createElement(IA,{type:EA})},empty:function(){return d?a?a():t.createElement(IA,{type:bA}):null},error:function(){return d&&g.sdkStore.error?r?r():t.createElement(IA,{type:CA}):null}}};return t.createElement(t.Fragment,null,t.createElement("div",{className:"sendbird-channel-list__header"},(null==n?void 0:n())||t.createElement(BB,{onEdit:function(){return l&&v(!0)},allowProfileEdit:l,renderIconButton:function(){return E.addChannel()}})),m&&t.createElement(qB,{onThemeChange:s,onCancel:function(){return v(!1)},onEditProfile:function(e){v(!1),o(e)}}),t.createElement(uG,{data:u,renderItem:E.channel,onLoadMore:c,placeholderLoading:E.placeholder.loading(),placeholderEmpty:E.placeholder.empty(),placeholderError:E.placeholder.error(),scrollRef:p}))},uG=function(e){var n,r,i,a,s=e.data,o=e.renderItem,l=e.onLoadMore,u=e.placeholderLoading,c=e.placeholderError,d=e.placeholderEmpty,h=e.scrollRef,f=(r=(n={onReachedBottom:function(){return null==l?void 0:l()}}).onReachedTop,i=n.onReachedBottom,a=n.onInBetween,zB(am((function(e){if(null==e?void 0:e.target){var t=e.target,n=t.scrollTop,s=t.scrollHeight,o=t.clientHeight,l={distanceFromBottom:s-n-o};r&&iF(n,0,ag)?r(l):i&&iF(s,o+n,ag)?i(l):a&&a(l)}})),100,{trailing:!0}));return t.createElement("div",{className:"sendbird-channel-list__body",onScroll:f,ref:h},c,t.createElement("div",null,s.map((function(e,t){return o({item:e,index:t})}))),u,0===s.length&&d)},cG=function(e,t){return"broadcast"===t&&(e.isBroadcast=!0),"supergroup"===t&&(e.isSuper=!0),e};(oG=sG||(sG={})).GROUP="group",oG.SUPERGROUP="supergroup",oG.BROADCAST="broadcast";var dG,hG,fG=t.createContext(null),pG={sdk:void 0,userListQuery:void 0,onCreateChannelClick:void 0,onChannelCreated:void 0,onBeforeCreateChannel:void 0,pageStep:0,type:sG.GROUP,onCreateChannel:void 0,overrideInviteUser:void 0},_G=function(e){var n=e.onCreateChannelClick,r=e.onBeforeCreateChannel,i=e.onChannelCreated,a=e.userListQuery,s=e.onCreateChannel,o=e.overrideInviteUser,l=gG().updateState,u=yT().state.config,c=null!=a?a:null==u?void 0:u.userListQuery;return t.useEffect((function(){l({onCreateChannelClick:n,onBeforeCreateChannel:r,onChannelCreated:i,userListQuery:c,onCreateChannel:s,overrideInviteUser:o})}),[n,r,i,a,s,o,c]),null},mG=function(e){var n=e.children;return t.createElement(vG,m({},e),t.createElement(_G,m({},e)),n)},vG=function(e){var n=e.children,r=KT({userListQuery:null==e?void 0:e.userListQuery,onCreateChannelClick:null==e?void 0:e.onCreateChannelClick,onChannelCreated:null==e?void 0:e.onChannelCreated,onBeforeCreateChannel:null==e?void 0:e.onBeforeCreateChannel,onCreateChannel:null==e?void 0:e.onCreateChannel,overrideInviteUser:null==e?void 0:e.overrideInviteUser}),i=t.useRef(function(e){return GC(m(m({},pG),e))}(r));return t.createElement(fG.Provider,{value:i.current},n)},gG=function(){return VC(fG,(function(e){return e}),pG)},EG=function(){var e=t.useContext(fG),n=function(){var e=yT(),t=e.state,n=e.actions;return m(m({},t),n)}();if(!e)throw new Error("useCreateChannel must be used within a CreateChannelProvider");return{state:Ag.useSyncExternalStore(e.subscribe,e.getState),actions:t.useMemo((function(){return{setPageStep:function(t){return e.setState((function(e){return m(m({},e),{pageStep:t})}))},setType:function(t){return e.setState((function(e){return m(m({},e),{type:t})}))},createChannel:oL(n)}}),[e])}},bG=function(e){var n=e.onCancel,r=e.userListQuery,i=EG(),a=i.state,s=a.onCreateChannelClick,o=a.onBeforeCreateChannel,l=a.onChannelCreated,u=a.onCreateChannel,c=a.overrideInviteUser,d=a.type,h=i.actions.createChannel,f=yT().state,p=f.config.userId,_=f.stores.sdkStore.sdk,v=[p],g=t.useState([]),E=g[0],y=g[1],C=t.useState({}),T=C[0],N=C[1],S=t.useContext(FN).stringSet,I=t.useState(null),w=I[0],A=I[1],M=Object.keys(T).length,O=S.MODAL__CREATE_CHANNEL__TITLE,R=S.BUTTON__CREATE,D=$M().isMobile,k=t.useState(window.innerHeight),L=k[0],x=k[1];return t.useEffect((function(){var e=r?r():function(e){var t=e.sdk,n=e.userFilledApplicationUserListQuery,r=t.createApplicationUserListQuery();return n&&Object.keys(n).forEach((function(e){r[e]=n[e]})),r}({sdk:_});A(e),(null==e?void 0:e.isLoading)||e.next().then((function(e){y(e)}))}),[]),t.useEffect((function(){var e=function(){x(window.innerHeight)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),t.createElement($k,{isFullScreenOnMobile:!0,titleText:O,submitText:R,type:ZO.PRIMARY,disabled:E.length>1&&0===Object.keys(T).length,onCancel:n,onSubmit:function(){var e=Object.keys(T).length>0?Object.keys(T):[p],t=null!=l?l:u,r=null!=s?s:c;if("function"!=typeof r){if(o){var i=o(e);cG(i,d),h(i).then((function(e){return null==t?void 0:t(e)}))}else{(i={}).invitedUserIds=e,i.isDistinct=!1,p&&(i.operatorUserIds=[p]),cG(i,d),h(i).then((function(e){return null==t?void 0:t(e)}))}null==n||n()}else r({users:e,onClose:null!=n?n:zT,channelType:d})}},t.createElement("div",null,t.createElement(yN,{color:M>0?TN.PRIMARY:TN.ONBACKGROUND_3,type:CN.CAPTION_1},"".concat(M," ").concat(S.MODAL__INVITE_MEMBER__SELECTED)),t.createElement("div",{className:"sendbird-create-channel--scroll",style:D?{height:"calc(".concat(L,"px - 200px)")}:{},onScroll:function(e){if(w){var t=e.target,n=w.hasNext,r=w.isLoading,i=t.clientHeight+t.scrollTop+50>t.scrollHeight;n&&i&&!r&&w.next().then((function(e){y(b(b([],E,!0),e,!0))}))}}},E.map((function(e){return!function(e){return function(t){return null==e?void 0:e.includes(t)}}(v)(e.userId)&&t.createElement(uL,{key:e.userId,user:e,checkBox:!0,checked:T[e.userId],onChange:function(e){var t,n=m(m({},T),((t={})[e.target.id]=e.target.checked,t));e.target.checked||delete n[e.target.id],N(n)}})})))))},yG=function(e){var n=e.onCancel,r=yT().state,i=sL(r),a=EG().actions,s=a.setPageStep,o=a.setType,l=t.useContext(FN).stringSet,u=function(e){var t,n=null===(t=null==e?void 0:e.appInfo)||void 0===t?void 0:t.applicationAttributes;return!!Array.isArray(n)&&n.includes("allow_broadcast_channel")}(i),c=function(e){var t,n=null===(t=null==e?void 0:e.appInfo)||void 0===t?void 0:t.applicationAttributes;return!!Array.isArray(n)&&n.includes("allow_super_group_channel")}(i);return t.createElement($k,{titleText:null==l?void 0:l.MODAL__CREATE_CHANNEL__TITLE,hideFooter:!0,onCancel:function(){null==n||n()},className:"sendbird-add-channel__modal"},t.createElement("div",{className:"sendbird-add-channel__rectangle-wrap"},t.createElement("div",{className:"sendbird-add-channel__rectangle",onClick:function(){o(sG.GROUP),s(1)},role:"button",tabIndex:0,onKeyDown:function(){o(sG.GROUP),s(1)}},t.createElement(pA,{className:"sendbird-add-channel__rectangle__chat-icon",type:_A.CHAT,fillColor:mA.PRIMARY,width:"28px",height:"28px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},l.MODAL__CREATE_CHANNEL__GROUP)),c&&t.createElement("div",{className:"sendbird-add-channel__rectangle",onClick:function(){o(sG.SUPERGROUP),s(1)},role:"button",tabIndex:0,onKeyDown:function(){o(sG.SUPERGROUP),s(1)}},t.createElement(pA,{className:"sendbird-add-channel__rectangle__supergroup-icon",type:_A.SUPERGROUP,fillColor:mA.PRIMARY,width:"28px",height:"28px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},l.MODAL__CREATE_CHANNEL__SUPER)),u&&t.createElement("div",{className:"sendbird-add-channel__rectangle",onClick:function(){o(sG.BROADCAST),s(1)},role:"button",tabIndex:0,onKeyDown:function(){o(sG.BROADCAST),s(1)}},t.createElement(pA,{className:"sendbird-add-channel__rectangle__broadcast-icon",type:_A.BROADCAST,fillColor:mA.PRIMARY,width:"28px",height:"28px"}),t.createElement(yN,{type:CN.SUBTITLE_1,color:TN.ONBACKGROUND_1},l.MODAL__CREATE_CHANNEL__BROADCAST))))},CG=function(e){var n=e.onCancel,r=e.renderStepOne,i=EG(),a=i.state,s=a.pageStep,o=a.userListQuery,l=i.actions.setPageStep;return t.createElement(t.Fragment,null,0===s&&((null==r?void 0:r())||t.createElement(yG,{onCancel:n})),1===s&&t.createElement(bG,{userListQuery:o,onCancel:function(){l(0),null==n||n()}}))},TG=function(e){return t.createElement(mG,m({},e),t.createElement(CG,m({},e)))},NG=function(e){var n=e.createChannelVisible,r=e.onChangeCreateChannelVisible,i=e.onBeforeCreateChannel,a=e.onCreateChannelClick,s=e.onChannelCreated,o=yT().state.config;return t.createElement(t.Fragment,null,t.createElement(nO,{height:"32px",width:"32px",disabled:!o.isOnline,onClick:function(){return r(!0)}},t.createElement(pA,{type:_A.CREATE,fillColor:mA.PRIMARY,width:"24px",height:"24px"})),n&&t.createElement(TG,{onCancel:function(){return r(!1)},onChannelCreated:function(e){null==s||s(e),r(!1)},onBeforeCreateChannel:i,onCreateChannelClick:a}))},SG=function(){var e=t.useState(!1),n=e[0],r=e[1],i=DB().state,a=i.onChannelCreated,s=i.onBeforeCreateChannel,o=i.onCreateChannelClick;return t.createElement(NG,{createChannelVisible:n,onChangeCreateChannelVisible:r,onCreateChannelClick:o,onBeforeCreateChannel:s,onChannelCreated:a})},IG=function(e){var n=e.renderHeader,r=e.renderChannelPreview,i=e.renderPlaceHolderError,a=e.renderPlaceHolderLoading,s=e.renderPlaceHolderEmptyList,o=DB().state,l=o.onChannelSelect,u=o.onThemeChange,c=o.allowProfileEdit,d=o.typingChannelUrls,h=o.groupChannels,f=o.initialized,p=o.selectedChannelUrl,_=o.loadMore,v=o.onUserProfileUpdated,b=o.scrollRef,y=yT().state,C=y.stores,T=y.config,N=T.logger,S=T.isOnline,I=C.sdkStore.sdk;return t.createElement(lG,{renderHeader:n,renderChannel:function(e){var n=e.item,i=e.index,a={channel:n,tabIndex:i,isSelected:n.url===p,isTyping:d.includes(n.url),renderChannelAction:function(e){return t.createElement(YB,m({},e))},onClick:function(){S||(null==I?void 0:I.isCacheEnabled)?(N.info("ChannelList: Clicked on channel:",n),l(n)):N.warning("ChannelList: Inactivated clicking channel item during offline.")},onLeaveChannel:function(){return g(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return N.info("ChannelList: Leaving channel",n),[4,n.leave()];case 1:return e.sent(),N.info("ChannelList: Leaving channel success"),[2]}}))}))}};return r?t.createElement("div",{key:n.url,onClick:a.onClick},r(a)):t.createElement(ZB,m({key:n.url},a))},renderPlaceHolderError:i,renderPlaceHolderLoading:a,renderPlaceHolderEmptyList:s,onChangeTheme:null!=u?u:zT,allowProfileEdit:c,onUserProfileUpdated:null!=v?v:zT,channels:h,onLoadMore:_,initialized:f,renderAddChannel:function(){return t.createElement(SG,null)},scrollRef:b})},wG=function(e){return t.createElement(PB,m({},e),t.createElement(IG,m({},e)))};(hG=dG||(dG={})).CHANNEL_LIST="CHANNEL_LIST",hG.CHANNEL="CHANNEL",hG.CHANNEL_SETTINGS="CHANNEL_SETTINGS",hG.MESSAGE_SEARCH="MESSAGE_SEARCH",hG.THREAD="THREAD";const AG="CareAiChat-module__chatInterface__ESwZS",MG="CareAiChat-module__careaiContainer__aV9aO",OG="CareAiChat-module__sendbirdConversationMessagesPadding__LQ0yx",RG="CareAiChat-module__customMessage__GXH4Y",DG="CareAiChat-module__customMessageBot__CgEcY",kG="CareAiChat-module__customMessageUser__WrxTg",LG="CareAiChat-module__customMessageAvatar__mjg4n",xG="CareAiChat-module__customMessageContent__yQgTI",UG="CareAiChat-module__customMessageBubble__JYLXZ",PG="CareAiChat-module__customMessageBubbleBot__gq8-1",FG="CareAiChat-module__customMessageBubbleUser__0ak9J",BG="CareAiChat-module__customMessageTime__oHE73",HG="CareAiChat-module__customGroupChannelList__-6ydS",GG="CareAiChat-module__customGroupChannelHeader__b2iZV",jG="CareAiChat-module__customInputWrapper__wNCUR",VG="CareAiChat-module__customTextarea__urAzR",qG="CareAiChat-module__customTextareaExpanded__wpGsQ",zG="CareAiChat-module__sendBtn__RNo5U",KG="CareAiChat-module__sendBtnActive__66OyI",YG=()=>{const e=t.useRef(null),[n,r]=t.useState(!1),{actions:{sendUserMessage:i}}=iN(),a=async()=>{const t=e.current;if(!t)return;const n=t.value.trim();if(!n)return;await i({message:n});const a=document.getElementsByClassName(OG)[0];a&&(a.scrollTop=a.scrollHeight),t.value="",t.style.height="auto",r(!1)};return f.jsxs("div",{className:jG,children:[f.jsx("textarea",{ref:e,className:VG,rows:1,onChange:()=>{const t=e.current,n=null==t?void 0:t.value.trim();r(!!n),t&&(t.style.height="auto",t.style.height=`${t.scrollHeight+2}px`,t.scrollHeight>44?t.classList.add(qG):t.classList.remove(qG))},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),a())}}),f.jsx("button",{className:`${zG} ${n?KG:""}`,onClick:a,children:f.jsx(RB,{width:26,height:26,color:n?"white":"#B4B4BE"})})]})},WG=({message:e})=>{const{sender:t,message:n,createdAt:r}=e,i="practo_account_id_1"===(null==t?void 0:t.userId);return f.jsxs("div",{className:`${RG} ${i?DG:kG}`,children:[i&&f.jsx("img",{src:"https://s3-alpha-sig.figma.com/img/d2cb/d486/aa526cbe87233fc8d781811b669c44bd?Expires=1744588800&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=AK60VshOFVshHgAdYDKxYevZjoFkbM6lPK2wCqe~jcCpdnW7tH8Havd28K6y~BhHAfOUt~BUmEQNZKkRydxbJYdhtNllE9d-U~DaRPFVQwWCvPx4wkWjcRxbqwd3ByYqTGdCleDIFIRZtiMnaluU6MRmzPsTu3zlneGeeTqHCOF-kH~cNF-udK~0j5gOjeRAImgS7-xyG2HAHRyuXNcQooqALSWCpePEfCOUnHJfG4xjWGldD4sfrP1S0jFjdRQiP-SqsrJE8vwHM3-AI4DugoAmgKkCNS91Xb7pyMWHbLKLhn54VcgxLmqzJMNhK0Y1PEPQe4YDF7wgpLwpjD-ljw__",alt:"bot-avatar",className:LG}),f.jsxs("div",{className:xG,children:[f.jsx("div",{className:`${UG} ${i?PG:FG}`,children:n}),f.jsx("span",{className:BG,children:(a=r,new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}))})]})]});var a},QG=()=>f.jsx("div",{className:GG,children:"Your Conversations"}),XG=({showChatHistory:e,setShowChatHistory:n,appId:r,accountId:i,accessToken:a,currentChannelUrl:s})=>{const[o,l]=t.useState(s);return f.jsx("div",{className:MG,children:f.jsx(OB,{appId:r,userId:i,nickname:"User",profileUrl:"",accessToken:a,children:f.jsxs("div",{className:AG,children:[e?f.jsx(wG,{renderHeader:()=>f.jsx(QG,{}),onChannelSelect:e=>{e&&l(e.url),n(!1)},onChannelCreated:()=>{},className:HG}):null,f.jsx(MF,{channelUrl:s,renderMessageInput:()=>f.jsx(YG,{}),renderMessage:WG})]})})})},ZG=({showChatHistory:e,setShowChatHistory:n,appId:r})=>{const[i,a]=t.useState(!0),[s,o]=t.useState("173815"),[l,u]=t.useState(""),[c,d]=t.useState("sendbird_group_channel_534427907_7b7bcc59afc50ce682b09d5c81e8bc22249bdbbc");return t.useEffect((()=>{if("undefined"!=typeof document){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/@sendbird/uikit-react@latest/dist/index.css",document.head.appendChild(e)}}),[]),f.jsx(XG,{showChatHistory:e,setShowChatHistory:n,appId:r,accountId:s,accessToken:l,currentChannelUrl:c})},JG="PageLoader-module__pageLoader__kzmI-",$G="PageLoader-module__loader__JrVVU",ej="PageLoader-module__spinner__D1AbV",tj=()=>f.jsx("div",{className:JG,"data-testid":"page-loader",children:f.jsx("div",{className:$G,children:f.jsx("div",{className:ej})})});var nj={
/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   */
parse:function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");var n={},r=t||{},i=e.split(/; */),a=r.decode||rj;return i.forEach((function(e){var t=e.indexOf("=");if(!(t<0)){var r=e.substr(0,t).trim(),i=e.substr(++t,e.length).trim();'"'==i[0]&&(i=i.slice(1,-1)),null==n[r]&&(n[r]=function(e,t){try{return t(e)}catch(O){return e}}(i,a))}})),n},serialize:function(e,t,n){var r=n||{},i=r.encode||ij;if(!aj.test(e))throw new TypeError("argument name is invalid");var a=i(t);if(a&&!aj.test(a))throw new TypeError("argument val is invalid");var s=[e+"="+a];if(null!=r.maxAge){var o=r.maxAge-0;if(isNaN(o))throw new Error("maxAge should be a Number");s.push("Max-Age="+o)}if(r.domain){if(!aj.test(r.domain))throw new TypeError("option domain is invalid");s.push("Domain="+r.domain)}if(r.path){if(!aj.test(r.path))throw new TypeError("option path is invalid");s.push("Path="+r.path)}r.expires&&s.push("Expires="+r.expires.toUTCString());r.httpOnly&&s.push("HttpOnly");r.secure&&s.push("Secure");return s.join("; ")}},rj=decodeURIComponent,ij=encodeURIComponent,aj=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;var sj=nj;"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e});var oj={},lj=void 0;function uj(){return!!lj&&!0!==lj.headersSent}function cj(e){oj=e?sj.parse(e):{}}var dj={load:function(e,t){var n="undefined"==typeof document?oj:sj.parse(document.cookie),r=n&&n[e];if(!t)try{r=JSON.parse(r)}catch(O){}return r},select:function(e){var t="undefined"==typeof document?oj:sj.parse(document.cookie);return t?e?Object.keys(t).reduce((function(n,r){if(!e.test(r))return n;var i={};return i[r]=t[r],Object.assign({},n,i)}),{}):t:{}},save:function(e,t,n){oj[e]=t,"object"==typeof t&&(oj[e]=JSON.stringify(t)),"undefined"!=typeof document&&(document.cookie=sj.serialize(e,oj[e],n)),uj()&&lj.cookie&&lj.cookie(e,t,n)},remove:function(e,t){delete oj[e],void 0===t?t={}:"string"==typeof t&&(t={path:t}),"undefined"!=typeof document&&(t.expires=new Date(1970,1,1,0,0,1),document.cookie=sj.serialize(e,"",t)),uj()&&lj.clearCookie&&lj.clearCookie(e,t)},setRawCookie:cj,plugToRequest:function(e,t){return e.cookie?oj=e.cookie:e.cookies?oj=e.cookies:e.headers&&e.headers.cookie?cj(e.headers.cookie):oj={},lj=t,function(){lj=null,oj={}}}};"undefined"!=typeof window&&(window.reactCookie=dj);const hj=o(dj),fj={full:{width:"100%",height:"100%"},hidden:{display:"none"}},pj=({phone:e,closeModal:n,setIsModalOpen:r,setShowLoginModal:i})=>{const[a,s]=t.useState("otp"),[o,l]=t.useState(!0),u=`https://${"www-conapps.practodev.com".replace("www","accounts")}/login_signup_otp?mobile=${encodeURIComponent(e)}&view_type=modal&name=User`,c="undefined"!=typeof window&&window.document?`/login?redirectToPath=${window.location.protocol}//${window.location.host}`:"",d=()=>{hj.load("modal_login")?s("redirect"):o&&l(!1)},h=()=>{const e=`${window.location.origin}/client-auth/login`;setTimeout((()=>{fetch(e).then((()=>{})).catch((e=>{})),l(!1),n(),r(!0),i(!1)}),3e3)};return"otp"===a?f.jsxs("div",{style:{height:"100%"},children:[o&&f.jsx(tj,{}),f.jsx("iframe",{style:fj.full,src:u,onLoad:d})]}):"redirect"===a?f.jsxs("div",{children:[o&&f.jsx(tj,{}),f.jsx("iframe",{style:fj.hidden,src:c,onLoad:h})]}):null};function _j({width:e=16,height:t=16,color:n="black"}){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:t,color:n,viewBox:"0 0 16 16",fill:"none",children:f.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.1657 1.83441C13.8533 1.52199 13.3467 1.52199 13.0343 1.83441L8.00001 6.86873L2.96569 1.83441C2.65327 1.52199 2.14674 1.52199 1.83432 1.83441C1.5219 2.14683 1.5219 2.65336 1.83432 2.96578L6.86864 8.0001L1.83432 13.0344C1.5219 13.3468 1.5219 13.8534 1.83432 14.1658C2.14674 14.4782 2.65327 14.4782 2.96569 14.1658L8.00001 9.13147L13.0343 14.1658C13.3467 14.4782 13.8533 14.4782 14.1657 14.1658C14.4781 13.8534 14.4781 13.3468 14.1657 13.0344L9.13138 8.0001L14.1657 2.96578C14.4781 2.65336 14.4781 2.14683 14.1657 1.83441Z",fill:"#2D2D32"})})}const mj="LoginModal-module__bottomLoginModalWrapper__oKEIO",vj="LoginModal-module__screenOverlay__vCPXo",gj="LoginModal-module__bottomLoginModal__O72DH",Ej="LoginModal-module__bottomModalContent__K9HgH",bj="LoginModal-module__title__hXH0p",yj="LoginModal-module__phoneInputContainer__x9sSA",Cj="LoginModal-module__phoneInputContainerError__oqpCo",Tj="LoginModal-module__countryCodeDropdown__5Jo23",Nj="LoginModal-module__phoneInput__XQBLP",Sj="LoginModal-module__phoneInputActive__nZlKG",Ij="LoginModal-module__errorText__yVA8B",wj="LoginModal-module__continueButton__4HMlk",Aj="LoginModal-module__continueButtonEnabled__Ml3G1",Mj="LoginModal-module__continueButtonDisabled__S6tRx",Oj="LoginModal-module__infoTextContainer__ERzop",Rj="LoginModal-module__infoTextSecondary__yYhvC",Dj=e=>/^[0-9]{10}$/.test(e),kj=({setIsModalOpen:e,setShowLoginModal:n})=>{const[r,i]=t.useState(""),[a,s]=t.useState("+91"),[o,l]=t.useState(!1),[u,c]=t.useState(!0);if(!u)return null;const d=()=>c(!1);return f.jsxs("div",{className:mj,onClick:d,children:[f.jsx("div",{className:vj}),f.jsx("div",{className:gj,onClick:e=>e.stopPropagation(),children:o?f.jsx(pj,{phone:r,closeModal:d,setIsModalOpen:e,setShowLoginModal:n}):f.jsxs("div",{className:Ej,children:[f.jsx("div",{onClick:d,children:f.jsx(_j,{})}),f.jsx("h2",{className:bj,children:"Enter your mobile number"}),f.jsxs("div",{className:`${yj} ${Dj(r)||10!==r.length?"":Cj}`,children:[f.jsx("div",{className:Tj,children:f.jsxs("select",{value:a,onChange:e=>s(e.target.value),children:[f.jsx("option",{value:"+91",children:"+91"}),f.jsx("option",{value:"+1",children:"+1"}),f.jsx("option",{value:"+44",children:"+44"})]})}),f.jsx("input",{type:"text",placeholder:"Mobile Number",value:r,onChange:e=>i(e.target.value),className:`${Nj} ${r.length>0?Sj:""}`,maxLength:10})]}),Dj(r)||10!==r.length?null:f.jsx("div",{className:Ij,children:"Please enter a valid 10-digit mobile number"}),f.jsxs("div",{className:Oj,children:["By continuing, you agree to our",f.jsx("span",{className:Rj,children:"Terms & Conditions"})]}),f.jsx("button",{onClick:()=>l(!0),className:`${wj} ${10===r.length&&Dj(r)?Aj:Mj}`,disabled:r.length<10||!Dj(r),children:"Continue"})]})})]})};const Lj=Object.freeze(Object.defineProperty({__proto__:null,xmlHttpRequest:function(e,t){return new Promise((function(n,r){if("undefined"!=typeof XMLHttpRequest){var i=As.of(e),a=i.dispatcher,s=i.logger,o=t.requestId,l=t.method,u=t.url,c=t.headers,d=void 0===c?{}:c,h=t.data,f=void 0===h?"":h,p=t.uploadProgressHandler,_=!1,m=new XMLHttpRequest;m.open(l,u),Object.keys(d).forEach((function(e){m.setRequestHeader(e,d[e])})),p&&m.upload.addEventListener("progress",(function(e){e.lengthComputable?p(o,e.loaded,e.total):s.debug("Progress computing failed: `Content-Length` header is not given.")})),m.onabort=function(){r(H.requestCanceled)},m.onerror=function(e){r(H.networkError)},m.onreadystatechange=function(){if(m.readyState===XMLHttpRequest.DONE&&!_)if(0===m.status||m.status>=200&&m.status<400)try{var t=JSON.parse(m.responseText);n(new nt(e,t))}catch(l){r(H.networkError)}else try{var i=JSON.parse(m.responseText);if(i){var s=new H(i);if(s.isSessionExpiredError){if(a.dispatch(new it({reason:s.code,message:s.message})),!(m instanceof ot)){var o=new bt;return a.dispatch(new ht({request:m,deferred:o,error:s})),o.promise}}else s.isSessionInvalidatedError&&a.dispatch(new it({reason:s.code,message:s.message}));r(s)}else r(H.requestFailed)}catch(l){r(H.requestFailed)}},a.on((function(e){e instanceof yt&&(e.requestId&&e.requestId!==o||(_=!0,m.abort()))})),m.send(f)}else r(H.xmlHttpRequestNotSupported)}))}},Symbol.toStringTag,{value:"Module"})),xj=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Uj={},Pj="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==s&&s||{},Fj="URLSearchParams"in Pj,Bj="Symbol"in Pj&&"iterator"in Symbol,Hj="FileReader"in Pj&&"Blob"in Pj&&function(){try{return new Blob,!0}catch(kf){return!1}}(),Gj="FormData"in Pj,jj="ArrayBuffer"in Pj;if(jj)var Vj=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],qj=ArrayBuffer.isView||function(e){return e&&Vj.indexOf(Object.prototype.toString.call(e))>-1};function zj(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Kj(e){return"string"!=typeof e&&(e=String(e)),e}function Yj(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return Bj&&(t[Symbol.iterator]=function(){return t}),t}function Wj(e){this.map={},e instanceof Wj?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function Qj(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function Xj(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function Zj(e){var t=new FileReader,n=Xj(t);return t.readAsArrayBuffer(e),n}function Jj(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function $j(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:Hj&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:Gj&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:Fj&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():jj&&Hj&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=Jj(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):jj&&(ArrayBuffer.prototype.isPrototypeOf(e)||qj(e))?this._bodyArrayBuffer=Jj(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Fj&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Hj&&(this.blob=function(){var e=Qj(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return Qj(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(Hj)return this.blob().then(Zj);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,n,r,i,a=Qj(this);if(a)return a;if(this._bodyBlob)return e=this._bodyBlob,n=Xj(t=new FileReader),i=(r=/charset=([A-Za-z0-9_-]+)/.exec(e.type))?r[1]:"utf-8",t.readAsText(e,i),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Gj&&(this.formData=function(){return this.text().then(nV)}),this.json=function(){return this.text().then(JSON.parse)},this}Wj.prototype.append=function(e,t){e=zj(e),t=Kj(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},Wj.prototype.delete=function(e){delete this.map[zj(e)]},Wj.prototype.get=function(e){return e=zj(e),this.has(e)?this.map[e]:null},Wj.prototype.has=function(e){return this.map.hasOwnProperty(zj(e))},Wj.prototype.set=function(e,t){this.map[zj(e)]=Kj(t)},Wj.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},Wj.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),Yj(e)},Wj.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),Yj(e)},Wj.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),Yj(e)},Bj&&(Wj.prototype[Symbol.iterator]=Wj.prototype.entries);var eV=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function tV(e,t){if(!(this instanceof tV))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,i=(t=t||{}).body;if(e instanceof tV){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Wj(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new Wj(t.headers)),this.method=(r=(n=t.method||this.method||"GET").toUpperCase(),eV.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in Pj)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;a.test(this.url)?this.url=this.url.replace(a,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function nV(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function rV(e,t){if(!(this instanceof rV))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new Wj(t.headers),this.url=t.url||"",this._initBody(e)}tV.prototype.clone=function(){return new tV(this,{body:this._bodyInit})},$j.call(tV.prototype),$j.call(rV.prototype),rV.prototype.clone=function(){return new rV(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Wj(this.headers),url:this.url})},rV.error=function(){var e=new rV(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var iV=[301,302,303,307,308];rV.redirect=function(e,t){if(-1===iV.indexOf(t))throw new RangeError("Invalid status code");return new rV(null,{status:t,headers:{location:e}})};var aV=Pj.DOMException;try{new aV}catch(kf){(aV=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),aV.prototype.constructor=aV}function sV(e,t){return new Promise((function(n,r){var i=new tV(e,t);if(i.signal&&i.signal.aborted)return r(new aV("Aborted","AbortError"));var a=new XMLHttpRequest;function s(){a.abort()}if(a.onload=function(){var e,t,r={statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new Wj,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();try{t.append(r,i)}catch(a){}}})),t)};0===i.url.indexOf("file://")&&(a.status<200||a.status>599)?r.status=200:r.status=a.status,r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var s="response"in a?a.response:a.responseText;setTimeout((function(){n(new rV(s,r))}),0)},a.onerror=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){r(new TypeError("Network request timed out"))}),0)},a.onabort=function(){setTimeout((function(){r(new aV("Aborted","AbortError"))}),0)},a.open(i.method,function(e){try{return""===e&&Pj.location.href?Pj.location.href:e}catch(kf){return e}}(i.url),!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&(Hj?a.responseType="blob":jj&&(a.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof Wj||Pj.Headers&&t.headers instanceof Pj.Headers)){var o=[];Object.getOwnPropertyNames(t.headers).forEach((function(e){o.push(zj(e)),a.setRequestHeader(e,Kj(t.headers[e]))})),i.headers.forEach((function(e,t){-1===o.indexOf(t)&&a.setRequestHeader(t,e)}))}else i.headers.forEach((function(e,t){a.setRequestHeader(t,e)}));i.signal&&(i.signal.addEventListener("abort",s),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",s)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}sV.polyfill=!0,Pj.fetch||(Pj.fetch=sV,Pj.Headers=Wj,Pj.Request=tV,Pj.Response=rV);var oV="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==s&&s||{fetch:null};oV.fetch||(oV.fetch=sV);const lV=i({__proto__:null,default:Uj},[Uj]);function uV(e){return new Int32Array(e)}function cV(e){return new Float32Array(e)}var dV={arraycopy:function(e,t,n,r,i){for(var a=t+i;t<a;)n[r++]=e[t++]},out:{}};dV.out.println=function(e){},dV.out.printf=function(){};var hV={};function fV(e){this.ordinal=e}hV.SQRT2=1.4142135623730951,hV.FAST_LOG10=function(e){return Math.log10(e)},hV.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},fV.short_block_allowed=new fV(0),fV.short_block_coupled=new fV(1),fV.short_block_dispensed=new fV(2),fV.short_block_forced=new fV(3);var pV={};function _V(e){this.ordinal=e}pV.MAX_VALUE=34028235e31,_V.vbr_off=new _V(0),_V.vbr_mt=new _V(1),_V.vbr_rh=new _V(2),_V.vbr_abr=new _V(3),_V.vbr_mtrh=new _V(4),_V.vbr_default=_V.vbr_mtrh;var mV,vV,gV,EV,bV,yV,CV={System:dV,VbrMode:_V,Float:pV,ShortBlock:fV,Util:hV,Arrays:{fill:function(e,t,n,r){if(2==arguments.length)for(var i=0;i<e.length;i++)e[i]=arguments[1];else for(i=t;i<n;i++)e[i]=r}},new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:cV,new_float_n:function e(t){if(1==t.length)return cV(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},new_int:uV,new_int_n:function e(t){if(1==t.length)return uV(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},new_short_n:function e(t){if(1==t.length)return function(e){return new Int16Array(e)}(t[0]);var n=t[0];t=t.slice(1);for(var r=[],i=0;i<n;i++)r.push(e(t));return r},assert:function(e){}};function TV(){if(EV)return gV;EV=1;var e=AV(),t=CV.System,n=CV.new_float,r=CV.new_float_n;return gV=function(){this.l=n(e.SBMAX_l),this.s=r([e.SBMAX_s,3]);var i=this;this.assign=function(n){t.arraycopy(n.l,0,i.l,0,e.SBMAX_l);for(var r=0;r<e.SBMAX_s;r++)for(var a=0;a<3;a++)i.s[r][a]=n.s[r][a]}}}function NV(e){var t=e;this.ordinal=function(){return t}}NV.STEREO=new NV(0),NV.JOINT_STEREO=new NV(1),NV.DUAL_CHANNEL=new NV(2),NV.MONO=new NV(3),NV.NOT_SET=new NV(4);var SV,IV,wV=NV;function AV(){if(IV)return SV;IV=1;var e=CV.System,t=CV.VbrMode,n=CV.new_array_n,r=CV.new_float,i=CV.new_float_n,a=CV.new_int,s=CV.assert;function o(){var l=function(){if(vV)return mV;vV=1;var e=CV.System,t=CV.Util,n=CV.Arrays,r=CV.new_float,i=AV();return mV=function(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*t.SQRT2*.5/2384e-9,.017876148*t.SQRT2*.5/2384e-9,.003134727*t.SQRT2*.5/2384e-9,.002457142*t.SQRT2*.5/2384e-9,971317e-9*t.SQRT2*.5/2384e-9,218868e-9*t.SQRT2*.5/2384e-9,101566e-9*t.SQRT2*.5/2384e-9,13828e-9*t.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=s[i.SHORT_TYPE],l=s[i.SHORT_TYPE],u=s[i.SHORT_TYPE],c=s[i.SHORT_TYPE],d=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function h(e,n,r){for(var i,s,o,l=10,u=n+238-14-286,c=-15;c<0;c++){var d,h,f;d=a[l+-10],h=e[u+-224]*d,f=e[n+224]*d,d=a[l+-9],h+=e[u+-160]*d,f+=e[n+160]*d,d=a[l+-8],h+=e[u+-96]*d,f+=e[n+96]*d,d=a[l+-7],h+=e[u+-32]*d,f+=e[n+32]*d,d=a[l+-6],h+=e[u+32]*d,f+=e[n+-32]*d,d=a[l+-5],h+=e[u+96]*d,f+=e[n+-96]*d,d=a[l+-4],h+=e[u+160]*d,f+=e[n+-160]*d,d=a[l+-3],h+=e[u+224]*d,f+=e[n+-224]*d,d=a[l+-2],h+=e[n+-256]*d,f-=e[u+256]*d,d=a[l+-1],h+=e[n+-192]*d,f-=e[u+192]*d,d=a[l+0],h+=e[n+-128]*d,f-=e[u+128]*d,d=a[l+1],h+=e[n+-64]*d,f-=e[u+64]*d,d=a[l+2],h+=e[n+0]*d,f-=e[u+0]*d,d=a[l+3],h+=e[n+64]*d,f-=e[u+-64]*d,d=a[l+4],h+=e[n+128]*d,f-=e[u+-128]*d,d=a[l+5],h+=e[n+192]*d,d=(f-=e[u+-192]*d)-(h*=a[l+6]),r[30+2*c]=f+h,r[31+2*c]=a[l+7]*d,l+=18,n--,u++}f=e[n+-16]*a[l+-10],h=e[n+-32]*a[l+-2],f+=(e[n+-48]-e[n+16])*a[l+-9],h+=e[n+-96]*a[l+-1],f+=(e[n+-80]+e[n+48])*a[l+-8],h+=e[n+-160]*a[l+0],f+=(e[n+-112]-e[n+80])*a[l+-7],h+=e[n+-224]*a[l+1],f+=(e[n+-144]+e[n+112])*a[l+-6],h-=e[n+32]*a[l+2],f+=(e[n+-176]-e[n+144])*a[l+-5],h-=e[n+96]*a[l+3],f+=(e[n+-208]+e[n+176])*a[l+-4],h-=e[n+160]*a[l+4],f+=(e[n+-240]-e[n+208])*a[l+-3],i=(h-=e[n+224])-f,s=h+f,f=r[14],h=r[15]-f,r[31]=s+f,r[30]=i+h,r[15]=i-h,r[14]=s-f,o=r[28]-r[0],r[0]+=r[28],r[28]=o*a[l+-36+7],o=r[29]-r[1],r[1]+=r[29],r[29]=o*a[l+-36+7],o=r[26]-r[2],r[2]+=r[26],r[26]=o*a[l+-72+7],o=r[27]-r[3],r[3]+=r[27],r[27]=o*a[l+-72+7],o=r[24]-r[4],r[4]+=r[24],r[24]=o*a[l+-108+7],o=r[25]-r[5],r[5]+=r[25],r[25]=o*a[l+-108+7],o=r[22]-r[6],r[6]+=r[22],r[22]=o*t.SQRT2,o=r[23]-r[7],r[7]+=r[23],r[23]=o*t.SQRT2-r[7],r[7]-=r[6],r[22]-=r[7],r[23]-=r[22],o=r[6],r[6]=r[31]-o,r[31]=r[31]+o,o=r[7],r[7]=r[30]-o,r[30]=r[30]+o,o=r[22],r[22]=r[15]-o,r[15]=r[15]+o,o=r[23],r[23]=r[14]-o,r[14]=r[14]+o,o=r[20]-r[8],r[8]+=r[20],r[20]=o*a[l+-180+7],o=r[21]-r[9],r[9]+=r[21],r[21]=o*a[l+-180+7],o=r[18]-r[10],r[10]+=r[18],r[18]=o*a[l+-216+7],o=r[19]-r[11],r[11]+=r[19],r[19]=o*a[l+-216+7],o=r[16]-r[12],r[12]+=r[16],r[16]=o*a[l+-252+7],o=r[17]-r[13],r[13]+=r[17],r[17]=o*a[l+-252+7],o=-r[20]+r[24],r[20]+=r[24],r[24]=o*a[l+-216+7],o=-r[21]+r[25],r[21]+=r[25],r[25]=o*a[l+-216+7],o=r[4]-r[8],r[4]+=r[8],r[8]=o*a[l+-216+7],o=r[5]-r[9],r[5]+=r[9],r[9]=o*a[l+-216+7],o=r[0]-r[12],r[0]+=r[12],r[12]=o*a[l+-72+7],o=r[1]-r[13],r[1]+=r[13],r[13]=o*a[l+-72+7],o=r[16]-r[28],r[16]+=r[28],r[28]=o*a[l+-72+7],o=-r[17]+r[29],r[17]+=r[29],r[29]=o*a[l+-72+7],o=t.SQRT2*(r[2]-r[10]),r[2]+=r[10],r[10]=o,o=t.SQRT2*(r[3]-r[11]),r[3]+=r[11],r[11]=o,o=t.SQRT2*(-r[18]+r[26]),r[18]+=r[26],r[26]=o-r[18],o=t.SQRT2*(-r[19]+r[27]),r[19]+=r[27],r[27]=o-r[19],o=r[2],r[19]-=r[3],r[3]-=o,r[2]=r[31]-o,r[31]+=o,o=r[3],r[11]-=r[19],r[18]-=o,r[3]=r[30]-o,r[30]+=o,o=r[18],r[27]-=r[11],r[19]-=o,r[18]=r[15]-o,r[15]+=o,o=r[19],r[10]-=o,r[19]=r[14]-o,r[14]+=o,o=r[10],r[11]-=o,r[10]=r[23]-o,r[23]+=o,o=r[11],r[26]-=o,r[11]=r[22]-o,r[22]+=o,o=r[26],r[27]-=o,r[26]=r[7]-o,r[7]+=o,o=r[27],r[27]=r[6]-o,r[6]+=o,o=t.SQRT2*(r[0]-r[4]),r[0]+=r[4],r[4]=o,o=t.SQRT2*(r[1]-r[5]),r[1]+=r[5],r[5]=o,o=t.SQRT2*(r[16]-r[20]),r[16]+=r[20],r[20]=o,o=t.SQRT2*(r[17]-r[21]),r[17]+=r[21],r[21]=o,o=-t.SQRT2*(r[8]-r[12]),r[8]+=r[12],r[12]=o-r[8],o=-t.SQRT2*(r[9]-r[13]),r[9]+=r[13],r[13]=o-r[9],o=-t.SQRT2*(r[25]-r[29]),r[25]+=r[29],r[29]=o-r[25],o=-t.SQRT2*(r[24]+r[28]),r[24]-=r[28],r[28]=o-r[24],o=r[24]-r[16],r[24]=o,o=r[20]-o,r[20]=o,o=r[28]-o,r[28]=o,o=r[25]-r[17],r[25]=o,o=r[21]-o,r[21]=o,o=r[29]-o,r[29]=o,o=r[17]-r[1],r[17]=o,o=r[9]-o,r[9]=o,o=r[25]-o,r[25]=o,o=r[5]-o,r[5]=o,o=r[21]-o,r[21]=o,o=r[13]-o,r[13]=o,o=r[29]-o,r[29]=o,o=r[1]-r[0],r[1]=o,o=r[16]-o,r[16]=o,o=r[17]-o,r[17]=o,o=r[8]-o,r[8]=o,o=r[9]-o,r[9]=o,o=r[24]-o,r[24]=o,o=r[25]-o,r[25]=o,o=r[4]-o,r[4]=o,o=r[5]-o,r[5]=o,o=r[20]-o,r[20]=o,o=r[21]-o,r[21]=o,o=r[12]-o,r[12]=o,o=r[13]-o,r[13]=o,o=r[28]-o,r[28]=o,o=r[29]-o,r[29]=o,o=r[0],r[0]+=r[31],r[31]-=o,o=r[1],r[1]+=r[30],r[30]-=o,o=r[16],r[16]+=r[15],r[15]-=o,o=r[17],r[17]+=r[14],r[14]-=o,o=r[8],r[8]+=r[23],r[23]-=o,o=r[9],r[9]+=r[22],r[22]-=o,o=r[24],r[24]+=r[7],r[7]-=o,o=r[25],r[25]+=r[6],r[6]-=o,o=r[4],r[4]+=r[27],r[27]-=o,o=r[5],r[5]+=r[26],r[26]-=o,o=r[20],r[20]+=r[11],r[11]-=o,o=r[21],r[21]+=r[10],r[10]-=o,o=r[12],r[12]+=r[19],r[19]-=o,o=r[13],r[13]+=r[18],r[18]-=o,o=r[28],r[28]+=r[3],r[3]-=o,o=r[29],r[29]+=r[2],r[2]-=o}function f(e,t){for(var n=0;n<3;n++){var r,a,o,l,u,c;a=(l=e[t+6]*s[i.SHORT_TYPE][0]-e[t+15])+(r=e[t+0]*s[i.SHORT_TYPE][2]-e[t+9]),o=l-r,u=(l=e[t+15]*s[i.SHORT_TYPE][0]+e[t+6])+(r=e[t+9]*s[i.SHORT_TYPE][2]+e[t+0]),c=-l+r,r=2069978111953089e-26*(e[t+3]*s[i.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*s[i.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*a+r,e[t+15]=190752519173728e-25*-u+l,o=.8660254037844387*o*1907525191737281e-26,u=.5*u*1907525191737281e-26+l,e[t+3]=o-u,e[t+6]=o+u,a=.5*a*1907525191737281e-26-r,c=.8660254037844387*c*1907525191737281e-26,e[t+9]=a+c,e[t+12]=a-c,t++}}this.mdct_sub48=function(t,a,p){for(var _,m,v,g,E,b,y,C,T,N,S,I,w,A,M,O,R,D,k,L,x,U=a,P=286,F=0;F<t.channels_out;F++){for(var B=0;B<t.mode_gr;B++){for(var H,G=t.l3_side.tt[B][F],j=G.xr,V=0,q=t.sb_sample[F][1-B],z=0,K=0;K<9;K++)for(h(U,P,q[z]),h(U,P+32,q[z+1]),z+=2,P+=64,H=1;H<32;H+=2)q[z-1][H]*=-1;for(H=0;H<32;H++,V+=18){var Y=G.block_type,W=t.sb_sample[F][B],Q=t.sb_sample[F][1-B];if(0!=G.mixed_block_flag&&H<2&&(Y=0),t.amp_filter[H]<1e-12)n.fill(j,V+0,V+18,0);else{if(t.amp_filter[H]<1)for(K=0;K<18;K++)Q[K][d[H]]*=t.amp_filter[H];if(Y==i.SHORT_TYPE){for(K=-3;K<0;K++){var X=s[i.SHORT_TYPE][K+3];j[V+3*K+9]=W[9+K][d[H]]*X-W[8-K][d[H]],j[V+3*K+18]=W[14-K][d[H]]*X+W[15+K][d[H]],j[V+3*K+10]=W[15+K][d[H]]*X-W[14-K][d[H]],j[V+3*K+19]=Q[2-K][d[H]]*X+Q[3+K][d[H]],j[V+3*K+11]=Q[3+K][d[H]]*X-Q[2-K][d[H]],j[V+3*K+20]=Q[8-K][d[H]]*X+Q[9+K][d[H]]}f(j,V)}else{var Z=r(18);for(K=-9;K<0;K++){var J,$;J=s[Y][K+27]*Q[K+9][d[H]]+s[Y][K+36]*Q[8-K][d[H]],$=s[Y][K+9]*W[K+9][d[H]]-s[Y][K+18]*W[8-K][d[H]],Z[K+9]=J-$*o[3+K+9],Z[K+18]=J*o[3+K+9]+$}_=j,m=V,g=void 0,E=void 0,void 0,void 0,void 0,void 0,void 0,S=void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,k=void 0,void 0,void 0,b=(v=Z)[17]-v[9],C=v[15]-v[11],T=v[14]-v[12],N=v[0]+v[8],S=v[1]+v[7],I=v[2]+v[6],w=v[3]+v[5],_[m+17]=N+I-w-(S-v[4]),E=(N+I-w)*l[19]+(S-v[4]),g=(b-C-T)*l[18],_[m+5]=g+E,_[m+6]=g-E,y=(v[16]-v[10])*l[18],S=S*l[19]+v[4],g=b*l[12]+y+C*l[13]+T*l[14],E=-N*l[16]+S-I*l[17]+w*l[15],_[m+1]=g+E,_[m+2]=g-E,g=b*l[13]-y-C*l[14]+T*l[12],E=-N*l[17]+S-I*l[15]+w*l[16],_[m+9]=g+E,_[m+10]=g-E,g=b*l[14]-y+C*l[12]-T*l[13],E=N*l[15]-S+I*l[16]-w*l[17],_[m+13]=g+E,_[m+14]=g-E,A=v[8]-v[0],O=v[6]-v[2],R=v[5]-v[3],D=v[17]+v[9],k=v[16]+v[10],L=v[15]+v[11],x=v[14]+v[12],_[m+0]=D+L+x+(k+v[13]),g=(D+L+x)*l[19]-(k+v[13]),E=(A-O+R)*l[18],_[m+11]=g+E,_[m+12]=g-E,M=(v[7]-v[1])*l[18],k=v[13]-k*l[19],g=D*l[15]-k+L*l[16]+x*l[17],E=A*l[14]+M+O*l[12]+R*l[13],_[m+3]=g+E,_[m+4]=g-E,g=-D*l[17]+k-L*l[15]-x*l[16],E=A*l[13]+M-O*l[14]-R*l[12],_[m+7]=g+E,_[m+8]=g-E,g=-D*l[16]+k-L*l[17]-x*l[15],E=A*l[12]-M+O*l[13]-R*l[14],_[m+15]=g+E,_[m+16]=g-E}}if(Y!=i.SHORT_TYPE&&0!=H)for(K=7;K>=0;--K){var ee,te;ee=j[V+K]*u[20+K]+j[V+-1-K]*c[28+K],te=j[V+K]*c[28+K]-j[V+-1-K]*u[20+K],j[V+-1-K]=ee,j[V+K]=te}}}if(U=p,P=286,1==t.mode_gr)for(var ne=0;ne<18;ne++)e.arraycopy(t.sb_sample[F][1][ne],0,t.sb_sample[F][0][ne],0,32)}}}}(),u=function(){if(yV)return bV;yV=1;var e=TV();return bV=function(){this.thm=new e,this.en=new e}}(),c=wV,d=o.FFTOFFSET,h=o.MPG_MD_MS_LR,f=null;this.psy=null;var p=null,_=null,m=null;this.setModules=function(e,t,n,r){f=e,this.psy=t,p=t,_=r,m=n};var v=new l;this.lame_encode_mp3_frame=function(l,g,E,b,y,C){var T,N=n([2,2]);N[0][0]=new u,N[0][1]=new u,N[1][0]=new u,N[1][1]=new u;var S,I=n([2,2]);I[0][0]=new u,I[0][1]=new u,I[1][0]=new u,I[1][1]=new u;var w,A,M,O=[null,null],R=l.internal_flags,D=i([2,4]),k=[.5,.5],L=[[0,0],[0,0]],x=[[0,0],[0,0]];if(O[0]=g,O[1]=E,0==R.lame_encode_frame_init&&function(e,t){var n,i,a=e.internal_flags;if(0==a.lame_encode_frame_init){var l,u,c=r(2014),d=r(2014);for(a.lame_encode_frame_init=1,l=0,u=0;l<286+576*(1+a.mode_gr);++l)l<576*a.mode_gr?(c[l]=0,2==a.channels_out&&(d[l]=0)):(c[l]=t[0][u],2==a.channels_out&&(d[l]=t[1][u]),++u);for(i=0;i<a.mode_gr;i++)for(n=0;n<a.channels_out;n++)a.l3_side.tt[i][n].block_type=o.SHORT_TYPE;v.mdct_sub48(a,c,d),s(576>=o.FFTOFFSET),s(a.mf_size>=o.BLKSIZE+e.framesize-o.FFTOFFSET),s(a.mf_size>=512+e.framesize-32)}}(l,O),R.padding=0,(R.slot_lag-=R.frac_SpF)<0&&(R.slot_lag+=l.out_samplerate,R.padding=1),0!=R.psymodel){var U=[null,null],P=0,F=a(2);for(M=0;M<R.mode_gr;M++){for(A=0;A<R.channels_out;A++)U[A]=O[A],P=576+576*M-o.FFTOFFSET;if(0!=(l.VBR==t.vbr_mtrh||l.VBR==t.vbr_mt?p.L3psycho_anal_vbr(l,U,P,M,N,I,L[M],x[M],D[M],F):p.L3psycho_anal_ns(l,U,P,M,N,I,L[M],x[M],D[M],F)))return-4;for(l.mode==c.JOINT_STEREO&&(k[M]=D[M][2]+D[M][3],k[M]>0&&(k[M]=D[M][3]/k[M])),A=0;A<R.channels_out;A++){var B=R.l3_side.tt[M][A];B.block_type=F[A],B.mixed_block_flag=0}}}else for(M=0;M<R.mode_gr;M++)for(A=0;A<R.channels_out;A++)R.l3_side.tt[M][A].block_type=o.NORM_TYPE,R.l3_side.tt[M][A].mixed_block_flag=0,x[M][A]=L[M][A]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*n+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}(R),v.mdct_sub48(R,O[0],O[1]),R.mode_ext=o.MPG_MD_LR_LR,l.force_ms)R.mode_ext=o.MPG_MD_MS_LR;else if(l.mode==c.JOINT_STEREO){var H=0,G=0;for(M=0;M<R.mode_gr;M++)for(A=0;A<R.channels_out;A++)H+=x[M][A],G+=L[M][A];if(H<=1*G){var j=R.l3_side.tt[0],V=R.l3_side.tt[R.mode_gr-1];j[0].block_type==j[1].block_type&&V[0].block_type==V[1].block_type&&(R.mode_ext=o.MPG_MD_MS_LR)}}if(R.mode_ext==h?(S=I,w=x):(S=N,w=L),l.analysis&&null!=R.pinfo)for(M=0;M<R.mode_gr;M++)for(A=0;A<R.channels_out;A++)R.pinfo.ms_ratio[M]=R.ms_ratio[M],R.pinfo.ms_ener_ratio[M]=k[M],R.pinfo.blocktype[M][A]=R.l3_side.tt[M][A].block_type,R.pinfo.pe[M][A]=w[M][A],e.arraycopy(R.l3_side.tt[M][A].xr,0,R.pinfo.xr[M][A],0,576),R.mode_ext==h&&(R.pinfo.ers[M][A]=R.pinfo.ers[M][A+2],e.arraycopy(R.pinfo.energy[M][A+2],0,R.pinfo.energy[M][A],0,R.pinfo.energy[M][A].length));if(l.VBR==t.vbr_off||l.VBR==t.vbr_abr){var q,z;for(q=0;q<18;q++)R.nsPsy.pefirbuf[q]=R.nsPsy.pefirbuf[q+1];for(z=0,M=0;M<R.mode_gr;M++)for(A=0;A<R.channels_out;A++)z+=w[M][A];for(R.nsPsy.pefirbuf[18]=z,z=R.nsPsy.pefirbuf[9],q=0;q<9;q++)z+=(R.nsPsy.pefirbuf[q]+R.nsPsy.pefirbuf[18-q])*o.fircoef[q];for(z=3350*R.mode_gr*R.channels_out/z,M=0;M<R.mode_gr;M++)for(A=0;A<R.channels_out;A++)w[M][A]*=z}if(R.iteration_loop.iteration_loop(l,w,k,S),f.format_bitstream(l),T=f.copy_buffer(R,b,y,C,1),l.bWriteVbrTag&&_.addVbrFrame(l),l.analysis&&null!=R.pinfo){for(A=0;A<R.channels_out;A++){var K;for(K=0;K<d;K++)R.pinfo.pcmdata[A][K]=R.pinfo.pcmdata[A][K+l.framesize];for(K=d;K<1600;K++)R.pinfo.pcmdata[A][K]=O[A][K-d]}m.set_frame_pinfo(l,S)}return function(e){var t,n;for(s(0<=e.bitrate_index&&e.bitrate_index<16),s(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var r=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}(R),T}}return o.ENCDELAY=576,o.POSTDELAY=1152,o.MDCTDELAY=48,o.FFTOFFSET=224+o.MDCTDELAY,o.DECDELAY=528,o.SBLIMIT=32,o.CBANDS=64,o.SBPSY_l=21,o.SBPSY_s=12,o.SBMAX_l=22,o.SBMAX_s=13,o.PSFB21=6,o.PSFB12=6,o.BLKSIZE=1024,o.HBLKSIZE=o.BLKSIZE/2+1,o.BLKSIZE_s=256,o.HBLKSIZE_s=o.BLKSIZE_s/2+1,o.NORM_TYPE=0,o.START_TYPE=1,o.SHORT_TYPE=2,o.STOP_TYPE=3,o.MPG_MD_LR_LR=0,o.MPG_MD_LR_I=1,o.MPG_MD_MS_LR=2,o.MPG_MD_MS_I=3,o.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],SV=o}var MV=CV.Util,OV=CV.new_float,RV=AV(),DV=CV.VbrMode,kV=CV.Float,LV=CV.ShortBlock,xV=CV.Util,UV=CV.Arrays,PV=CV.new_float,FV=CV.new_float_n,BV=CV.new_int,HV=CV.assert,GV=function(){var e=OV(RV.BLKSIZE),t=OV(RV.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(e,t,r){var i,a,s,o=0,l=t+(r<<=1);i=4;do{var u,c,d,h,f,p,_;_=i>>1,p=(f=i<<1)+(h=i),i=f<<1,s=(a=t)+_;do{C=e[a+0]-e[a+h],y=e[a+0]+e[a+h],I=e[a+f]-e[a+p],N=e[a+f]+e[a+p],e[a+f]=y-N,e[a+0]=y+N,e[a+p]=C-I,e[a+h]=C+I,C=e[s+0]-e[s+h],y=e[s+0]+e[s+h],I=MV.SQRT2*e[s+p],N=MV.SQRT2*e[s+f],e[s+f]=y-N,e[s+0]=y+N,e[s+p]=C-I,e[s+h]=C+I,s+=i,a+=i}while(a<l);for(c=n[o+0],u=n[o+1],d=1;d<_;d++){var m,v;m=1-2*u*u,v=2*u*c,a=t+d,s=t+h-d;do{var g,E,b,y,C,T,N,S,I,w;E=v*e[a+h]-m*e[s+h],g=m*e[a+h]+v*e[s+h],C=e[a+0]-g,y=e[a+0]+g,T=e[s+0]-E,b=e[s+0]+E,E=v*e[a+p]-m*e[s+p],g=m*e[a+p]+v*e[s+p],I=e[a+f]-g,N=e[a+f]+g,w=e[s+f]-E,S=e[s+f]+E,E=u*N-c*w,g=c*N+u*w,e[a+f]=y-g,e[a+0]=y+g,e[s+p]=T-E,e[s+h]=T+E,E=c*S-u*I,g=u*S+c*I,e[s+f]=b-g,e[s+0]=b+g,e[a+p]=C-E,e[a+h]=C+E,s+=i,a+=i}while(a<l);c=(m=c)*n[o+0]-u*n[o+1],u=m*n[o+1]+u*n[o+0]}o+=2}while(i<r)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,n,a,s,o){for(var l=0;l<3;l++){var u=RV.BLKSIZE_s/2,c=65535&192*(l+1),d=RV.BLKSIZE_s/8-1;do{var h,f,p,_,m,v=255&i[d<<2];f=(h=t[v]*s[a][o+v+c])-(m=t[127-v]*s[a][o+v+c+128]),h+=m,_=(p=t[v+64]*s[a][o+v+c+64])-(m=t[63-v]*s[a][o+v+c+192]),p+=m,u-=4,n[l][u+0]=h+p,n[l][u+2]=h-p,n[l][u+1]=f+_,n[l][u+3]=f-_,f=(h=t[v+1]*s[a][o+v+c+1])-(m=t[126-v]*s[a][o+v+c+129]),h+=m,_=(p=t[v+65]*s[a][o+v+c+65])-(m=t[62-v]*s[a][o+v+c+193]),p+=m,n[l][u+RV.BLKSIZE_s/2+0]=h+p,n[l][u+RV.BLKSIZE_s/2+2]=h-p,n[l][u+RV.BLKSIZE_s/2+1]=f+_,n[l][u+RV.BLKSIZE_s/2+3]=f-_}while(--d>=0);r(n[l],u,RV.BLKSIZE_s/2)}},this.fft_long=function(t,n,a,s,o){var l=RV.BLKSIZE/8-1,u=RV.BLKSIZE/2;do{var c,d,h,f,p,_=255&i[l];d=(c=e[_]*s[a][o+_])-(p=e[_+512]*s[a][o+_+512]),c+=p,f=(h=e[_+256]*s[a][o+_+256])-(p=e[_+768]*s[a][o+_+768]),h+=p,n[0+(u-=4)]=c+h,n[u+2]=c-h,n[u+1]=d+f,n[u+3]=d-f,d=(c=e[_+1]*s[a][o+_+1])-(p=e[_+513]*s[a][o+_+513]),c+=p,f=(h=e[_+257]*s[a][o+_+257])-(p=e[_+769]*s[a][o+_+769]),h+=p,n[u+RV.BLKSIZE/2+0]=c+h,n[u+RV.BLKSIZE/2+2]=c-h,n[u+RV.BLKSIZE/2+1]=d+f,n[u+RV.BLKSIZE/2+3]=d-f}while(--l>=0);r(n,u,RV.BLKSIZE/2)},this.init_fft=function(n){for(var r=0;r<RV.BLKSIZE;r++)e[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/RV.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/RV.BLKSIZE);for(r=0;r<RV.BLKSIZE_s/2;r++)t[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/RV.BLKSIZE_s))}},jV=AV(),VV=function(){var e=wV,t=new GV,n=2.302585092994046,r=1/217621504/(jV.BLKSIZE/2),i=21,a=.2302585093;function s(e,t){for(var n=0,i=0;i<jV.BLKSIZE/2;++i)n+=e[i]*t.ATH.eql_w[i];return n*r}function o(e,n,r,i,a,o,l,u,c,d,h){var f=e.internal_flags;if(c<2)t.fft_long(f,i[a],c,d,h),t.fft_short(f,o[l],c,d,h);else if(2==c){for(var p=jV.BLKSIZE-1;p>=0;--p){var _=i[a+0][p],m=i[a+1][p];i[a+0][p]=(_+m)*xV.SQRT2*.5,i[a+1][p]=(_-m)*xV.SQRT2*.5}for(var v=2;v>=0;--v)for(p=jV.BLKSIZE_s-1;p>=0;--p)_=o[l+0][v][p],m=o[l+1][v][p],o[l+0][v][p]=(_+m)*xV.SQRT2*.5,o[l+1][v][p]=(_-m)*xV.SQRT2*.5}for(n[0]=i[a+0][0],n[0]*=n[0],p=jV.BLKSIZE/2-1;p>=0;--p){var g=i[a+0][jV.BLKSIZE/2-p],E=i[a+0][jV.BLKSIZE/2+p];n[jV.BLKSIZE/2-p]=.5*(g*g+E*E)}for(v=2;v>=0;--v)for(r[v][0]=o[l+0][v][0],r[v][0]*=r[v][0],p=jV.BLKSIZE_s/2-1;p>=0;--p)g=o[l+0][v][jV.BLKSIZE_s/2-p],E=o[l+0][v][jV.BLKSIZE_s/2+p],r[v][jV.BLKSIZE_s/2-p]=.5*(g*g+E*E);var b=0;for(p=11;p<jV.HBLKSIZE;p++)b+=n[p];if(f.tot_ener[c]=b,e.analysis){for(p=0;p<jV.HBLKSIZE;p++)f.pinfo.energy[u][c][p]=f.pinfo.energy_save[c][p],f.pinfo.energy_save[c][p]=n[p];f.pinfo.pe[u][c]=f.pe[c]}2==e.athaa_loudapprox&&c<2&&(f.loudness_sq[u][c]=f.loudness_sq_save[c],f.loudness_sq_save[c]=s(n,f))}var l,u,c,d=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],h=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],f=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],p=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function _(e,t,n,r,i,a){var s,o,d;if(t>e){if(!(t<e*u))return e+t;s=t/e}else{if(e>=t*u)return e+t;s=e/t}if(e+=t,r+3<=6){if(s>=l)return e;var _=0|xV.FAST_LOG10_X(s,16);return e*f[_]}return _=0|xV.FAST_LOG10_X(s,16),t=i.ATH.cb_l[n]*i.ATH.adjust,e<c*t?e>t?(o=1,_<=13&&(o=p[_]),d=xV.FAST_LOG10_X(e/t,10/15),e*((h[_]-o)*d+o)):_>13?e:e*p[_]:e*h[_]}var m=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function v(e,t,n){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=n&&n<=2){if(r>=l)return e+t;var i=0|xV.FAST_LOG10_X(r,16);return(e+t)*m[i]}return r<u?e+t:(e<t&&(e=t),e)}function g(e,t,n,r,i){var a,s,o=0,l=0;for(a=s=0;a<jV.SBMAX_s;++s,++a){for(var u=e.bo_s[a],c=e.npart_s,d=u<c?u:c;s<d;)HV(t[s]>=0),HV(n[s]>=0),o+=t[s],l+=n[s],s++;if(e.en[r].s[a][i]=o,e.thm[r].s[a][i]=l,s>=c){++a;break}HV(t[s]>=0),HV(n[s]>=0);var h=e.PSY.bo_s_weight[a],f=1-h;o=h*t[s],l=h*n[s],e.en[r].s[a][i]+=o,e.thm[r].s[a][i]+=l,o=f*t[s],l=f*n[s]}for(;a<jV.SBMAX_s;++a)e.en[r].s[a][i]=0,e.thm[r].s[a][i]=0}function E(e,t,n,r){var i,a,s=0,o=0;for(i=a=0;i<jV.SBMAX_l;++a,++i){for(var l=e.bo_l[i],u=e.npart_l,c=l<u?l:u;a<c;)HV(t[a]>=0),HV(n[a]>=0),s+=t[a],o+=n[a],a++;if(e.en[r].l[i]=s,e.thm[r].l[i]=o,a>=u){++i;break}HV(t[a]>=0),HV(n[a]>=0);var d=e.PSY.bo_l_weight[i],h=1-d;s=d*t[a],o=d*n[a],e.en[r].l[i]+=s,e.thm[r].l[i]+=o,s=h*t[a],o=h*n[a]}for(;i<jV.SBMAX_l;++i)e.en[r].l[i]=0,e.thm[r].l[i]=0}function b(e,t,n,r,i,a){var s,o,l=e.internal_flags;for(o=s=0;o<l.npart_s;++o){for(var u=0,c=l.numlines_s[o],d=0;d<c;++d,++s)u+=t[a][s];n[o]=u}for(HV(o==l.npart_s),s=o=0;o<l.npart_s;o++){var h=l.s3ind_s[o][0],f=l.s3_ss[s++]*n[h];for(++h;h<=l.s3ind_s[o][1];)f+=l.s3_ss[s]*n[h],++s,++h;var p=2*l.nb_s1[i][o];if(r[o]=Math.min(f,p),l.blocktype_old[1&i]==jV.SHORT_TYPE){p=16*l.nb_s2[i][o];var _=r[o];r[o]=Math.min(p,_)}l.nb_s2[i][o]=l.nb_s1[i][o],l.nb_s1[i][o]=f,HV(r[o]>=0)}for(;o<=jV.CBANDS;++o)n[o]=0,r[o]=0}function y(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var C=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function T(e,t){for(var r=309.07,i=0;i<jV.SBMAX_s-1;i++)for(var a=0;a<3;a++){var s=e.thm.s[i][a];if(s>0){var o=s*t,l=e.en.s[i][a];l>o&&(r+=l>1e10*o?C[i]*(10*n):C[i]*xV.FAST_LOG10(l/o))}}return r}var N=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function S(e,t){for(var r=281.0575,i=0;i<jV.SBMAX_l-1;i++){var a=e.thm.l[i];if(a>0){var s=a*t,o=e.en.l[i];o>s&&(r+=o>1e10*s?N[i]*(10*n):N[i]*xV.FAST_LOG10(o/s))}}return r}function I(e,t,n,r,i){var a,s;for(a=s=0;a<e.npart_l;++a){var o,l=0,u=0;for(o=0;o<e.numlines_l[a];++o,++s){var c=t[s];l+=c,u<c&&(u=c)}n[a]=l,r[a]=u,i[a]=l*e.rnumlines_l[a],HV(e.rnumlines_l[a]>=0),HV(n[a]>=0),HV(r[a]>=0),HV(i[a]>=0)}}function w(e,t,n,r){var i=d.length-1,a=0,s=n[a]+n[a+1];for(s>0?((o=t[a])<t[a+1]&&(o=t[a+1]),HV(e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0,a=1;a<e.npart_l-1;a++){var o,l;(s=n[a-1]+n[a]+n[a+1])>0?((o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),HV(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0}HV(a==e.npart_l-1),(s=n[a-1]+n[a])>0?((o=t[a-1])<t[a]&&(o=t[a]),HV(e.numlines_l[a-1]+e.numlines_l[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]-1))))>i&&(l=i),r[a]=l):r[a]=0,HV(a==e.npart_l-1)}var A=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function M(e,n,r,i,a,s,o,l){var u=e.internal_flags;if(i<2)t.fft_long(u,o[l],i,n,r);else if(2==i)for(var c=jV.BLKSIZE-1;c>=0;--c){var d=o[l+0][c],h=o[l+1][c];o[l+0][c]=(d+h)*xV.SQRT2*.5,o[l+1][c]=(d-h)*xV.SQRT2*.5}for(s[0]=o[l+0][0],s[0]*=s[0],c=jV.BLKSIZE/2-1;c>=0;--c){var f=o[l+0][jV.BLKSIZE/2-c],p=o[l+0][jV.BLKSIZE/2+c];s[jV.BLKSIZE/2-c]=.5*(f*f+p*p)}var _=0;for(c=11;c<jV.HBLKSIZE;c++)_+=s[c];if(u.tot_ener[i]=_,e.analysis){for(c=0;c<jV.HBLKSIZE;c++)u.pinfo.energy[a][i][c]=u.pinfo.energy_save[i][c],u.pinfo.energy_save[i][c]=s[c];u.pinfo.pe[a][i]=u.pe[i]}}function O(e,n,r,i,a,s,o,l){var u=e.internal_flags;if(0==a&&i<2&&t.fft_short(u,o[l],i,n,r),2==i)for(var c=jV.BLKSIZE_s-1;c>=0;--c){var d=o[l+0][a][c],h=o[l+1][a][c];o[l+0][a][c]=(d+h)*xV.SQRT2*.5,o[l+1][a][c]=(d-h)*xV.SQRT2*.5}for(s[a][0]=o[l+0][a][0],s[a][0]*=s[a][0],c=jV.BLKSIZE_s/2-1;c>=0;--c){var f=o[l+0][a][jV.BLKSIZE_s/2-c],p=o[l+0][a][jV.BLKSIZE_s/2+c];s[a][jV.BLKSIZE_s/2-c]=.5*(f*f+p*p)}}function R(e,t,n,r){var i=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(i.loudness_sq[t][n]=i.loudness_sq_save[n],i.loudness_sq_save[n]=s(r,i))}this.L3psycho_anal_ns=function(t,n,r,a,s,l,u,c,h,f){var p,m,v,C,N,M,O,R,D,k,L=t.internal_flags,x=FV([2,jV.BLKSIZE]),U=FV([2,3,jV.BLKSIZE_s]),P=PV(jV.CBANDS+1),F=PV(jV.CBANDS+1),B=PV(jV.CBANDS+2),H=BV(2),G=BV(2),j=FV([2,576]),V=BV(jV.CBANDS+2),q=BV(jV.CBANDS+2);for(UV.fill(q,0),p=L.channels_out,t.mode==e.JOINT_STEREO&&(p=4),D=t.VBR==DV.vbr_off?0==L.ResvMax?0:L.ResvSize/L.ResvMax*.5:t.VBR==DV.vbr_rh||t.VBR==DV.vbr_mtrh||t.VBR==DV.vbr_mt?.6:1,m=0;m<L.channels_out;m++){var z=n[m],K=r+576-350-i+192;for(C=0;C<576;C++){var Y,W;for(Y=z[K+C+10],W=0,N=0;N<9;N+=2)Y+=A[N]*(z[K+C+N]+z[K+C+i-N]),W+=A[N+1]*(z[K+C+N+1]+z[K+C+i-N-1]);j[m][C]=Y+W}s[a][m].en.assign(L.en[m]),s[a][m].thm.assign(L.thm[m]),p>2&&(l[a][m].en.assign(L.en[m+2]),l[a][m].thm.assign(L.thm[m+2]))}for(m=0;m<p;m++){var Q,X=PV(12),Z=[0,0,0,0],J=PV(12),$=1,ee=PV(jV.CBANDS),te=PV(jV.CBANDS),ne=[0,0,0,0],re=PV(jV.HBLKSIZE),ie=FV([3,jV.HBLKSIZE_s]);for(HV(L.npart_s<=jV.CBANDS),HV(L.npart_l<=jV.CBANDS),C=0;C<3;C++)X[C]=L.nsPsy.last_en_subshort[m][C+6],HV(L.nsPsy.last_en_subshort[m][C+4]>0),J[C]=X[C]/L.nsPsy.last_en_subshort[m][C+4],Z[0]+=X[C];if(2==m)for(C=0;C<576;C++){var ae,se;ae=j[0][C],se=j[1][C],j[0][C]=ae+se,j[1][C]=ae-se}var oe=j[1&m],le=0;for(C=0;C<9;C++){for(var ue=le+64,ce=1;le<ue;le++)ce<Math.abs(oe[le])&&(ce=Math.abs(oe[le]));L.nsPsy.last_en_subshort[m][C]=X[C+3]=ce,Z[1+C/3]+=ce,ce>X[C+3-2]?(HV(X[C+3-2]>0),ce/=X[C+3-2]):ce=X[C+3-2]>10*ce?X[C+3-2]/(10*ce):0,J[C+3]=ce}if(t.analysis){var de=J[0];for(C=1;C<12;C++)de<J[C]&&(de=J[C]);L.pinfo.ers[a][m]=L.pinfo.ers_save[m],L.pinfo.ers_save[m]=de}for(Q=3==m?L.nsPsy.attackthre_s:L.nsPsy.attackthre,C=0;C<12;C++)0==ne[C/3]&&J[C]>Q&&(ne[C/3]=C%3+1);for(C=1;C<4;C++){var he;Z[C-1]>Z[C]?(HV(Z[C]>0),he=Z[C-1]/Z[C]):(HV(Z[C-1]>0),he=Z[C]/Z[C-1]),he<1.7&&(ne[C]=0,1==C&&(ne[0]=0))}for(0!=ne[0]&&0!=L.nsPsy.lastAttacks[m]&&(ne[0]=0),3!=L.nsPsy.lastAttacks[m]&&ne[0]+ne[1]+ne[2]+ne[3]==0||($=0,0!=ne[1]&&0!=ne[0]&&(ne[1]=0),0!=ne[2]&&0!=ne[1]&&(ne[2]=0),0!=ne[3]&&0!=ne[2]&&(ne[3]=0)),m<2?G[m]=$:0==$&&(G[0]=G[1]=0),h[m]=L.tot_ener[m],o(t,re,ie,x,1&m,U,1&m,a,m,n,r),I(L,re,P,ee,te),w(L,ee,te,V),R=0;R<3;R++){var fe,pe;for(b(t,ie,F,B,m,R),g(L,F,B,m,R),O=0;O<jV.SBMAX_s;O++){if(pe=L.thm[m].s[O][R],pe*=.8,ne[R]>=2||1==ne[R+1]){var _e=0!=R?R-1:2;ce=y(L.thm[m].s[O][_e],pe,.6*D),pe=Math.min(pe,ce)}1==ne[R]?(_e=0!=R?R-1:2,ce=y(L.thm[m].s[O][_e],pe,.3*D),pe=Math.min(pe,ce)):(0!=R&&3==ne[R-1]||0==R&&3==L.nsPsy.lastAttacks[m])&&(_e=2!=R?R+1:0,ce=y(L.thm[m].s[O][_e],pe,.3*D),pe=Math.min(pe,ce)),fe=X[3*R+3]+X[3*R+4]+X[3*R+5],6*X[3*R+5]<fe&&(pe*=.5,6*X[3*R+4]<fe&&(pe*=.5)),L.thm[m].s[O][R]=pe}}for(L.nsPsy.lastAttacks[m]=ne[2],M=0,v=0;v<L.npart_l;v++){for(var me=L.s3ind[v][0],ve=P[me]*d[V[me]],ge=L.s3_ll[M++]*ve;++me<=L.s3ind[v][1];)ve=P[me]*d[V[me]],ge=_(ge,L.s3_ll[M++]*ve,me,me-v,L);ge*=.158489319246111,L.blocktype_old[1&m]==jV.SHORT_TYPE?B[v]=ge:B[v]=y(Math.min(ge,Math.min(2*L.nb_1[m][v],16*L.nb_2[m][v])),ge,D),L.nb_2[m][v]=L.nb_1[m][v],L.nb_1[m][v]=ge}for(;v<=jV.CBANDS;++v)P[v]=0,B[v]=0;E(L,P,B,m)}for(t.mode!=e.STEREO&&t.mode!=e.JOINT_STEREO||t.interChRatio>0&&function(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var r=0;r<jV.SBMAX_l;r++){var i=n.thm[0].l[r],a=n.thm[1].l[r];n.thm[0].l[r]+=a*t,n.thm[1].l[r]+=i*t}for(r=0;r<jV.SBMAX_s;r++)for(var s=0;s<3;s++)i=n.thm[0].s[r][s],a=n.thm[1].s[r][s],n.thm[0].s[r][s]+=a*t,n.thm[1].s[r][s]+=i*t}}(t,t.interChRatio),t.mode==e.JOINT_STEREO&&(function(e){for(var t=0;t<jV.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var i=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=r,e.thm[3].l[t]=i}for(t=0;t<jV.SBMAX_s;t++)for(var a=0;a<3;a++)e.thm[0].s[t][a]>1.58*e.thm[1].s[t][a]||e.thm[1].s[t][a]>1.58*e.thm[0].s[t][a]||(n=e.mld_s[t]*e.en[3].s[t][a],r=Math.max(e.thm[2].s[t][a],Math.min(e.thm[3].s[t][a],n)),n=e.mld_s[t]*e.en[2].s[t][a],i=Math.max(e.thm[3].s[t][a],Math.min(e.thm[2].s[t][a],n)),e.thm[2].s[t][a]=r,e.thm[3].s[t][a]=i)}(L),k=t.msfix,Math.abs(k)>0&&function(e,t,n){var r=t,i=Math.pow(10,n);t*=2,r*=2;for(var a=0;a<jV.SBMAX_l;a++)c=e.ATH.cb_l[e.bm_l[a]]*i,(o=Math.min(Math.max(e.thm[0].l[a],c),Math.max(e.thm[1].l[a],c)))*t<(l=Math.max(e.thm[2].l[a],c))+(u=Math.max(e.thm[3].l[a],c))&&(l*=d=o*r/(l+u),u*=d),e.thm[2].l[a]=Math.min(l,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(u,e.thm[3].l[a]);for(i*=jV.BLKSIZE_s/jV.BLKSIZE,a=0;a<jV.SBMAX_s;a++)for(var s=0;s<3;s++){var o,l,u,c,d;c=e.ATH.cb_s[e.bm_s[a]]*i,(o=Math.min(Math.max(e.thm[0].s[a][s],c),Math.max(e.thm[1].s[a][s],c)))*t<(l=Math.max(e.thm[2].s[a][s],c))+(u=Math.max(e.thm[3].s[a][s],c))&&(l*=d=o*t/(l+u),u*=d),e.thm[2].s[a][s]=Math.min(e.thm[2].s[a][s],l),e.thm[3].s[a][s]=Math.min(e.thm[3].s[a][s],u)}}(L,k,t.ATHlower*L.ATH.adjust)),function(e,t,n,r){var i=e.internal_flags;e.short_blocks!=LV.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var a=0;a<i.channels_out;a++)r[a]=jV.NORM_TYPE,e.short_blocks==LV.short_block_dispensed&&(t[a]=1),e.short_blocks==LV.short_block_forced&&(t[a]=0),0!=t[a]?(HV(i.blocktype_old[a]!=jV.START_TYPE),i.blocktype_old[a]==jV.SHORT_TYPE&&(r[a]=jV.STOP_TYPE)):(r[a]=jV.SHORT_TYPE,i.blocktype_old[a]==jV.NORM_TYPE&&(i.blocktype_old[a]=jV.START_TYPE),i.blocktype_old[a]==jV.STOP_TYPE&&(i.blocktype_old[a]=jV.SHORT_TYPE)),n[a]=i.blocktype_old[a],i.blocktype_old[a]=r[a]}(t,G,f,H),m=0;m<p;m++){var Ee,be,ye,Ce=0;m>1?(Ee=c,Ce=-2,be=jV.NORM_TYPE,f[0]!=jV.SHORT_TYPE&&f[1]!=jV.SHORT_TYPE||(be=jV.SHORT_TYPE),ye=l[a][m-2]):(Ee=u,Ce=0,be=f[m],ye=s[a][m]),be==jV.SHORT_TYPE?Ee[Ce+m]=T(ye,L.masking_lower):Ee[Ce+m]=S(ye,L.masking_lower),t.analysis&&(L.pinfo.pe[a][m]=Ee[Ce+m])}return 0};var D=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function k(e,t,n){if(0==n)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function L(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function x(e,t,n,r,i,a){var s,o,l,u=e.internal_flags,c=new float[jV.CBANDS],h=PV(jV.CBANDS),f=new int[jV.CBANDS];for(l=o=0;l<u.npart_s;++l){var p=0,_=0,m=u.numlines_s[l];for(s=0;s<m;++s,++o){var g=t[a][o];p+=g,_<g&&(_=g)}n[l]=p,c[l]=_,h[l]=p/m,HV(h[l]>=0)}for(HV(l==u.npart_s);l<jV.CBANDS;++l)c[l]=0,h[l]=0;for(function(e,t,n,r){var i=d.length-1,a=0,s=n[a]+n[a+1];for(s>0?((o=t[a])<t[a+1]&&(o=t[a+1]),HV(e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0,a=1;a<e.npart_s-1;a++){var o,l;s=n[a-1]+n[a]+n[a+1],HV(a+1<e.npart_s),s>0?((o=t[a-1])<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),HV(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1>0),(l=0|(s=20*(3*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(l=i),r[a]=l):r[a]=0}HV(a==e.npart_s-1),(s=n[a-1]+n[a])>0?((o=t[a-1])<t[a]&&(o=t[a]),HV(e.numlines_s[a-1]+e.numlines_s[a]-1>0),(l=0|(s=20*(2*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]-1))))>i&&(l=i),r[a]=l):r[a]=0,HV(a==e.npart_s-1)}(u,c,h,f),o=l=0;l<u.npart_s;l++){var E,b,y,C,T,N=u.s3ind_s[l][0],S=u.s3ind_s[l][1];for(E=f[N],b=1,C=u.s3_ss[o]*n[N]*d[f[N]],++o,++N;N<=S;)E+=f[N],b+=1,C=v(C,y=u.s3_ss[o]*n[N]*d[f[N]],N-l),++o,++N;C*=T=.5*d[E=(1+2*E)/(2*b)],r[l]=C,u.nb_s2[i][l]=u.nb_s1[i][l],u.nb_s1[i][l]=C,y=c[l],y*=u.minval_s[l],y*=T,r[l]>y&&(r[l]=y),u.masking_lower>1&&(r[l]*=u.masking_lower),r[l]>n[l]&&(r[l]=n[l]),u.masking_lower<1&&(r[l]*=u.masking_lower),HV(r[l]>=0)}for(;l<jV.CBANDS;++l)n[l]=0,r[l]=0}function U(e,t,n,r,i){var a,s=PV(jV.CBANDS),o=PV(jV.CBANDS),l=BV(jV.CBANDS+2);I(e,t,n,s,o),w(e,s,o,l);var u=0;for(a=0;a<e.npart_l;a++){var c,h,f,p=e.s3ind[a][0],_=e.s3ind[a][1],m=0,g=0;for(m=l[p],g+=1,h=e.s3_ll[u]*n[p]*d[l[p]],++u,++p;p<=_;)m+=l[p],g+=1,h=v(h,c=e.s3_ll[u]*n[p]*d[l[p]],p-a),++u,++p;if(h*=f=.5*d[m=(1+2*m)/(2*g)],e.blocktype_old[1&i]==jV.SHORT_TYPE){var E=2*e.nb_1[i][a];r[a]=E>0?Math.min(h,E):Math.min(h,.3*n[a])}else{var b=16*e.nb_2[i][a],y=2*e.nb_1[i][a];b<=0&&(b=h),y<=0&&(y=h),E=e.blocktype_old[1&i]==jV.NORM_TYPE?Math.min(y,b):y,r[a]=Math.min(h,E)}e.nb_2[i][a]=e.nb_1[i][a],e.nb_1[i][a]=h,c=s[a],c*=e.minval_l[a],c*=f,r[a]>c&&(r[a]=c),e.masking_lower>1&&(r[a]*=e.masking_lower),r[a]>n[a]&&(r[a]=n[a]),e.masking_lower<1&&(r[a]*=e.masking_lower),HV(r[a]>=0)}for(;a<jV.CBANDS;++a)n[a]=0,r[a]=0}function P(e,t,n,r,i,a,s){for(var o,l,u=2*a,c=a>0?Math.pow(10,i):1,d=0;d<s;++d){var h=e[2][d],f=e[3][d],p=t[0][d],_=t[1][d],m=t[2][d],v=t[3][d];if(p<=1.58*_&&_<=1.58*p){var g=n[d]*f,E=n[d]*h;l=Math.max(m,Math.min(v,g)),o=Math.max(v,Math.min(m,E))}else l=m,o=v;if(a>0){var b,y,C=r[d]*c;if(b=Math.min(Math.max(p,C),Math.max(_,C)),(y=(m=Math.max(l,C))+(v=Math.max(o,C)))>0&&b*u<y){var T=b*u/y;m*=T,v*=T}l=Math.min(m,l),o=Math.min(v,o)}l>h&&(l=h),o>f&&(o=f),t[2][d]=l,t[3][d]=o}}function F(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*a)}function B(e){var t,n,r,i,a=0;for(a=0;F(a,e)>1e-20;a-=1);for(r=a,i=0;Math.abs(i-r)>1e-12;)F(a=(i+r)/2,e)>0?i=a:r=a;for(t=r,a=0,a=0;F(a,e)>1e-20;a+=1);for(r=0,i=a;Math.abs(i-r)>1e-12;)F(a=(i+r)/2,e)>0?r=a:i=a;n=i;var s,o=0,l=1e3;for(s=0;s<=l;++s)o+=F(a=t+s*(n-t)/l,e);return 1001/(o*(n-t))}function H(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function G(e,t,n,r,i,a,s,o,l,u,c,d){var h,f=PV(jV.CBANDS+1),p=o/(d>15?1152:384),_=BV(jV.HBLKSIZE);o/=l;var m=0,v=0;for(h=0;h<jV.CBANDS;h++){var g;for(w=H(o*m),f[h]=o*m,g=m;H(o*g)-w<.34&&g<=l/2;g++);for(e[h]=g-m,v=h+1;m<g;)HV(m<jV.HBLKSIZE),_[m++]=h;if(m>l/2){m=l/2,++h;break}}HV(h<jV.CBANDS),f[h]=o*m;for(var E=0;E<d;E++){var b,y,C,T,N;C=u[E],T=u[E+1],(b=0|Math.floor(.5+c*(C-.5)))<0&&(b=0),(y=0|Math.floor(.5+c*(T-.5)))>l/2&&(y=l/2),n[E]=(_[b]+_[y])/2,t[E]=_[y];var S=p*T;s[E]=(S-f[t[E]])/(f[t[E]+1]-f[t[E]]),s[E]<0?s[E]=0:s[E]>1&&(s[E]=1),N=H(o*u[E]*c),N=Math.min(N,15.5)/15.5,a[E]=Math.pow(10,1.25*(1-Math.cos(Math.PI*N))-2.5)}m=0;for(var I=0;I<v;I++){var w,A,M=e[I];w=H(o*m),A=H(o*(m+M-1)),r[I]=.5*(w+A),w=H(o*(m-.5)),A=H(o*(m+M-.5)),i[I]=A-w,m+=M}return v}function j(e,t,n,r,i,s){var o,l,u,c,d,h=FV([jV.CBANDS,jV.CBANDS]),f=0;if(s)for(var p=0;p<t;p++)for(o=0;o<t;o++){var _=(l=void 0,void 0,void 0,d=void 0,l=n[p]-n[o],u=(l*=l>=0?3:1.5)>=.5&&l<=2.5?8*((d=l-.5)*d-2*d):0,((c=15.811389+7.5*(l+=.474)-17.5*Math.sqrt(1+l*l))<=-60?0:(l=Math.exp((u+c)*a),l/=.6609193))*r[o]);h[p][o]=_*i[p]}else for(o=0;o<t;o++){var m=15+Math.min(21/n[o],12),v=B(m);for(p=0;p<t;p++)_=v*F(n[p]-n[o],m)*r[o],h[p][o]=_*i[p]}for(p=0;p<t;p++){for(o=0;o<t&&!(h[p][o]>0);o++);for(e[p][0]=o,o=t-1;o>0&&!(h[p][o]>0);o--);e[p][1]=o,f+=e[p][1]-e[p][0]+1}var g=PV(f),E=0;for(p=0;p<t;p++)for(o=e[p][0];o<=e[p][1];o++)g[E++]=h[p][o];return g}function V(e){var t=H(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function q(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(t,n,r,a,s,o,l,u,c,d){var h=t.internal_flags,f=PV(jV.HBLKSIZE),p=FV([3,jV.HBLKSIZE_s]),_=FV([2,jV.BLKSIZE]),m=FV([2,3,jV.BLKSIZE_s]),v=FV([4,jV.CBANDS]),b=FV([4,jV.CBANDS]),C=FV([4,3]),N=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],I=BV(2),w=t.mode==e.JOINT_STEREO?4:h.channels_out;!function(t,n,r,a,s,o,l,u,c,d){for(var h=FV([2,576]),f=t.internal_flags,p=f.channels_out,_=t.mode==e.JOINT_STEREO?4:p,m=0;m<p;m++){firbuf=n[m];for(var v=r+576-350-i+192,g=0;g<576;g++){var E,b;E=firbuf[v+g+10],b=0;for(var y=0;y<9;y+=2)E+=D[y]*(firbuf[v+g+y]+firbuf[v+g+i-y]),b+=D[y+1]*(firbuf[v+g+y+1]+firbuf[v+g+i-y-1]);h[m][g]=E+b}s[a][m].en.assign(f.en[m]),s[a][m].thm.assign(f.thm[m]),_>2&&(o[a][m].en.assign(f.en[m+2]),o[a][m].thm.assign(f.thm[m+2]))}for(m=0;m<_;m++){var C=PV(12),T=PV(12),N=[0,0,0,0],S=h[1&m],I=0,w=3==m?f.nsPsy.attackthre_s:f.nsPsy.attackthre,A=1;if(2==m)for(g=0,y=576;y>0;++g,--y){var M=h[0][g],O=h[1][g];h[0][g]=M+O,h[1][g]=M-O}for(g=0;g<3;g++)T[g]=f.nsPsy.last_en_subshort[m][g+6],HV(f.nsPsy.last_en_subshort[m][g+4]>0),C[g]=T[g]/f.nsPsy.last_en_subshort[m][g+4],N[0]+=T[g];for(g=0;g<9;g++){for(var R=I+64,k=1;I<R;I++)k<Math.abs(S[I])&&(k=Math.abs(S[I]));f.nsPsy.last_en_subshort[m][g]=T[g+3]=k,N[1+g/3]+=k,k>T[g+3-2]?(HV(T[g+3-2]>0),k/=T[g+3-2]):k=T[g+3-2]>10*k?T[g+3-2]/(10*k):0,C[g+3]=k}for(g=0;g<3;++g){var L=T[3*g+3]+T[3*g+4]+T[3*g+5],x=1;6*T[3*g+5]<L&&(x*=.5,6*T[3*g+4]<L&&(x*=.5)),u[m][g]=x}if(t.analysis){var U=C[0];for(g=1;g<12;g++)U<C[g]&&(U=C[g]);f.pinfo.ers[a][m]=f.pinfo.ers_save[m],f.pinfo.ers_save[m]=U}for(g=0;g<12;g++)0==c[m][g/3]&&C[g]>w&&(c[m][g/3]=g%3+1);for(g=1;g<4;g++){var P=N[g-1],F=N[g];Math.max(P,F)<4e4&&P<1.7*F&&F<1.7*P&&(1==g&&c[m][0]<=c[m][g]&&(c[m][0]=0),c[m][g]=0)}c[m][0]<=f.nsPsy.lastAttacks[m]&&(c[m][0]=0),3!=f.nsPsy.lastAttacks[m]&&c[m][0]+c[m][1]+c[m][2]+c[m][3]==0||(A=0,0!=c[m][1]&&0!=c[m][0]&&(c[m][1]=0),0!=c[m][2]&&0!=c[m][1]&&(c[m][2]=0),0!=c[m][3]&&0!=c[m][2]&&(c[m][3]=0)),m<2?d[m]=A:0==A&&(d[0]=d[1]=0),l[m]=f.tot_ener[m]}}(t,n,r,a,s,o,c,C,N,I),function(e,t){var n=e.internal_flags;e.short_blocks!=LV.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<n.channels_out;r++)e.short_blocks==LV.short_block_dispensed&&(t[r]=1),e.short_blocks==LV.short_block_forced&&(t[r]=0)}(t,I);for(var A=0;A<w;A++)M(t,n,r,A,a,f,_,B=1&A),R(t,a,A,f),0!=I[B]?U(h,f,v[A],b[A],A):L(h,A);for(I[0]+I[1]==2&&t.mode==e.JOINT_STEREO&&P(v,b,h.mld_cb_l,h.ATH.cb_l,t.ATHlower*h.ATH.adjust,t.msfix,h.npart_l),A=0;A<w;A++)0!=I[B=1&A]&&E(h,v[A],b[A],A);for(var F=0;F<3;F++){for(A=0;A<w;++A)0!=I[B=1&A]?k(h,A,F):(O(t,n,r,A,F,p,m,B),x(t,p,v[A],b[A],A,F));for(I[0]+I[1]==0&&t.mode==e.JOINT_STEREO&&P(v,b,h.mld_cb_s,h.ATH.cb_s,t.ATHlower*h.ATH.adjust,t.msfix,h.npart_s),A=0;A<w;++A)0==I[B=1&A]&&g(h,v[A],b[A],A,F)}for(A=0;A<w;A++){var B;if(0==I[B=1&A])for(var H=0;H<jV.SBMAX_s;H++){var G=PV(3);for(F=0;F<3;F++){var j=h.thm[A].s[H][F];if(j*=.8,N[A][F]>=2||1==N[A][F+1]){var V=0!=F?F-1:2,q=y(h.thm[A].s[H][V],j,.36);j=Math.min(j,q)}else 1==N[A][F]?(V=0!=F?F-1:2,q=y(h.thm[A].s[H][V],j,.18),j=Math.min(j,q)):(0!=F&&3==N[A][F-1]||0==F&&3==h.nsPsy.lastAttacks[A])&&(V=2!=F?F+1:0,q=y(h.thm[A].s[H][V],j,.18),j=Math.min(j,q));j*=C[A][F],G[F]=j}for(F=0;F<3;F++)h.thm[A].s[H][F]=G[F]}}for(A=0;A<w;A++)h.nsPsy.lastAttacks[A]=N[A][2];for(function(e,t,n){for(var r=e.internal_flags,i=0;i<r.channels_out;i++){var a=jV.NORM_TYPE;0!=t[i]?(HV(r.blocktype_old[i]!=jV.START_TYPE),r.blocktype_old[i]==jV.SHORT_TYPE&&(a=jV.STOP_TYPE)):(a=jV.SHORT_TYPE,r.blocktype_old[i]==jV.NORM_TYPE&&(r.blocktype_old[i]=jV.START_TYPE),r.blocktype_old[i]==jV.STOP_TYPE&&(r.blocktype_old[i]=jV.SHORT_TYPE)),n[i]=r.blocktype_old[i],r.blocktype_old[i]=a}}(t,I,d),A=0;A<w;A++){var z,K,Y,W;A>1?(z=u,K=-2,Y=jV.NORM_TYPE,d[0]!=jV.SHORT_TYPE&&d[1]!=jV.SHORT_TYPE||(Y=jV.SHORT_TYPE),W=o[a][A-2]):(z=l,K=0,Y=d[A],W=s[a][A]),Y==jV.SHORT_TYPE?z[K+A]=T(W,h.masking_lower):z[K+A]=S(W,h.masking_lower),t.analysis&&(h.pinfo.pe[a][A]=z[K+A])}return 0},this.psymodel_init=function(e){var r,i,a=e.internal_flags,s=!0,o=13,d=24,h=0,f=0,p=-8.25,_=-4.5,m=PV(jV.CBANDS),v=PV(jV.CBANDS),g=PV(jV.CBANDS),E=e.out_samplerate;switch(e.experimentalZ){default:case 0:s=!0;break;case 1:s=e.VBR!=DV.vbr_mtrh&&e.VBR!=DV.vbr_mt;break;case 2:s=!1;break;case 3:o=8,h=-1.75,f=-.0125,p=-8.25,_=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=jV.NORM_TYPE,r=0;r<4;++r){for(var b=0;b<jV.CBANDS;++b)a.nb_1[r][b]=1e20,a.nb_2[r][b]=1e20,a.nb_s1[r][b]=a.nb_s2[r][b]=1;for(var y=0;y<jV.SBMAX_l;y++)a.en[r].l[y]=1e20,a.thm[r].l[y]=1e20;for(b=0;b<3;++b){for(y=0;y<jV.SBMAX_s;y++)a.en[r].s[y][b]=1e20,a.thm[r].s[y][b]=1e20;a.nsPsy.lastAttacks[r]=0}for(b=0;b<9;b++)a.nsPsy.last_en_subshort[r][b]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=G(a.numlines_l,a.bo_l,a.bm_l,m,v,a.mld_l,a.PSY.bo_l_weight,E,jV.BLKSIZE,a.scalefac_band.l,jV.BLKSIZE/1152,jV.SBMAX_l),HV(a.npart_l<jV.CBANDS),r=0;r<a.npart_l;r++){var C=h;m[r]>=o&&(C=f*(m[r]-o)/(d-o)+h*(d-m[r])/(d-o)),g[r]=Math.pow(10,C/10),a.numlines_l[r]>0?a.rnumlines_l[r]=1/a.numlines_l[r]:a.rnumlines_l[r]=0}for(a.s3_ll=j(a.s3ind,a.npart_l,m,v,g,s),b=0,r=0;r<a.npart_l;r++){S=kV.MAX_VALUE;for(var T=0;T<a.numlines_l[r];T++,b++){var N=E*b/(1e3*jV.BLKSIZE);I=this.ATHformula(1e3*N,e)-20,I=Math.pow(10,.1*I),S>(I*=a.numlines_l[r])&&(S=I)}a.ATH.cb_l[r]=S,(S=20*m[r]/10-20)>6&&(S=100),S<-15&&(S=-15),S-=8,a.minval_l[r]=Math.pow(10,S/10)*a.numlines_l[r]}for(a.npart_s=G(a.numlines_s,a.bo_s,a.bm_s,m,v,a.mld_s,a.PSY.bo_s_weight,E,jV.BLKSIZE_s,a.scalefac_band.s,jV.BLKSIZE_s/384,jV.SBMAX_s),HV(a.npart_s<jV.CBANDS),b=0,r=0;r<a.npart_s;r++){var S;for(C=p,m[r]>=o&&(C=_*(m[r]-o)/(d-o)+p*(d-m[r])/(d-o)),g[r]=Math.pow(10,C/10),S=kV.MAX_VALUE,T=0;T<a.numlines_s[r];T++,b++){var I;N=E*b/(1e3*jV.BLKSIZE_s),I=this.ATHformula(1e3*N,e)-20,I=Math.pow(10,.1*I),S>(I*=a.numlines_s[r])&&(S=I)}a.ATH.cb_s[r]=S,S=7*m[r]/12-7,m[r]>12&&(S*=1+3.1*Math.log(1+S)),m[r]<12&&(S*=1+2.3*Math.log(1-S)),S<-15&&(S=-15),S-=8,a.minval_s[r]=Math.pow(10,S/10)*a.numlines_s[r]}a.s3_ss=j(a.s3ind_s,a.npart_s,m,v,g,s),l=Math.pow(10,9/16),u=Math.pow(10,1.5),c=Math.pow(10,1.5),t.init_fft(a),a.decay=Math.exp(-1*n/(.01*E/192)),i=3.5,!!(2&e.exp_nspsytune)&&(i=1),Math.abs(e.msfix)>0&&(i=e.msfix),e.msfix=i;for(var w=0;w<a.npart_l;w++)a.s3ind[w][1]>a.npart_l-1&&(a.s3ind[w][1]=a.npart_l-1);var A=576*a.mode_gr/E;if(a.ATH.decay=Math.pow(10,-1.2*A),a.ATH.adjust=.01,a.ATH.adjustLimit=1,HV(a.bo_l[jV.SBMAX_l-1]<=a.npart_l),HV(a.bo_s[jV.SBMAX_s-1]<=a.npart_s),-1!=e.ATHtype){var M=e.out_samplerate/jV.BLKSIZE,O=0;for(N=0,r=0;r<jV.BLKSIZE/2;++r)N+=M,a.ATH.eql_w[r]=1/Math.pow(10,this.ATHformula(N,e)/10),O+=a.ATH.eql_w[r];for(O=1/O,r=jV.BLKSIZE/2;--r>=0;)a.ATH.eql_w[r]*=O}for(w=b=0;w<a.npart_s;++w)for(r=0;r<a.numlines_s[w];++r)++b;for(w=b=0;w<a.npart_l;++w)for(r=0;r<a.numlines_l[w];++r)++b;for(b=0,r=0;r<a.npart_l;r++)N=E*(b+a.numlines_l[r]/2)/(1*jV.BLKSIZE),a.mld_cb_l[r]=V(N),b+=a.numlines_l[r];for(;r<jV.CBANDS;++r)a.mld_cb_l[r]=1;for(b=0,r=0;r<a.npart_s;r++)N=E*(b+a.numlines_s[r]/2)/(1*jV.BLKSIZE_s),a.mld_cb_s[r]=V(N),b+=a.numlines_s[r];for(;r<jV.CBANDS;++r)a.mld_cb_s[r]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=q(e,9);break;case 1:n=q(e,-1);break;case 2:default:n=q(e,0);break;case 3:n=q(e,1)+6;break;case 4:n=q(e,t.ATHcurve)}return n}},qV=wV,zV=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=qV.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},KV=AV(),YV={};YV.SFBMAX=3*KV.SBMAX_s;var WV=YV,QV=CV.new_float,XV=CV.new_int,ZV=WV,JV=function(){this.xr=QV(576),this.l3_enc=XV(576),this.scalefac=XV(ZV.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=XV(3),this.subblock_gain=XV(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=XV(ZV.SFBMAX),this.window=XV(ZV.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=XV(4),this.max_nonzero_coeff=0;var e=this;function t(e){return new Int32Array(e)}this.assign=function(n){var r;e.xr=(r=n.xr,new Float32Array(r)),e.l3_enc=t(n.l3_enc),e.scalefac=t(n.scalefac),e.xrpow_max=n.xrpow_max,e.part2_3_length=n.part2_3_length,e.big_values=n.big_values,e.count1=n.count1,e.global_gain=n.global_gain,e.scalefac_compress=n.scalefac_compress,e.block_type=n.block_type,e.mixed_block_flag=n.mixed_block_flag,e.table_select=t(n.table_select),e.subblock_gain=t(n.subblock_gain),e.region0_count=n.region0_count,e.region1_count=n.region1_count,e.preflag=n.preflag,e.scalefac_scale=n.scalefac_scale,e.count1table_select=n.count1table_select,e.part2_length=n.part2_length,e.sfb_lmax=n.sfb_lmax,e.sfb_smin=n.sfb_smin,e.psy_lmax=n.psy_lmax,e.sfbmax=n.sfbmax,e.psymax=n.psymax,e.sfbdivide=n.sfbdivide,e.width=t(n.width),e.window=t(n.window),e.count1bits=n.count1bits,e.sfb_partition_table=n.sfb_partition_table.slice(0),e.slen=t(n.slen),e.max_nonzero_coeff=n.max_nonzero_coeff}},$V=CV.new_int,eq=JV,tq=CV.System,nq=CV.new_int,rq=AV(),iq=function(e,t,n,r){this.l=nq(1+rq.SBMAX_l),this.s=nq(1+rq.SBMAX_s),this.psfb21=nq(1+rq.PSFB21),this.psfb12=nq(1+rq.PSFB12);var i=this.l,a=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],tq.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),tq.arraycopy(this.arrS,0,a,0,Math.min(this.arrS.length,this.s.length)),tq.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),tq.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},aq=CV.new_float,sq=CV.new_float_n,oq=CV.new_int,lq=AV(),uq=CV.new_byte,cq=CV.new_double,dq=CV.new_float,hq=CV.new_float_n,fq=CV.new_int,pq=CV.new_int_n,_q=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[$V(4),$V(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new eq},mq=iq,vq=function(){this.last_en_subshort=sq([4,9]),this.lastAttacks=oq(4),this.pefirbuf=aq(19),this.longfact=aq(lq.SBMAX_l),this.shortfact=aq(lq.SBMAX_s),this.attackthre=0,this.attackthre_s=0},gq=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},Eq=TV(),bq=AV(),yq=WV;function Cq(){function e(){this.write_timing=0,this.ptr=0,this.buf=uq(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=hq([2,Cq.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new _q,this.ms_ratio=dq(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=fq(2),this.CurrentStep=fq(2),this.masking_lower=0,this.bv_scf=fq(576),this.pseudohalf=fq(yq.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Cq.BPC+1),this.itime=cq(2),this.sideinfo_len=0,this.sb_sample=hq([2,2,18,bq.SBLIMIT]),this.amp_filter=dq(32),this.header=new Array(Cq.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new mq,this.minval_l=dq(bq.CBANDS),this.minval_s=dq(bq.CBANDS),this.nb_1=hq([4,bq.CBANDS]),this.nb_2=hq([4,bq.CBANDS]),this.nb_s1=hq([4,bq.CBANDS]),this.nb_s2=hq([4,bq.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=dq(4),this.loudness_sq=hq([2,2]),this.loudness_sq_save=dq(2),this.mld_l=dq(bq.SBMAX_l),this.mld_s=dq(bq.SBMAX_s),this.bm_l=fq(bq.SBMAX_l),this.bo_l=fq(bq.SBMAX_l),this.bm_s=fq(bq.SBMAX_s),this.bo_s=fq(bq.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=pq([bq.CBANDS,2]),this.s3ind_s=pq([bq.CBANDS,2]),this.numlines_s=fq(bq.CBANDS),this.numlines_l=fq(bq.CBANDS),this.rnumlines_l=dq(bq.CBANDS),this.mld_cb_l=dq(bq.CBANDS),this.mld_cb_s=dq(bq.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=dq(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=fq(2),this.nsPsy=new vq,this.VBR_seek_table=new gq,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=pq([16,5]),this.bitrate_blockType_Hist=pq([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new Eq;for(t=0;t<this.thm.length;t++)this.thm[t]=new Eq;for(t=0;t<this.header.length;t++)this.header[t]=new e}Cq.MFSIZE=3456+bq.ENCDELAY-bq.MDCTDELAY,Cq.MAX_HEADER_BUF=256,Cq.MAX_BITS_PER_CHANNEL=4095,Cq.MAX_BITS_PER_GRANULE=7680,Cq.BPC=320;var Tq=Cq,Nq=CV.new_float,Sq=AV(),Iq=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Nq(Sq.SBMAX_l),this.s=Nq(Sq.SBMAX_s),this.psfb21=Nq(Sq.PSFB21),this.psfb12=Nq(Sq.PSFB12),this.cb_l=Nq(Sq.CBANDS),this.cb_s=Nq(Sq.CBANDS),this.eql_w=Nq(Sq.BLKSIZE/2)},wq=CV.System,Aq=CV.Arrays;function Mq(){var e=Mq.RMS_WINDOW_TIME_NUMERATOR,t=Mq.RMS_WINDOW_TIME_DENOMINATOR,n=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],r=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function i(e,t,n,r,i,a){for(;0!=i--;)n[r]=1e-10+e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4]-n[r-3]*a[5]+e[t-3]*a[6]-n[r-4]*a[7]+e[t-4]*a[8]-n[r-5]*a[9]+e[t-5]*a[10]-n[r-6]*a[11]+e[t-6]*a[12]-n[r-7]*a[13]+e[t-7]*a[14]-n[r-8]*a[15]+e[t-8]*a[16]-n[r-9]*a[17]+e[t-9]*a[18]-n[r-10]*a[19]+e[t-10]*a[20],++r,++t}function a(e,t,n,r,i,a){for(;0!=i--;)n[r]=e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4],++r,++t}function s(e){return e*e}this.InitGainAnalysis=function(n,r){return function(n,r){for(var i=0;i<MAX_ORDER;i++)n.linprebuf[i]=n.lstepbuf[i]=n.loutbuf[i]=n.rinprebuf[i]=n.rstepbuf[i]=n.routbuf[i]=0;switch(0|r){case 48e3:n.reqindex=0;break;case 44100:n.reqindex=1;break;case 32e3:n.reqindex=2;break;case 24e3:n.reqindex=3;break;case 22050:n.reqindex=4;break;case 16e3:n.reqindex=5;break;case 12e3:n.reqindex=6;break;case 11025:n.reqindex=7;break;case 8e3:n.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return n.sampleWindow=0|(r*e+t-1)/t,n.lsum=0,n.rsum=0,n.totsamp=0,Aq.ill(n.A,0),INIT_GAIN_ANALYSIS_OK}(n,r)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(n.linpre=MAX_ORDER,n.rinpre=MAX_ORDER,n.lstep=MAX_ORDER,n.rstep=MAX_ORDER,n.lout=MAX_ORDER,n.rout=MAX_ORDER,Aq.fill(n.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,t,o,l,u,c,d){var h,f,p,_,m,v,g;if(0==c)return GAIN_ANALYSIS_OK;switch(g=0,m=c,d){case 1:l=t,u=o;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(c<MAX_ORDER?(wq.arraycopy(t,o,e.linprebuf,MAX_ORDER,c),wq.arraycopy(l,u,e.rinprebuf,MAX_ORDER,c)):(wq.arraycopy(t,o,e.linprebuf,MAX_ORDER,MAX_ORDER),wq.arraycopy(l,u,e.rinprebuf,MAX_ORDER,MAX_ORDER));m>0;){v=m>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:m,g<MAX_ORDER?(h=e.linpre+g,f=e.linprebuf,p=e.rinpre+g,_=e.rinprebuf,v>MAX_ORDER-g&&(v=MAX_ORDER-g)):(h=o+g,f=t,p=u+g,_=l),i(f,h,e.lstepbuf,e.lstep+e.totsamp,v,n[e.reqindex]),i(_,p,e.rstepbuf,e.rstep+e.totsamp,v,n[e.reqindex]),a(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,v,r[e.reqindex]),a(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,v,r[e.reqindex]),h=e.lout+e.totsamp,f=e.loutbuf,p=e.rout+e.totsamp,_=e.routbuf;for(var E=v%8;0!=E--;)e.lsum+=s(f[h++]),e.rsum+=s(_[p++]);for(E=v/8;0!=E--;)e.lsum+=s(f[h+0])+s(f[h+1])+s(f[h+2])+s(f[h+3])+s(f[h+4])+s(f[h+5])+s(f[h+6])+s(f[h+7]),h+=8,e.rsum+=s(_[p+0])+s(_[p+1])+s(_[p+2])+s(_[p+3])+s(_[p+4])+s(_[p+5])+s(_[p+6])+s(_[p+7]),p+=8;if(m-=v,g+=v,e.totsamp+=v,e.totsamp==e.sampleWindow){var b=10*Mq.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),y=b<=0?0:0|b;y>=e.A.length&&(y=e.A.length-1),e.A[y]++,e.lsum=e.rsum=0,wq.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),wq.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),wq.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),wq.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return c<MAX_ORDER?(wq.arraycopy(e.linprebuf,c,e.linprebuf,0,MAX_ORDER-c),wq.arraycopy(e.rinprebuf,c,e.rinprebuf,0,MAX_ORDER-c),wq.arraycopy(t,o,e.linprebuf,MAX_ORDER-c,c),wq.arraycopy(l,u,e.rinprebuf,MAX_ORDER-c,c)):(wq.arraycopy(t,o+c-MAX_ORDER,e.linprebuf,0,MAX_ORDER),wq.arraycopy(l,u+c-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var n,r=0;for(n=0;n<t;n++)r+=e[n];if(0==r)return GAIN_NOT_ENOUGH_SAMPLES;var i=0|Math.ceil(r*(1-.95));for(n=t;n-- >0&&!((i-=e[n])<=0););return 64.82-n/Mq.STEPS_per_dB}(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}Mq.STEPS_per_dB=100,Mq.MAX_dB=120,Mq.GAIN_NOT_ENOUGH_SAMPLES=-24601,Mq.GAIN_ANALYSIS_ERROR=0,Mq.GAIN_ANALYSIS_OK=1,Mq.INIT_GAIN_ANALYSIS_ERROR=0,Mq.INIT_GAIN_ANALYSIS_OK=1,Mq.YULE_ORDER=10,Mq.MAX_ORDER=Mq.YULE_ORDER,Mq.MAX_SAMP_FREQ=48e3,Mq.RMS_WINDOW_TIME_NUMERATOR=1,Mq.RMS_WINDOW_TIME_DENOMINATOR=20,Mq.MAX_SAMPLES_PER_WINDOW=Mq.MAX_SAMP_FREQ*Mq.RMS_WINDOW_TIME_NUMERATOR/Mq.RMS_WINDOW_TIME_DENOMINATOR+1;var Oq=Mq,Rq=CV.new_float,Dq=CV.new_int,kq=Oq,Lq=function(){this.linprebuf=Rq(2*kq.MAX_ORDER),this.linpre=0,this.lstepbuf=Rq(kq.MAX_SAMPLES_PER_WINDOW+kq.MAX_ORDER),this.lstep=0,this.loutbuf=Rq(kq.MAX_SAMPLES_PER_WINDOW+kq.MAX_ORDER),this.lout=0,this.rinprebuf=Rq(2*kq.MAX_ORDER),this.rinpre=0,this.rstepbuf=Rq(kq.MAX_SAMPLES_PER_WINDOW+kq.MAX_ORDER),this.rstep=0,this.routbuf=Rq(kq.MAX_SAMPLES_PER_WINDOW+kq.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Dq(0|kq.STEPS_per_dB*kq.MAX_dB),this.B=Dq(0|kq.STEPS_per_dB*kq.MAX_dB)},xq=function(e){this.bits=e},Uq=CV.new_float,Pq=CV.new_int,Fq=CV.assert,Bq=xq,Hq=AV(),Gq=WV,jq=Tq,Vq=function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,n,r){var i,a=e.internal_flags,s=Uq(Gq.SFBMAX),o=Uq(576),l=Pq(2),u=0,c=a.l3_side,d=new Bq(u);this.quantize.rv.ResvFrameBegin(e,d),u=d.bits;for(var h=0;h<a.mode_gr;h++){i=this.quantize.qupvt.on_pe(e,t,l,u,h,h),a.mode_ext==Hq.MPG_MD_MS_LR&&(this.quantize.ms_convert(a.l3_side,h),this.quantize.qupvt.reduce_side(l,n[h],u,i));for(var f=0;f<a.channels_out;f++){var p,_,m=c.tt[h][f];m.block_type!=Hq.SHORT_TYPE?(p=0,_=a.PSY.mask_adjust-p):(p=0,_=a.PSY.mask_adjust_short-p),a.masking_lower=Math.pow(10,.1*_),this.quantize.init_outer_loop(a,m),this.quantize.init_xrpow(a,m,o)&&(this.quantize.qupvt.calc_xmin(e,r[h][f],m,s),this.quantize.outer_loop(e,m,s,o,f,l[f])),this.quantize.iteration_finish_one(a,h,f),Fq(m.part2_3_length<=jq.MAX_BITS_PER_CHANNEL),Fq(m.part2_3_length<=l[f])}}this.quantize.rv.ResvFrameEnd(a,u)}};function qq(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}var zq={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};zq.ht=[new qq(0,0,null,null),new qq(2,0,zq.t1HB,zq.t1l),new qq(3,0,zq.t2HB,zq.t2l),new qq(3,0,zq.t3HB,zq.t3l),new qq(0,0,null,null),new qq(4,0,zq.t5HB,zq.t5l),new qq(4,0,zq.t6HB,zq.t6l),new qq(6,0,zq.t7HB,zq.t7l),new qq(6,0,zq.t8HB,zq.t8l),new qq(6,0,zq.t9HB,zq.t9l),new qq(8,0,zq.t10HB,zq.t10l),new qq(8,0,zq.t11HB,zq.t11l),new qq(8,0,zq.t12HB,zq.t12l),new qq(16,0,zq.t13HB,zq.t13l),new qq(0,0,null,zq.t16_5l),new qq(16,0,zq.t15HB,zq.t15l),new qq(1,1,zq.t16HB,zq.t16l),new qq(2,3,zq.t16HB,zq.t16l),new qq(3,7,zq.t16HB,zq.t16l),new qq(4,15,zq.t16HB,zq.t16l),new qq(6,63,zq.t16HB,zq.t16l),new qq(8,255,zq.t16HB,zq.t16l),new qq(10,1023,zq.t16HB,zq.t16l),new qq(13,8191,zq.t16HB,zq.t16l),new qq(4,15,zq.t24HB,zq.t24l),new qq(5,31,zq.t24HB,zq.t24l),new qq(6,63,zq.t24HB,zq.t24l),new qq(7,127,zq.t24HB,zq.t24l),new qq(8,255,zq.t24HB,zq.t24l),new qq(9,511,zq.t24HB,zq.t24l),new qq(11,2047,zq.t24HB,zq.t24l),new qq(13,8191,zq.t24HB,zq.t24l),new qq(0,0,zq.t32HB,zq.t32l),new qq(0,0,zq.t33HB,zq.t33l)],zq.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],zq.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],zq.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],zq.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],zq.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],zq.scfsi_band=[0,6,11,16,21];var Kq,Yq,Wq,Qq,Xq,Zq,Jq,$q,ez=zq;function tz(){if(Yq)return Kq;Yq=1;var e=iq,t=CV.VbrMode,n=CV.Float,r=CV.Util,i=CV.new_float,a=CV.new_int,s=CV.assert,o=AV(),l=xq,u=Tq;function c(){var d=rz(),h=null,f=null,p=null;this.setModules=function(e,t,n){h=e,f=t,p=n},this.IPOW20=function(e){return s(0<=e&&e<c.Q_MAX),y[e]};var _=2220446049250313e-31,m=c.IXMAX_VAL+2,v=c.Q_MAX,g=c.Q_MAX2;c.LARGE_BITS;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var E=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=E,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var b=i(v+g+1),y=i(v),C=i(m),T=i(m);function N(e,t){var n=p.ATHformula(t,e);return n-=100,Math.pow(10,n/10+e.ATHlower)}function S(e){this.s=e}this.adj43=T,this.iteration_init=function(e){var t,r=e.internal_flags,i=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,i.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,r=e.internal_flags.ATH.psfb21,i=e.internal_flags.ATH.s,a=e.internal_flags.ATH.psfb12,s=e.internal_flags,l=e.out_samplerate,u=0;u<o.SBMAX_l;u++){var c=s.scalefac_band.l[u],d=s.scalefac_band.l[u+1];t[u]=n.MAX_VALUE;for(var h=c;h<d;h++){var f=N(e,h*l/1152);t[u]=Math.min(t[u],f)}}for(u=0;u<o.PSFB21;u++)for(c=s.scalefac_band.psfb21[u],d=s.scalefac_band.psfb21[u+1],r[u]=n.MAX_VALUE,h=c;h<d;h++)f=N(e,h*l/1152),r[u]=Math.min(r[u],f);for(u=0;u<o.SBMAX_s;u++){for(c=s.scalefac_band.s[u],d=s.scalefac_band.s[u+1],i[u]=n.MAX_VALUE,h=c;h<d;h++)f=N(e,h*l/384),i[u]=Math.min(i[u],f);i[u]*=s.scalefac_band.s[u+1]-s.scalefac_band.s[u]}for(u=0;u<o.PSFB12;u++){for(c=s.scalefac_band.psfb12[u],d=s.scalefac_band.psfb12[u+1],a[u]=n.MAX_VALUE,h=c;h<d;h++)f=N(e,h*l/384),a[u]=Math.min(a[u],f);a[u]*=s.scalefac_band.s[13]-s.scalefac_band.s[12]}if(e.noATH){for(u=0;u<o.SBMAX_l;u++)t[u]=1e-20;for(u=0;u<o.PSFB21;u++)r[u]=1e-20;for(u=0;u<o.SBMAX_s;u++)i[u]=1e-20;for(u=0;u<o.PSFB12;u++)a[u]=1e-20}s.ATH.floor=10*Math.log10(N(e,-1))}(e),C[0]=0,t=1;t<m;t++)C[t]=Math.pow(t,4/3);for(t=0;t<m-1;t++)T[t]=t+1-Math.pow(.5*(C[t]+C[t+1]),.75);for(T[t]=.5,t=0;t<v;t++)y[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=v+g;t++)b[t]=Math.pow(2,.25*(t-210-g));var a,s,l,u;for(h.huffman_init(r),(t=e.exp_nspsytune>>2&63)>=32&&(t-=64),a=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>8&63)>=32&&(t-=64),s=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>14&63)>=32&&(t-=64),l=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>20&63)>=32&&(t-=64),u=l*Math.pow(10,t/4/10),t=0;t<o.SBMAX_l;t++)c=t<=6?a:t<=13?s:t<=20?l:u,r.nsPsy.longfact[t]=c;for(t=0;t<o.SBMAX_s;t++){var c;c=t<=5?a:t<=10?s:t<=11?l:u,r.nsPsy.shortfact[t]=c}}},this.on_pe=function(e,t,n,r,i,s){var o,c,d=e.internal_flags,h=0,p=a(2),_=new l(h),m=f.ResvMaxBits(e,r,_,s),v=(h=_.bits)+m;for(v>u.MAX_BITS_PER_GRANULE&&(v=u.MAX_BITS_PER_GRANULE),o=0,c=0;c<d.channels_out;++c)n[c]=Math.min(u.MAX_BITS_PER_CHANNEL,h/d.channels_out),p[c]=0|n[c]*t[i][c]/700-n[c],p[c]>3*r/4&&(p[c]=3*r/4),p[c]<0&&(p[c]=0),p[c]+n[c]>u.MAX_BITS_PER_CHANNEL&&(p[c]=Math.max(0,u.MAX_BITS_PER_CHANNEL-n[c])),o+=p[c];if(o>m)for(c=0;c<d.channels_out;++c)p[c]=m*p[c]/o;for(c=0;c<d.channels_out;++c)n[c]+=p[c],m-=p[c];for(o=0,c=0;c<d.channels_out;++c)o+=n[c];if(o>u.MAX_BITS_PER_GRANULE)for(c=0;c<d.channels_out;++c)n[c]*=u.MAX_BITS_PER_GRANULE,n[c]/=o,n[c];return v},this.reduce_side=function(e,t,n,r){s(e[0]+e[1]<=u.MAX_BITS_PER_GRANULE);var i=.33*(.5-t)/.5;i<0&&(i=0),i>.5&&(i=.5);var a=0|.5*i*(e[0]+e[1]);a>u.MAX_BITS_PER_CHANNEL-e[0]&&(a=u.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0),e[1]>=125&&(e[1]-a>125?(e[0]<n&&(e[0]+=a),e[1]-=a):(e[0]+=e[1]-125,e[1]=125)),(a=e[0]+e[1])>r&&(e[0]=r*e[0]/a,e[1]=r*e[1]/a),s(e[0]<=u.MAX_BITS_PER_CHANNEL),s(e[1]<=u.MAX_BITS_PER_CHANNEL),s(e[0]+e[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var i=90.30873362,a=r.FAST_LOG10_X(t,10),s=e*e,o=0;return a-=n,s>1e-20&&(o=1+r.FAST_LOG10_X(s,10/i)),o<0&&(o=0),a*=o,a+=n+i-94.82444863,Math.pow(10,.1*a)},this.calc_xmin=function(e,n,r,i){var a,s=0,l=e.internal_flags,u=0,c=0,h=l.ATH,f=r.xr,p=e.VBR==t.vbr_mtrh?1:0,m=l.masking_lower;for(e.VBR!=t.vbr_mtrh&&e.VBR!=t.vbr_mt||(m=1),a=0;a<r.psy_lmax;a++){N=(T=e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh?athAdjust(h.adjust,h.l[a],h.floor):h.adjust*h.l[a])/(b=r.width[a]),S=_,M=b>>1,A=0;do{A+=O=f[u]*f[u],S+=O<N?O:N,A+=R=f[++u]*f[u],S+=R<N?R:N,u++}while(--M>0);A>T&&c++,a==o.SBPSY_l&&S<(w=T*l.nsPsy.longfact[a])&&(S=w),0!=p&&(T=S),e.ATHonly||(I=n.en.l[a])>0&&(w=A*n.thm.l[a]*m/I,0!=p&&(w*=l.nsPsy.longfact[a]),T<w&&(T=w)),i[s++]=0!=p?T:T*l.nsPsy.longfact[a]}var v=575;if(r.block_type!=o.SHORT_TYPE)for(var g=576;0!=g--&&d.EQ(f[g],0);)v=g;r.max_nonzero_coeff=v;for(var E=r.sfb_smin;a<r.psymax;E++,a+=3){var b,y,C;for(C=e.VBR==t.vbr_rh||e.VBR==t.vbr_mtrh?athAdjust(h.adjust,h.s[E],h.floor):h.adjust*h.s[E],b=r.width[a],y=0;y<3;y++){var T,N,S,I,w,A=0,M=b>>1;N=C/b,S=_;do{var O,R;A+=O=f[u]*f[u],S+=O<N?O:N,A+=R=f[++u]*f[u],S+=R<N?R:N,u++}while(--M>0);A>C&&c++,E==o.SBPSY_s&&S<(w=C*l.nsPsy.shortfact[E])&&(S=w),T=0!=p?S:C,e.ATHonly||e.ATHshort||(I=n.en.s[E][y])>0&&(w=A*n.thm.s[E][y]*m/I,0!=p&&(w*=l.nsPsy.shortfact[E]),T<w&&(T=w)),i[s++]=0!=p?T:T*l.nsPsy.shortfact[E]}e.useTemporal&&(i[s-3]>i[s-3+1]&&(i[s-3+1]+=(i[s-3]-i[s-3+1])*l.decay),i[s-3+1]>i[s-3+2]&&(i[s-3+2]+=(i[s-3+1]-i[s-3+2])*l.decay))}return c},this.calc_noise_core=function(e,t,n,r){var a=0,s=t.s,o=e.l3_enc;if(s>e.count1)for(;0!=n--;)u=e.xr[s],s++,a+=u*u,u=e.xr[s],s++,a+=u*u;else if(s>e.big_values){var l=i(2);for(l[0]=0,l[1]=r;0!=n--;)u=Math.abs(e.xr[s])-l[o[s]],s++,a+=u*u,u=Math.abs(e.xr[s])-l[o[s]],s++,a+=u*u}else for(;0!=n--;){var u;u=Math.abs(e.xr[s])-C[o[s]]*r,s++,a+=u*u,u=Math.abs(e.xr[s])-C[o[s]]*r,s++,a+=u*u}return t.s=s,a},this.calc_noise=function(e,t,n,i,a){var o,l,u,d=0,h=0,f=0,p=0,_=0,m=-20,v=0,g=e.scalefac,y=0;for(i.over_SSD=0,o=0;o<e.psymax;o++){var C,T=e.global_gain-(g[y++]+(0!=e.preflag?E[o]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[o]],N=0;if(null!=a&&a.step[o]==T)N=a.noise[o],v+=e.width[o],n[d++]=N/t[h++],N=a.noise_log[o];else{var I,w=(s(0<=(u=T)+c.Q_MAX2&&u<c.Q_MAX),b[u+c.Q_MAX2]);l=e.width[o]>>1,v+e.width[o]>e.max_nonzero_coeff&&(l=(I=e.max_nonzero_coeff-v+1)>0?I>>1:0);var A=new S(v);N=this.calc_noise_core(e,A,l,w),v=A.s,null!=a&&(a.step[o]=T,a.noise[o]=N),N=n[d++]=N/t[h++],N=r.FAST_LOG10(Math.max(N,1e-20)),null!=a&&(a.noise_log[o]=N)}null!=a&&(a.global_gain=e.global_gain),_+=N,N>0&&(C=Math.max(0|10*N+.5,1),i.over_SSD+=C*C,f++,p+=N),m=Math.max(m,N)}return i.over_count=f,i.tot_noise=_,i.over_noise=p,i.max_noise=m,f},this.set_pinfo=function(e,t,n,r,a){var l,u,c,d,h,f=e.internal_flags,p=0==t.scalefac_scale?.5:1,_=t.scalefac,m=i(L3Side.SFBMAX),v=i(L3Side.SFBMAX),g=new CalcNoiseResult;calc_xmin(e,n,t,m),calc_noise(t,m,v,g,null);var b=0;for(u=t.sfb_lmax,t.block_type!=o.SHORT_TYPE&&0==t.mixed_block_flag&&(u=22),l=0;l<u;l++){var y=f.scalefac_band.l[l],C=(T=f.scalefac_band.l[l+1])-y;for(d=0;b<T;b++)d+=t.xr[b]*t.xr[b];d/=C,h=1e15,f.pinfo.en[r][a][l]=h*d,f.pinfo.xfsf[r][a][l]=h*m[l]*v[l]/C,n.en.l[l]>0&&!e.ATHonly?d/=n.en.l[l]:d=0,f.pinfo.thr[r][a][l]=h*Math.max(d*n.thm.l[l],f.ATH.l[l]),f.pinfo.LAMEsfb[r][a][l]=0,0!=t.preflag&&l>=11&&(f.pinfo.LAMEsfb[r][a][l]=-p*E[l]),l<o.SBPSY_l&&(s(_[l]>=0),f.pinfo.LAMEsfb[r][a][l]-=p*_[l])}if(t.block_type==o.SHORT_TYPE)for(u=l,l=t.sfb_smin;l<o.SBMAX_s;l++){y=f.scalefac_band.s[l],C=(T=f.scalefac_band.s[l+1])-y;for(var T,N=0;N<3;N++){for(d=0,c=y;c<T;c++)d+=t.xr[b]*t.xr[b],b++;d=Math.max(d/C,1e-20),h=1e15,f.pinfo.en_s[r][a][3*l+N]=h*d,f.pinfo.xfsf_s[r][a][3*l+N]=h*m[u]*v[u]/C,n.en.s[l][N]>0?d/=n.en.s[l][N]:d=0,(e.ATHonly||e.ATHshort)&&(d=0),f.pinfo.thr_s[r][a][3*l+N]=h*Math.max(d*n.thm.s[l][N],f.ATH.s[l]),f.pinfo.LAMEsfb_s[r][a][3*l+N]=-2*t.subblock_gain[N],l<o.SBPSY_s&&(f.pinfo.LAMEsfb_s[r][a][3*l+N]-=p*_[u]),u++}}f.pinfo.LAMEqss[r][a]=t.global_gain,f.pinfo.LAMEmainbits[r][a]=t.part2_3_length+t.part2_length,f.pinfo.LAMEsfbits[r][a]=t.part2_length,f.pinfo.over[r][a]=g.over_count,f.pinfo.max_noise[r][a]=10*g.max_noise,f.pinfo.over_noise[r][a]=10*g.over_noise,f.pinfo.tot_noise[r][a]=10*g.tot_noise,f.pinfo.over_SSD[r][a]=g.over_SSD}}return c.Q_MAX=257,c.Q_MAX2=116,c.LARGE_BITS=1e5,c.IXMAX_VAL=8206,Kq=c}function nz(){if(Qq)return Wq;Qq=1;var e=CV.System,t=CV.Arrays,n=CV.new_int,r=CV.assert,i=AV(),a=ez,s=JV,o=tz();return Wq=function l(){var u=null;function c(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,u=e};var d=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function h(e,t,n,r,i,a){var s=.5946/t;for(e>>=1;0!=e--;)i[a++]=s>n[r++]?0:1,i[a++]=s>n[r++]?0:1}function f(e,t,n,r,i,a){var s=(e>>=1)%2;for(e>>=1;0!=e--;){var o,l,c,d,h,f,p,_;o=n[r++]*t,l=n[r++]*t,h=0|o,c=n[r++]*t,f=0|l,d=n[r++]*t,p=0|c,o+=u.adj43[h],_=0|d,l+=u.adj43[f],i[a++]=0|o,c+=u.adj43[p],i[a++]=0|l,d+=u.adj43[_],i[a++]=0|c,i[a++]=0|d}0!=s&&(h=0|(o=n[r++]*t),f=0|(l=n[r++]*t),o+=u.adj43[h],l+=u.adj43[f],i[a++]=0|o,i[a++]=0|l)}var p=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function _(e,t,n,r){var i=function(e,t,n){var r=0,i=0;do{var a=e[t++],s=e[t++];r<a&&(r=a),i<s&&(i=s)}while(t<n);return r<i&&(r=i),r}(e,t,n);switch(i){case 0:return i;case 1:return function(e,t,n,r){var i=0,s=a.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,i+=s[o]}while(t<n);return r.bits+=i,1}(e,t,n,r);case 2:case 3:return function(e,t,n,r,i){var s,o,l=0,u=a.ht[r].xlen;o=2==r?a.table23:a.table56;do{var c=e[t+0]*u+e[t+1];t+=2,l+=o[c]}while(t<n);return s=65535&l,(l>>=16)>s&&(l=s,r++),i.bits+=l,r}(e,t,n,p[i-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,r,i){var s=0,o=0,l=0,u=a.ht[r].xlen,c=a.ht[r].hlen,d=a.ht[r+1].hlen,h=a.ht[r+2].hlen;do{var f=e[t+0]*u+e[t+1];t+=2,s+=c[f],o+=d[f],l+=h[f]}while(t<n);var p=r;return s>o&&(s=o,p++),s>l&&(s=l,p=r+2),i.bits+=s,p}(e,t,n,p[i-1],r);default:if(i>o.IXMAX_VAL)return r.bits=o.LARGE_BITS,-1;var s,l;for(i-=15,s=24;s<32&&!(a.ht[s].linmax>=i);s++);for(l=s-8;l<24&&!(a.ht[l].linmax>=i);l++);return function(e,t,n,r,i,s){var o,l=65536*a.ht[r].xlen+a.ht[i].xlen,u=0;do{var c=e[t++],d=e[t++];0!=c&&(c>14&&(c=15,u+=l),c*=16),0!=d&&(d>14&&(d=15,u+=l),c+=d),u+=a.largetbl[c]}while(t<n);return o=65535&u,(u>>=16)>o&&(u=o,r=i),s.bits+=u,r}(e,t,n,l,s,r)}}function m(e,t,n,r,a,s,o,l){for(var u=t.big_values,d=2;d<i.SBMAX_l+1;d++){var h=e.scalefac_band.l[d];if(h>=u)break;var f=a[d-2]+t.count1bits;if(n.part2_3_length<=f)break;var p=new c(f),m=_(r,h,u,p);f=p.bits,n.part2_3_length<=f||(n.assign(t),n.part2_3_length=f,n.region0_count=s[d-2],n.region1_count=d-2-s[d-2],n.table_select[0]=o[d-2],n.table_select[1]=l[d-2],n.table_select[2]=m)}}this.noquant_count_bits=function(e,t,n){var s=t.l3_enc,o=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=n&&(n.sfb_count1=0);o>1&&!(s[o-1]|s[o-2]);o-=2);t.count1=o;for(var l=0,u=0;o>3;o-=4){var d;if((2147483647&(s[o-1]|s[o-2]|s[o-3]|s[o-4]))>1)break;d=2*(2*(2*s[o-4]+s[o-3])+s[o-2])+s[o-1],l+=a.t32l[d],u+=a.t33l[d]}var h=l;if(t.count1table_select=0,l>u&&(h=u,t.count1table_select=1),t.count1bits=h,t.big_values=o,0==o)return h;if(t.block_type==i.SHORT_TYPE)(l=3*e.scalefac_band.s[3])>t.big_values&&(l=t.big_values),u=t.big_values;else if(t.block_type==i.NORM_TYPE){if(l=t.region0_count=e.bv_scf[o-2],u=t.region1_count=e.bv_scf[o-1],r(l+u+2<i.SBPSY_l),u=e.scalefac_band.l[l+u+2],l=e.scalefac_band.l[l+1],u<o){var f=new c(h);t.table_select[2]=_(s,u,o,f),h=f.bits}}else t.region0_count=7,t.region1_count=i.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(u=o)&&(l=u);if(l=Math.min(l,o),u=Math.min(u,o),0<l&&(f=new c(h),t.table_select[0]=_(s,0,l,f),h=f.bits),l<u&&(f=new c(h),t.table_select[1]=_(s,l,u,f),h=f.bits),2==e.use_best_huffman&&(t.part2_3_length=h,best_huffman_divide(e,t),h=t.part2_3_length),null!=n&&t.block_type==i.NORM_TYPE){for(var p=0;e.scalefac_band.l[p]<t.big_values;)p++;n.sfb_count1=p}return h},this.count_bits=function(e,n,a,s){var l=a.l3_enc,c=o.IXMAX_VAL/u.IPOW20(a.global_gain);if(a.xrpow_max>c)return o.LARGE_BITS;if(function(e,n,a,s,o){var l,c,d,p=0,_=0,m=0,v=0,g=n,E=0,b=g,y=0,C=e,T=0;for(d=null!=o&&s.global_gain==o.global_gain,c=s.block_type==i.SHORT_TYPE?38:21,l=0;l<=c;l++){var N=-1;if((d||s.block_type==i.NORM_TYPE)&&(N=s.global_gain-(s.scalefac[l]+(0!=s.preflag?u.pretab[l]:0)<<s.scalefac_scale+1)-8*s.subblock_gain[s.window[l]]),r(s.width[l]>=0),d&&o.step[l]==N)0!=_&&(f(_,a,C,T,b,y),_=0),0!=m&&(h(m,a,C,T,b,y),m=0);else{var S,I=s.width[l];if(p+s.width[l]>s.max_nonzero_coeff&&(S=s.max_nonzero_coeff-p+1,t.fill(n,s.max_nonzero_coeff,576,0),(I=S)<0&&(I=0),l=c+1),0==_&&0==m&&(b=g,y=E,C=e,T=v),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&N>=o.step[l]?(0!=_&&(f(_,a,C,T,b,y),_=0,b=g,y=E,C=e,T=v),m+=I):(0!=m&&(h(m,a,C,T,b,y),m=0,b=g,y=E,C=e,T=v),_+=I),I<=0){0!=m&&(h(m,a,C,T,b,y),m=0),0!=_&&(f(_,a,C,T,b,y),_=0);break}}l<=c&&(E+=s.width[l],v+=s.width[l],p+=s.width[l])}0!=_&&(f(_,a,C,T,b,y),_=0),0!=m&&(h(m,a,C,T,b,y),m=0)}(n,l,u.IPOW20(a.global_gain),a,s),2&e.substep_shaping)for(var d=0,p=a.global_gain+a.scalefac_scale,_=.634521682242439/u.IPOW20(p),m=0;m<a.sfbmax;m++){var v,g=a.width[m];if(0==e.pseudohalf[m])d+=g;else for(v=d,d+=g;v<d;++v)l[v]=n[v]>=_?l[v]:0}return this.noquant_count_bits(e,a,s)},this.best_huffman_divide=function(e,t){var r=new s,l=t.l3_enc,u=n(23),d=n(23),h=n(23),f=n(23);if(t.block_type!=i.SHORT_TYPE||1!=e.mode_gr){r.assign(t),t.block_type==i.NORM_TYPE&&(function(e,t,n,r,i,a,s){for(var l=t.big_values,u=0;u<=22;u++)r[u]=o.LARGE_BITS;for(u=0;u<16;u++){var d=e.scalefac_band.l[u+1];if(d>=l)break;var h=0,f=new c(h),p=_(n,0,d,f);h=f.bits;for(var m=0;m<8;m++){var v=e.scalefac_band.l[u+m+2];if(v>=l)break;var g=h,E=_(n,d,v,f=new c(g));g=f.bits,r[u+m]>g&&(r[u+m]=g,i[u+m]=u,a[u+m]=p,s[u+m]=E)}}}(e,t,l,u,d,h,f),m(e,r,t,l,u,d,h,f));var p=r.big_values;if(!(0==p||(l[p-2]|l[p-1])>1||(p=t.count1+2)>576)){r.assign(t),r.count1=p;for(var v=0,g=0;p>r.big_values;p-=4){var E=2*(2*(2*l[p-4]+l[p-3])+l[p-2])+l[p-1];v+=a.t32l[E],g+=a.t33l[E]}if(r.big_values=p,r.count1table_select=0,v>g&&(v=g,r.count1table_select=1),r.count1bits=v,r.block_type==i.NORM_TYPE)m(e,r,t,l,u,d,h,f);else{if(r.part2_3_length=v,(v=e.scalefac_band.l[8])>p&&(v=p),v>0){var b=new c(r.part2_3_length);r.table_select[0]=_(l,0,v,b),r.part2_3_length=b.bits}p>v&&(b=new c(r.part2_3_length),r.table_select[1]=_(l,v,p,b),r.part2_3_length=b.bits),t.part2_3_length>r.part2_3_length&&t.assign(r)}}}};var v=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],E=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],b=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=E,l.slen2_tab=b,this.best_scalefac_store=function(e,t,n,r){var s,o,l,c,d=r.tt[t][n],h=0;for(l=0,s=0;s<d.sfbmax;s++){var f=d.width[s];for(l+=f,c=-f;c<0&&0==d.l3_enc[c+l];c++);0==c&&(d.scalefac[s]=h=-2)}if(0==d.scalefac_scale&&0==d.preflag){var p=0;for(s=0;s<d.sfbmax;s++)d.scalefac[s]>0&&(p|=d.scalefac[s]);if(!(1&p)&&0!=p){for(s=0;s<d.sfbmax;s++)d.scalefac[s]>0&&(d.scalefac[s]>>=1);d.scalefac_scale=h=1}}if(0==d.preflag&&d.block_type!=i.SHORT_TYPE&&2==e.mode_gr){for(s=11;s<i.SBPSY_l&&!(d.scalefac[s]<u.pretab[s]&&-2!=d.scalefac[s]);s++);if(s==i.SBPSY_l){for(s=11;s<i.SBPSY_l;s++)d.scalefac[s]>0&&(d.scalefac[s]-=u.pretab[s]);d.preflag=h=1}}for(o=0;o<4;o++)r.scfsi[n][o]=0;for(2==e.mode_gr&&1==t&&r.tt[0][n].block_type!=i.SHORT_TYPE&&r.tt[1][n].block_type!=i.SHORT_TYPE&&(function(e,t){for(var n,r=t.tt[1][e],s=t.tt[0][e],o=0;o<a.scfsi_band.length-1;o++){for(n=a.scfsi_band[o];n<a.scfsi_band[o+1]&&!(s.scalefac[n]!=r.scalefac[n]&&r.scalefac[n]>=0);n++);if(n==a.scfsi_band[o+1]){for(n=a.scfsi_band[o];n<a.scfsi_band[o+1];n++)r.scalefac[n]=-1;t.scfsi[e][o]=1}}var l=0,u=0;for(n=0;n<11;n++)-1!=r.scalefac[n]&&(u++,l<r.scalefac[n]&&(l=r.scalefac[n]));for(var c=0,d=0;n<i.SBPSY_l;n++)-1!=r.scalefac[n]&&(d++,c<r.scalefac[n]&&(c=r.scalefac[n]));for(o=0;o<16;o++)if(l<v[o]&&c<g[o]){var h=E[o]*u+b[o]*d;r.part2_length>h&&(r.part2_length=h,r.scalefac_compress=o)}}(n,r),h=0),s=0;s<d.sfbmax;s++)-2==d.scalefac[s]&&(d.scalefac[s]=0);0!=h&&(2==e.mode_gr?this.scale_bitcount(d):this.scale_bitcount_lsf(e,d))};var y=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],C=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],T=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,a,s=0,l=0,c=e.scalefac;if(r(function(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}(c,e.sfbmax)),e.block_type==i.SHORT_TYPE)a=y,0!=e.mixed_block_flag&&(a=C);else if(a=T,0==e.preflag){for(n=11;n<i.SBPSY_l&&!(c[n]<u.pretab[n]);n++);if(n==i.SBPSY_l)for(e.preflag=1,n=11;n<i.SBPSY_l;n++)c[n]-=u.pretab[n]}for(n=0;n<e.sfbdivide;n++)s<c[n]&&(s=c[n]);for(;n<e.sfbmax;n++)l<c[n]&&(l=c[n]);for(e.part2_length=o.LARGE_BITS,t=0;t<16;t++)s<v[t]&&l<g[t]&&e.part2_length>a[t]&&(e.part2_length=a[t],e.scalefac_compress=t);return e.part2_length==o.LARGE_BITS};var N=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(t,a){var s,o,l,c,d,h,f,p,_=n(4),m=a.scalefac;for(s=0!=a.preflag?2:0,f=0;f<4;f++)_[f]=0;if(a.block_type==i.SHORT_TYPE){o=1;var v=u.nr_of_sfb_block[s][o];for(p=0,l=0;l<4;l++)for(c=v[l]/3,f=0;f<c;f++,p++)for(d=0;d<3;d++)m[3*p+d]>_[l]&&(_[l]=m[3*p+d])}else for(o=0,v=u.nr_of_sfb_block[s][o],p=0,l=0;l<4;l++)for(c=v[l],f=0;f<c;f++,p++)m[p]>_[l]&&(_[l]=m[p]);for(h=!1,l=0;l<4;l++)_[l]>N[s][l]&&(h=!0);if(!h){var g,E,b,y;for(a.sfb_partition_table=u.nr_of_sfb_block[s][o],l=0;l<4;l++)a.slen[l]=S[_[l]];switch(g=a.slen[0],E=a.slen[1],b=a.slen[2],y=a.slen[3],s){case 0:a.scalefac_compress=(5*g+E<<4)+(b<<2)+y;break;case 1:a.scalefac_compress=400+(5*g+E<<2)+b;break;case 2:a.scalefac_compress=500+3*g+E;break;default:e.err.printf("intensity stereo not implemented yet\n")}}if(!h)for(r(null!=a.sfb_partition_table),a.part2_length=0,l=0;l<4;l++)a.part2_length+=a.slen[l]*a.sfb_partition_table[l];return h};var S=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,r=0;e.scalefac_band.l[++r]<t;);for(n=d[r][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=d[r][0]),e.bv_scf[t-2]=n,n=d[r][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=d[r][1]),e.bv_scf[t-1]=n}}}}function rz(){if(Zq)return Xq;Zq=1;var e=CV.System,t=CV.Arrays,n=CV.new_byte,r=CV.new_float_n,i=CV.new_int,a=CV.assert,s=nz(),o=ez,l=AV(),u=Tq;function c(){var c=iz(),d=this,h=null,f=null,p=null,_=null;this.setModules=function(e,t,n,r){h=e,f=t,p=n,_=r};var m=null,v=0,g=0,E=0;function b(t,n,r){for(;r>0;){var i;0==E&&(E=8,g++,a(g<c.LAME_MAXMP3BUFFER),a(t.header[t.w_ptr].write_timing>=v),t.header[t.w_ptr].write_timing==v&&(s=t,e.arraycopy(s.header[s.w_ptr].buf,0,m,g,s.sideinfo_len),g+=s.sideinfo_len,v+=8*s.sideinfo_len,s.w_ptr=s.w_ptr+1&u.MAX_HEADER_BUF-1),m[g]=0),r-=i=Math.min(r,E),E-=i,m[g]|=n>>r<<E,v+=i}var s}function y(e,t,n){for(;n>0;){var r;0==E&&(E=8,g++,a(g<c.LAME_MAXMP3BUFFER),m[g]=0),n-=r=Math.min(n,E),E-=r,m[g]|=t>>n<<E,v+=r}}function C(e,t){var n,r=e.internal_flags;if(t>=8&&(b(r,76,8),t-=8),t>=8&&(b(r,65,8),t-=8),t>=8&&(b(r,77,8),t-=8),t>=8&&(b(r,69,8),t-=8),t>=32){var i=p.getLameShortVersion();if(t>=32)for(n=0;n<i.length&&t>=8;++n)t-=8,b(r,i.charAt(n),8)}for(;t>=1;t-=1)b(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1}function T(e,t,n){for(var r=e.header[e.h_ptr].ptr;n>0;){var i=Math.min(n,8-(7&r));n-=i,e.header[e.h_ptr].buf[r>>3]|=t>>n<<8-(7&r)-i,r+=i}e.header[e.h_ptr].ptr=r}function N(e,t){e<<=8;for(var n=0;n<8;n++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function S(e,t){var n,r=o.ht[t.count1table_select+32],i=0,s=t.big_values,l=t.big_values;for(a(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var u=0,c=0;0!=t.l3_enc[s+0]&&(c+=8,t.xr[l+0]<0&&u++),0!=t.l3_enc[s+1]&&(c+=4,u*=2,t.xr[l+1]<0&&u++),0!=t.l3_enc[s+2]&&(c+=2,u*=2,t.xr[l+2]<0&&u++),0!=t.l3_enc[s+3]&&(c++,u*=2,t.xr[l+3]<0&&u++),s+=4,l+=4,b(e,u+r.table[c],r.hlen[c]),i+=r.hlen[c]}return i}function I(e,t,n,r,i){var s=o.ht[t],l=0;if(0==t)return l;for(var u=n;u<r;u+=2){var c=0,d=0,h=s.xlen,f=s.xlen,p=0,_=i.l3_enc[u],m=i.l3_enc[u+1];if(0!=_&&(i.xr[u]<0&&p++,c--),t>15){if(_>14){var v=_-15;a(v<=s.linmax),p|=v<<1,d=h,_=15}if(m>14){var g=m-15;a(g<=s.linmax),p<<=h,p|=g,d+=h,m=15}f=16}0!=m&&(p<<=1,i.xr[u+1]<0&&p++,c--),_=_*f+m,d-=c,c+=s.hlen[_],b(e,s.table[_],c),b(e,p,d),l+=c+d}return l}function w(e,t){var n=3*e.scalefac_band.s[3];return n>t.big_values&&(n=t.big_values),I(e,t.table_select[0],0,n,t)+I(e,t.table_select[1],n,t.big_values,t)}function A(e,t){var n,r,i,s;n=t.big_values;var o=t.region0_count+1;return a(o<e.scalefac_band.l.length),i=e.scalefac_band.l[o],o+=t.region1_count+1,a(o<e.scalefac_band.l.length),i>n&&(i=n),(s=e.scalefac_band.l[o])>n&&(s=n),r=I(e,t.table_select[0],0,i,t),(r+=I(e,t.table_select[1],i,s,t))+I(e,t.table_select[2],s,n,t)}function M(){this.total=0}function O(t,n){var r,i,a,s,o,l=t.internal_flags;return o=l.w_ptr,-1==(s=l.h_ptr-1)&&(s=u.MAX_HEADER_BUF-1),r=l.header[s].write_timing-v,n.total=r,r>=0&&(i=1+s-o,s<o&&(i=1+s-o+u.MAX_HEADER_BUF),r-=8*i*l.sideinfo_len),r+=a=d.getframebits(t),n.total+=a,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=g+1,r<0&&e.err.println("strange error flushing buffer ... \n"),r}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?o.bitrate_table[e.version][n.bitrate_index]:e.brate,8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=N(255&t[2],n),n=N(255&t[3],n);for(var r=6;r<e.sideinfo_len;r++)n=N(255&t[r],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,r=e.internal_flags,i=r.h_ptr-1;if(-1==i&&(i=u.MAX_HEADER_BUF-1),t=r.l3_side,!((n=O(e,new M))<0)){if(C(e,n),a(r.header[i].write_timing+this.getframebits(e)==v),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var s=h.GetTitleGain(r.rgdata);a(NEQ(s,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),r.RadioGain=0|Math.floor(10*s+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var r,i=e.internal_flags;n-- >0;)for(y(0,t,8),r=0;r<u.MAX_HEADER_BUF;++r)i.header[r].write_timing+=8},this.format_bitstream=function(n){var r,i=n.internal_flags;r=i.l3_side;var o=this.getframebits(n);C(n,r.resvDrain_pre),function(n,r){var i,s,o,c=n.internal_flags;if(i=c.l3_side,c.header[c.h_ptr].ptr=0,t.fill(c.header[c.h_ptr].buf,0,c.sideinfo_len,0),n.out_samplerate<16e3?T(c,4094,12):T(c,4095,12),T(c,n.version,1),T(c,1,2),T(c,n.error_protection?0:1,1),T(c,c.bitrate_index,4),T(c,c.samplerate_index,2),T(c,c.padding,1),T(c,n.extension,1),T(c,n.mode.ordinal(),2),T(c,c.mode_ext,2),T(c,n.copyright,1),T(c,n.original,1),T(c,n.emphasis,2),n.error_protection&&T(c,0,16),1==n.version){for(a(i.main_data_begin>=0),T(c,i.main_data_begin,9),2==c.channels_out?T(c,i.private_bits,3):T(c,i.private_bits,5),o=0;o<c.channels_out;o++){var d;for(d=0;d<4;d++)T(c,i.scfsi[o][d],1)}for(s=0;s<2;s++)for(o=0;o<c.channels_out;o++)T(c,(h=i.tt[s][o]).part2_3_length+h.part2_length,12),T(c,h.big_values/2,9),T(c,h.global_gain,8),T(c,h.scalefac_compress,4),h.block_type!=l.NORM_TYPE?(T(c,1,1),T(c,h.block_type,2),T(c,h.mixed_block_flag,1),14==h.table_select[0]&&(h.table_select[0]=16),T(c,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),T(c,h.table_select[1],5),T(c,h.subblock_gain[0],3),T(c,h.subblock_gain[1],3),T(c,h.subblock_gain[2],3)):(T(c,0,1),14==h.table_select[0]&&(h.table_select[0]=16),T(c,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),T(c,h.table_select[1],5),14==h.table_select[2]&&(h.table_select[2]=16),T(c,h.table_select[2],5),a(0<=h.region0_count&&h.region0_count<16),a(0<=h.region1_count&&h.region1_count<8),T(c,h.region0_count,4),T(c,h.region1_count,3)),T(c,h.preflag,1),T(c,h.scalefac_scale,1),T(c,h.count1table_select,1)}else for(a(i.main_data_begin>=0),T(c,i.main_data_begin,8),T(c,i.private_bits,c.channels_out),s=0,o=0;o<c.channels_out;o++){var h;T(c,(h=i.tt[s][o]).part2_3_length+h.part2_length,12),T(c,h.big_values/2,9),T(c,h.global_gain,8),T(c,h.scalefac_compress,9),h.block_type!=l.NORM_TYPE?(T(c,1,1),T(c,h.block_type,2),T(c,h.mixed_block_flag,1),14==h.table_select[0]&&(h.table_select[0]=16),T(c,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),T(c,h.table_select[1],5),T(c,h.subblock_gain[0],3),T(c,h.subblock_gain[1],3),T(c,h.subblock_gain[2],3)):(T(c,0,1),14==h.table_select[0]&&(h.table_select[0]=16),T(c,h.table_select[0],5),14==h.table_select[1]&&(h.table_select[1]=16),T(c,h.table_select[1],5),14==h.table_select[2]&&(h.table_select[2]=16),T(c,h.table_select[2],5),a(0<=h.region0_count&&h.region0_count<16),a(0<=h.region1_count&&h.region1_count<8),T(c,h.region0_count,4),T(c,h.region1_count,3)),T(c,h.scalefac_scale,1),T(c,h.count1table_select,1)}n.error_protection&&CRC_writeheader(c,c.header[c.h_ptr].buf);var f=c.h_ptr;a(c.header[f].ptr==8*c.sideinfo_len),c.h_ptr=f+1&u.MAX_HEADER_BUF-1,c.header[c.h_ptr].write_timing=c.header[f].write_timing+r,c.h_ptr==c.w_ptr&&e.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(n,o);var c=8*i.sideinfo_len;if(c+=function(e){var t,n,r,i,o=0,u=e.internal_flags,c=u.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<u.channels_out;n++){var d=c.tt[t][n],h=s.slen1_tab[d.scalefac_compress],f=s.slen2_tab[d.scalefac_compress];for(i=0,r=0;r<d.sfbdivide;r++)-1!=d.scalefac[r]&&(b(u,d.scalefac[r],h),i+=h);for(;r<d.sfbmax;r++)-1!=d.scalefac[r]&&(b(u,d.scalefac[r],f),i+=f);a(i==d.part2_length),d.block_type==l.SHORT_TYPE?i+=w(u,d):i+=A(u,d),i+=S(u,d),a(i==d.part2_3_length+d.part2_length),o+=i}else for(t=0,n=0;n<u.channels_out;n++){d=c.tt[t][n];var p,_,m=0;if(a(null!=d.sfb_partition_table),i=0,r=0,_=0,d.block_type==l.SHORT_TYPE){for(;_<4;_++){var v=d.sfb_partition_table[_]/3,g=d.slen[_];for(p=0;p<v;p++,r++)b(u,Math.max(d.scalefac[3*r+0],0),g),b(u,Math.max(d.scalefac[3*r+1],0),g),b(u,Math.max(d.scalefac[3*r+2],0),g),m+=3*g}i+=w(u,d)}else{for(;_<4;_++)for(v=d.sfb_partition_table[_],g=d.slen[_],p=0;p<v;p++,r++)b(u,Math.max(d.scalefac[r],0),g),m+=g;i+=A(u,d)}i+=S(u,d),a(i==d.part2_3_length),a(m==d.part2_length),o+=m+i}return o}(n),C(n,r.resvDrain_post),c+=r.resvDrain_post,r.main_data_begin+=(o-c)/8,O(n,new M)!=i.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*r.main_data_begin!=i.ResvSize&&(e.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*r.main_data_begin,i.ResvSize,r.resvDrain_post,r.resvDrain_pre,8*i.sideinfo_len,c-r.resvDrain_post-8*i.sideinfo_len,c,c%8,o),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),i.ResvSize=8*r.main_data_begin),v>1e9){var d;for(d=0;d<u.MAX_HEADER_BUF;++d)i.header[d].write_timing-=v;v=0}return 0},this.copy_buffer=function(t,n,a,s,o){var l=g+1;if(l<=0)return 0;if(0!=s&&l>s)return-1;if(e.arraycopy(m,0,n,a,l),g=-1,E=0,0!=o){var u=i(1);if(u[0]=t.nMusicCRC,_.updateMusicCRC(u,n,a,l),t.nMusicCRC=u[0],l>0&&(t.VBR_seek_table.nBytesWritten+=l),t.decode_on_the_fly)for(var c,d=r([2,1152]),p=l,v=-1;0!=v;)if(v=f.hip_decode1_unclipped(t.hip,n,a,p,d[0],d[1]),p=0,-1==v&&(v=0),v>0){if(t.findPeakSample){for(c=0;c<v;c++)d[0][c]>t.PeakSample?t.PeakSample=d[0][c]:-d[0][c]>t.PeakSample&&(t.PeakSample=-d[0][c]);if(t.channels_out>1)for(c=0;c<v;c++)d[1][c]>t.PeakSample?t.PeakSample=d[1][c]:-d[1][c]>t.PeakSample&&(t.PeakSample=-d[1][c])}if(t.findReplayGain&&h.AnalyzeSamples(t.rgdata,d[0],0,d[1],0,v,t.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return l},this.init_bit_stream_w=function(e){m=n(c.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,g=-1,E=0,v=0}}return c.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},c.NEQ=function(e,t){return!c.EQ(e,t)},Xq=c}function iz(){if($q)return Jq;$q=1;var e=CV.System,t=CV.VbrMode,n=CV.ShortBlock,r=CV.new_float,i=CV.new_int_n,a=CV.new_short_n,s=CV.assert,o=VV,l=zV,u=Tq,c=Iq,d=Lq,h=Vq,f=rz(),p=ez,_=AV();return Jq=function m(){var v,g,E,b,y,C=wV,T=this;m.V9=410,m.V8=420,m.V7=430,m.V6=440,m.V5=450,m.V4=460,m.V3=470,m.V2=480,m.V1=490,m.V0=500,m.R3MIX=1e3,m.STANDARD=1001,m.EXTREME=1002,m.INSANE=1003,m.STANDARD_FAST=1004,m.EXTREME_FAST=1005,m.MEDIUM=1006,m.MEDIUM_FAST=1007,m.LAME_MAXMP3BUFFER=147456;var N,S,I,w=new o;function A(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=r(_.SBMAX_l),this.bo_s_weight=r(_.SBMAX_s)}function M(){this.lowerlimit=0}function O(e,t){this.lowpass=t}this.enc=new _,this.setModules=function(e,t,n,r,i,a,s,o,l){v=e,g=t,E=n,b=r,y=i,N=a,S=o,I=l,this.enc.setModules(g,w,b,N)};var R=4294479419;function D(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function k(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function L(e,t,n){n<16e3&&(t=2);for(var r=p.bitrate_table[t][1],i=2;i<=14;i++)p.bitrate_table[t][i]>0&&Math.abs(p.bitrate_table[t][i]-e)<Math.abs(r-e)&&(r=p.bitrate_table[t][i]);return r}function x(e,t,n){n<16e3&&(t=2);for(var r=0;r<=14;r++)if(p.bitrate_table[t][r]>0&&p.bitrate_table[t][r]==e)return r;return-1}function U(e,t){var n=[new O(8,2e3),new O(16,3700),new O(24,3900),new O(32,5500),new O(40,7e3),new O(48,7500),new O(56,1e4),new O(64,11e3),new O(80,13500),new O(96,15100),new O(112,15600),new O(128,17e3),new O(160,17500),new O(192,18600),new O(224,19400),new O(256,19700),new O(320,20500)],r=T.nearestBitrateFullIndex(t);e.lowerlimit=n[r].lowpass}function P(e){var t=_.BLKSIZE+e.framesize-_.FFTOFFSET;return Math.max(t,512+e.framesize-32)}function F(e,t,n,r,i,a){var s=T.enc.lame_encode_mp3_frame(e,t,n,r,i,a);return e.frameNum++,s}function B(){this.n_in=0,this.n_out=0}function H(){this.num_used=0}function G(e,t){return 0!=t?G(t,e%t):e}function j(e,t,n){var r=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var i=e-.5,a=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(i)<1e-9?r/Math.PI:a*Math.sin(n*r*i)/(Math.PI*n*i)}function V(e,t,n,i,a,o,l,c,d){var h,f,p=e.internal_flags,_=0,m=e.out_samplerate/G(e.out_samplerate,e.in_samplerate);m>u.BPC&&(m=u.BPC);var v=Math.abs(p.resample_ratio-Math.floor(.5+p.resample_ratio))<1e-4?1:0,g=1/p.resample_ratio;g>1&&(g=1);var E=31;0==E%2&&--E;var b=(E+=v)+1;if(0==p.fill_buffer_resample_init){for(p.inbuf_old[0]=r(b),p.inbuf_old[1]=r(b),h=0;h<=2*m;++h)p.blackfilt[h]=r(b);for(p.itime[0]=0,p.itime[1]=0,_=0;_<=2*m;_++){var y=0,C=(_-m)/(2*m);for(h=0;h<=E;h++)y+=p.blackfilt[_][h]=j(h-C,g,E);for(h=0;h<=E;h++)p.blackfilt[_][h]/=y}p.fill_buffer_resample_init=1}var T=p.inbuf_old[d];for(f=0;f<i;f++){var N,S;if(N=f*p.resample_ratio,E+(_=0|Math.floor(N-p.itime[d]))-E/2>=l)break;C=N-p.itime[d]-(_+E%2*.5),S=0|Math.floor(2*C*m+m+.5);var I=0;for(h=0;h<=E;++h){var w=0|h+_-E/2;I+=(w<0?T[b+w]:a[o+w])*p.blackfilt[S][h]}t[n+f]=I}if(c.num_used=Math.min(l,E+_-E/2),p.itime[d]+=c.num_used-f*p.resample_ratio,c.num_used>=b)for(h=0;h<b;h++)T[h]=a[o+c.num_used+h-b];else{var A=b-c.num_used;for(h=0;h<A;++h)T[h]=T[h+c.num_used];for(_=0;h<b;++h,++_)T[h]=a[o+_];s(_==c.num_used)}return f}function q(e,t,n,r,i,a){var s=e.internal_flags;if(s.resample_ratio<.9999||s.resample_ratio>1.0001)for(var o=0;o<s.channels_out;o++){var l=new H;a.n_out=V(e,t[o],s.mf_size,e.framesize,n[o],r,i,l,o),a.n_in=l.num_used}else{a.n_out=Math.min(e.framesize,i),a.n_in=a.n_out;for(var u=0;u<a.n_out;++u)t[0][s.mf_size+u]=n[0][r+u],2==s.channels_out&&(t[1][s.mf_size+u]=n[1][r+u])}}this.lame_init=function(){var e,n,r=new l;return(e=r).class_id=R,n=e.internal_flags=new u,e.mode=C.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,n.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=t.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,n.VBR_min_bitrate=1,n.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,n.resample_ratio=1,n.OldValue[0]=180,n.OldValue[1]=180,n.CurrentStep[0]=4,n.CurrentStep[1]=4,n.masking_lower=1,n.nsPsy.attackthre=-1,n.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,n.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY,e.encoder_padding=0,n.mf_size=_.ENCDELAY-_.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,n.decode_on_the_fly=!1,n.findReplayGain=!1,n.findPeakSample=!1,n.RadioGain=0,n.AudiophileGain=0,n.noclipGainChange=0,n.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,r.lame_allocated_gfp=1,r},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,r=0,i=0,a=0;a=t[16],i=16,r=t[16],n=16;for(var s=0;s<16;s++)if(Math.max(e,t[s+1])!=e){a=t[s+1],i=s+1,r=t[s],n=s;break}return a-e>e-r?n:i},this.lame_init_params=function(r){var a,l,u,m,T,O=r.internal_flags;if(O.Class_ID=0,null==O.ATH&&(O.ATH=new c),null==O.PSY&&(O.PSY=new A),null==O.rgdata&&(O.rgdata=new d),O.channels_in=r.num_channels,1==O.channels_in&&(r.mode=C.MONO),O.channels_out=r.mode==C.MONO?1:2,O.mode_ext=_.MPG_MD_MS_LR,r.mode==C.MONO&&(r.force_ms=!1),r.VBR==t.vbr_off&&128!=r.VBR_mean_bitrate_kbps&&0==r.brate&&(r.brate=r.VBR_mean_bitrate_kbps),r.VBR==t.vbr_off||r.VBR==t.vbr_mtrh||r.VBR==t.vbr_mt||(r.free_format=!1),r.VBR==t.vbr_off&&0==r.brate&&f.EQ(r.compression_ratio,0)&&(r.compression_ratio=11.025),r.VBR==t.vbr_off&&r.compression_ratio>0&&(0==r.out_samplerate&&(r.out_samplerate=map2MP3Frequency(int(.97*r.in_samplerate))),r.brate=0|16*r.out_samplerate*O.channels_out/(1e3*r.compression_ratio),O.samplerate_index=k(r.out_samplerate,r),r.free_format||(r.brate=L(r.brate,r.version,r.out_samplerate))),0!=r.out_samplerate&&(r.out_samplerate<16e3?(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,64)):r.out_samplerate<32e3?(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,8),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,160)):(r.VBR_mean_bitrate_kbps=Math.max(r.VBR_mean_bitrate_kbps,32),r.VBR_mean_bitrate_kbps=Math.min(r.VBR_mean_bitrate_kbps,320))),0==r.lowpassfreq){var P=16e3;switch(r.VBR){case t.vbr_off:U(F=new M,r.brate),P=F.lowerlimit;break;case t.vbr_abr:var F;U(F=new M,r.VBR_mean_bitrate_kbps),P=F.lowerlimit;break;case t.vbr_rh:var B=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=r.VBR_q&&r.VBR_q<=9){var H=B[r.VBR_q],G=B[r.VBR_q+1],j=r.VBR_q_frac;P=linear_int(H,G,j)}else P=19500;break;default:B=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950],0<=r.VBR_q&&r.VBR_q<=9?(H=B[r.VBR_q],G=B[r.VBR_q+1],j=r.VBR_q_frac,P=linear_int(H,G,j)):P=19500}r.mode!=C.MONO||r.VBR!=t.vbr_off&&r.VBR!=t.vbr_abr||(P*=1.5),r.lowpassfreq=0|P}if(0==r.out_samplerate&&(2*r.lowpassfreq>r.in_samplerate&&(r.lowpassfreq=r.in_samplerate/2),r.out_samplerate=(a=0|r.lowpassfreq,u=44100,(l=r.in_samplerate)>=48e3?u=48e3:l>=44100?u=44100:l>=32e3?u=32e3:l>=24e3?u=24e3:l>=22050?u=22050:l>=16e3?u=16e3:l>=12e3?u=12e3:l>=11025?u=11025:l>=8e3&&(u=8e3),-1==a?u:(a<=15960&&(u=44100),a<=15250&&(u=32e3),a<=11220&&(u=24e3),a<=9970&&(u=22050),a<=7230&&(u=16e3),a<=5420&&(u=12e3),a<=4510&&(u=11025),a<=3970&&(u=8e3),l<u?l>44100?48e3:l>32e3?44100:l>24e3?32e3:l>22050?24e3:l>16e3?22050:l>12e3?16e3:l>11025?12e3:l>8e3?11025:8e3:u))),r.lowpassfreq=Math.min(20500,r.lowpassfreq),r.lowpassfreq=Math.min(r.out_samplerate/2,r.lowpassfreq),r.VBR==t.vbr_off&&(r.compression_ratio=16*r.out_samplerate*O.channels_out/(1e3*r.brate)),r.VBR==t.vbr_abr&&(r.compression_ratio=16*r.out_samplerate*O.channels_out/(1e3*r.VBR_mean_bitrate_kbps)),r.bWriteVbrTag||(r.findReplayGain=!1,r.decode_on_the_fly=!1,O.findPeakSample=!1),O.findReplayGain=r.findReplayGain,O.decode_on_the_fly=r.decode_on_the_fly,O.decode_on_the_fly&&(O.findPeakSample=!0),O.findReplayGain&&v.InitGainAnalysis(O.rgdata,r.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return r.internal_flags=null,-6;switch(O.decode_on_the_fly&&!r.decode_only&&(null!=O.hip&&I.hip_decode_exit(O.hip),O.hip=I.hip_decode_init()),O.mode_gr=r.out_samplerate<=24e3?1:2,r.framesize=576*O.mode_gr,r.encoder_delay=_.ENCDELAY,O.resample_ratio=r.in_samplerate/r.out_samplerate,r.VBR){case t.vbr_mt:case t.vbr_rh:case t.vbr_mtrh:r.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][r.VBR_q];break;case t.vbr_abr:r.compression_ratio=16*r.out_samplerate*O.channels_out/(1e3*r.VBR_mean_bitrate_kbps);break;default:r.compression_ratio=16*r.out_samplerate*O.channels_out/(1e3*r.brate)}if(r.mode==C.NOT_SET&&(r.mode=C.JOINT_STEREO),r.highpassfreq>0?(O.highpass1=2*r.highpassfreq,r.highpasswidth>=0?O.highpass2=2*(r.highpassfreq+r.highpasswidth):O.highpass2=2*r.highpassfreq,O.highpass1/=r.out_samplerate,O.highpass2/=r.out_samplerate):(O.highpass1=0,O.highpass2=0),r.lowpassfreq>0?(O.lowpass2=2*r.lowpassfreq,r.lowpasswidth>=0?(O.lowpass1=2*(r.lowpassfreq-r.lowpasswidth),O.lowpass1<0&&(O.lowpass1=0)):O.lowpass1=2*r.lowpassfreq,O.lowpass1/=r.out_samplerate,O.lowpass2/=r.out_samplerate):(O.lowpass1=0,O.lowpass2=0),function(t){var n=t.internal_flags,r=32,i=-1;if(n.lowpass1>0){for(var a=999,s=0;s<=31;s++)(c=s/31)>=n.lowpass2&&(r=Math.min(r,s)),n.lowpass1<c&&c<n.lowpass2&&(a=Math.min(a,s));n.lowpass1=999==a?(r-.75)/31:(a-.75)/31,n.lowpass2=r/31}if(n.highpass2>0&&n.highpass2<.75/31*.9&&(n.highpass1=0,n.highpass2=0,e.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),n.highpass2>0){var o=-1;for(s=0;s<=31;s++)(c=s/31)<=n.highpass1&&(i=Math.max(i,s)),n.highpass1<c&&c<n.highpass2&&(o=Math.max(o,s));n.highpass1=i/31,n.highpass2=-1==o?(i+.75)/31:(o+.75)/31}for(s=0;s<32;s++){var l,u,c=s/31;l=n.highpass2>n.highpass1?D((n.highpass2-c)/(n.highpass2-n.highpass1+1e-20)):1,u=n.lowpass2>n.lowpass1?D((c-n.lowpass1)/(n.lowpass2-n.lowpass1+1e-20)):1,n.amp_filter[s]=l*u}}(r),O.samplerate_index=k(r.out_samplerate,r),O.samplerate_index<0)return r.internal_flags=null,-1;if(r.VBR==t.vbr_off){if(r.free_format)O.bitrate_index=0;else if(r.brate=L(r.brate,r.version,r.out_samplerate),O.bitrate_index=x(r.brate,r.version,r.out_samplerate),O.bitrate_index<=0)return r.internal_flags=null,-1}else O.bitrate_index=1;r.analysis&&(r.bWriteVbrTag=!1),null!=O.pinfo&&(r.bWriteVbrTag=!1),g.init_bit_stream_w(O);for(var V,q=O.samplerate_index+3*r.version+6*(r.out_samplerate<16e3?1:0),z=0;z<_.SBMAX_l+1;z++)O.scalefac_band.l[z]=b.sfBandIndex[q].l[z];for(z=0;z<_.PSFB21+1;z++){var K=(O.scalefac_band.l[22]-O.scalefac_band.l[21])/_.PSFB21,Y=O.scalefac_band.l[21]+z*K;O.scalefac_band.psfb21[z]=Y}for(O.scalefac_band.psfb21[_.PSFB21]=576,z=0;z<_.SBMAX_s+1;z++)O.scalefac_band.s[z]=b.sfBandIndex[q].s[z];for(z=0;z<_.PSFB12+1;z++)K=(O.scalefac_band.s[13]-O.scalefac_band.s[12])/_.PSFB12,Y=O.scalefac_band.s[12]+z*K,O.scalefac_band.psfb12[z]=Y;for(O.scalefac_band.psfb12[_.PSFB12]=192,1==r.version?O.sideinfo_len=1==O.channels_out?21:36:O.sideinfo_len=1==O.channels_out?13:21,r.error_protection&&(O.sideinfo_len+=2),T=void 0,T=(m=r).internal_flags,m.frameNum=0,m.write_id3tag_automatic&&S.id3tag_write_v2(m),T.bitrate_stereoMode_Hist=i([16,5]),T.bitrate_blockType_Hist=i([16,6]),T.PeakSample=0,m.bWriteVbrTag&&N.InitVbrTag(m),O.Class_ID=R,V=0;V<19;V++)O.nsPsy.pefirbuf[V]=700*O.mode_gr*O.channels_out;switch(-1==r.ATHtype&&(r.ATHtype=4),s(r.VBR_q<=9),s(r.VBR_q>=0),r.VBR){case t.vbr_mt:r.VBR=t.vbr_mtrh;case t.vbr_mtrh:null==r.useTemporal&&(r.useTemporal=!1),E.apply_preset(r,500-10*r.VBR_q,0),r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),r.quality<5&&(r.quality=0),r.quality>5&&(r.quality=5),O.PSY.mask_adjust=r.maskingadjust,O.PSY.mask_adjust_short=r.maskingadjust_short,r.experimentalY?O.sfb21_extra=!1:O.sfb21_extra=r.out_samplerate>44e3,O.iteration_loop=new VBRNewIterationLoop(y);break;case t.vbr_rh:E.apply_preset(r,500-10*r.VBR_q,0),O.PSY.mask_adjust=r.maskingadjust,O.PSY.mask_adjust_short=r.maskingadjust_short,r.experimentalY?O.sfb21_extra=!1:O.sfb21_extra=r.out_samplerate>44e3,r.quality>6&&(r.quality=6),r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),O.iteration_loop=new VBROldIterationLoop(y);break;default:var W;O.sfb21_extra=!1,r.quality<0&&(r.quality=LAME_DEFAULT_QUALITY),(W=r.VBR)==t.vbr_off&&(r.VBR_mean_bitrate_kbps=r.brate),E.apply_preset(r,r.VBR_mean_bitrate_kbps,0),r.VBR=W,O.PSY.mask_adjust=r.maskingadjust,O.PSY.mask_adjust_short=r.maskingadjust_short,W==t.vbr_off?O.iteration_loop=new h(y):O.iteration_loop=new ABRIterationLoop(y)}if(s(r.scale>=0),r.VBR!=t.vbr_off){if(O.VBR_min_bitrate=1,O.VBR_max_bitrate=14,r.out_samplerate<16e3&&(O.VBR_max_bitrate=8),0!=r.VBR_min_bitrate_kbps&&(r.VBR_min_bitrate_kbps=L(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate),O.VBR_min_bitrate=x(r.VBR_min_bitrate_kbps,r.version,r.out_samplerate),O.VBR_min_bitrate<0))return-1;if(0!=r.VBR_max_bitrate_kbps&&(r.VBR_max_bitrate_kbps=L(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate),O.VBR_max_bitrate=x(r.VBR_max_bitrate_kbps,r.version,r.out_samplerate),O.VBR_max_bitrate<0))return-1;r.VBR_min_bitrate_kbps=p.bitrate_table[r.version][O.VBR_min_bitrate],r.VBR_max_bitrate_kbps=p.bitrate_table[r.version][O.VBR_max_bitrate],r.VBR_mean_bitrate_kbps=Math.min(p.bitrate_table[r.version][O.VBR_max_bitrate],r.VBR_mean_bitrate_kbps),r.VBR_mean_bitrate_kbps=Math.max(p.bitrate_table[r.version][O.VBR_min_bitrate],r.VBR_mean_bitrate_kbps)}return r.tune&&(O.PSY.mask_adjust+=r.tune_value_a,O.PSY.mask_adjust_short+=r.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(r),s(r.scale>=0),r.athaa_type<0?O.ATH.useAdjust=3:O.ATH.useAdjust=r.athaa_type,O.ATH.aaSensitivityP=Math.pow(10,r.athaa_sensitivity/-10),null==r.short_blocks&&(r.short_blocks=n.short_block_allowed),r.short_blocks!=n.short_block_allowed||r.mode!=C.JOINT_STEREO&&r.mode!=C.STEREO||(r.short_blocks=n.short_block_coupled),r.quant_comp<0&&(r.quant_comp=1),r.quant_comp_short<0&&(r.quant_comp_short=0),r.msfix<0&&(r.msfix=0),r.exp_nspsytune=1|r.exp_nspsytune,r.internal_flags.nsPsy.attackthre<0&&(r.internal_flags.nsPsy.attackthre=o.NSATTACKTHRE),r.internal_flags.nsPsy.attackthre_s<0&&(r.internal_flags.nsPsy.attackthre_s=o.NSATTACKTHRE_S),s(r.scale>=0),r.scale<0&&(r.scale=1),r.ATHtype<0&&(r.ATHtype=4),r.ATHcurve<0&&(r.ATHcurve=4),r.athaa_loudapprox<0&&(r.athaa_loudapprox=2),r.interChRatio<0&&(r.interChRatio=0),null==r.useTemporal&&(r.useTemporal=!0),O.slot_lag=O.frac_SpF=0,r.VBR==t.vbr_off&&(O.slot_lag=O.frac_SpF=72e3*(r.version+1)*r.brate%r.out_samplerate|0),b.iteration_init(r),w.psymodel_init(r),s(r.scale>=0),0},this.lame_encode_flush=function(e,t,n,r){var i,s,o,l,u=e.internal_flags,c=a([2,1152]),d=0,h=u.mf_samples_to_encode-_.POSTDELAY,f=P(e);if(u.mf_samples_to_encode<1)return 0;for(i=0,e.in_samplerate!=e.out_samplerate&&(h+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-h%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,l=(h+o)/e.framesize;l>0&&d>=0;){var p=f-u.mf_size,m=e.frameNum;p*=e.in_samplerate,(p/=e.out_samplerate)>1152&&(p=1152),p<1&&(p=1),s=r-i,0==r&&(s=0),n+=d=this.lame_encode_buffer(e,c[0],c[1],p,t,n,s),i+=d,l-=m!=e.frameNum?1:0}if(u.mf_samples_to_encode=0,d<0)return d;if(s=r-i,0==r&&(s=0),g.flush_bitstream(e),(d=g.copy_buffer(u,t,n,s,1))<0)return d;if(n+=d,s=r-(i+=d),0==r&&(s=0),e.write_id3tag_automatic){if(S.id3tag_write_v1(e),(d=g.copy_buffer(u,t,n,s,0))<0)return d;i+=d}return i},this.lame_encode_buffer=function(e,t,n,i,a,o,l){var c,d,h=e.internal_flags,p=[null,null];if(h.Class_ID!=R)return-3;if(0==i)return 0;d=i,(null==(c=h).in_buffer_0||c.in_buffer_nsamples<d)&&(c.in_buffer_0=r(d),c.in_buffer_1=r(d),c.in_buffer_nsamples=d),p[0]=h.in_buffer_0,p[1]=h.in_buffer_1;for(var m=0;m<i;m++)p[0][m]=t[m],h.channels_in>1&&(p[1][m]=n[m]);return function(e,t,n,r,i,a,o){var l,c,d,h,p,m=e.internal_flags,E=0,b=[null,null],y=[null,null];if(m.Class_ID!=R)return-3;if(0==r)return 0;if((p=g.copy_buffer(m,i,a,o,0))<0)return p;if(a+=p,E+=p,y[0]=t,y[1]=n,f.NEQ(e.scale,0)&&f.NEQ(e.scale,1))for(c=0;c<r;++c)y[0][c]*=e.scale,2==m.channels_out&&(y[1][c]*=e.scale);if(f.NEQ(e.scale_left,0)&&f.NEQ(e.scale_left,1))for(c=0;c<r;++c)y[0][c]*=e.scale_left;if(f.NEQ(e.scale_right,0)&&f.NEQ(e.scale_right,1))for(c=0;c<r;++c)y[1][c]*=e.scale_right;if(2==e.num_channels&&1==m.channels_out)for(c=0;c<r;++c)y[0][c]=.5*(y[0][c]+y[1][c]),y[1][c]=0;h=P(e),b[0]=m.mfbuf[0],b[1]=m.mfbuf[1];for(var C=0;r>0;){var T,N,S=[null,null];S[0]=y[0],S[1]=y[1];var I=new B;if(q(e,b,S,C,r,I),T=I.n_in,N=I.n_out,m.findReplayGain&&!m.decode_on_the_fly&&v.AnalyzeSamples(m.rgdata,b[0],m.mf_size,b[1],m.mf_size,N,m.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(r-=T,C+=T,m.channels_out,m.mf_size+=N,s(m.mf_size<=u.MFSIZE),m.mf_samples_to_encode<1&&(m.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY),m.mf_samples_to_encode+=N,m.mf_size>=h){var w=o-E;if(0==o&&(w=0),(l=F(e,b[0],b[1],i,a,w))<0)return l;for(a+=l,E+=l,m.mf_size-=e.framesize,m.mf_samples_to_encode-=e.framesize,d=0;d<m.channels_out;d++)for(c=0;c<m.mf_size;c++)b[d][c]=b[d][c+e.framesize]}}return E}(e,p[0],p[1],i,a,o,l)}}}var az=CV.VbrMode,sz=CV.new_float,oz=CV.new_int,lz=CV.System,uz=CV.VbrMode,cz=CV.Util,dz=CV.Arrays,hz=CV.new_float,fz=CV.assert,pz=function(){this.setModules=function(e,t){}},_z=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0},mz=function(){this.global_gain=0,this.sfb_count1=0,this.step=oz(39),this.noise=sz(39),this.noise_log=sz(39)},vz=AV(),gz=JV,Ez=WV,bz=CV.assert,yz=CV.System,Cz=CV.VbrMode,Tz=CV.ShortBlock,Nz=CV.Arrays,Sz=CV.new_byte,Iz=CV.assert;function wz(){var e,t,n;this.setModules=function(r,i,a){e=r,t=i,n=a};var r=wz.NUMTOCENTRIES,i=wz.MAXFRAMESIZE,a=r+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,s="Xing",o="Info",l=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function u(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],(n<<=8)|255&e[t+3]}function c(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function d(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function h(e,t,n){return 255&(e<<t|n&~(-1<<t))}function f(t,n){var r=t.internal_flags;n[0]=h(n[0],8,255),n[1]=h(n[1],3,7),n[1]=h(n[1],1,t.out_samplerate<16e3?0:1),n[1]=h(n[1],1,t.version),n[1]=h(n[1],2,1),n[1]=h(n[1],1,t.error_protection?0:1),n[2]=h(n[2],4,r.bitrate_index),n[2]=h(n[2],2,r.samplerate_index),n[2]=h(n[2],1,0),n[2]=h(n[2],1,t.extension),n[3]=h(n[3],2,t.mode.ordinal()),n[3]=h(n[3],2,r.mode_ext),n[3]=h(n[3],1,t.copyright),n[3]=h(n[3],1,t.original),n[3]=h(n[3],2,t.emphasis),n[0]=255;var i,a,s=241&n[1];i=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==Cz.vbr_off&&(i=t.brate),a=t.free_format?0:255&16*e.BitrateIndex(i,t.version,t.out_samplerate),1==t.version?(n[1]=255&s|10,s=13&n[2],n[2]=255&(a|s)):(n[1]=255&s|2,s=13&n[2],n[2]=255&(a|s))}function p(e,t){return t>>8^l[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];Iz(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var i,a,l=e[n+1]>>3&1,c=e[n+2]>>2&3,d=e[n+3]>>6&3,h=e[n+2]>>4&15;if(h=Tables.bitrate_table[l][h],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][c]:t.samprate=Tables.samplerate_table[l][c],i=e,a=n+=0!=l?3!=d?36:21:3!=d?21:13,!new String(i,a,4(),null).equals(s)&&!new String(i,a,4(),null).equals(o))return null;n+=4,t.hId=l;var f=t.flags=u(e,n);if(n+=4,!!(1&f)&&(t.frames=u(e,n),n+=4),!!(2&f)&&(t.bytes=u(e,n),n+=4),4&f){if(null!=t.toc)for(var p=0;p<r;p++)t.toc[p]=e[n+p];n+=r}t.vbrScale=-1,!!(8&f)&&(t.vbrScale=u(e,n),n+=4),t.headersize=72e3*(l+1)*h/t.samprate;var _=e[(n+=21)+0]<<4;_+=e[n+1]>>4;var m=(15&e[n+1])<<8;return(_<0||_>3e3)&&(_=-1),((m+=255&e[n+2])<0||m>3e3)&&(m=-1),t.encDelay=_,t.encPadding=m,t},this.InitVbrTag=function(e){var n,r=e.internal_flags;n=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==Cz.vbr_off&&(n=e.brate);var s=72e3*(e.version+1)*n/e.out_samplerate,o=r.sideinfo_len+a;if(r.VBR_seek_table.TotalFrameSize=s,s<o||s>i)e.bWriteVbrTag=!1;else{r.VBR_seek_table.nVbrNumFrames=0,r.VBR_seek_table.nBytesWritten=0,r.VBR_seek_table.sum=0,r.VBR_seek_table.seen=0,r.VBR_seek_table.want=1,r.VBR_seek_table.pos=0,null==r.VBR_seek_table.bag&&(r.VBR_seek_table.bag=new int[400],r.VBR_seek_table.size=400);var l=Sz(i);f(e,l);for(var u=r.VBR_seek_table.TotalFrameSize,c=0;c<u;++c)t.add_dummy_byte(e,255&l[c],1)}},this.updateMusicCRC=function(e,t,n,r){for(var i=0;i<r;++i)e[0]=p(t[n+i],e[0])},this.getLameTagFrame=function(e,i){var a=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(a.Class_ID!=Lame.LAME_ID)return 0;if(a.VBR_seek_table.pos<=0)return 0;if(i.length<a.VBR_seek_table.TotalFrameSize)return a.VBR_seek_table.TotalFrameSize;Nz.fill(i,0,a.VBR_seek_table.TotalFrameSize,0),f(e,i);var l=Sz(r);if(e.free_format)for(var u=1;u<r;++u)l[u]=255&255*u/100;else!function(e,t){if(!(e.pos<=0))for(var n=1;n<r;++n){var i=n/r,a=0|Math.floor(i*e.pos);a>e.pos-1&&(a=e.pos-1);var s=0|256*e.bag[a]/e.sum;s>255&&(s=255),t[n]=255&s}}(a.VBR_seek_table,l);var h=a.sideinfo_len;e.error_protection&&(h-=2),e.VBR==Cz.vbr_off?(i[h++]=255&o.charAt(0),i[h++]=255&o.charAt(1),i[h++]=255&o.charAt(2),i[h++]=255&o.charAt(3)):(i[h++]=255&s.charAt(0),i[h++]=255&s.charAt(1),i[h++]=255&s.charAt(2),i[h++]=255&s.charAt(3)),c(i,h,15),c(i,h+=4,a.VBR_seek_table.nVbrNumFrames),h+=4;var _=a.VBR_seek_table.nBytesWritten+a.VBR_seek_table.TotalFrameSize;c(i,h,0|_),h+=4,yz.arraycopy(l,0,i,h,l.length),h+=l.length,e.error_protection&&t.CRC_writeheader(a,i);var m=0;for(u=0;u<h;u++)m=p(i[u],m);return h+=function(e,t,r,i,a){var s,o,l,u,h,f,_=e.internal_flags,m=0,v=e.encoder_delay,g=e.encoder_padding,E=100-10*e.VBR_q-e.quality,b=n.getLameVeryShortVersion(),y=[1,5,3,2,4,0,3],C=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),T=0,N=0,S=e.internal_flags.noise_shaping,I=0,w=0,A=!!(1&e.exp_nspsytune),M=!!(2&e.exp_nspsytune),O=!1,R=!1,D=e.internal_flags.nogap_total,k=e.internal_flags.nogap_current,L=e.ATHtype;switch(e.VBR){case vbr_abr:h=e.VBR_mean_bitrate_kbps;break;case vbr_off:h=e.brate;break;default:h=e.VBR_min_bitrate_kbps}switch(s=0+(e.VBR.ordinal()<y.length?y[e.VBR.ordinal()]:0),_.findReplayGain&&(_.RadioGain>510&&(_.RadioGain=510),_.RadioGain<-510&&(_.RadioGain=-510),N=8192,N|=3072,_.RadioGain>=0?N|=_.RadioGain:(N|=512,N|=-_.RadioGain)),_.findPeakSample&&(T=Math.abs(0|_.PeakSample/32767*Math.pow(2,23)+.5)),-1!=D&&(k>0&&(R=!0),k<D-1&&(O=!0)),u=L+((A?1:0)<<4)+((M?1:0)<<5)+((O?1:0)<<6)+((R?1:0)<<7),E<0&&(E=0),e.mode){case MONO:I=0;break;case STEREO:I=1;break;case DUAL_CHANNEL:I=2;break;case JOINT_STEREO:I=e.force_ms?4:3;break;case NOT_SET:default:I=7}f=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==Tz.short_block_forced||e.short_blocks==Tz.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==L||e.in_samplerate<=32e3)&&(w=1),o=S+(I<<2)+(w<<5)+(f<<6),l=_.nMusicCRC,c(r,i+m,E),m+=4;for(var x=0;x<9;x++)r[i+m+x]=255&b.charAt(x);r[i+(m+=9)]=255&s,r[i+ ++m]=255&C,c(r,i+ ++m,T),d(r,i+(m+=4),N),d(r,i+(m+=2),0),r[i+(m+=2)]=255&u,r[i+ ++m]=h>=255?255:255&h,r[i+ ++m]=255&v>>4,r[i+m+1]=255&(v<<4)+(g>>8),r[i+m+2]=255&g,r[i+(m+=3)]=255&o,m++,r[i+m++]=0,d(r,i+m,e.preset),c(r,i+(m+=2),t),d(r,i+(m+=4),l),m+=2;for(var U=0;U<m;U++)a=p(r[i+U],a);return d(r,i+m,a),m+2}(e,_,i,h,m),a.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=function(e){e.seek(0);var t=Sz(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(n);var r=Sz(i),a=getLameTagFrame(e,r);return a>r.length?-1:(a<1||t.write(r,0,a),0)}}wz.NUMTOCENTRIES=100,wz.MAXFRAMESIZE=2880;var Az=wz,Mz=CV.new_byte,Oz=CV.assert,Rz=iz(),Dz=function(){var e,t=iz();function n(e,t,n,r,i,a,s,o,l,u,c,d,h,f,p){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=r,this.st_lrm=i,this.st_s=a,this.masking_adj=s,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=u,this.ath_sensitivity=c,this.interch=d,this.safejoint=h,this.sfb21mod=f,this.msfix=p}function r(e,t,n,r,i,a,s,o,l,u,c,d,h,f){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=r,this.nsmsfix=i,this.st_lrm=a,this.st_s=s,this.nsbass=o,this.scale=l,this.masking_adj=u,this.ath_lower=c,this.ath_curve=d,this.interch=h,this.sfscale=f}this.setModules=function(t){e=t};var i=[new n(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new n(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new n(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new n(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new n(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new n(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new n(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new n(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new n(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new n(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new n(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],a=[new n(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new n(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new n(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new n(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new n(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new n(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new n(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new n(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new n(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new n(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new n(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function s(e,t,n){var r,s,o=e.VBR==az.vbr_rh?i:a,l=e.VBR_q_frac,u=o[t],c=o[t+1],d=u;u.st_lrm=u.st_lrm+l*(c.st_lrm-u.st_lrm),u.st_s=u.st_s+l*(c.st_s-u.st_s),u.masking_adj=u.masking_adj+l*(c.masking_adj-u.masking_adj),u.masking_adj_short=u.masking_adj_short+l*(c.masking_adj_short-u.masking_adj_short),u.ath_lower=u.ath_lower+l*(c.ath_lower-u.ath_lower),u.ath_curve=u.ath_curve+l*(c.ath_curve-u.ath_curve),u.ath_sensitivity=u.ath_sensitivity+l*(c.ath_sensitivity-u.ath_sensitivity),u.interch=u.interch+l*(c.interch-u.interch),u.msfix=u.msfix+l*(c.msfix-u.msfix),r=e,0>(s=d.vbr_q)&&(s=0),9<s&&(s=9),r.VBR_q=s,r.VBR_q_frac=0,0!=n?e.quant_comp=d.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=d.quant_comp),0!=n?e.quant_comp_short=d.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=d.quant_comp_s),0!=d.expY&&(e.experimentalY=0!=d.expY),0!=n?e.internal_flags.nsPsy.attackthre=d.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=d.st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=d.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=d.st_s),0!=n?e.maskingadjust=d.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=d.masking_adj),0!=n?e.maskingadjust_short=d.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=d.masking_adj_short),0!=n?e.ATHlower=-d.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-d.ath_lower/10),0!=n?e.ATHcurve=d.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=d.ath_curve),0!=n?e.athaa_sensitivity=d.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=d.ath_sensitivity),d.interch>0&&(0!=n?e.interChRatio=d.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=d.interch)),d.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|d.safejoint),d.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|d.sfb21mod<<20),0!=n?e.msfix=d.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=d.msfix),0==n&&(e.VBR_q=t,e.VBR_q_frac=l)}var o=[new r(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new r(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new r(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new r(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new r(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new r(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new r(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new r(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new r(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new r(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new r(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new r(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new r(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new r(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new r(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new r(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new r(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(t,n,r){var i=n,a=e.nearestBitrateFullIndex(n);if(t.VBR=az.vbr_abr,t.VBR_mean_bitrate_kbps=i,t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,320),t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,8),t.brate=t.VBR_mean_bitrate_kbps,t.VBR_mean_bitrate_kbps>320&&(t.disable_reservoir=!0),o[a].safejoint>0&&(t.exp_nspsytune=2|t.exp_nspsytune),o[a].sfscale>0&&(t.internal_flags.noise_shaping=2),Math.abs(o[a].nsbass)>0){var s=int(4*o[a].nsbass);s<0&&(s+=64),t.exp_nspsytune=t.exp_nspsytune|s<<2}return 0!=r?t.quant_comp=o[a].quant_comp:Math.abs(t.quant_comp- -1)>0||(t.quant_comp=o[a].quant_comp),0!=r?t.quant_comp_short=o[a].quant_comp_s:Math.abs(t.quant_comp_short- -1)>0||(t.quant_comp_short=o[a].quant_comp_s),0!=r?t.msfix=o[a].nsmsfix:Math.abs(t.msfix- -1)>0||(t.msfix=o[a].nsmsfix),0!=r?t.internal_flags.nsPsy.attackthre=o[a].st_lrm:Math.abs(t.internal_flags.nsPsy.attackthre- -1)>0||(t.internal_flags.nsPsy.attackthre=o[a].st_lrm),0!=r?t.internal_flags.nsPsy.attackthre_s=o[a].st_s:Math.abs(t.internal_flags.nsPsy.attackthre_s- -1)>0||(t.internal_flags.nsPsy.attackthre_s=o[a].st_s),0!=r?t.scale=o[a].scale:Math.abs(t.scale- -1)>0||(t.scale=o[a].scale),0!=r?t.maskingadjust=o[a].masking_adj:Math.abs(t.maskingadjust-0)>0||(t.maskingadjust=o[a].masking_adj),o[a].masking_adj>0?0!=r?t.maskingadjust_short=.9*o[a].masking_adj:Math.abs(t.maskingadjust_short-0)>0||(t.maskingadjust_short=.9*o[a].masking_adj):0!=r?t.maskingadjust_short=1.1*o[a].masking_adj:Math.abs(t.maskingadjust_short-0)>0||(t.maskingadjust_short=1.1*o[a].masking_adj),0!=r?t.ATHlower=-o[a].ath_lower/10:Math.abs(10*-t.ATHlower-0)>0||(t.ATHlower=-o[a].ath_lower/10),0!=r?t.ATHcurve=o[a].ath_curve:Math.abs(t.ATHcurve- -1)>0||(t.ATHcurve=o[a].ath_curve),0!=r?t.interChRatio=o[a].interch:Math.abs(t.interChRatio- -1)>0||(t.interChRatio=o[a].interch),n}this.apply_preset=function(e,n,r){switch(n){case t.R3MIX:n=t.V3,e.VBR=az.vbr_mtrh;break;case t.MEDIUM:n=t.V4,e.VBR=az.vbr_rh;break;case t.MEDIUM_FAST:n=t.V4,e.VBR=az.vbr_mtrh;break;case t.STANDARD:n=t.V2,e.VBR=az.vbr_rh;break;case t.STANDARD_FAST:n=t.V2,e.VBR=az.vbr_mtrh;break;case t.EXTREME:n=t.V0,e.VBR=az.vbr_rh;break;case t.EXTREME_FAST:n=t.V0,e.VBR=az.vbr_mtrh;break;case t.INSANE:return n=320,e.preset=n,l(e,n,r),e.VBR=az.vbr_off,n}switch(e.preset=n,n){case t.V9:return s(e,9,r),n;case t.V8:return s(e,8,r),n;case t.V7:return s(e,7,r),n;case t.V6:return s(e,6,r),n;case t.V5:return s(e,5,r),n;case t.V4:return s(e,4,r),n;case t.V3:return s(e,3,r),n;case t.V2:return s(e,2,r),n;case t.V1:return s(e,1,r),n;case t.V0:return s(e,0,r),n}return 8<=n&&n<=320?l(e,n,r):(e.preset=0,n)}},kz=Oq,Lz=tz(),xz=function(){var e,t,n;this.rv=null,this.qupvt=null;var r,i=new pz;function a(e){this.ordinal=e}function s(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function o(e,t,n,r,i){var a;switch(e){default:case 9:t.over_count>0?(a=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(a=n.bits<t.bits)):a=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:a=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n,r=1e-37,i=0;i<t.psymax;i++)r+=(n=e[i],cz.FAST_LOG10(.368+.632*n*n*n));return Math.max(1e-20,r)}(i,r);case 1:a=n.max_noise<t.max_noise;break;case 2:a=n.tot_noise<t.tot_noise;break;case 3:a=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:a=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:a=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&n.bits<t.bits),a}function l(e,t,i,a,o){var l=e.internal_flags;!function(e,t,n,r,i){var a,s=e.internal_flags;a=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<n[l]&&(o=n[l]);var u=s.noise_shaping_amp;switch(3==u&&(u=i?2:1),u){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var c=0;for(l=0;l<t.sfbmax;l++){var d,h=t.width[l];if(c+=h,!(n[l]<o)){if(2&s.substep_shaping&&(s.pseudohalf[l]=0==s.pseudohalf[l]?1:0,0==s.pseudohalf[l]&&2==s.noise_shaping_amp))return;for(t.scalefac[l]++,d=-h;d<0;d++)r[c+d]*=a,r[c+d]>t.xrpow_max&&(t.xrpow_max=r[c+d]);if(2==s.noise_shaping_amp)return}}}(e,t,i,a,o);var u=s(t);return!(u||(u=2==l.mode_gr?r.scale_bitcount(t):r.scale_bitcount_lsf(l,t))&&(l.noise_shaping>1&&(dz.fill(l.pseudohalf,0),0==t.scalefac_scale?(function(e,t){for(var r=0,i=0;i<e.sfbmax;i++){var a=e.width[i],s=e.scalefac[i];if(0!=e.preflag&&(s+=n.pretab[i]),r+=a,1&s){s++;for(var o=-a;o<0;o++)t[r+o]*=1.2968395546510096,t[r+o]>e.xrpow_max&&(e.xrpow_max=t[r+o])}e.scalefac[i]=s>>1}e.preflag=0,e.scalefac_scale=1}(t,a),u=!1):t.block_type==vz.SHORT_TYPE&&l.subblock_gain>0&&(u=function(e,t,r){var i,a=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(a[i]>=16)return!0;for(var s=0;s<3;s++){var o=0,l=0;for(i=t.sfb_lmax+s;i<t.sfbdivide;i+=3)o<a[i]&&(o=a[i]);for(;i<t.sfbmax;i+=3)l<a[i]&&(l=a[i]);if(!(o<16&&l<8)){if(t.subblock_gain[s]>=7)return!0;t.subblock_gain[s]++;var u=e.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+s;i<t.sfbmax;i+=3){var c=t.width[i],d=a[i];if((d-=4>>t.scalefac_scale)>=0)a[i]=d,u+=3*c;else{a[i]=0;var h=210+(d<<t.scalefac_scale+1);p=n.IPOW20(h),u+=c*(s+1);for(var f=-c;f<0;f++)r[u+f]*=p,r[u+f]>t.xrpow_max&&(t.xrpow_max=r[u+f]);u+=c*(3-s-1)}}var p=n.IPOW20(202);for(u+=t.width[i]*(s+1),f=-t.width[i];f<0;f++)r[u+f]*=p,r[u+f]>t.xrpow_max&&(t.xrpow_max=r[u+f])}}return!1}(l,t,a)||s(t))),u||(u=2==l.mode_gr?r.scale_bitcount(t):r.scale_bitcount_lsf(l,t)),u))}this.setModules=function(a,s,o,l){e=a,t=s,this.rv=s,n=o,this.qupvt=o,r=l,i.setModules(n,r)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var r=e.tt[t][0].xr[n],i=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(r+i)*(.5*cz.SQRT2),e.tt[t][1].xr[n]=(r-i)*(.5*cz.SQRT2)}},this.init_xrpow=function(e,t,n){var r=0,i=0|t.max_nonzero_coeff;if(t.xrpow_max=0,dz.fill(n,i,576,0),(r=function(e,t,n,r){r=0;for(var i=0;i<=n;++i){var a=Math.abs(e.xr[i]);r+=a,t[i]=Math.sqrt(a*Math.sqrt(a)),t[i]>e.xrpow_max&&(e.xrpow_max=t[i])}return r}(t,n,i,r))>1e-20){var a=0;2&e.substep_shaping&&(a=1);for(var s=0;s<t.psymax;s++)e.pseudohalf[s]=a;return!0}return dz.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=vz.SBPSY_l,t.sfb_smin=vz.SBPSY_s,t.psy_lmax=e.sfb21_extra?vz.SBMAX_l:vz.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var r=0;r<vz.SBMAX_l;r++)t.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],t.window[r]=3;if(t.block_type==vz.SHORT_TYPE){var i=hz(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?vz.SBMAX_s:vz.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(vz.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var a=e.scalefac_band.l[t.sfb_lmax];for(lz.arraycopy(t.xr,0,i,0,576),r=t.sfb_smin;r<vz.SBMAX_s;r++)for(var s=e.scalefac_band.s[r],o=e.scalefac_band.s[r+1],l=0;l<3;l++)for(var u=s;u<o;u++)t.xr[a++]=i[3*u+l];var c=t.sfb_lmax;for(r=t.sfb_smin;r<vz.SBMAX_s;r++)t.width[c]=t.width[c+1]=t.width[c+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],t.window[c]=0,t.window[c+1]=1,t.window[c+2]=2,c+=3}t.count1bits=0,t.sfb_partition_table=n.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,dz.fill(t.scalefac,0),function(e,t){var r=e.ATH,i=t.xr;if(t.block_type!=vz.SHORT_TYPE)for(var a=!1,s=vz.PSFB21-1;s>=0&&!a;s--){var o=e.scalefac_band.psfb21[s],l=e.scalefac_band.psfb21[s+1],u=n.athAdjust(r.adjust,r.psfb21[s],r.floor);e.nsPsy.longfact[21]>1e-12&&(u*=e.nsPsy.longfact[21]);for(var c=l-1;c>=o;c--){if(!(Math.abs(i[c])<u)){a=!0;break}i[c]=0}}else for(var d=0;d<3;d++)for(a=!1,s=vz.PSFB12-1;s>=0&&!a;s--){l=(o=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*d+(e.scalefac_band.psfb12[s]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[s+1]-e.scalefac_band.psfb12[s]);var h=n.athAdjust(r.adjust,r.psfb12[s],r.floor);for(e.nsPsy.shortfact[12]>1e-12&&(h*=e.nsPsy.shortfact[12]),c=l-1;c>=o;c--){if(!(Math.abs(i[c])<h)){a=!0;break}i[c]=0}}}(e,t)},a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2),this.trancate_smallspectrums=function(e,t,i,a){var s=hz(Ez.SFBMAX);if((4&e.substep_shaping||t.block_type!=vz.SHORT_TYPE)&&!(128&e.substep_shaping)){n.calc_noise(t,i,s,new _z,null);for(var o=0;o<576;o++){var l=0;0!=t.l3_enc[o]&&(l=Math.abs(t.xr[o])),a[o]=l}o=0;var u=8;t.block_type==vz.SHORT_TYPE&&(u=6);do{var c,d,h,f,p=t.width[u];if(o+=p,!(s[u]>=1||(dz.sort(a,o-p,p),BitStream.EQ(a[o-1],0)))){c=(1-s[u])*i[u],d=0,f=0;do{var _;for(h=1;f+h<p&&!BitStream.NEQ(a[f+o-p],a[f+o+h-p]);h++);if(c<(_=a[f+o-p]*a[f+o-p]*h)){0!=f&&(d=a[f+o-p-1]);break}c-=_,f+=h}while(f<p);if(!BitStream.EQ(d,0))do{Math.abs(t.xr[o-p])<=d&&(t.l3_enc[o-p]=0)}while(--p>0)}}while(++u<t.psymax);t.part2_3_length=r.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,i,s,u,c){var d=e.internal_flags,h=new gz,f=hz(576),p=hz(Ez.SFBMAX),_=new _z,m=new mz,v=9999999,g=!1,E=!1,b=0;if(function(e,t,n,i,s){var o,l=e.CurrentStep[i],u=!1,c=e.OldValue[i],d=a.BINSEARCH_NONE;for(t.global_gain=c,n-=t.part2_length;;){var h;if(o=r.count_bits(e,s,t,null),1==l||o==n)break;o>n?(d==a.BINSEARCH_DOWN&&(u=!0),u&&(l/=2),d=a.BINSEARCH_UP,h=l):(d==a.BINSEARCH_UP&&(u=!0),u&&(l/=2),d=a.BINSEARCH_DOWN,h=-l),t.global_gain+=h,t.global_gain<0&&(t.global_gain=0,u=!0),t.global_gain>255&&(t.global_gain=255,u=!0)}for(fz(t.global_gain>=0),fz(t.global_gain<256);o>n&&t.global_gain<255;)t.global_gain++,o=r.count_bits(e,s,t,null);e.CurrentStep[i]=c-t.global_gain>=4?4:2,e.OldValue[i]=t.global_gain,t.part2_3_length=o}(d,t,c,u,s),0==d.noise_shaping)return 100;n.calc_noise(t,i,p,_,m),_.bits=t.part2_3_length,h.assign(t);var y=0;for(lz.arraycopy(s,0,f,0,576);!g;){do{var C,T=new _z,N=255;if(C=2&d.substep_shaping?20:3,d.sfb21_extra){if(p[h.sfbmax]>1)break;if(h.block_type==vz.SHORT_TYPE&&(p[h.sfbmax+1]>1||p[h.sfbmax+2]>1))break}if(!l(e,h,p,s,E))break;0!=h.scalefac_scale&&(N=254);var S=c-h.part2_length;if(S<=0)break;for(;(h.part2_3_length=r.count_bits(d,s,h,m))>S&&h.global_gain<=N;)h.global_gain++;if(h.global_gain>N)break;if(0==_.over_count){for(;(h.part2_3_length=r.count_bits(d,s,h,m))>v&&h.global_gain<=N;)h.global_gain++;if(h.global_gain>N)break}if(n.calc_noise(h,i,p,T,m),T.bits=h.part2_3_length,0!=(o(t.block_type!=vz.SHORT_TYPE?e.quant_comp:e.quant_comp_short,_,T,h,p)?1:0))v=t.part2_3_length,_=T,t.assign(h),y=0,lz.arraycopy(s,0,f,0,576);else if(0==d.full_outer_loop){if(++y>C&&0==_.over_count)break;if(3==d.noise_shaping_amp&&E&&y>30)break;if(3==d.noise_shaping_amp&&E&&h.global_gain-b>15)break}}while(h.global_gain+h.scalefac_scale<255);3==d.noise_shaping_amp?E?g=!0:(h.assign(t),lz.arraycopy(f,0,s,0,576),y=0,b=h.global_gain,E=!0):g=!0}return fz(t.global_gain+t.scalefac_scale<=255),e.VBR==uz.vbr_rh||e.VBR==uz.vbr_mtrh?lz.arraycopy(f,0,s,0,576):!!(1&d.substep_shaping)&&trancate_smallspectrums(d,t,i,s),_.over_count},this.iteration_finish_one=function(e,n,i){var a=e.l3_side,s=a.tt[n][i];r.best_scalefac_store(e,n,i,a),1==e.use_best_huffman&&r.best_huffman_divide(e,s),t.ResvAdjust(e,s)},this.VBR_encode_granule=function(e,t,n,r,i,a,s){var o,l=e.internal_flags,u=new gz,c=hz(576),d=s,h=s+1,f=(s+a)/2,p=0,_=l.sfb21_extra;fz(d<=LameInternalFlags.MAX_BITS_PER_CHANNEL),dz.fill(u.l3_enc,0);do{l.sfb21_extra=!(f>d-42)&&_,outer_loop(e,t,n,r,i,f)<=0?(p=1,h=t.part2_3_length,u.assign(t),lz.arraycopy(r,0,c,0,576),o=(s=h-32)-a,f=(s+a)/2):(o=s-(a=f+32),f=(s+a)/2,0!=p&&(p=2,t.assign(u),lz.arraycopy(c,0,r,0,576)))}while(o>12);l.sfb21_extra=_,2==p&&lz.arraycopy(u.l3_enc,0,t.l3_enc,0,576),fz(t.part2_3_length<=d)},this.get_framebits=function(n,r){var i=n.internal_flags;i.bitrate_index=i.VBR_min_bitrate;var a=e.getframebits(n);i.bitrate_index=1,a=e.getframebits(n);for(var s=1;s<=i.VBR_max_bitrate;s++){i.bitrate_index=s;var o=new MeanBits(a);r[s]=t.ResvFrameBegin(n,o),a=o.bits}},this.VBR_old_prepare=function(e,r,i,a,s,o,l,u,c){var d,h=e.internal_flags,f=0,p=1,_=0;h.bitrate_index=h.VBR_max_bitrate;var m=t.ResvFrameBegin(e,new MeanBits(0))/h.mode_gr;get_framebits(e,o);for(var v=0;v<h.mode_gr;v++){var g=n.on_pe(e,r,u[v],m,v,0);h.mode_ext==vz.MPG_MD_MS_LR&&(ms_convert(h.l3_side,v),n.reduce_side(u[v],i[v],m,g));for(var E=0;E<h.channels_out;++E){var b=h.l3_side.tt[v][E];b.block_type!=vz.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-r[v][E]/300))-.05,d=h.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-r[v][E]/300))-.14,d=h.PSY.mask_adjust_short-f),h.masking_lower=Math.pow(10,.1*d),init_outer_loop(h,b),c[v][E]=n.calc_xmin(e,a[v][E],b,s[v][E]),0!=c[v][E]&&(p=0),l[v][E]=126,_+=u[v][E]}}for(v=0;v<h.mode_gr;v++)for(E=0;E<h.channels_out;E++)_>o[h.VBR_max_bitrate]&&(u[v][E]*=o[h.VBR_max_bitrate],u[v][E]/=_),l[v][E]>u[v][E]&&(l[v][E]=u[v][E]);return p},this.bitpressure_strategy=function(e,t,n,r){for(var i=0;i<e.mode_gr;i++)for(var a=0;a<e.channels_out;a++){for(var s=e.l3_side.tt[i][a],o=t[i][a],l=0,u=0;u<s.psy_lmax;u++)o[l++]*=1+.029*u*u/vz.SBMAX_l/vz.SBMAX_l;if(s.block_type==vz.SHORT_TYPE)for(u=s.sfb_smin;u<vz.SBMAX_s;u++)o[l++]*=1+.029*u*u/vz.SBMAX_s/vz.SBMAX_s,o[l++]*=1+.029*u*u/vz.SBMAX_s/vz.SBMAX_s,o[l++]*=1+.029*u*u/vz.SBMAX_s/vz.SBMAX_s;r[i][a]=0|Math.max(n[i][a],.9*r[i][a])}},this.VBR_new_prepare=function(e,r,i,a,s,o){var l,u=e.internal_flags,c=1,d=0,h=0;if(e.free_format)u.bitrate_index=0,f=new MeanBits(d),l=t.ResvFrameBegin(e,f),d=f.bits,s[0]=l;else{u.bitrate_index=u.VBR_max_bitrate;var f=new MeanBits(d);t.ResvFrameBegin(e,f),d=f.bits,get_framebits(e,s),l=s[u.VBR_max_bitrate]}for(var p=0;p<u.mode_gr;p++){n.on_pe(e,r,o[p],d,p,0),u.mode_ext==vz.MPG_MD_MS_LR&&ms_convert(u.l3_side,p);for(var _=0;_<u.channels_out;++_){var m=u.l3_side.tt[p][_];u.masking_lower=Math.pow(10,.1*u.PSY.mask_adjust),init_outer_loop(u,m),0!=n.calc_xmin(e,i[p][_],m,a[p][_])&&(c=0),h+=o[p][_]}}for(p=0;p<u.mode_gr;p++)for(_=0;_<u.channels_out;_++)h>l&&(o[p][_]*=l,o[p][_]/=h);return c},this.calc_target_bits=function(r,i,a,s,o,l){var u,c,d,h,f=r.internal_flags,p=f.l3_side,_=0;f.bitrate_index=f.VBR_max_bitrate;var m=new MeanBits(_);for(l[0]=t.ResvFrameBegin(r,m),_=m.bits,f.bitrate_index=1,_=e.getframebits(r)-8*f.sideinfo_len,o[0]=_/(f.mode_gr*f.channels_out),_=r.VBR_mean_bitrate_kbps*r.framesize*1e3,!!(1&f.substep_shaping)&&(_*=1.09),_/=r.out_samplerate,_-=8*f.sideinfo_len,_/=f.mode_gr*f.channels_out,(u=.93+.07*(11-r.compression_ratio)/5.5)<.9&&(u=.9),u>1&&(u=1),c=0;c<f.mode_gr;c++){var v=0;for(d=0;d<f.channels_out;d++){if(s[c][d]=int(u*_),i[c][d]>700){var g=int((i[c][d]-700)/1.4),E=p.tt[c][d];s[c][d]=int(u*_),E.block_type==vz.SHORT_TYPE&&g<_/2&&(g=_/2),g>3*_/2?g=3*_/2:g<0&&(g=0),s[c][d]+=g}s[c][d]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(s[c][d]=LameInternalFlags.MAX_BITS_PER_CHANNEL),v+=s[c][d]}if(v>LameInternalFlags.MAX_BITS_PER_GRANULE)for(d=0;d<f.channels_out;++d)s[c][d]*=LameInternalFlags.MAX_BITS_PER_GRANULE,s[c][d]/=v}if(f.mode_ext==vz.MPG_MD_MS_LR)for(c=0;c<f.mode_gr;c++)n.reduce_side(s[c],a[c],_*f.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(h=0,c=0;c<f.mode_gr;c++)for(d=0;d<f.channels_out;d++)s[c][d]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(s[c][d]=LameInternalFlags.MAX_BITS_PER_CHANNEL),h+=s[c][d];if(h>l[0])for(c=0;c<f.mode_gr;c++)for(d=0;d<f.channels_out;d++)s[c][d]*=l[0],s[c][d]/=h}},Uz=nz(),Pz=function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var r,i=t.internal_flags,a=i.l3_side,s=e.getframebits(t);n.bits=(s-8*i.sideinfo_len)/i.mode_gr;var o=2048*i.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),i.ResvMax=r-s,i.ResvMax>o&&(i.ResvMax=o),(i.ResvMax<0||t.disable_reservoir)&&(i.ResvMax=0);var l=n.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return l>r&&(l=r),bz(0==i.ResvMax%8),bz(i.ResvMax>=0),a.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=n.bits/2,i.pinfo.resvsize=i.ResvSize),l},this.ResvMaxBits=function(e,t,n,r){var i,a=e.internal_flags,s=a.ResvSize,o=a.ResvMax;0!=r&&(s+=t),!!(1&a.substep_shaping)&&(o*=.9),n.bits=t,10*s>9*o?(i=s-9*o/10,n.bits+=i,a.substep_shaping|=128):(i=0,a.substep_shaping&=127,e.disable_reservoir||1&a.substep_shaping||(n.bits-=.1*t));var l=s<6*a.ResvMax/10?s:6*a.ResvMax/10;return(l-=i)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var n,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var i=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(n=e.ResvSize%8)&&(i+=n),(n=e.ResvSize-i-e.ResvMax)>0&&(i+=n);var a=Math.min(8*r.main_data_begin,i)/8;r.resvDrain_pre+=8*a,i-=8*a,e.ResvSize-=8*a,r.main_data_begin-=a,r.resvDrain_post+=i,e.ResvSize-=i}},Fz=wV,Bz=rz();AV();var Hz=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},Gz=Az;function jz(){this.setModules=function(e,t){}}function Vz(){this.setModules=function(e,t,n){}}function qz(){}function zz(){this.setModules=function(e,t){}}function Kz(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Yz(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Kz.RIFF=Yz("RIFF"),Kz.WAVE=Yz("WAVE"),Kz.fmt_=Yz("fmt "),Kz.data=Yz("data"),Kz.readHeader=function(e){var t=new Kz,n=e.getUint32(0,!1);if(Kz.RIFF==n&&(e.getUint32(4,!0),Kz.WAVE==e.getUint32(8,!1)&&Kz.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),i=20;switch(r){case 16:case 18:t.channels=e.getUint16(i+2,!0),t.sampleRate=e.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var a=Kz.data,s=0;a!=n&&(n=e.getUint32(i,!1),s=e.getUint32(i+4,!0),a!=n);)i+=s+8;return t.dataLen=s,t.dataOffset=i+8,t}};var Wz=function(e,t,n){3!=arguments.length&&(e=1,t=44100,n=128);var r=new Rz,i=new jz,a=new kz,s=new Bz,o=new Dz,l=new Lz,u=new xz,c=new Gz,d=new Hz,h=new zz,f=new Pz,p=new Uz,_=new Vz,m=new qz;r.setModules(a,s,o,l,u,c,d,h,m),s.setModules(a,m,d,c),h.setModules(s,d),o.setModules(r),u.setModules(s,f,l,p),l.setModules(p,f,r.enc.psy),f.setModules(s),p.setModules(l),c.setModules(r,s,d),i.setModules(_,m),_.setModules(d,h,o);var v=r.lame_init();v.num_channels=e,v.in_samplerate=t,v.brate=n,v.mode=Fz.STEREO,v.quality=3,v.bWriteVbrTag=!1,v.disable_reservoir=!0,v.write_id3tag_automatic=!1,r.lame_init_params(v);var g=1152,E=0|1.25*g+7200,b=Mz(E);this.encodeBuffer=function(t,n){1==e&&(n=t),Oz(t.length==n.length),t.length>g&&(g=t.length,b=Mz(E=0|1.25*g+7200));var i=r.lame_encode_buffer(v,t,n,t.length,b,0,E);return new Int8Array(b.subarray(0,i))},this.flush=function(){var e=r.lame_encode_flush(v,b,0,E);return new Int8Array(b.subarray(0,e))}},Qz=Kz;const Xz=Object.freeze(Object.defineProperty({__proto__:null,downsampleToWav:function(e,t){var n=new AudioContext({sampleRate:11025}),r=new FileReader;r.onload=function(r){var i;n.decodeAudioData(null===(i=r.target)||void 0===i?void 0:i.result,(function(n){var r=!window.OfflineAudioContext,i=new OfflineAudioContext(1,16e3*n.duration,16e3),a=i.createBufferSource();a.buffer=n,a.connect(i.destination);var s=new FileReader;s.onload=function(){var e=function(e){var n=r?e.renderedBuffer:e,i=function(e,t){var n,r=e.numberOfChannels,i=t*r*2+44,a=new ArrayBuffer(i),s=new DataView(a),o=[],l=0,u=0,c=0;for(h(1179011410),h(i-8),h(1163280727),h(544501094),h(16),d(1),d(r),h(e.sampleRate),h(2*e.sampleRate*r),d(2*r),d(16),h(1635017060),h(i-c-4),l=0;l<e.numberOfChannels;l++)o.push(e.getChannelData(l));for(;c<i;){for(l=0;l<r;l++)n=0|(.5+(n=Math.max(-1,Math.min(1,o[l][u])))<0?32768*n:32767*n),s.setInt16(c,n,!0),c+=2;u++}return a;function d(e){s.setUint16(c,e,!0),c+=2}function h(e){s.setUint32(c,e,!0),c+=4}}(n,n.length);t&&t(i)};r?(i.oncomplete=e,i.startRendering()):i.startRendering().then(e).catch((function(e){}))},s.readAsArrayBuffer(e),a.start(0)}))},r.readAsArrayBuffer(e)},encodeMp3:function(e){var t=Qz.readHeader(new DataView(e)),n=new Int16Array(e,t.dataOffset,t.dataLen/2),r=new Wz(t.channels,t.sampleRate,128),i=1152,a=1===t.channels?n:new Int16Array(t.dataLen/(2*t.channels)),s=2===t.channels?new Int16Array(t.dataLen/(2*t.channels)):void 0;if(t.channels>1)for(var o=0;o<a.length;o++)a[o]=n[2*o],s&&(s[o]=n[2*o+1]);for(var l=[],u=a.length,c=0;u>=i;c+=i){var d=a.subarray(c,c+i),h=void 0;s&&(h=s.subarray(c,c+i));var f=r.encodeBuffer(d,h);l.push(new Int8Array(f)),u-=i}var p=r.flush();return l.push(new Int8Array(p)),l}},Symbol.toStringTag,{value:"Module"}));e.CareAiChat=ZG,e.CareAiContainer=({appId:e})=>{const[n,r]=t.useState(!1),[i,a]=t.useState(!0);return t.useEffect((()=>{}),[]),i?f.jsx(kj,{setIsModalOpen:r,setShowLoginModal:a}):f.jsx(ZG,{showChatHistory:!1,setShowChatHistory:()=>{},appId:e})},e.LoginModal=kj,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=index.umd.js.map
